<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions</title>
<!--Generated on Mon Aug 18 12:37:23 2025 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<!--Document created on August 18, 2025.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdn.jsdelivr.net/gh/arXiv/arxiv-browse@master/arxiv/browse/static/css/ar5iv.0.8.2.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdn.jsdelivr.net/gh/arXiv/arxiv-browse@master/arxiv/browse/static/css/ar5iv-fonts.0.8.2.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdn.jsdelivr.net/gh/arXiv/arxiv-browse@master/arxiv/browse/static/css/latexml_styles.0.8.2.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<link href="book.css" rel="stylesheet" type="text/css"/><script defer="defer" src="shared-ui.js"></script><script defer="defer" src="book.js"></script></head>
<body id="top">
<nav class="ltx_page_navbar"><a class="ltx_ref" href="book-main.html" rel="start" title=""><span class="ltx_text ltx_ref_title">Learning Deep Representations of Data Distributions</span></a>
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_chapter"><a class="ltx_ref" href="Chx1.html" title="In Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title">Preface</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a class="ltx_ref" href="Chx2.html" title="In Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title">Declaration of Open Source</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a class="ltx_ref" href="Chx3.html" title="In Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title">Acknowledgment</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a class="ltx_ref" href="Ch1.html" title="In Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a class="ltx_ref" href="Ch2.html" title="In Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Learning Linear and Independent Structures</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a class="ltx_ref" href="Ch3.html" title="In Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Pursuing Low-Dimensional Distributions via Lossy Compression</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a class="ltx_ref" href="Ch4.html" title="In Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Deep Representations from Unrolled Optimization</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a class="ltx_ref" href="Ch5.html" title="In Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Consistent and Self-Consistent Representations</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a class="ltx_ref" href="Ch6.html" title="In Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Inference with Low-Dimensional Distributions</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a class="ltx_ref" href="Ch7.html" title="In Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7 </span>Learning Representations for Real-World Data</span></a></li>
<li class="ltx_tocentry ltx_tocentry_chapter"><a class="ltx_ref" href="Ch8.html" title="In Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">8 </span>Future Study of Intelligence</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix ltx_ref_self">
<span class="ltx_ref ltx_ref_self"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Optimization Methods</span></span>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="#S1" title="In Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.1 </span>Steepest Descent</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="#S1.SS1" title="In A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.1.1 </span>Vanilla Gradient Descent for Smooth Problems</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#S1.SS1.SSSx1" title="In A.1.1 Vanilla Gradient Descent for Smooth Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title">Step-Size Selection</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="#S1.SS2" title="In A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.1.2 </span>Preconditioned Gradient Descent for Badly-Conditioned Problems</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#S1.SS2.SSSx1" title="In A.1.2 Preconditioned Gradient Descent for Badly-Conditioned Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title">Newton’s Method</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#S1.SS2.SSSx2" title="In A.1.2 Preconditioned Gradient Descent for Badly-Conditioned Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title">PGD</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#S1.SS3" title="In A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.1.3 </span>Proximal Gradient Descent for Non-Smooth Problems</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#S1.SS4" title="In A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.1.4 </span>Stochastic Gradient Descent for Large-Scale Problems</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#S1.SS5" title="In A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.1.5 </span>Putting Everything Together: Adam</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="#S2" title="In Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.2 </span>Computing Gradients via Automatic Differentiation</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#S2.SS1" title="In A.2 Computing Gradients via Automatic Differentiation ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.2.1 </span>Differentials</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#S2.SS2" title="In A.2 Computing Gradients via Automatic Differentiation ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.2.2 </span>Automatic Differentiation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#S2.SS3" title="In A.2 Computing Gradients via Automatic Differentiation ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.2.3 </span>Back Propagation</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="#S3" title="In Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.3 </span>Game Theory and Minimax Optimization</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="#S3.SS1" title="In A.3 Game Theory and Minimax Optimization ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.3.1 </span>Learning Stackelberg Equilibria</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#S3.SS1.SSSx1" title="In A.3.1 Learning Stackelberg Equilibria ‣ A.3 Game Theory and Minimax Optimization ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title">Convergence of One-Timescale GDA to Stackelberg Equilibrium</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="#S3.SS1.SSSx2" title="In A.3.1 Learning Stackelberg Equilibria ‣ A.3 Game Theory and Minimax Optimization ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title">Local Convergence of Two-Timescale GDA to Stackelberg Equilibrium</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="#S3.SS2" title="In A.3 Game Theory and Minimax Optimization ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.3.2 </span>Practical Considerations when Learning Stackelberg Equilibria</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="#S4" title="In Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.4 </span>Exercises</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="A2.html" title="In Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B </span>Entropy, Diffusion, Denoising, and Lossy Coding</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<header class="ltx_page_header">
</header>
<div class="ltx_page_content">
<section class="ltx_appendix ltx_authors_1line">
<h1 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Optimization Methods</h1><div class="mini-toc"><div class="mini-toc-title">In this section</div><ul><li><a href="#S1">Steepest Descent</a><div class="mini-toc-sub"><a href="#S1.SS1">Vanilla Gradient Descent for Smooth Problems</a><a href="#S1.SS2">Preconditioned Gradient Descent for Badly-Conditioned Problems</a><a href="#S1.SS3">Proximal Gradient Descent for Non-Smooth Problems</a><a href="#S1.SS4">Stochastic Gradient Descent for Large-Scale Problems</a><a href="#S1.SS5">Putting Everything Together: Adam</a></div></li><li><a href="#S2">Computing Gradients via Automatic Differentiation</a><div class="mini-toc-sub"><a href="#S2.SS1">Differentials</a><a href="#S2.SS2">Automatic Differentiation</a><a href="#S2.SS3">Back Propagation</a></div></li><li><a href="#S3">Game Theory and Minimax Optimization</a><div class="mini-toc-sub"><a href="#S3.SS1">Learning Stackelberg Equilibria</a><a href="#S3.SS2">Practical Considerations when Learning Stackelberg Equilibria</a></div></li><li><a href="#S4">Exercises</a></li></ul></div>
<div class="ltx_para" id="p1">
<blockquote class="ltx_quote">
<p class="ltx_p">“<span class="ltx_text ltx_font_italic">Since the building of all the universe is perfect and is created by the wisdom creator, nothing arises in the universe in which one cannot see the sense of some maximum or minimum.</span>”</p>
<p class="ltx_p">  – L. Euler</p>
</blockquote>
</div>
<div class="ltx_para" id="p2">
<p class="ltx_p">In this chapter, we give a brief introduction to some of the most basic but important optimization algorithms used in this book. The purpose is only to help the reader apply these algorithms to problems studied in this book, not to gain a deep understanding about these algorithms. Hence, we will not provide a thorough justification for the algorithms introduced, in terms of performance guarantees.</p>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">A.1 </span>Steepest Descent</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p">Optimization is concerned with the question of how to find where a function, say <math alttext="L(\theta)" class="ltx_Math" display="inline" id="S1.p1.m1"><semantics><mrow><mi>L</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">L(\theta)</annotation><annotation encoding="application/x-llamapun">italic_L ( italic_θ )</annotation></semantics></math>, reaches its minimum value. Mathematically, this is stated as a problem:</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\operatorname*{arg\ min}_{\theta\in\Theta}\mathcal{L}(\theta)," class="ltx_Math" display="block" id="S1.E1.m1"><semantics><mrow><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\operatorname*{arg\ min}_{\theta\in\Theta}\mathcal{L}(\theta),</annotation><annotation encoding="application/x-llamapun">start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.1)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where <math alttext="\Theta" class="ltx_Math" display="inline" id="S1.p1.m2"><semantics><mi mathvariant="normal">Θ</mi><annotation encoding="application/x-tex">\Theta</annotation><annotation encoding="application/x-llamapun">roman_Θ</annotation></semantics></math> represents a domain to which the argument <math alttext="\bm{x}" class="ltx_Math" display="inline" id="S1.p1.m3"><semantics><mi>𝒙</mi><annotation encoding="application/x-tex">\bm{x}</annotation><annotation encoding="application/x-llamapun">bold_italic_x</annotation></semantics></math> is confined. Often (and unleess otherwise mentioned, in this chapter) <math alttext="\Theta" class="ltx_Math" display="inline" id="S1.p1.m4"><semantics><mi mathvariant="normal">Θ</mi><annotation encoding="application/x-tex">\Theta</annotation><annotation encoding="application/x-llamapun">roman_Θ</annotation></semantics></math> is simply <math alttext="\mathbb{R}^{n}" class="ltx_Math" display="inline" id="S1.p1.m5"><semantics><msup><mi>ℝ</mi><mi>n</mi></msup><annotation encoding="application/x-tex">\mathbb{R}^{n}</annotation><annotation encoding="application/x-llamapun">blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT</annotation></semantics></math>. Without loss of generality, we assume that here the function <math alttext="\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S1.p1.m6"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ )</annotation></semantics></math> is smooth<span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span>In case the function <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="footnote1.m1"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> is not smooth, we replace its gradient with a so-called <span class="ltx_text ltx_font_italic">subgradient</span>.</span></span></span>.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p">The efficiency of finding the (global) minima depends on what information we have about the function <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.p2.m1"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>. For most optimization problems considered in this book, the dimension of <math alttext="\theta" class="ltx_Math" display="inline" id="S1.p2.m2"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>, say <math alttext="n" class="ltx_Math" display="inline" id="S1.p2.m3"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation><annotation encoding="application/x-llamapun">italic_n</annotation></semantics></math>, is very large. That makes computing or accessing local information about <math alttext="\ell" class="ltx_Math" display="inline" id="S1.p2.m4"><semantics><mi mathvariant="normal">ℓ</mi><annotation encoding="application/x-tex">\ell</annotation><annotation encoding="application/x-llamapun">roman_ℓ</annotation></semantics></math> expensive. In particular, since the gradient <math alttext="\nabla\mathcal{L}" class="ltx_Math" display="inline" id="S1.p2.m5"><semantics><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ caligraphic_L</annotation></semantics></math> has <math alttext="n" class="ltx_Math" display="inline" id="S1.p2.m6"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation><annotation encoding="application/x-llamapun">italic_n</annotation></semantics></math> entries, it is often reasonable to compute; however, the Hessian <math alttext="\nabla^{2}\mathcal{L}" class="ltx_Math" display="inline" id="S1.p2.m7"><semantics><mrow><msup><mo>∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla^{2}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L</annotation></semantics></math> has <math alttext="n^{2}" class="ltx_Math" display="inline" id="S1.p2.m8"><semantics><msup><mi>n</mi><mn>2</mn></msup><annotation encoding="application/x-tex">n^{2}</annotation><annotation encoding="application/x-llamapun">italic_n start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math> entries which is often wildly impractical to compute (and the same goes for higher-order derivatives). Hence, it is typical to assume that we have the zeroth-order information, i.e., we are able to evaluate <math alttext="\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S1.p2.m9"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ )</annotation></semantics></math>, and the first-order information, i.e., we are able to evaluate <math alttext="\nabla\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S1.p2.m10"><semantics><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">∇ caligraphic_L ( italic_θ )</annotation></semantics></math>. Optimization theorists may rephrase this as saying we have a “first-order <span class="ltx_text ltx_font_italic">oracle</span>.” All optimization algorithms that we introduce in this section only use a first-order oracle.<span class="ltx_note ltx_role_footnote" id="footnote2"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_tag ltx_tag_note">2</span>We refer the readers to the book by <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx295" title="">WM22</a>]</cite> for a more systematic introduction to optimization algorithms in a high-dimensional space, including algorithms assuming higher-order oracles.</span></span></span></p>
</div>
<section class="ltx_subsection" id="S1.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.1.1 </span>Vanilla Gradient Descent for Smooth Problems</h3>
<div class="ltx_para" id="S1.SS1.p1">
<p class="ltx_p">The simplest and most widely used method for optimization is <span class="ltx_text ltx_font_italic">gradient descent</span> (GD). It was first introduced by Cauchy in 1847. The idea is very simple: starting from an initial state, we iteratively take small steps such that each step reduces the value of the function <math alttext="\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S1.SS1.p1.m1"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ )</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S1.SS1.p2">
<p class="ltx_p">Suppose that the current state is <math alttext="\theta" class="ltx_Math" display="inline" id="S1.SS1.p2.m1"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>. We want to take a small step, say of distance <math alttext="h" class="ltx_Math" display="inline" id="S1.SS1.p2.m2"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math>, in a direction, indicated by a vector <math alttext="\bm{v}" class="ltx_Math" display="inline" id="S1.SS1.p2.m3"><semantics><mi>𝒗</mi><annotation encoding="application/x-tex">\bm{v}</annotation><annotation encoding="application/x-llamapun">bold_italic_v</annotation></semantics></math>, to reach a new state <math alttext="\theta+h\bm{v}" class="ltx_Math" display="inline" id="S1.SS1.p2.m4"><semantics><mrow><mi>θ</mi><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒗</mi></mrow></mrow><annotation encoding="application/x-tex">\theta+h\bm{v}</annotation><annotation encoding="application/x-llamapun">italic_θ + italic_h bold_italic_v</annotation></semantics></math> such that the value of the function decreases:</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta+h\bm{v})\leq\mathcal{L}(\theta)." class="ltx_Math" display="block" id="S1.E2.m1"><semantics><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>θ</mi><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒗</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta+h\bm{v})\leq\mathcal{L}(\theta).</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ + italic_h bold_italic_v ) ≤ caligraphic_L ( italic_θ ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">To find such a direction <math alttext="\bm{v}" class="ltx_Math" display="inline" id="S1.SS1.p2.m5"><semantics><mi>𝒗</mi><annotation encoding="application/x-tex">\bm{v}</annotation><annotation encoding="application/x-llamapun">bold_italic_v</annotation></semantics></math>, we can approximate <math alttext="\mathcal{L}(\theta+h\bm{v})" class="ltx_Math" display="inline" id="S1.SS1.p2.m6"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>θ</mi><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒗</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta+h\bm{v})</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ + italic_h bold_italic_v )</annotation></semantics></math> through a Taylor expansion around <math alttext="h=0" class="ltx_Math" display="inline" id="S1.SS1.p2.m7"><semantics><mrow><mi>h</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">h=0</annotation><annotation encoding="application/x-llamapun">italic_h = 0</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta+h\bm{v})=\mathcal{L}(\theta)+h\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle+o(h)," class="ltx_Math" display="block" id="S1.E3.m1"><semantics><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>θ</mi><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒗</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow></mrow><mo>+</mo><mrow><mi>o</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta+h\bm{v})=\mathcal{L}(\theta)+h\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle+o(h),</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ + italic_h bold_italic_v ) = caligraphic_L ( italic_θ ) + italic_h ⟨ ∇ caligraphic_L ( italic_θ ) , bold_italic_v ⟩ + italic_o ( italic_h ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where the inner product here (and in this chapter) will be the <math alttext="\ell^{2}" class="ltx_Math" display="inline" id="S1.SS1.p2.m8"><semantics><msup><mi mathvariant="normal">ℓ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\ell^{2}</annotation><annotation encoding="application/x-llamapun">roman_ℓ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math> inner product, i.e., <math alttext="\langle\bm{x},\bm{y}\rangle=\bm{x}^{\top}\bm{y}" class="ltx_Math" display="inline" id="S1.SS1.p2.m9"><semantics><mrow><mrow><mo stretchy="false">⟨</mo><mi>𝒙</mi><mo>,</mo><mi>𝒚</mi><mo stretchy="false">⟩</mo></mrow><mo>=</mo><mrow><msup><mi>𝒙</mi><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><mi>𝒚</mi></mrow></mrow><annotation encoding="application/x-tex">\langle\bm{x},\bm{y}\rangle=\bm{x}^{\top}\bm{y}</annotation><annotation encoding="application/x-llamapun">⟨ bold_italic_x , bold_italic_y ⟩ = bold_italic_x start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT bold_italic_y</annotation></semantics></math>. To find the direction of <span class="ltx_text ltx_font_italic">steepest descent</span>, we attempt to minimize this Taylor expansion among unit vectors <math alttext="\bm{v}" class="ltx_Math" display="inline" id="S1.SS1.p2.m10"><semantics><mi>𝒗</mi><annotation encoding="application/x-tex">\bm{v}</annotation><annotation encoding="application/x-llamapun">bold_italic_v</annotation></semantics></math>. If <math alttext="\nabla\mathcal{L}(\theta)=\bm{0}" class="ltx_Math" display="inline" id="S1.SS1.p2.m11"><semantics><mrow><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mn>𝟎</mn></mrow><annotation encoding="application/x-tex">\nabla\mathcal{L}(\theta)=\bm{0}</annotation><annotation encoding="application/x-llamapun">∇ caligraphic_L ( italic_θ ) = bold_0</annotation></semantics></math>, then the second term above is <math alttext="0" class="ltx_Math" display="inline" id="S1.SS1.p2.m12"><mn>0</mn></math> regardless of the value of <math alttext="\bm{v}" class="ltx_Math" display="inline" id="S1.SS1.p2.m13"><semantics><mi>𝒗</mi><annotation encoding="application/x-tex">\bm{v}</annotation><annotation encoding="application/x-llamapun">bold_italic_v</annotation></semantics></math>, so we cannot attempt to make progress, i.e., the algorithm has converged. On the other hand, if <math alttext="\nabla\mathcal{L}(\theta)\neq\bm{0}" class="ltx_Math" display="inline" id="S1.SS1.p2.m14"><semantics><mrow><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≠</mo><mn>𝟎</mn></mrow><annotation encoding="application/x-tex">\nabla\mathcal{L}(\theta)\neq\bm{0}</annotation><annotation encoding="application/x-llamapun">∇ caligraphic_L ( italic_θ ) ≠ bold_0</annotation></semantics></math> then it holds</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{d}\\
\|\bm{v}\|_{2}=1\end{subarray}}[\mathcal{L}(\theta)+h\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle]=\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{d}\\
\|\bm{v}\|_{2}=1\end{subarray}}\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle=-\frac{\nabla\mathcal{L}(\theta)}{\|\nabla\mathcal{L}(\theta)\|_{2}}," class="ltx_Math" display="block" id="S1.E4.m1"><semantics><mrow><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mtable rowspacing="0pt"><mtr><mtd><mrow><mi>𝒗</mi><mo>∈</mo><msup><mi>ℝ</mi><mi>d</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mo stretchy="false">‖</mo><mi>𝒗</mi><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><mo>=</mo><mn>1</mn></mrow></mtd></mtr></mtable></munder><mo>⁡</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mtable rowspacing="0pt"><mtr><mtd><mrow><mi>𝒗</mi><mo>∈</mo><msup><mi>ℝ</mi><mi>d</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mo stretchy="false">‖</mo><mi>𝒗</mi><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><mo>=</mo><mn>1</mn></mrow></mtd></mtr></mtable></munder><mo>⁡</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow></mrow><mo>=</mo><mrow><mo>−</mo><mfrac><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><msub><mrow><mo stretchy="false">‖</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub></mfrac></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{d}\\
\|\bm{v}\|_{2}=1\end{subarray}}[\mathcal{L}(\theta)+h\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle]=\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{d}\\
\|\bm{v}\|_{2}=1\end{subarray}}\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle=-\frac{\nabla\mathcal{L}(\theta)}{\|\nabla\mathcal{L}(\theta)\|_{2}},</annotation><annotation encoding="application/x-llamapun">start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT start_ARG start_ROW start_CELL bold_italic_v ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT end_CELL end_ROW start_ROW start_CELL ∥ bold_italic_v ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT = 1 end_CELL end_ROW end_ARG end_POSTSUBSCRIPT [ caligraphic_L ( italic_θ ) + italic_h ⟨ ∇ caligraphic_L ( italic_θ ) , bold_italic_v ⟩ ] = start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT start_ARG start_ROW start_CELL bold_italic_v ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT end_CELL end_ROW start_ROW start_CELL ∥ bold_italic_v ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT = 1 end_CELL end_ROW end_ARG end_POSTSUBSCRIPT ⟨ ∇ caligraphic_L ( italic_θ ) , bold_italic_v ⟩ = - divide start_ARG ∇ caligraphic_L ( italic_θ ) end_ARG start_ARG ∥ ∇ caligraphic_L ( italic_θ ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT end_ARG ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">In words, this means that the value of <math alttext="\mathcal{L}(\theta+h\bm{v})" class="ltx_Math" display="inline" id="S1.SS1.p2.m15"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>θ</mi><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒗</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta+h\bm{v})</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ + italic_h bold_italic_v )</annotation></semantics></math> decreases the fastest along the direction <math alttext="\bm{v}=-\nabla\mathcal{L}(\theta)/\|\nabla\mathcal{L}(\theta)\|_{2}" class="ltx_Math" display="inline" id="S1.SS1.p2.m16"><semantics><mrow><mi>𝒗</mi><mo>=</mo><mrow><mo rspace="0.167em">−</mo><mrow><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>/</mo><msub><mrow><mo stretchy="false">‖</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub></mrow></mrow></mrow><annotation encoding="application/x-tex">\bm{v}=-\nabla\mathcal{L}(\theta)/\|\nabla\mathcal{L}(\theta)\|_{2}</annotation><annotation encoding="application/x-llamapun">bold_italic_v = - ∇ caligraphic_L ( italic_θ ) / ∥ ∇ caligraphic_L ( italic_θ ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>, for small enough <math alttext="h" class="ltx_Math" display="inline" id="S1.SS1.p2.m17"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math>. This leads to the gradient descent method: From the current state <math alttext="\theta_{k}" class="ltx_Math" display="inline" id="S1.SS1.p2.m18"><semantics><msub><mi>θ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\theta_{k}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> (<math alttext="k=0,1,\ldots" class="ltx_Math" display="inline" id="S1.SS1.p2.m19"><semantics><mrow><mi>k</mi><mo>=</mo><mrow><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mi mathvariant="normal">…</mi></mrow></mrow><annotation encoding="application/x-tex">k=0,1,\ldots</annotation><annotation encoding="application/x-llamapun">italic_k = 0 , 1 , …</annotation></semantics></math>), we take a step of size <math alttext="h" class="ltx_Math" display="inline" id="S1.SS1.p2.m20"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math> in the direction of the negative gradient to reach the next iterate,</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta_{k+1}=\theta_{k}-h\nabla\mathcal{L}(\theta_{k})." class="ltx_Math" display="block" id="S1.E5.m1"><semantics><mrow><mrow><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\theta_{k+1}=\theta_{k}-h\nabla\mathcal{L}(\theta_{k}).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_h ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">The step size <math alttext="h" class="ltx_Math" display="inline" id="S1.SS1.p2.m21"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math> is also called the <span class="ltx_text ltx_font_italic">learning rate</span> in machine learning contexts.</p>
</div>
<section class="ltx_subsubsection" id="S1.SS1.SSSx1">
<h4 class="ltx_title ltx_title_subsubsection">Step-Size Selection</h4>
<div class="ltx_para" id="S1.SS1.SSSx1.p1">
<p class="ltx_p">The remaining question is what the step size <math alttext="h" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p1.m1"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math> should be? If we choose <math alttext="h" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p1.m2"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math> to be too small, the value of the function may decrease very slowly, as shown by the plot in the middle in <a class="ltx_ref" href="#F1" title="In Step-Size Selection ‣ A.1.1 Vanilla Gradient Descent for Smooth Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Figure</span> <span class="ltx_text ltx_ref_tag">A.1</span></a>. If <math alttext="h" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p1.m3"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math> is too large, the value might not even decrease at all, as shown by the plot on the right in <a class="ltx_ref" href="#F1" title="In Step-Size Selection ‣ A.1.1 Vanilla Gradient Descent for Smooth Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Figure</span> <span class="ltx_text ltx_ref_tag">A.1</span></a>.</p>
</div>
<figure class="ltx_figure" id="F1">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_3"><img alt="Figure A.1 : The effect of step size h h italic_h on the convergence of the gradient descent method." class="ltx_graphics ltx_figure_panel ltx_img_landscape" height="138" id="F1.g1" src="chapters/appendixA/figs/GD-1.png" width="174"/></div>
<div class="ltx_flex_cell ltx_flex_size_3"><img alt="Figure A.1 : The effect of step size h h italic_h on the convergence of the gradient descent method." class="ltx_graphics ltx_figure_panel ltx_img_landscape" height="138" id="F1.g2" src="chapters/appendixA/figs/GD-2.png" width="173"/></div>
<div class="ltx_flex_cell ltx_flex_size_3"><img alt="Figure A.1 : The effect of step size h h italic_h on the convergence of the gradient descent method." class="ltx_graphics ltx_figure_panel ltx_img_landscape" height="138" id="F1.g3" src="chapters/appendixA/figs/GD-3.png" width="176"/></div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" style="font-size:90%;">Figure A.1</span>: </span><span class="ltx_text" style="font-size:90%;">The effect of step size <math alttext="h" class="ltx_Math" display="inline" id="F1.m2"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math> on the convergence of the gradient descent method.</span></figcaption>
</figure>
<div class="ltx_para" id="S1.SS1.SSSx1.p2">
<p class="ltx_p">So the step size <math alttext="h" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p2.m1"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math> should be chosen based on the landscape of the function <math alttext="\mathcal{L}(\theta_{k})" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p2.m2"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta_{k})</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT )</annotation></semantics></math>. Ideally, to choose the best step size <math alttext="h" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p2.m3"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math>, we can solve the following optimization problem over a single variable <math alttext="h" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p2.m4"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="h=\operatorname*{arg\ min}_{h\geq 0}\mathcal{L}(\theta_{k}-h\nabla\mathcal{L}(\theta_{k}))." class="ltx_Math" display="block" id="S1.E6.m1"><semantics><mrow><mrow><mi>h</mi><mo>=</mo><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>h</mi><mo>≥</mo><mn>0</mn></mrow></munder><mo>⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">h=\operatorname*{arg\ min}_{h\geq 0}\mathcal{L}(\theta_{k}-h\nabla\mathcal{L}(\theta_{k})).</annotation><annotation encoding="application/x-llamapun">italic_h = start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_h ≥ 0 end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_h ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.6)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">This method of choosing the step size is called <span class="ltx_text ltx_font_italic">line search</span>. However, when the function <math alttext="L(\theta_{k})" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p2.m5"><semantics><mrow><mi>L</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">L(\theta_{k})</annotation><annotation encoding="application/x-llamapun">italic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT )</annotation></semantics></math> is complicated, which is usually the case for training a deep neural network, this one-dimensional optimization is very difficult to solve at each iteration of gradient descent.</p>
</div>
<div class="ltx_para" id="S1.SS1.SSSx1.p3">
<p class="ltx_p">Then how should we choose a proper step size <math alttext="h" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p3.m1"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math>? One common and classical approach is to try to obtain a good approximation of the local landscape around the current state <math alttext="\theta" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p3.m2"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> based on some knowledge about the overall landscape of the function <math alttext="\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p3.m3"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ )</annotation></semantics></math>.</p>
</div>
<figure class="ltx_figure" id="F2"><svg class="ltx_picture" height="218.49" id="F2.pic1" overflow="visible" version="1.1" width="266.27"><g fill="#000000" stroke="#000000" stroke-width="0.4pt" transform="translate(0,218.49) matrix(1 0 0 -1 0 0) translate(17.99,0) translate(0,17.99)"><path d="M -17.72 0 L 229.76 0" style="fill:none"></path><g stroke-dasharray="none" stroke-dashoffset="0.0pt" stroke-linecap="round" stroke-linejoin="round" transform="matrix(1.0 0.0 0.0 1.0 230.04 0)"><path d="M -2.88 3.32 C -2.35 1.33 -1.18 0.39 0 0 C -1.18 -0.39 -2.35 -1.33 -2.88 -3.32" style="fill:none"></path></g><g fill="#000000" stroke="#000000" transform="matrix(1.0 0.0 0.0 1.0 235.2 -4.8)"><foreignobject height="9.61" overflow="visible" transform="matrix(1 0 0 -1 0 16.6)" width="6.5"><math alttext="\theta" class="ltx_Math" display="inline" id="F2.pic1.m1"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math></foreignobject></g><path d="M 0 -17.72 L 0 176.61" style="fill:none"></path><g stroke-dasharray="none" stroke-dashoffset="0.0pt" stroke-linecap="round" stroke-linejoin="round" transform="matrix(0.0 1.0 -1.0 0.0 0 176.89)"><path d="M -2.88 3.32 C -2.35 1.33 -1.18 0.39 0 0 C -1.18 -0.39 -2.35 -1.33 -2.88 -3.32" style="fill:none"></path></g><g fill="#000000" stroke="#000000" transform="matrix(1.0 0.0 0.0 1.0 -12.95 185.51)"><foreignobject height="13.84" overflow="visible" transform="matrix(1 0 0 -1 0 16.6)" width="25.91"><math alttext="\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="F2.pic1.m2"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ )</annotation></semantics></math></foreignobject></g><g stroke-width="0.8pt"><g color="#0000FF" fill="#0000FF" stroke="#0000FF"><path d="M 0 141.73 C 0 141.73 21.67 123.71 35.43 113.38 C 49.2 103.06 57.1 88.58 70.87 88.58 C 84.63 88.58 92.53 120.27 106.3 113.38 C 120.06 106.5 127.97 60.03 141.73 53.15 C 155.5 46.27 163.4 67.63 177.16 77.95 C 190.93 88.28 212.6 106.3 212.6 106.3" style="fill:none"></path></g><g color="#0000FF" fill="#0000FF" stroke="#0000FF" transform="matrix(1.0 0.0 0.0 1.0 217.76 102.84)"><foreignobject height="13.84" overflow="visible" transform="matrix(1 0 0 -1 0 16.6)" width="25.91"><math alttext="\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="F2.pic1.m3"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ )</annotation></semantics></math></foreignobject></g></g><g color="#FF0000" fill="#FF0000" stroke="#FF0000" stroke-dasharray="3.0pt,3.0pt" stroke-dashoffset="0.0pt" stroke-width="0.8pt"><path d="M 0 159.45 C 0 159.45 25.6 140.93 35.43 131.1 C 45.27 121.27 61.03 88.58 70.87 88.58 C 80.7 88.58 96.47 133.56 106.3 131.1 C 116.13 128.64 131.9 73.32 141.73 70.87 C 151.56 68.41 167.33 103.55 177.16 113.38 C 187 123.22 212.6 141.73 212.6 141.73" style="fill:none"></path><g fill="#FF0000" stroke="#FF0000" transform="matrix(1.0 0.0 0.0 1.0 217.76 138.27)"><foreignobject height="13.84" overflow="visible" transform="matrix(1 0 0 -1 0 16.6)" width="25.18"><math alttext="u(\theta)" class="ltx_Math" display="inline" id="F2.pic1.m4"><semantics><mrow><mi>u</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">u(\theta)</annotation><annotation encoding="application/x-llamapun">italic_u ( italic_θ )</annotation></semantics></math></foreignobject></g></g><g color="#0000FF" fill="#0000FF" stroke="#0000FF"><path d="M 70.87 88.58 M 73.36 88.58 C 73.36 89.96 72.24 91.07 70.87 91.07 C 69.49 91.07 68.38 89.96 68.38 88.58 C 68.38 87.21 69.49 86.09 70.87 86.09 C 72.24 86.09 73.36 87.21 73.36 88.58 Z M 70.87 88.58"></path></g><g color="#0000FF" fill="#0000FF" stroke="#0000FF" transform="matrix(1.0 0.0 0.0 1.0 75.75 74.08)"><foreignobject height="12.11" overflow="visible" transform="matrix(1 0 0 -1 0 16.6)" width="10.37"><math alttext="\theta_{0}" class="ltx_Math" display="inline" id="F2.pic1.m5"><semantics><msub><mi>θ</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\theta_{0}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math></foreignobject></g><g color="#FF0000" fill="#FF0000" stroke="#FF0000"><path d="M 141.73 53.15 M 144.22 53.15 C 144.22 54.52 143.11 55.64 141.73 55.64 C 140.36 55.64 139.24 54.52 139.24 53.15 C 139.24 51.77 140.36 50.66 141.73 50.66 C 143.11 50.66 144.22 51.77 144.22 53.15 Z M 141.73 53.15"></path></g><g color="#FF0000" fill="#FF0000" stroke="#FF0000" transform="matrix(1.0 0.0 0.0 1.0 146.62 38.65)"><foreignobject height="12.11" overflow="visible" transform="matrix(1 0 0 -1 0 16.6)" width="10.37"><math alttext="\theta_{1}" class="ltx_Math" display="inline" id="F2.pic1.m6"><semantics><msub><mi>θ</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\theta_{1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math></foreignobject></g><g stroke-dasharray="3.0pt,3.0pt" stroke-dashoffset="0.0pt"><path d="M 70.87 0 L 70.87 88.58" style="fill:none"></path></g><g stroke-dasharray="3.0pt,3.0pt" stroke-dashoffset="0.0pt"><path d="M 141.73 0 L 141.73 70.87" style="fill:none"></path></g></g></svg>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" style="font-size:90%;">Figure A.2</span>: </span><span class="ltx_text ltx_font_bold" style="font-size:90%;">Majorization-minimization scheme and intuition.<span class="ltx_text ltx_font_medium"> A function <math alttext="\mathcal{L}\colon\Theta\to\mathbb{R}" class="ltx_Math" display="inline" id="F2.m9"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">→</mo><mi>ℝ</mi></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}\colon\Theta\to\mathbb{R}</annotation><annotation encoding="application/x-llamapun">caligraphic_L : roman_Θ → blackboard_R</annotation></semantics></math> has a global upper bound <math alttext="u\colon\Theta\to\mathbb{R}" class="ltx_Math" display="inline" id="F2.m10"><semantics><mrow><mi>u</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">→</mo><mi>ℝ</mi></mrow></mrow><annotation encoding="application/x-tex">u\colon\Theta\to\mathbb{R}</annotation><annotation encoding="application/x-llamapun">italic_u : roman_Θ → blackboard_R</annotation></semantics></math> which meets <math alttext="L" class="ltx_Math" display="inline" id="F2.m11"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation><annotation encoding="application/x-llamapun">italic_L</annotation></semantics></math> at at least one point <math alttext="\theta_{0}" class="ltx_Math" display="inline" id="F2.m12"><semantics><msub><mi>θ</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\theta_{0}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math>. Then, finding the <math alttext="\theta_{1}" class="ltx_Math" display="inline" id="F2.m13"><semantics><msub><mi>θ</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\theta_{1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> which minimizes <math alttext="u" class="ltx_Math" display="inline" id="F2.m14"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation><annotation encoding="application/x-llamapun">italic_u</annotation></semantics></math> will improve the value of <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="F2.m15"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> from <math alttext="\mathcal{L}(\theta_{0})" class="ltx_Math" display="inline" id="F2.m16"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta_{0})</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT )</annotation></semantics></math>. Note that similar results can be shown about local upper bounds.</span></span></figcaption>
</figure>
<div class="ltx_para" id="S1.SS1.SSSx1.p4">
<p class="ltx_p">Common conditions for the landscape of <math alttext="\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p4.m1"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ )</annotation></semantics></math> include:</p>
<ul class="ltx_itemize" id="S1.I1">
<li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i1.p1">
<p class="ltx_p"><math alttext="\alpha" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m1"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation><annotation encoding="application/x-llamapun">italic_α</annotation></semantics></math>-Strong Convexity. Recall that <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m2"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> is <math alttext="\alpha" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m3"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation><annotation encoding="application/x-llamapun">italic_α</annotation></semantics></math><span class="ltx_text ltx_font_italic">-strongly convex</span> if its graph lies above a global quadratic lower bound of slope <math alttext="\alpha" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m4"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation><annotation encoding="application/x-llamapun">italic_α</annotation></semantics></math>, i.e.,</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta)\geq l_{\theta_{0},\alpha}(\theta)\doteq\mathcal{L}(\theta_{0})+\langle\nabla\mathcal{L}(\theta_{0}),\theta-\theta_{0}\rangle+\frac{\alpha}{2}\|\theta-\theta_{0}\|_{2}^{2}" class="ltx_Math" display="block" id="S1.E7.m1"><semantics><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≥</mo><mrow><msub><mi>l</mi><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>,</mo><mi>α</mi></mrow></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mrow><mi>θ</mi><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><mo stretchy="false">⟩</mo></mrow><mo>+</mo><mrow><mfrac><mi>α</mi><mn>2</mn></mfrac><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><mi>θ</mi><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)\geq l_{\theta_{0},\alpha}(\theta)\doteq\mathcal{L}(\theta_{0})+\langle\nabla\mathcal{L}(\theta_{0}),\theta-\theta_{0}\rangle+\frac{\alpha}{2}\|\theta-\theta_{0}\|_{2}^{2}</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ ) ≥ italic_l start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_α end_POSTSUBSCRIPT ( italic_θ ) ≐ caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) + ⟨ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) , italic_θ - italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ⟩ + divide start_ARG italic_α end_ARG start_ARG 2 end_ARG ∥ italic_θ - italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.7)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">for any “base point” <math alttext="\theta_{0}" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m5"><semantics><msub><mi>θ</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\theta_{0}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math>. We say that <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m6"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> is <span class="ltx_text ltx_font_italic">convex</span> if it is <math alttext="0" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m7"><mn>0</mn></math>-strongly convex, i.e., its graph lies above its tangents. It is easy to show (proof as exercise) that strongly convex functions have unique global minima. Another important fact (proof as exercise) is that <math alttext="\alpha" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m8"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation><annotation encoding="application/x-llamapun">italic_α</annotation></semantics></math>-strongly convex twice-differentiable functions <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m9"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> have (symmetric) Hessians <math alttext="\nabla^{2}\mathcal{L}" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m10"><semantics><mrow><msup><mo>∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla^{2}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L</annotation></semantics></math> whose minimum eigenvalue is <math alttext="\geq\alpha" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m11"><semantics><mrow><mi></mi><mo>≥</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">\geq\alpha</annotation><annotation encoding="application/x-llamapun">≥ italic_α</annotation></semantics></math>. For <math alttext="\alpha&gt;0" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m12"><semantics><mrow><mi>α</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha&gt;0</annotation><annotation encoding="application/x-llamapun">italic_α &gt; 0</annotation></semantics></math> this implies the Hessian is symmetric positive definite, and for <math alttext="\alpha=0" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m13"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha=0</annotation><annotation encoding="application/x-llamapun">italic_α = 0</annotation></semantics></math> (i.e., <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.I1.i1.p1.m14"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> is convex) this implies that the Hessian is symmetric positive semidefinite.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i2.p1">
<p class="ltx_p"><math alttext="\beta" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m1"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation><annotation encoding="application/x-llamapun">italic_β</annotation></semantics></math>-Lipschitz Gradient (also called <math alttext="\beta" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m2"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation><annotation encoding="application/x-llamapun">italic_β</annotation></semantics></math>-Smoothness). Recall that <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m3"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> has <math alttext="\beta" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m4"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation><annotation encoding="application/x-llamapun">italic_β</annotation></semantics></math><span class="ltx_text ltx_font_italic">-Lipschitz gradient</span> if <math alttext="\nabla\mathcal{L}" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m5"><semantics><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ caligraphic_L</annotation></semantics></math> exists and is <math alttext="\beta" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m6"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation><annotation encoding="application/x-llamapun">italic_β</annotation></semantics></math>-Lipschitz, i.e.,</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\|\nabla\mathcal{L}(\theta)-\nabla\mathcal{L}(\theta_{0})\|_{2}\leq\beta\|\theta-\theta_{0}\|_{2}." class="ltx_Math" display="block" id="S1.E8.m1"><semantics><mrow><mrow><msub><mrow><mo stretchy="false">‖</mo><mrow><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><mo>≤</mo><mrow><mi>β</mi><mo lspace="0em" rspace="0em">​</mo><msub><mrow><mo stretchy="false">‖</mo><mrow><mi>θ</mi><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\|\nabla\mathcal{L}(\theta)-\nabla\mathcal{L}(\theta_{0})\|_{2}\leq\beta\|\theta-\theta_{0}\|_{2}.</annotation><annotation encoding="application/x-llamapun">∥ ∇ caligraphic_L ( italic_θ ) - ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ≤ italic_β ∥ italic_θ - italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.8)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">for any “base point” <math alttext="\theta_{0}" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m7"><semantics><msub><mi>θ</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\theta_{0}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math>. It is easy to show (proof as exercise) that this is equivalent to <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m8"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> having a global quadratic upper bound of slope <math alttext="\beta" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m9"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation><annotation encoding="application/x-llamapun">italic_β</annotation></semantics></math>, i.e.,</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E9">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta)\leq u_{\theta_{0},\beta}(\theta)\doteq\mathcal{L}(\theta_{0})+\langle\nabla\mathcal{L}(\theta_{0}),\theta-\theta_{0}\rangle+\frac{\beta}{2}\|\theta-\theta_{0}\|_{2}^{2}." class="ltx_Math" display="block" id="S1.E9.m1"><semantics><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><msub><mi>u</mi><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>,</mo><mi>β</mi></mrow></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mrow><mi>θ</mi><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><mo stretchy="false">⟩</mo></mrow><mo>+</mo><mrow><mfrac><mi>β</mi><mn>2</mn></mfrac><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><mi>θ</mi><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)\leq u_{\theta_{0},\beta}(\theta)\doteq\mathcal{L}(\theta_{0})+\langle\nabla\mathcal{L}(\theta_{0}),\theta-\theta_{0}\rangle+\frac{\beta}{2}\|\theta-\theta_{0}\|_{2}^{2}.</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ ) ≤ italic_u start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_β end_POSTSUBSCRIPT ( italic_θ ) ≐ caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) + ⟨ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) , italic_θ - italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ⟩ + divide start_ARG italic_β end_ARG start_ARG 2 end_ARG ∥ italic_θ - italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.9)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">for any “base point” <math alttext="\theta_{0}" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m10"><semantics><msub><mi>θ</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\theta_{0}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math>. Another important fact (proof as exercise) is that convex <math alttext="\beta" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m11"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation><annotation encoding="application/x-llamapun">italic_β</annotation></semantics></math>-Lipschitz gradient twice-differentiable functions have (symmetric) Hessians <math alttext="\nabla^{2}\mathcal{L}" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m12"><semantics><mrow><msup><mo>∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla^{2}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L</annotation></semantics></math> whose largest eigenvalue is <math alttext="\leq\beta" class="ltx_Math" display="inline" id="S1.I1.i2.p1.m13"><semantics><mrow><mi></mi><mo>≤</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\leq\beta</annotation><annotation encoding="application/x-llamapun">≤ italic_β</annotation></semantics></math>.</p>
</div>
</li>
</ul>
<p class="ltx_p">First, let us suppose that <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p4.m2"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> has <math alttext="\beta" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p4.m3"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation><annotation encoding="application/x-llamapun">italic_β</annotation></semantics></math>-Lipschitz gradient (but is not necessarily even convex). We will use this occasion to introduce a common optimization theme: <span class="ltx_text ltx_font_italic">to minimize <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p4.m4"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>, we can minimize an upper bound on <math alttext="L" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p4.m5"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation><annotation encoding="application/x-llamapun">italic_L</annotation></semantics></math></span>, which is justified by the following lemma visualized in <a class="ltx_ref" href="#F2" title="In Step-Size Selection ‣ A.1.1 Vanilla Gradient Descent for Smooth Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Figure</span> <span class="ltx_text ltx_ref_tag">A.2</span></a>.</p>
</div>
<div class="ltx_theorem ltx_theorem_lemma" id="Thmlemma1">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold">Lemma A.1</span></span><span class="ltx_text ltx_font_bold"> </span>(Majorization-Minimization)<span class="ltx_text ltx_font_bold">.</span>
</h6>
<div class="ltx_para" id="Thmlemma1.p1">
<p class="ltx_p"><span class="ltx_text ltx_font_italic">Suppose that <math alttext="u\colon\Theta\to\mathbb{R}" class="ltx_Math" display="inline" id="Thmlemma1.p1.m1"><semantics><mrow><mi>u</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">→</mo><mi>ℝ</mi></mrow></mrow><annotation encoding="application/x-tex">u\colon\Theta\to\mathbb{R}</annotation><annotation encoding="application/x-llamapun">italic_u : roman_Θ → blackboard_R</annotation></semantics></math> is a global upper bound on <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="Thmlemma1.p1.m2"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>, namely <math alttext="\mathcal{L}(\theta)\leq u(\theta)" class="ltx_Math" display="inline" id="Thmlemma1.p1.m3"><semantics><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mi>u</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)\leq u(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ ) ≤ italic_u ( italic_θ )</annotation></semantics></math> for all <math alttext="\theta\in\Theta" class="ltx_Math" display="inline" id="Thmlemma1.p1.m4"><semantics><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow><annotation encoding="application/x-tex">\theta\in\Theta</annotation><annotation encoding="application/x-llamapun">italic_θ ∈ roman_Θ</annotation></semantics></math>. Suppose that they meet with equality at <math alttext="\theta_{0}" class="ltx_Math" display="inline" id="Thmlemma1.p1.m5"><semantics><msub><mi>θ</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\theta_{0}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math>, i.e., <math alttext="\mathcal{L}(\theta_{0})=u(\theta_{0})" class="ltx_Math" display="inline" id="Thmlemma1.p1.m6"><semantics><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mi>u</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta_{0})=u(\theta_{0})</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) = italic_u ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT )</annotation></semantics></math>. Then</span></p>
<table class="ltx_equation ltx_eqn_table" id="S1.E10">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta_{1}\in\operatorname*{arg\ min}_{\theta\in\Theta}u(\theta)\implies\mathcal{L}(\theta_{1})\leq u(\theta_{1})\leq u(\theta_{0})=\mathcal{L}(\theta_{0})." class="ltx_Math" display="block" id="S1.E10.m1"><semantics><mrow><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>∈</mo><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo>⁡</mo><mi>u</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">⟹</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mi>u</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mi>u</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\theta_{1}\in\operatorname*{arg\ min}_{\theta\in\Theta}u(\theta)\implies\mathcal{L}(\theta_{1})\leq u(\theta_{1})\leq u(\theta_{0})=\mathcal{L}(\theta_{0}).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT italic_u ( italic_θ ) ⟹ caligraphic_L ( italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) ≤ italic_u ( italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) ≤ italic_u ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) = caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.10)</span></td>
</tr></tbody>
</table>
</div>
</div>
<div class="ltx_para" id="S1.SS1.SSSx1.p5">
<p class="ltx_p">We will use this lemma to show that we can use the Lipschitz gradient property to ensure that each gradient step cannot worsen the value of <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m1"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>. Indeed, at every base point <math alttext="\theta_{0}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m2"><semantics><msub><mi>θ</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\theta_{0}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math>, we have that <math alttext="u_{\theta_{0},\beta}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m3"><semantics><msub><mi>u</mi><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>,</mo><mi>β</mi></mrow></msub><annotation encoding="application/x-tex">u_{\theta_{0},\beta}</annotation><annotation encoding="application/x-llamapun">italic_u start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_β end_POSTSUBSCRIPT</annotation></semantics></math> is a global upper bound on <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m4"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>, and <math alttext="u_{\theta_{0},\beta}(\theta_{0})=\mathcal{L}(\theta_{0})" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m5"><semantics><mrow><mrow><msub><mi>u</mi><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>,</mo><mi>β</mi></mrow></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">u_{\theta_{0},\beta}(\theta_{0})=\mathcal{L}(\theta_{0})</annotation><annotation encoding="application/x-llamapun">italic_u start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_β end_POSTSUBSCRIPT ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) = caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT )</annotation></semantics></math>. Hence by <a class="ltx_ref" href="#Thmlemma1" title="Lemma A.1 (Majorization-Minimization). ‣ Step-Size Selection ‣ A.1.1 Vanilla Gradient Descent for Smooth Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Lemma</span> <span class="ltx_text ltx_ref_tag">A.1</span></a></p>
<table class="ltx_equation ltx_eqn_table" id="S1.E11">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\text{if $\theta$ minimizes $u_{\theta_{0},\beta}$ then}\quad\mathcal{L}(\theta)\leq u_{\theta_{0},\beta}(\theta)\leq u_{\theta_{0},\beta}(\theta_{0})=\mathcal{L}(\theta_{0})." class="ltx_Math" display="block" id="S1.E11.m1"><semantics><mrow><mrow><mrow><mrow><mtext>if </mtext><mi>θ</mi><mtext> minimizes </mtext><msub><mi>u</mi><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>,</mo><mi>β</mi></mrow></msub><mtext> then</mtext></mrow><mspace width="1em"></mspace><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>≤</mo><mrow><msub><mi>u</mi><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>,</mo><mi>β</mi></mrow></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><msub><mi>u</mi><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>,</mo><mi>β</mi></mrow></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\text{if $\theta$ minimizes $u_{\theta_{0},\beta}$ then}\quad\mathcal{L}(\theta)\leq u_{\theta_{0},\beta}(\theta)\leq u_{\theta_{0},\beta}(\theta_{0})=\mathcal{L}(\theta_{0}).</annotation><annotation encoding="application/x-llamapun">if italic_θ minimizes italic_u start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_β end_POSTSUBSCRIPT then caligraphic_L ( italic_θ ) ≤ italic_u start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_β end_POSTSUBSCRIPT ( italic_θ ) ≤ italic_u start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_β end_POSTSUBSCRIPT ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) = caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.11)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">This motivates us, when finding an update to obtain <math alttext="\theta_{k+1}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m6"><semantics><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\theta_{k+1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT</annotation></semantics></math> from <math alttext="\theta_{k}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m7"><semantics><msub><mi>θ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\theta_{k}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>, we can instead minimize the upper bound <math alttext="u_{\theta_{k},\beta}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m8"><semantics><msub><mi>u</mi><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><mi>β</mi></mrow></msub><annotation encoding="application/x-tex">u_{\theta_{k},\beta}</annotation><annotation encoding="application/x-llamapun">italic_u start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_β end_POSTSUBSCRIPT</annotation></semantics></math> over <math alttext="\theta" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m9"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> and set that to be <math alttext="\theta_{k+1}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m10"><semantics><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\theta_{k+1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT</annotation></semantics></math>. By minimizing <math alttext="u_{\theta_{k},\beta}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m11"><semantics><msub><mi>u</mi><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><mi>β</mi></mrow></msub><annotation encoding="application/x-tex">u_{\theta_{k},\beta}</annotation><annotation encoding="application/x-llamapun">italic_u start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_β end_POSTSUBSCRIPT</annotation></semantics></math> (proof as exercise) we get</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E12">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta_{k+1}=\theta_{k}-\frac{1}{\beta}\nabla\mathcal{L}(\theta_{k})\implies\mathcal{L}(\theta_{k+1})\leq\mathcal{L}(\theta_{k})." class="ltx_Math" display="block" id="S1.E12.m1"><semantics><mrow><mrow><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><mfrac><mn>1</mn><mi>β</mi></mfrac><mo lspace="0.167em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">⟹</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\theta_{k+1}=\theta_{k}-\frac{1}{\beta}\nabla\mathcal{L}(\theta_{k})\implies\mathcal{L}(\theta_{k+1})\leq\mathcal{L}(\theta_{k}).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - divide start_ARG 1 end_ARG start_ARG italic_β end_ARG ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ⟹ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT ) ≤ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.12)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">This implies that a step size <math alttext="h=1/\beta" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m12"><semantics><mrow><mi>h</mi><mo>=</mo><mrow><mn>1</mn><mo>/</mo><mi>β</mi></mrow></mrow><annotation encoding="application/x-tex">h=1/\beta</annotation><annotation encoding="application/x-llamapun">italic_h = 1 / italic_β</annotation></semantics></math> is a usable learning rate, but it does not provide a convergence rate or certify that <math alttext="L(\theta_{k})" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m13"><semantics><mrow><mi>L</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">L(\theta_{k})</annotation><annotation encoding="application/x-llamapun">italic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT )</annotation></semantics></math> actually converges to <math alttext="\min_{\theta}\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p5.m14"><semantics><mrow><mrow><msub><mi>min</mi><mi>θ</mi></msub><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\min_{\theta}\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">roman_min start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ )</annotation></semantics></math>. This requires a little more rigor, which we now pursue.</p>
</div>
<div class="ltx_para" id="S1.SS1.SSSx1.p6">
<p class="ltx_p">Now, let us suppose that <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m1"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> is <math alttext="\alpha" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m2"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation><annotation encoding="application/x-llamapun">italic_α</annotation></semantics></math>-strongly convex, has <math alttext="\beta" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m3"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation><annotation encoding="application/x-llamapun">italic_β</annotation></semantics></math>-Lipschitz gradient, and has global optimum <math alttext="\theta^{\star}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m4"><semantics><msup><mi>θ</mi><mo>⋆</mo></msup><annotation encoding="application/x-tex">\theta^{\star}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT</annotation></semantics></math>. We will show that <math alttext="\theta_{k}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m5"><semantics><msub><mi>θ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\theta_{k}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> will converge directly to the unique global optimum <math alttext="\theta^{\star}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m6"><semantics><msup><mi>θ</mi><mo>⋆</mo></msup><annotation encoding="application/x-tex">\theta^{\star}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT</annotation></semantics></math>, which is a very strong form of convergence. In particular, we will bound <math alttext="\|\theta^{\star}-\theta_{k}\|_{2}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m7"><semantics><msub><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mi>k</mi></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><annotation encoding="application/x-tex">\|\theta^{\star}-\theta_{k}\|_{2}</annotation><annotation encoding="application/x-llamapun">∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math> using both strong convexity and Lipschitzness of the gradient of <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m8"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>, i.e., taking a look at the neighborhood around <math alttext="\theta_{k}" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m9"><semantics><msub><mi>θ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\theta_{k}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>:<span class="ltx_note ltx_role_footnote" id="footnote3"><sup class="ltx_note_mark">3</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">3</sup><span class="ltx_tag ltx_tag_note">3</span>In this proof the <math alttext="\beta" class="ltx_Math" display="inline" id="footnote3.m1"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation><annotation encoding="application/x-llamapun">italic_β</annotation></semantics></math>-Lipschitz Gradient invocation step is a little non-trivial. We also leave this step as an exercise, with the hint to plug in <math alttext="\theta=\theta_{0}-h\nabla\mathcal{L}(\theta_{0})" class="ltx_Math" display="inline" id="footnote3.m2"><semantics><mrow><mi>θ</mi><mo>=</mo><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex">\theta=\theta_{0}-h\nabla\mathcal{L}(\theta_{0})</annotation><annotation encoding="application/x-llamapun">italic_θ = italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT - italic_h ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT )</annotation></semantics></math> into the Lipschitz gradient identity.</span></span></span></p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx100">
<tbody id="S1.E13"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\|\theta^{\star}-\theta_{k+1}\|_{2}^{2}" class="ltx_Math" display="inline" id="S1.E13.m1"><semantics><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup><annotation encoding="application/x-tex">\displaystyle\|\theta^{\star}-\theta_{k+1}\|_{2}^{2}</annotation><annotation encoding="application/x-llamapun">∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\leq\|\theta^{\star}-\theta_{k}+h\nabla\mathcal{L}(\theta_{k})\|_{2}^{2}" class="ltx_Math" display="inline" id="S1.E13.m2"><semantics><mrow><mi></mi><mo>≤</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mi>k</mi></msub></mrow><mo>+</mo><mrow><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\displaystyle\leq\|\theta^{\star}-\theta_{k}+h\nabla\mathcal{L}(\theta_{k})\|_{2}^{2}</annotation><annotation encoding="application/x-llamapun">≤ ∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT + italic_h ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.13)</span></td>
</tr></tbody>
<tbody id="S1.E14"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\|\theta^{\star}-\theta_{k}\|_{2}^{2}+2h\langle\nabla\mathcal{L}(\theta_{k}),\theta^{\star}-\theta_{k}\rangle+h^{2}\|\nabla\mathcal{L}(\theta_{k})\|_{2}^{2}" class="ltx_Math" display="inline" id="S1.E14.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mi>k</mi></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup><mo>+</mo><mrow><mn>2</mn><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mi>k</mi></msub></mrow><mo stretchy="false">⟩</mo></mrow></mrow><mo>+</mo><mrow><msup><mi>h</mi><mn>2</mn></msup><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\|\theta^{\star}-\theta_{k}\|_{2}^{2}+2h\langle\nabla\mathcal{L}(\theta_{k}),\theta^{\star}-\theta_{k}\rangle+h^{2}\|\nabla\mathcal{L}(\theta_{k})\|_{2}^{2}</annotation><annotation encoding="application/x-llamapun">= ∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + 2 italic_h ⟨ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) , italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ⟩ + italic_h start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ∥ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.14)</span></td>
</tr></tbody>
<tbody id="S1.E15"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\leq\|\theta^{\star}-\theta_{k}\|_{2}^{2}+2h\left(\mathcal{L}(\theta^{\star})-\mathcal{L}(\theta_{k})-\frac{\alpha}{2}\|\theta^{\star}-\theta_{k}\|_{2}^{2}\right)+h^{2}\|\nabla\mathcal{L}(\theta_{k})\|_{2}^{2}\quad\text{($\alpha$-SC)}" class="ltx_Math" display="inline" id="S1.E15.m1"><semantics><mrow><mi></mi><mo>≤</mo><mrow><mrow><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mi>k</mi></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup><mo>+</mo><mrow><mn>2</mn><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo>(</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mstyle displaystyle="true"><mfrac><mi>α</mi><mn>2</mn></mfrac></mstyle><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mi>k</mi></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow></mrow><mo>)</mo></mrow></mrow><mo>+</mo><mrow><msup><mi>h</mi><mn>2</mn></msup><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow></mrow><mspace width="1em"></mspace><mrow><mtext>(</mtext><mi>α</mi><mtext>-SC)</mtext></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\leq\|\theta^{\star}-\theta_{k}\|_{2}^{2}+2h\left(\mathcal{L}(\theta^{\star})-\mathcal{L}(\theta_{k})-\frac{\alpha}{2}\|\theta^{\star}-\theta_{k}\|_{2}^{2}\right)+h^{2}\|\nabla\mathcal{L}(\theta_{k})\|_{2}^{2}\quad\text{($\alpha$-SC)}</annotation><annotation encoding="application/x-llamapun">≤ ∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + 2 italic_h ( caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) - caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) - divide start_ARG italic_α end_ARG start_ARG 2 end_ARG ∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ) + italic_h start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ∥ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ( italic_α -SC)</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.15)</span></td>
</tr></tbody>
<tbody id="S1.E16"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left(1-\alpha h\right)\|\theta^{\star}-\theta_{k}\|_{2}^{2}+2h(\mathcal{L}(\theta^{\star})-L(\theta_{k}))+h^{2}\|\nabla\mathcal{L}(\theta_{k})\|_{2}^{2}" class="ltx_Math" display="inline" id="S1.E16.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mrow><mo>(</mo><mrow><mn>1</mn><mo>−</mo><mrow><mi>α</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mrow><mo>)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mi>k</mi></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo>+</mo><mrow><mn>2</mn><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi>L</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><msup><mi>h</mi><mn>2</mn></msup><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\left(1-\alpha h\right)\|\theta^{\star}-\theta_{k}\|_{2}^{2}+2h(\mathcal{L}(\theta^{\star})-L(\theta_{k}))+h^{2}\|\nabla\mathcal{L}(\theta_{k})\|_{2}^{2}</annotation><annotation encoding="application/x-llamapun">= ( 1 - italic_α italic_h ) ∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + 2 italic_h ( caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) - italic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ) + italic_h start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ∥ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.16)</span></td>
</tr></tbody>
<tbody id="S1.E17"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\leq\left(1-\alpha h\right)\|\theta^{\star}-\theta_{k}\|_{2}^{2}+2h(\mathcal{L}(\theta^{k})-\mathcal{L}(\theta^{\star}))+2h^{2}\beta(\mathcal{L}(\theta_{k})-\mathcal{L}(\theta^{\star}))\quad\text{($\beta$-LG)}" class="ltx_Math" display="inline" id="S1.E17.m1"><semantics><mrow><mi></mi><mo>≤</mo><mrow><mrow><mrow><mrow><mo>(</mo><mrow><mn>1</mn><mo>−</mo><mrow><mi>α</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mrow><mo>)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mi>k</mi></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo>+</mo><mrow><mn>2</mn><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mi>k</mi></msup><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mn>2</mn><mo lspace="0em" rspace="0em">​</mo><msup><mi>h</mi><mn>2</mn></msup><mo lspace="0em" rspace="0em">​</mo><mi>β</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><mspace width="1em"></mspace><mrow><mtext>(</mtext><mi>β</mi><mtext>-LG)</mtext></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\leq\left(1-\alpha h\right)\|\theta^{\star}-\theta_{k}\|_{2}^{2}+2h(\mathcal{L}(\theta^{k})-\mathcal{L}(\theta^{\star}))+2h^{2}\beta(\mathcal{L}(\theta_{k})-\mathcal{L}(\theta^{\star}))\quad\text{($\beta$-LG)}</annotation><annotation encoding="application/x-llamapun">≤ ( 1 - italic_α italic_h ) ∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + 2 italic_h ( caligraphic_L ( italic_θ start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT ) - caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ) + 2 italic_h start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT italic_β ( caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) - caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ) ( italic_β -LG)</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.17)</span></td>
</tr></tbody>
<tbody id="S1.E18"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left(1-\alpha h\right)\|\theta^{\star}-\theta_{k}\|_{2}^{2}-2h(1-\beta h)(\mathcal{L}(\theta_{k})-\mathcal{L}(\theta^{\star}))." class="ltx_Math" display="inline" id="S1.E18.m1"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><mrow><mrow><mo>(</mo><mrow><mn>1</mn><mo>−</mo><mrow><mi>α</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mrow><mo>)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mi>k</mi></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo>−</mo><mrow><mn>2</mn><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>−</mo><mrow><mi>β</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\left(1-\alpha h\right)\|\theta^{\star}-\theta_{k}\|_{2}^{2}-2h(1-\beta h)(\mathcal{L}(\theta_{k})-\mathcal{L}(\theta^{\star})).</annotation><annotation encoding="application/x-llamapun">= ( 1 - italic_α italic_h ) ∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT - 2 italic_h ( 1 - italic_β italic_h ) ( caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) - caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.18)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">In order to ensure that the gradient descent iteration makes progress we must pick the step size so that <math alttext="1-\beta h\geq 0" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m10"><semantics><mrow><mrow><mn>1</mn><mo>−</mo><mrow><mi>β</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mrow><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">1-\beta h\geq 0</annotation><annotation encoding="application/x-llamapun">1 - italic_β italic_h ≥ 0</annotation></semantics></math>, i.e., <math alttext="h\leq 1/\beta" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m11"><semantics><mrow><mi>h</mi><mo>≤</mo><mrow><mn>1</mn><mo>/</mo><mi>β</mi></mrow></mrow><annotation encoding="application/x-tex">h\leq 1/\beta</annotation><annotation encoding="application/x-llamapun">italic_h ≤ 1 / italic_β</annotation></semantics></math>. If such a setting occurs, then</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx101">
<tbody id="S1.E19"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\|\theta^{\star}-\theta_{k+1}\|_{2}^{2}" class="ltx_Math" display="inline" id="S1.E19.m1"><semantics><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup><annotation encoding="application/x-tex">\displaystyle\|\theta^{\star}-\theta_{k+1}\|_{2}^{2}</annotation><annotation encoding="application/x-llamapun">∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\leq(1-\alpha h)\|\theta^{\star}-\theta_{k}\|_{2}^{2}\leq(1-\alpha h)^{2}\|\theta^{\star}-\theta_{k-1}\|_{2}^{2}\leq\cdots" class="ltx_Math" display="inline" id="S1.E19.m2"><semantics><mrow><mi></mi><mo>≤</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>−</mo><mrow><mi>α</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mi>k</mi></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo>≤</mo><mrow><msup><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>−</mo><mrow><mi>α</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mrow><mo stretchy="false">)</mo></mrow><mn>2</mn></msup><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo>≤</mo><mi mathvariant="normal">⋯</mi></mrow><annotation encoding="application/x-tex">\displaystyle\leq(1-\alpha h)\|\theta^{\star}-\theta_{k}\|_{2}^{2}\leq(1-\alpha h)^{2}\|\theta^{\star}-\theta_{k-1}\|_{2}^{2}\leq\cdots</annotation><annotation encoding="application/x-llamapun">≤ ( 1 - italic_α italic_h ) ∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ≤ ( 1 - italic_α italic_h ) start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ≤ ⋯</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.19)</span></td>
</tr></tbody>
<tbody id="S1.E20"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\leq(1-\alpha h)^{k+1}\|\theta^{\star}-\theta_{0}\|_{2}^{2}." class="ltx_Math" display="inline" id="S1.E20.m1"><semantics><mrow><mrow><mi></mi><mo>≤</mo><mrow><msup><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>−</mo><mrow><mi>α</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mrow><mo stretchy="false">)</mo></mrow><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle\leq(1-\alpha h)^{k+1}\|\theta^{\star}-\theta_{0}\|_{2}^{2}.</annotation><annotation encoding="application/x-llamapun">≤ ( 1 - italic_α italic_h ) start_POSTSUPERSCRIPT italic_k + 1 end_POSTSUPERSCRIPT ∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.20)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">In order to minimize the right-hand side, we can set <math alttext="h=1/\beta" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m12"><semantics><mrow><mi>h</mi><mo>=</mo><mrow><mn>1</mn><mo>/</mo><mi>β</mi></mrow></mrow><annotation encoding="application/x-tex">h=1/\beta</annotation><annotation encoding="application/x-llamapun">italic_h = 1 / italic_β</annotation></semantics></math>, which obtains</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E21">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\|\theta^{\star}-\theta_{k+1}\|_{2}^{2}\leq(1-\alpha/\beta)^{k+1}\|\theta^{\star}-\theta_{0}\|_{2}^{2}," class="ltx_Math" display="block" id="S1.E21.m1"><semantics><mrow><mrow><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup><mo>≤</mo><mrow><msup><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>−</mo><mrow><mi>α</mi><mo>/</mo><mi>β</mi></mrow></mrow><mo stretchy="false">)</mo></mrow><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\|\theta^{\star}-\theta_{k+1}\|_{2}^{2}\leq(1-\alpha/\beta)^{k+1}\|\theta^{\star}-\theta_{0}\|_{2}^{2},</annotation><annotation encoding="application/x-llamapun">∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ≤ ( 1 - italic_α / italic_β ) start_POSTSUPERSCRIPT italic_k + 1 end_POSTSUPERSCRIPT ∥ italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT - italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.21)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">showing convergence to global optimum with exponentially decaying error. Notice that here we used a convergence rate to obtain a favorable <span class="ltx_text ltx_font_italic">step size</span> of <math alttext="h=1/\beta" class="ltx_Math" display="inline" id="S1.SS1.SSSx1.p6.m13"><semantics><mrow><mi>h</mi><mo>=</mo><mrow><mn>1</mn><mo>/</mo><mi>β</mi></mrow></mrow><annotation encoding="application/x-tex">h=1/\beta</annotation><annotation encoding="application/x-llamapun">italic_h = 1 / italic_β</annotation></semantics></math>. This motif will re-occur in this section.</p>
</div>
<div class="ltx_para" id="S1.SS1.SSSx1.p7">
<p class="ltx_p">We end this section with a caveat: learning a global optimum is (usually) impractically hard. Under certain conditions, we can ensure that the gradient descent iterates converge to a <span class="ltx_text ltx_font_italic">local optimum</span>. Also, under more relaxed conditions, we can ensure <span class="ltx_text ltx_font_italic">local</span> convergence, i.e., that the iterates converge to a (global or local) optimum if the sequence is initialized close enough to the optimum.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S1.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.1.2 </span>Preconditioned Gradient Descent for Badly-Conditioned Problems</h3>
<figure class="ltx_figure" id="F3"><img alt="Figure A.3 : The negative gradient − ∇ ℒ λ -\nabla\mathcal{L}_{\lambda} - ∇ caligraphic_L start_POSTSUBSCRIPT italic_λ end_POSTSUBSCRIPT and pre-conditioned (Newton’s method step) vector field − [ ∇ 2 ℒ λ ] − 1 ​ [ ∇ ℒ λ ] -[\nabla^{2}\mathcal{L}_{\lambda}]^{-1}[\nabla\mathcal{L}_{\lambda}] - [ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L start_POSTSUBSCRIPT italic_λ end_POSTSUBSCRIPT ] start_POSTSUPERSCRIPT - 1 end_POSTSUPERSCRIPT [ ∇ caligraphic_L start_POSTSUBSCRIPT italic_λ end_POSTSUBSCRIPT ] where λ = 19 \lambda=19 italic_λ = 19 . There is a section of the space where following the negative gradient vector field makes very little progress towards finding the minimum, but in all cases following the Newton’s method vector field achieves equal speed of progress towards the optimum since the gradient is whitened. Since the Hessian here is diagonal, adaptive learning rate algorithms (e.g. Adam, as will be discussed later in the section) can make similar progress as Newton’s method, but a non-axis-aligned Hessian may even prevent Adam from succeeding quickly." class="ltx_graphics ltx_img_landscape" height="200" id="F3.g1" src="chapters/appendixA/figs/hessian_geometry.png" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" style="font-size:90%;">Figure A.3</span>: </span><span class="ltx_text ltx_font_bold" style="font-size:90%;">The negative gradient <math alttext="-\nabla\mathcal{L}_{\lambda}" class="ltx_Math" display="inline" id="F3.m4"><semantics><mrow><mo rspace="0.167em">−</mo><mrow><mo rspace="0.167em">∇</mo><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>λ</mi></msub></mrow></mrow><annotation encoding="application/x-tex">-\nabla\mathcal{L}_{\lambda}</annotation><annotation encoding="application/x-llamapun">- ∇ caligraphic_L start_POSTSUBSCRIPT italic_λ end_POSTSUBSCRIPT</annotation></semantics></math> and pre-conditioned (Newton’s method step) vector field <math alttext="-[\nabla^{2}\mathcal{L}_{\lambda}]^{-1}[\nabla\mathcal{L}_{\lambda}]" class="ltx_Math" display="inline" id="F3.m5"><semantics><mrow><mo>−</mo><mrow><msup><mrow><mo stretchy="false">[</mo><mrow><msup><mo rspace="0.167em">∇</mo><mn>2</mn></msup><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>λ</mi></msub></mrow><mo stretchy="false">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mo rspace="0.167em">∇</mo><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>λ</mi></msub></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">-[\nabla^{2}\mathcal{L}_{\lambda}]^{-1}[\nabla\mathcal{L}_{\lambda}]</annotation><annotation encoding="application/x-llamapun">- [ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L start_POSTSUBSCRIPT italic_λ end_POSTSUBSCRIPT ] start_POSTSUPERSCRIPT - 1 end_POSTSUPERSCRIPT [ ∇ caligraphic_L start_POSTSUBSCRIPT italic_λ end_POSTSUBSCRIPT ]</annotation></semantics></math><span class="ltx_text ltx_font_medium"> where <math alttext="\lambda=19" class="ltx_Math" display="inline" id="F3.m6"><semantics><mrow><mi>λ</mi><mo>=</mo><mn>19</mn></mrow><annotation encoding="application/x-tex">\lambda=19</annotation><annotation encoding="application/x-llamapun">italic_λ = 19</annotation></semantics></math>. There is a section of the space where following the negative gradient vector field makes very little progress towards finding the minimum, but in all cases following the Newton’s method vector field achieves equal speed of progress towards the optimum since the gradient is whitened. Since the Hessian here is diagonal, adaptive learning rate algorithms (e.g. Adam, as will be discussed later in the section) can make similar progress as Newton’s method, but a non-axis-aligned Hessian may even prevent Adam from succeeding quickly.</span></span></figcaption>
</figure>
<section class="ltx_subsubsection" id="S1.SS2.SSSx1">
<h4 class="ltx_title ltx_title_subsubsection">Newton’s Method</h4>
<div class="ltx_para" id="S1.SS2.SSSx1.p1">
<p class="ltx_p">There are some smooth problems and strongly convex problems on which gradient descent nonetheless does quite poorly. For example, let <math alttext="\lambda\geq 0" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p1.m1"><semantics><mrow><mi>λ</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\lambda\geq 0</annotation><annotation encoding="application/x-llamapun">italic_λ ≥ 0</annotation></semantics></math> and let <math alttext="\mathcal{L}_{\lambda}\colon\mathbb{R}^{2}\to\mathbb{R}" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p1.m2"><semantics><mrow><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>λ</mi></msub><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><mn>2</mn></msup><mo stretchy="false">→</mo><mi>ℝ</mi></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}_{\lambda}\colon\mathbb{R}^{2}\to\mathbb{R}</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUBSCRIPT italic_λ end_POSTSUBSCRIPT : blackboard_R start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT → blackboard_R</annotation></semantics></math> of the form</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E22">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{\lambda}(\theta)=\mathcal{L}_{\lambda}\left(\begin{bmatrix}\theta_{1}\\
\theta_{2}\end{bmatrix}\right)\doteq\frac{1}{2}\left\{(1+\lambda)\theta_{1}^{2}+\theta_{2}^{2}\right\}=\frac{1}{2}\theta^{\top}\begin{bmatrix}1+\lambda&amp;0\\
0&amp;1\end{bmatrix}\theta." class="ltx_Math" display="block" id="S1.E22.m1"><semantics><mrow><mrow><mrow><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>λ</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>λ</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo>(</mo><mrow><mo>[</mo><mtable displaystyle="true" rowspacing="0pt"><mtr><mtd><msub><mi>θ</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd><msub><mi>θ</mi><mn>2</mn></msub></mtd></mtr></mtable><mo>]</mo></mrow><mo>)</mo></mrow></mrow><mo>≐</mo><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo lspace="0em" rspace="0em">​</mo><mrow><mo>{</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>+</mo><mi>λ</mi></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msubsup><mi>θ</mi><mn>1</mn><mn>2</mn></msubsup></mrow><mo>+</mo><msubsup><mi>θ</mi><mn>2</mn><mn>2</mn></msubsup></mrow><mo>}</mo></mrow></mrow><mo>=</mo><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo>[</mo><mtable columnspacing="5pt" displaystyle="true" rowspacing="0pt"><mtr><mtd><mrow><mn>1</mn><mo>+</mo><mi>λ</mi></mrow></mtd><mtd><mn>0</mn></mtd></mtr><mtr><mtd><mn>0</mn></mtd><mtd><mn>1</mn></mtd></mtr></mtable><mo>]</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}_{\lambda}(\theta)=\mathcal{L}_{\lambda}\left(\begin{bmatrix}\theta_{1}\\
\theta_{2}\end{bmatrix}\right)\doteq\frac{1}{2}\left\{(1+\lambda)\theta_{1}^{2}+\theta_{2}^{2}\right\}=\frac{1}{2}\theta^{\top}\begin{bmatrix}1+\lambda&amp;0\\
0&amp;1\end{bmatrix}\theta.</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUBSCRIPT italic_λ end_POSTSUBSCRIPT ( italic_θ ) = caligraphic_L start_POSTSUBSCRIPT italic_λ end_POSTSUBSCRIPT ( [ start_ARG start_ROW start_CELL italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_CELL end_ROW start_ROW start_CELL italic_θ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT end_CELL end_ROW end_ARG ] ) ≐ divide start_ARG 1 end_ARG start_ARG 2 end_ARG { ( 1 + italic_λ ) italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + italic_θ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT } = divide start_ARG 1 end_ARG start_ARG 2 end_ARG italic_θ start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT [ start_ARG start_ROW start_CELL 1 + italic_λ end_CELL start_CELL 0 end_CELL end_ROW start_ROW start_CELL 0 end_CELL start_CELL 1 end_CELL end_ROW end_ARG ] italic_θ .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.22)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">This problem is <math alttext="1" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p1.m3"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation><annotation encoding="application/x-llamapun">1</annotation></semantics></math>-strongly convex and has <math alttext="(1+\lambda)" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p1.m4"><semantics><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>+</mo><mi>λ</mi></mrow><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1+\lambda)</annotation><annotation encoding="application/x-llamapun">( 1 + italic_λ )</annotation></semantics></math>-Lipschitz gradient. The convergence rate is then geometric with rate <math alttext="1-1/(1+\lambda)" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p1.m5"><semantics><mrow><mn>1</mn><mo>−</mo><mrow><mn>1</mn><mo>/</mo><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>+</mo><mi>λ</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">1-1/(1+\lambda)</annotation><annotation encoding="application/x-llamapun">1 - 1 / ( 1 + italic_λ )</annotation></semantics></math>. For large <math alttext="\lambda" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p1.m6"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation><annotation encoding="application/x-llamapun">italic_λ</annotation></semantics></math>, this is still not very fast. In this section, we will introduce a class of optimization problems which can successfully optimize such badly-conditioned functions.</p>
</div>
<div class="ltx_para" id="S1.SS2.SSSx1.p2">
<p class="ltx_p">The key lies in the objective’s <span class="ltx_text ltx_font_italic">curvature</span>, which is given by the Hessian. Suppose that (as a counterfactual) we had a <span class="ltx_text ltx_font_italic">second-order</span> oracle which would allow us to compute <math alttext="\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p2.m1"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ )</annotation></semantics></math>, <math alttext="\nabla\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p2.m2"><semantics><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">∇ caligraphic_L ( italic_θ )</annotation></semantics></math>, and <math alttext="\nabla^{2}\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p2.m3"><semantics><mrow><mrow><msup><mo>∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla^{2}\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ )</annotation></semantics></math>. Then, instead of picking a descent direction <math alttext="\bm{v}" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p2.m4"><semantics><mi>𝒗</mi><annotation encoding="application/x-tex">\bm{v}</annotation><annotation encoding="application/x-llamapun">bold_italic_v</annotation></semantics></math> to optimize the first-order Taylor expansion around <math alttext="\theta" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p2.m5"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>, we could optimize the second-order Taylor expansion instead. Intuitively this would allow us to incorporate curvature information into the update.</p>
</div>
<div class="ltx_para" id="S1.SS2.SSSx1.p3">
<p class="ltx_p">Let us carry out this computation. The second-order Taylor expansion of <math alttext="\mathcal{L}(\theta+h\bm{v})" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p3.m1"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>θ</mi><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒗</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta+h\bm{v})</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ + italic_h bold_italic_v )</annotation></semantics></math> around <math alttext="h=0" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p3.m2"><semantics><mrow><mi>h</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">h=0</annotation><annotation encoding="application/x-llamapun">italic_h = 0</annotation></semantics></math> is</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E23">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta+h\bm{v})=\mathcal{L}(\theta)+h\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle+\frac{1}{2}h^{2}\langle[\nabla^{2}\mathcal{L}(\theta)]\bm{v},\bm{v}\rangle+o(h^{2})." class="ltx_Math" display="block" id="S1.E23.m1"><semantics><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>θ</mi><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒗</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow></mrow><mo>+</mo><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo lspace="0em" rspace="0em">​</mo><msup><mi>h</mi><mn>2</mn></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo stretchy="false">[</mo><mrow><mrow><msup><mo rspace="0.167em">∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>𝒗</mi></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow></mrow><mo>+</mo><mrow><mi>o</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>h</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta+h\bm{v})=\mathcal{L}(\theta)+h\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle+\frac{1}{2}h^{2}\langle[\nabla^{2}\mathcal{L}(\theta)]\bm{v},\bm{v}\rangle+o(h^{2}).</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ + italic_h bold_italic_v ) = caligraphic_L ( italic_θ ) + italic_h ⟨ ∇ caligraphic_L ( italic_θ ) , bold_italic_v ⟩ + divide start_ARG 1 end_ARG start_ARG 2 end_ARG italic_h start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ⟨ [ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ ) ] bold_italic_v , bold_italic_v ⟩ + italic_o ( italic_h start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.23)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Then we can compute the descent direction:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx102">
<tbody id="S1.E24"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{n}\\
\|\bm{v}\|_{2}=1\end{subarray}}\left[\mathcal{L}(\theta)+h\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle+\frac{1}{2}h^{2}\langle[\nabla^{2}\mathcal{L}(\theta)]\bm{v},\bm{v}\rangle\right]" class="ltx_Math" display="inline" id="S1.E24.m1"><semantics><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mtable rowspacing="0pt"><mtr><mtd><mrow><mi>𝒗</mi><mo>∈</mo><msup><mi>ℝ</mi><mi>n</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mo stretchy="false">‖</mo><mi>𝒗</mi><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><mo>=</mo><mn>1</mn></mrow></mtd></mtr></mtable></munder><mo>⁡</mo><mrow><mo>[</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow></mrow><mo>+</mo><mrow><mstyle displaystyle="true"><mfrac><mn>1</mn><mn>2</mn></mfrac></mstyle><mo lspace="0em" rspace="0em">​</mo><msup><mi>h</mi><mn>2</mn></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo stretchy="false">[</mo><mrow><mrow><msup><mo rspace="0.167em">∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>𝒗</mi></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow></mrow></mrow><mo>]</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{n}\\
\|\bm{v}\|_{2}=1\end{subarray}}\left[\mathcal{L}(\theta)+h\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle+\frac{1}{2}h^{2}\langle[\nabla^{2}\mathcal{L}(\theta)]\bm{v},\bm{v}\rangle\right]</annotation><annotation encoding="application/x-llamapun">start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT start_ARG start_ROW start_CELL bold_italic_v ∈ blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT end_CELL end_ROW start_ROW start_CELL ∥ bold_italic_v ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT = 1 end_CELL end_ROW end_ARG end_POSTSUBSCRIPT [ caligraphic_L ( italic_θ ) + italic_h ⟨ ∇ caligraphic_L ( italic_θ ) , bold_italic_v ⟩ + divide start_ARG 1 end_ARG start_ARG 2 end_ARG italic_h start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ⟨ [ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ ) ] bold_italic_v , bold_italic_v ⟩ ]</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{n}\\
\|\bm{v}\|_{2}=1\end{subarray}}\left[\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle+\frac{1}{2}h\langle[\nabla^{2}\mathcal{L}(\theta)]\bm{v},\bm{v}\rangle\right]." class="ltx_Math" display="inline" id="S1.E24.m2"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mtable rowspacing="0pt"><mtr><mtd><mrow><mi>𝒗</mi><mo>∈</mo><msup><mi>ℝ</mi><mi>n</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mo stretchy="false">‖</mo><mi>𝒗</mi><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><mo>=</mo><mn>1</mn></mrow></mtd></mtr></mtable></munder><mo>⁡</mo><mrow><mo>[</mo><mrow><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow><mo>+</mo><mrow><mstyle displaystyle="true"><mfrac><mn>1</mn><mn>2</mn></mfrac></mstyle><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo stretchy="false">[</mo><mrow><mrow><msup><mo rspace="0.167em">∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>𝒗</mi></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow></mrow></mrow><mo>]</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{n}\\
\|\bm{v}\|_{2}=1\end{subarray}}\left[\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle+\frac{1}{2}h\langle[\nabla^{2}\mathcal{L}(\theta)]\bm{v},\bm{v}\rangle\right].</annotation><annotation encoding="application/x-llamapun">= start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT start_ARG start_ROW start_CELL bold_italic_v ∈ blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT end_CELL end_ROW start_ROW start_CELL ∥ bold_italic_v ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT = 1 end_CELL end_ROW end_ARG end_POSTSUBSCRIPT [ ⟨ ∇ caligraphic_L ( italic_θ ) , bold_italic_v ⟩ + divide start_ARG 1 end_ARG start_ARG 2 end_ARG italic_h ⟨ [ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ ) ] bold_italic_v , bold_italic_v ⟩ ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.24)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">This optimization problem is a little difficult to solve because of the constraint <math alttext="\|\bm{v}\|_{2}=1" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p3.m3"><semantics><mrow><msub><mrow><mo stretchy="false">‖</mo><mi>𝒗</mi><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\|\bm{v}\|_{2}=1</annotation><annotation encoding="application/x-llamapun">∥ bold_italic_v ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT = 1</annotation></semantics></math>. But in practice we never normalize the descent direction <math alttext="\bm{v}" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p3.m4"><semantics><mi>𝒗</mi><annotation encoding="application/x-tex">\bm{v}</annotation><annotation encoding="application/x-llamapun">bold_italic_v</annotation></semantics></math> and use the step size <math alttext="h" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p3.m5"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math> to control the size of the update. So let us just solve the above problem over all vectors <math alttext="\bm{v}\in\mathbb{R}^{n}" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p3.m6"><semantics><mrow><mi>𝒗</mi><mo>∈</mo><msup><mi>ℝ</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">\bm{v}\in\mathbb{R}^{n}</annotation><annotation encoding="application/x-llamapun">bold_italic_v ∈ blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT</annotation></semantics></math>:<span class="ltx_note ltx_role_footnote" id="footnote4"><sup class="ltx_note_mark">4</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">4</sup><span class="ltx_tag ltx_tag_note">4</span>If <math alttext="\nabla^{2}\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="footnote4.m1"><semantics><mrow><mrow><msup><mo>∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla^{2}\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ )</annotation></semantics></math> is not invertible, then we can replace <math alttext="[\nabla^{2}\mathcal{L}(\theta)]^{-1}" class="ltx_Math" display="inline" id="footnote4.m2"><semantics><msup><mrow><mo stretchy="false">[</mo><mrow><mrow><msup><mo rspace="0.167em">∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">[\nabla^{2}\mathcal{L}(\theta)]^{-1}</annotation><annotation encoding="application/x-llamapun">[ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ ) ] start_POSTSUPERSCRIPT - 1 end_POSTSUPERSCRIPT</annotation></semantics></math> with the Moore-Penrose pseudoinverse of <math alttext="\nabla^{2}\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="footnote4.m3"><semantics><mrow><mrow><msup><mo>∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla^{2}\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ )</annotation></semantics></math>.</span></span></span></p>
<table class="ltx_equation ltx_eqn_table" id="S1.E25">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\operatorname*{arg\ min}_{\bm{v}\in\mathbb{R}^{n}}\left[\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle+\frac{1}{2}h\langle[\nabla^{2}\mathcal{L}(\theta)]\bm{v},\bm{v}\rangle\right]=-\frac{1}{h}[\nabla^{2}\mathcal{L}(\theta)]^{-1}[\nabla\mathcal{L}(\theta)]." class="ltx_Math" display="block" id="S1.E25.m1"><semantics><mrow><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>𝒗</mi><mo>∈</mo><msup><mi>ℝ</mi><mi>n</mi></msup></mrow></munder><mo>⁡</mo><mrow><mo>[</mo><mrow><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow><mo>+</mo><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo stretchy="false">[</mo><mrow><mrow><msup><mo rspace="0.167em">∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>𝒗</mi></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow></mrow></mrow><mo>]</mo></mrow></mrow><mo>=</mo><mrow><mo>−</mo><mrow><mfrac><mn>1</mn><mi>h</mi></mfrac><mo lspace="0em" rspace="0em">​</mo><msup><mrow><mo stretchy="false">[</mo><mrow><mrow><msup><mo rspace="0.167em">∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\operatorname*{arg\ min}_{\bm{v}\in\mathbb{R}^{n}}\left[\langle\nabla\mathcal{L}(\theta),\bm{v}\rangle+\frac{1}{2}h\langle[\nabla^{2}\mathcal{L}(\theta)]\bm{v},\bm{v}\rangle\right]=-\frac{1}{h}[\nabla^{2}\mathcal{L}(\theta)]^{-1}[\nabla\mathcal{L}(\theta)].</annotation><annotation encoding="application/x-llamapun">start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT bold_italic_v ∈ blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT end_POSTSUBSCRIPT [ ⟨ ∇ caligraphic_L ( italic_θ ) , bold_italic_v ⟩ + divide start_ARG 1 end_ARG start_ARG 2 end_ARG italic_h ⟨ [ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ ) ] bold_italic_v , bold_italic_v ⟩ ] = - divide start_ARG 1 end_ARG start_ARG italic_h end_ARG [ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ ) ] start_POSTSUPERSCRIPT - 1 end_POSTSUPERSCRIPT [ ∇ caligraphic_L ( italic_θ ) ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.25)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">We can thus use the steepest descent iteration</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E26">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta_{k+1}=\theta_{k}-[\nabla^{2}\mathcal{L}(\theta_{k})]^{-1}[\nabla\mathcal{L}(\theta_{k})]," class="ltx_Math" display="block" id="S1.E26.m1"><semantics><mrow><mrow><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><msup><mrow><mo stretchy="false">[</mo><mrow><mrow><msup><mo rspace="0.167em">∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\theta_{k+1}=\theta_{k}-[\nabla^{2}\mathcal{L}(\theta_{k})]^{-1}[\nabla\mathcal{L}(\theta_{k})],</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - [ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ] start_POSTSUPERSCRIPT - 1 end_POSTSUPERSCRIPT [ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ] ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.26)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">(this is the celebrated <span class="ltx_text ltx_font_italic">Newton’s method</span>), or</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E27">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta_{k+1}=\theta_{k}-h[\nabla^{2}\mathcal{L}(\theta_{k})]^{-1}[\nabla\mathcal{L}(\theta_{k})]," class="ltx_Math" display="block" id="S1.E27.m1"><semantics><mrow><mrow><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><msup><mrow><mo stretchy="false">[</mo><mrow><mrow><msup><mo rspace="0.167em">∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\theta_{k+1}=\theta_{k}-h[\nabla^{2}\mathcal{L}(\theta_{k})]^{-1}[\nabla\mathcal{L}(\theta_{k})],</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_h [ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ] start_POSTSUPERSCRIPT - 1 end_POSTSUPERSCRIPT [ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ] ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.27)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">(which is called <span class="ltx_text ltx_font_italic">underdamped Newton’s method</span>). Since the second-order quadratic <math alttext="\mathcal{L}_{\lambda}" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p3.m7"><semantics><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>λ</mi></msub><annotation encoding="application/x-tex">\mathcal{L}_{\lambda}</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUBSCRIPT italic_λ end_POSTSUBSCRIPT</annotation></semantics></math> is equal to its second-order Taylor expansion, if we run Newton’s method for <span class="ltx_text ltx_font_italic">one step</span>, we will achieve the global minimum in <span class="ltx_text ltx_font_italic">one step</span> no matter how large <math alttext="\lambda" class="ltx_Math" display="inline" id="S1.SS2.SSSx1.p3.m8"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation><annotation encoding="application/x-llamapun">italic_λ</annotation></semantics></math> is. <a class="ltx_ref" href="#F3" title="In A.1.2 Preconditioned Gradient Descent for Badly-Conditioned Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Figure</span> <span class="ltx_text ltx_ref_tag">A.3</span></a> gives some intuition about poorly conditioned functions and the gradient steps versus Newton’s steps.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S1.SS2.SSSx2">
<h4 class="ltx_title ltx_title_subsubsection">PGD</h4>
<div class="ltx_para" id="S1.SS2.SSSx2.p1">
<p class="ltx_p">In practice, we do <span class="ltx_text ltx_font_italic">not</span> have a second-order oracle which allows us to compute <math alttext="\nabla^{2}\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S1.SS2.SSSx2.p1.m1"><semantics><mrow><mrow><msup><mo>∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla^{2}\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ )</annotation></semantics></math>. Instead, we can attempt to <span class="ltx_text ltx_font_italic">learn an approximation to it</span> alongside the parameter update <math alttext="\theta_{k+1}" class="ltx_Math" display="inline" id="S1.SS2.SSSx2.p1.m2"><semantics><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\theta_{k+1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT</annotation></semantics></math> from <math alttext="\theta_{k}" class="ltx_Math" display="inline" id="S1.SS2.SSSx2.p1.m3"><semantics><msub><mi>θ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\theta_{k}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S1.SS2.SSSx2.p2">
<p class="ltx_p">How do we learn an approximation to it? We shall find some equations which the Hessian’s inverse satisfies and then try to update our approximation so that it satisfies the equations. Namely, taking the Taylor series of <math alttext="\nabla\mathcal{L}(\theta+\delta_{\theta})" class="ltx_Math" display="inline" id="S1.SS2.SSSx2.p2.m1"><semantics><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>θ</mi><mo>+</mo><msub><mi>δ</mi><mi>θ</mi></msub></mrow><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla\mathcal{L}(\theta+\delta_{\theta})</annotation><annotation encoding="application/x-llamapun">∇ caligraphic_L ( italic_θ + italic_δ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT )</annotation></semantics></math> around point <math alttext="\theta" class="ltx_Math" display="inline" id="S1.SS2.SSSx2.p2.m2"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>, we obtain</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E28">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\underbrace{\nabla L(\theta+\delta_{\theta})-\nabla\mathcal{L}(\theta)}_{\doteq\delta_{\bm{g}}}=[\nabla^{2}\mathcal{L}(\theta)]\delta_{\theta}+o(\|\delta_{\theta}\|_{2})." class="ltx_Math" display="block" id="S1.E28.m1"><semantics><mrow><mrow><munder><munder accentunder="true"><mrow><mrow><mrow><mo rspace="0.167em">∇</mo><mi>L</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>θ</mi><mo>+</mo><msub><mi>δ</mi><mi>θ</mi></msub></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>⏟</mo></munder><mrow><mi></mi><mo>≐</mo><msub><mi>δ</mi><mi>𝒈</mi></msub></mrow></munder><mo>=</mo><mrow><mrow><mrow><mo stretchy="false">[</mo><mrow><mrow><msup><mo rspace="0.167em">∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msub><mi>δ</mi><mi>θ</mi></msub></mrow><mo>+</mo><mrow><mi>o</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mrow><mo stretchy="false">‖</mo><msub><mi>δ</mi><mi>θ</mi></msub><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\underbrace{\nabla L(\theta+\delta_{\theta})-\nabla\mathcal{L}(\theta)}_{\doteq\delta_{\bm{g}}}=[\nabla^{2}\mathcal{L}(\theta)]\delta_{\theta}+o(\|\delta_{\theta}\|_{2}).</annotation><annotation encoding="application/x-llamapun">under⏟ start_ARG ∇ italic_L ( italic_θ + italic_δ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ) - ∇ caligraphic_L ( italic_θ ) end_ARG start_POSTSUBSCRIPT ≐ italic_δ start_POSTSUBSCRIPT bold_italic_g end_POSTSUBSCRIPT end_POSTSUBSCRIPT = [ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ ) ] italic_δ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT + italic_o ( ∥ italic_δ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.28)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">In this case we have</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E29">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\delta_{\bm{g}}\approx[\nabla^{2}\mathcal{L}(\theta)]\delta_{\theta}\implies\delta_{\theta}\approx[\nabla^{2}\mathcal{L}(\theta)]^{-1}\delta_{\bm{g}}" class="ltx_Math" display="block" id="S1.E29.m1"><semantics><mrow><msub><mi>δ</mi><mi>𝒈</mi></msub><mo>≈</mo><mrow><mrow><mo stretchy="false">[</mo><mrow><mrow><msup><mo rspace="0.167em">∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msub><mi>δ</mi><mi>θ</mi></msub></mrow><mo stretchy="false">⟹</mo><msub><mi>δ</mi><mi>θ</mi></msub><mo>≈</mo><mrow><msup><mrow><mo stretchy="false">[</mo><mrow><mrow><msup><mo rspace="0.167em">∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo lspace="0em" rspace="0em">​</mo><msub><mi>δ</mi><mi>𝒈</mi></msub></mrow></mrow><annotation encoding="application/x-tex">\delta_{\bm{g}}\approx[\nabla^{2}\mathcal{L}(\theta)]\delta_{\theta}\implies\delta_{\theta}\approx[\nabla^{2}\mathcal{L}(\theta)]^{-1}\delta_{\bm{g}}</annotation><annotation encoding="application/x-llamapun">italic_δ start_POSTSUBSCRIPT bold_italic_g end_POSTSUBSCRIPT ≈ [ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ ) ] italic_δ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ⟹ italic_δ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ≈ [ ∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ ) ] start_POSTSUPERSCRIPT - 1 end_POSTSUPERSCRIPT italic_δ start_POSTSUBSCRIPT bold_italic_g end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.29)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">We can now try to learn a symmetric positive semidefinite pre-conditioner <math alttext="P\in\mathbb{R}^{n\times n}" class="ltx_Math" display="inline" id="S1.SS2.SSSx2.p2.m3"><semantics><mrow><mi>P</mi><mo>∈</mo><msup><mi>ℝ</mi><mrow><mi>n</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">P\in\mathbb{R}^{n\times n}</annotation><annotation encoding="application/x-llamapun">italic_P ∈ blackboard_R start_POSTSUPERSCRIPT italic_n × italic_n end_POSTSUPERSCRIPT</annotation></semantics></math> such that</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E30">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\delta_{\theta}\approx P\delta_{\bm{g}}," class="ltx_Math" display="block" id="S1.E30.m1"><semantics><mrow><mrow><msub><mi>δ</mi><mi>θ</mi></msub><mo>≈</mo><mrow><mi>P</mi><mo lspace="0em" rspace="0em">​</mo><msub><mi>δ</mi><mi>𝒈</mi></msub></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\delta_{\theta}\approx P\delta_{\bm{g}},</annotation><annotation encoding="application/x-llamapun">italic_δ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ≈ italic_P italic_δ start_POSTSUBSCRIPT bold_italic_g end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.30)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">updating it at each iteration along with <math alttext="\theta_{k}" class="ltx_Math" display="inline" id="S1.SS2.SSSx2.p2.m4"><semantics><msub><mi>θ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\theta_{k}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>. Namely, we have the <span class="ltx_text ltx_font_italic">PSGD</span> iteration</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx103">
<tbody id="S1.E31"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle P_{k}" class="ltx_Math" display="inline" id="S1.E31.m1"><semantics><msub><mi>P</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\displaystyle P_{k}</annotation><annotation encoding="application/x-llamapun">italic_P start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\mathrm{PreconditionerUpdate}(P_{k-1};\theta_{k},\nabla\mathcal{L}(\theta_{k}))" class="ltx_Math" display="inline" id="S1.E31.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mi>PreconditionerUpdate</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>P</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>;</mo><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\mathrm{PreconditionerUpdate}(P_{k-1};\theta_{k},\nabla\mathcal{L}(\theta_{k}))</annotation><annotation encoding="application/x-llamapun">= roman_PreconditionerUpdate ( italic_P start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT ; italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.31)</span></td>
</tr></tbody>
<tbody id="S1.E32"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\theta_{k+1}" class="ltx_Math" display="inline" id="S1.E32.m1"><semantics><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\displaystyle\theta_{k+1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\theta_{k}-hP_{k}\nabla\mathcal{L}(\theta_{k})." class="ltx_Math" display="inline" id="S1.E32.m2"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><msub><mi>P</mi><mi>k</mi></msub><mo lspace="0.167em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\theta_{k}-hP_{k}\nabla\mathcal{L}(\theta_{k}).</annotation><annotation encoding="application/x-llamapun">= italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_h italic_P start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.32)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">This update has two problems: how can we even use <math alttext="P" class="ltx_Math" display="inline" id="S1.SS2.SSSx2.p2.m5"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation><annotation encoding="application/x-llamapun">italic_P</annotation></semantics></math> (since we already said we cannot store an <math alttext="n\times n" class="ltx_Math" display="inline" id="S1.SS2.SSSx2.p2.m6"><semantics><mrow><mi>n</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n\times n</annotation><annotation encoding="application/x-llamapun">italic_n × italic_n</annotation></semantics></math> matrix) and how can we <span class="ltx_text ltx_font_italic">update</span> <math alttext="P" class="ltx_Math" display="inline" id="S1.SS2.SSSx2.p2.m7"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation><annotation encoding="application/x-llamapun">italic_P</annotation></semantics></math> at each iteration? The answers are very related; we can never materialize <math alttext="P" class="ltx_Math" display="inline" id="S1.SS2.SSSx2.p2.m8"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation><annotation encoding="application/x-llamapun">italic_P</annotation></semantics></math> in computer memory, but we can represent it using a low-rank factorization (or comparable methods such as <span class="ltx_text ltx_font_italic">Kronecker factorization</span> which is particularly suited to the form of deep neural networks). Then the preconditioner update step is designed to exploit the structure of the preconditioner representation.</p>
</div>
<div class="ltx_para" id="S1.SS2.SSSx2.p3">
<p class="ltx_p">We end this subsection with a caveat: in deep learning, for example, <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.SS2.SSSx2.p3.m1"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> is not a convex function and so Newton’s method (and approximations to it) do not make sense. In this case we look at the geometric intuition of Newton’s method on convex functions, say from <a class="ltx_ref" href="#F3" title="In A.1.2 Preconditioned Gradient Descent for Badly-Conditioned Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Figure</span> <span class="ltx_text ltx_ref_tag">A.3</span></a>: the inverse Hessian <span class="ltx_text ltx_font_italic">whitens</span> the gradients. Thus instead of a Hessian-approximating preconditioner, we can adjust the above procedures to learn a more general whitening transformation for the gradient. This is the idea behind the original proposal of PSGD <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx158" title="">Li17</a>]</cite>, which contains more information about how to store and update the preconditioner, and more modern optimizers like Muon <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx166" title="">LSY+25</a>]</cite>.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S1.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.1.3 </span>Proximal Gradient Descent for Non-Smooth Problems</h3>
<div class="ltx_para" id="S1.SS3.p1">
<p class="ltx_p">Even in very toy problems, however, such as LASSO or dictionary learning, the problem is not strongly convex but rather just convex, and the objective is no longer just smooth but rather the sum of a smooth function and a non-smooth regularizer (such as the <math alttext="\ell^{1}" class="ltx_Math" display="inline" id="S1.SS3.p1.m1"><semantics><msup><mi mathvariant="normal">ℓ</mi><mn>1</mn></msup><annotation encoding="application/x-tex">\ell^{1}</annotation><annotation encoding="application/x-llamapun">roman_ℓ start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT</annotation></semantics></math> norm). Such problems are solved by <span class="ltx_text ltx_font_italic">proximal optimization algorithms</span>, which generalize steepest descent to non-smooth objectives.</p>
</div>
<div class="ltx_para" id="S1.SS3.p2">
<p class="ltx_p">Formally, let us say that</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E33">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta)\doteq\mathcal{S}(\theta)+\mathcal{R}(\theta)" class="ltx_Math" display="block" id="S1.E33.m1"><semantics><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi class="ltx_font_mathcaligraphic">ℛ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)\doteq\mathcal{S}(\theta)+\mathcal{R}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ ) ≐ caligraphic_S ( italic_θ ) + caligraphic_R ( italic_θ )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.33)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where <math alttext="\mathcal{S}" class="ltx_Math" display="inline" id="S1.SS3.p2.m1"><semantics><mi class="ltx_font_mathcaligraphic">𝒮</mi><annotation encoding="application/x-tex">\mathcal{S}</annotation><annotation encoding="application/x-llamapun">caligraphic_S</annotation></semantics></math> is smooth, say with <math alttext="\beta" class="ltx_Math" display="inline" id="S1.SS3.p2.m2"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation><annotation encoding="application/x-llamapun">italic_β</annotation></semantics></math>-Lipschitz gradient, and <math alttext="\mathcal{R}" class="ltx_Math" display="inline" id="S1.SS3.p2.m3"><semantics><mi class="ltx_font_mathcaligraphic">ℛ</mi><annotation encoding="application/x-tex">\mathcal{R}</annotation><annotation encoding="application/x-llamapun">caligraphic_R</annotation></semantics></math> is non-smooth (i.e., rough). The proximal gradient algorithm generalizes the steepest descent algorithm, by using the majorization-minimization framework (i.e., <a class="ltx_ref" href="#Thmlemma1" title="Lemma A.1 (Majorization-Minimization). ‣ Step-Size Selection ‣ A.1.1 Vanilla Gradient Descent for Smooth Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Lemma</span> <span class="ltx_text ltx_ref_tag">A.1</span></a>) with a different global upper bound. Namely, we construct such an upper bound by asking: what if we take the Lipschitz gradient upper bound of <math alttext="S" class="ltx_Math" display="inline" id="S1.SS3.p2.m4"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation><annotation encoding="application/x-llamapun">italic_S</annotation></semantics></math> but <span class="ltx_text ltx_font_italic">leave <math alttext="R" class="ltx_Math" display="inline" id="S1.SS3.p2.m5"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation><annotation encoding="application/x-llamapun">italic_R</annotation></semantics></math> alone</span>? Namely, we have</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E34">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta_{1})=\mathcal{S}(\theta_{1})+\mathcal{R}(\theta_{1})\leq u_{\theta_{0},\beta}(\theta_{1})\doteq\mathcal{S}(\theta_{0})+\langle\nabla\mathcal{S}(\theta_{0}),\theta_{1}-\theta_{0}\rangle+\frac{\beta}{2}\|\theta_{1}-\theta_{0}\|_{2}^{2}+\mathcal{R}(\theta_{1})." class="ltx_Math" display="block" id="S1.E34.m1"><semantics><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi class="ltx_font_mathcaligraphic">ℛ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>≤</mo><mrow><msub><mi>u</mi><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>,</mo><mi>β</mi></mrow></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">𝒮</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><mo stretchy="false">⟩</mo></mrow><mo>+</mo><mrow><mfrac><mi>β</mi><mn>2</mn></mfrac><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo>+</mo><mrow><mi class="ltx_font_mathcaligraphic">ℛ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta_{1})=\mathcal{S}(\theta_{1})+\mathcal{R}(\theta_{1})\leq u_{\theta_{0},\beta}(\theta_{1})\doteq\mathcal{S}(\theta_{0})+\langle\nabla\mathcal{S}(\theta_{0}),\theta_{1}-\theta_{0}\rangle+\frac{\beta}{2}\|\theta_{1}-\theta_{0}\|_{2}^{2}+\mathcal{R}(\theta_{1}).</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) = caligraphic_S ( italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) + caligraphic_R ( italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) ≤ italic_u start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_β end_POSTSUBSCRIPT ( italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) ≐ caligraphic_S ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) + ⟨ ∇ caligraphic_S ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) , italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT - italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ⟩ + divide start_ARG italic_β end_ARG start_ARG 2 end_ARG ∥ italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT - italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + caligraphic_R ( italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.34)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Note that (proof as exercise)</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E35">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\operatorname*{arg\ min}_{\theta_{1}}u_{\theta_{0},\beta}(\theta_{1})=\operatorname*{arg\ min}_{\theta_{1}}\left[\frac{\beta}{2}\left\|\theta_{1}-\left(\theta_{0}-\frac{1}{\beta}\nabla\mathcal{S}(\theta_{0})\right)\right\|_{2}^{2}+\mathcal{R}(\theta_{1})\right]." class="ltx_Math" display="block" id="S1.E35.m1"><semantics><mrow><mrow><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><msub><mi>θ</mi><mn>1</mn></msub></munder><mo lspace="0.167em">⁡</mo><msub><mi>u</mi><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>,</mo><mi>β</mi></mrow></msub></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><msub><mi>θ</mi><mn>1</mn></msub></munder><mo>⁡</mo><mrow><mo>[</mo><mrow><mrow><mfrac><mi>β</mi><mn>2</mn></mfrac><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo>‖</mo><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>−</mo><mrow><mo>(</mo><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>−</mo><mrow><mfrac><mn>1</mn><mi>β</mi></mfrac><mo lspace="0.167em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">𝒮</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>)</mo></mrow></mrow><mo>‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo>+</mo><mrow><mi class="ltx_font_mathcaligraphic">ℛ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>]</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\operatorname*{arg\ min}_{\theta_{1}}u_{\theta_{0},\beta}(\theta_{1})=\operatorname*{arg\ min}_{\theta_{1}}\left[\frac{\beta}{2}\left\|\theta_{1}-\left(\theta_{0}-\frac{1}{\beta}\nabla\mathcal{S}(\theta_{0})\right)\right\|_{2}^{2}+\mathcal{R}(\theta_{1})\right].</annotation><annotation encoding="application/x-llamapun">start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT italic_u start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_β end_POSTSUBSCRIPT ( italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) = start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT [ divide start_ARG italic_β end_ARG start_ARG 2 end_ARG ∥ italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT - ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT - divide start_ARG 1 end_ARG start_ARG italic_β end_ARG ∇ caligraphic_S ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + caligraphic_R ( italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.35)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Now if we try to minimize the upper bound <math alttext="u_{\theta_{0},\beta}" class="ltx_Math" display="inline" id="S1.SS3.p2.m6"><semantics><msub><mi>u</mi><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>,</mo><mi>β</mi></mrow></msub><annotation encoding="application/x-tex">u_{\theta_{0},\beta}</annotation><annotation encoding="application/x-llamapun">italic_u start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_β end_POSTSUBSCRIPT</annotation></semantics></math>, we are picking a <math alttext="\theta_{1}" class="ltx_Math" display="inline" id="S1.SS3.p2.m7"><semantics><msub><mi>θ</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\theta_{1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> that:</p>
<ul class="ltx_itemize" id="S1.I2">
<li class="ltx_item" id="S1.I2.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I2.i1.p1">
<p class="ltx_p">is close to the gradient update <math alttext="\theta_{0}-\frac{1}{\beta}\nabla\mathcal{S}(\theta_{0})" class="ltx_Math" display="inline" id="S1.I2.i1.p1.m1"><semantics><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>−</mo><mrow><mfrac><mn>1</mn><mi>β</mi></mfrac><mo lspace="0.167em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">𝒮</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\theta_{0}-\frac{1}{\beta}\nabla\mathcal{S}(\theta_{0})</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT - divide start_ARG 1 end_ARG start_ARG italic_β end_ARG ∇ caligraphic_S ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT )</annotation></semantics></math>;</p>
</div>
</li>
<li class="ltx_item" id="S1.I2.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I2.i2.p1">
<p class="ltx_p">has a small value of the regularizer <math alttext="\mathcal{R}(\theta_{1})" class="ltx_Math" display="inline" id="S1.I2.i2.p1.m1"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℛ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{R}(\theta_{1})</annotation><annotation encoding="application/x-llamapun">caligraphic_R ( italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT )</annotation></semantics></math></p>
</div>
</li>
</ul>
<p class="ltx_p">and trades off these properties according to the smoothness parameter <math alttext="\beta" class="ltx_Math" display="inline" id="S1.SS3.p2.m8"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation><annotation encoding="application/x-llamapun">italic_β</annotation></semantics></math>. Accordingly, let us define the proximal operator</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E36">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\operatorname{prox}_{h,\mathcal{R}}(\theta)\doteq\operatorname*{arg\ min}_{\theta_{1}}\left[\frac{1}{2h}\|\theta_{1}-\theta\|_{2}^{2}+\mathcal{R}(\theta)\right]." class="ltx_Math" display="block" id="S1.E36.m1"><semantics><mrow><mrow><mrow><msub><mi>prox</mi><mrow><mi>h</mi><mo>,</mo><mi class="ltx_font_mathcaligraphic">ℛ</mi></mrow></msub><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><msub><mi>θ</mi><mn>1</mn></msub></munder><mo>⁡</mo><mrow><mo>[</mo><mrow><mrow><mfrac><mn>1</mn><mrow><mn>2</mn><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mfrac><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>−</mo><mi>θ</mi></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo>+</mo><mrow><mi class="ltx_font_mathcaligraphic">ℛ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>]</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\operatorname{prox}_{h,\mathcal{R}}(\theta)\doteq\operatorname*{arg\ min}_{\theta_{1}}\left[\frac{1}{2h}\|\theta_{1}-\theta\|_{2}^{2}+\mathcal{R}(\theta)\right].</annotation><annotation encoding="application/x-llamapun">roman_prox start_POSTSUBSCRIPT italic_h , caligraphic_R end_POSTSUBSCRIPT ( italic_θ ) ≐ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT [ divide start_ARG 1 end_ARG start_ARG 2 italic_h end_ARG ∥ italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT - italic_θ ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + caligraphic_R ( italic_θ ) ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.36)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Then, we can define the <span class="ltx_text ltx_font_italic">proximal gradient descent</span> iteration which, at each iteration, minimizes the upper bound <math alttext="u_{\theta_{k},h^{-1}}" class="ltx_Math" display="inline" id="S1.SS3.p2.m9"><semantics><msub><mi>u</mi><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><msup><mi>h</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></msub><annotation encoding="application/x-tex">u_{\theta_{k},h^{-1}}</annotation><annotation encoding="application/x-llamapun">italic_u start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_h start_POSTSUPERSCRIPT - 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math>, i.e.,</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E37">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta_{k+1}=\operatorname{prox}_{h,\mathcal{R}}(\theta_{k}-h\nabla\mathcal{S}(\theta_{k}))." class="ltx_Math" display="block" id="S1.E37.m1"><semantics><mrow><mrow><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><msub><mi>prox</mi><mrow><mi>h</mi><mo>,</mo><mi class="ltx_font_mathcaligraphic">ℛ</mi></mrow></msub><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">𝒮</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\theta_{k+1}=\operatorname{prox}_{h,\mathcal{R}}(\theta_{k}-h\nabla\mathcal{S}(\theta_{k})).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = roman_prox start_POSTSUBSCRIPT italic_h , caligraphic_R end_POSTSUBSCRIPT ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_h ∇ caligraphic_S ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.37)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Convergence proofs are possible when <math alttext="h\leq 1/\beta" class="ltx_Math" display="inline" id="S1.SS3.p2.m10"><semantics><mrow><mi>h</mi><mo>≤</mo><mrow><mn>1</mn><mo>/</mo><mi>β</mi></mrow></mrow><annotation encoding="application/x-tex">h\leq 1/\beta</annotation><annotation encoding="application/x-llamapun">italic_h ≤ 1 / italic_β</annotation></semantics></math>, but we do not give any in this section.</p>
</div>
<div class="ltx_para" id="S1.SS3.p3">
<p class="ltx_p">One remaining question is: how can we compute the proximal operator? At first
glance, it seems like we have traded one intractable minimization problem for
another. Since we have not made any assumption on <math alttext="\mathcal{R}" class="ltx_Math" display="inline" id="S1.SS3.p3.m1"><semantics><mi class="ltx_font_mathcaligraphic">ℛ</mi><annotation encoding="application/x-tex">\mathcal{R}</annotation><annotation encoding="application/x-llamapun">caligraphic_R</annotation></semantics></math> so far, the framework
works even when <math alttext="\mathcal{R}" class="ltx_Math" display="inline" id="S1.SS3.p3.m2"><semantics><mi class="ltx_font_mathcaligraphic">ℛ</mi><annotation encoding="application/x-tex">\mathcal{R}</annotation><annotation encoding="application/x-llamapun">caligraphic_R</annotation></semantics></math> is a very complex function (such as a neural network
loss), which would require us to solve a neural network training problem in
order to compute a single proximal operator. However, in practice, for simple
regularizers <math alttext="\mathcal{R}" class="ltx_Math" display="inline" id="S1.SS3.p3.m3"><semantics><mi class="ltx_font_mathcaligraphic">ℛ</mi><annotation encoding="application/x-tex">\mathcal{R}</annotation><annotation encoding="application/x-llamapun">caligraphic_R</annotation></semantics></math> such as those we use in this manuscript, there exist
proximal operators which are easy to compute or even in closed-form. We give
a few below (the proofs are an exercise).</p>
</div>
<div class="ltx_theorem ltx_theorem_example" id="Thmexample1">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Example A.1</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexample1.p1">
<p class="ltx_p">Let <math alttext="\Gamma\subseteq\Theta" class="ltx_Math" display="inline" id="Thmexample1.p1.m1"><semantics><mrow><mi mathvariant="normal">Γ</mi><mo>⊆</mo><mi mathvariant="normal">Θ</mi></mrow><annotation encoding="application/x-tex">\Gamma\subseteq\Theta</annotation><annotation encoding="application/x-llamapun">roman_Γ ⊆ roman_Θ</annotation></semantics></math> be a set, and let <math alttext="\chi_{\Gamma}" class="ltx_Math" display="inline" id="Thmexample1.p1.m2"><semantics><msub><mi>χ</mi><mi mathvariant="normal">Γ</mi></msub><annotation encoding="application/x-tex">\chi_{\Gamma}</annotation><annotation encoding="application/x-llamapun">italic_χ start_POSTSUBSCRIPT roman_Γ end_POSTSUBSCRIPT</annotation></semantics></math> be the characteristic function on <math alttext="\Gamma" class="ltx_Math" display="inline" id="Thmexample1.p1.m3"><semantics><mi mathvariant="normal">Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation><annotation encoding="application/x-llamapun">roman_Γ</annotation></semantics></math>, i.e.,</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E38">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\chi_{\Gamma}(\theta)\doteq\begin{cases}0,&amp;\text{if}\ \theta\in\Gamma\\
+\infty,&amp;\text{if}\ \theta\notin\Gamma.\end{cases}" class="ltx_Math" display="block" id="S1.E38.m1"><semantics><mrow><mrow><msub><mi>χ</mi><mi mathvariant="normal">Γ</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><mo>{</mo><mtable columnspacing="5pt" displaystyle="true" rowspacing="0pt"><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mn>0</mn><mo>,</mo></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mtext>if</mtext><mo lspace="0.500em" rspace="0em">​</mo><mi>θ</mi></mrow><mo>∈</mo><mi mathvariant="normal">Γ</mi></mrow></mtd></mtr><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mo>+</mo><mi mathvariant="normal">∞</mi></mrow><mo>,</mo></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mrow><mtext>if</mtext><mo lspace="0.500em" rspace="0em">​</mo><mi>θ</mi></mrow><mo>∉</mo><mi mathvariant="normal">Γ</mi></mrow><mo lspace="0em">.</mo></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\chi_{\Gamma}(\theta)\doteq\begin{cases}0,&amp;\text{if}\ \theta\in\Gamma\\
+\infty,&amp;\text{if}\ \theta\notin\Gamma.\end{cases}</annotation><annotation encoding="application/x-llamapun">italic_χ start_POSTSUBSCRIPT roman_Γ end_POSTSUBSCRIPT ( italic_θ ) ≐ { start_ROW start_CELL 0 , end_CELL start_CELL if italic_θ ∈ roman_Γ end_CELL end_ROW start_ROW start_CELL + ∞ , end_CELL start_CELL if italic_θ ∉ roman_Γ . end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.38)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Then the proximal operator of <math alttext="\chi_{\Gamma}" class="ltx_Math" display="inline" id="Thmexample1.p1.m4"><semantics><msub><mi>χ</mi><mi mathvariant="normal">Γ</mi></msub><annotation encoding="application/x-tex">\chi_{\Gamma}</annotation><annotation encoding="application/x-llamapun">italic_χ start_POSTSUBSCRIPT roman_Γ end_POSTSUBSCRIPT</annotation></semantics></math> is a projection, i.e.,</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E39">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\operatorname{prox}_{h,\chi_{\Gamma}}(\theta)=\operatorname*{arg\ min}_{\theta_{1}\in\Gamma}\frac{1}{2}\|\theta_{1}-\theta\|_{2}^{2}=\operatorname*{arg\ min}_{\theta_{1}\in\Gamma}\|\theta_{1}-\theta\|_{2}." class="ltx_Math" display="block" id="S1.E39.m1"><semantics><mrow><mrow><mrow><msub><mi>prox</mi><mrow><mi>h</mi><mo>,</mo><msub><mi>χ</mi><mi mathvariant="normal">Γ</mi></msub></mrow></msub><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>∈</mo><mi mathvariant="normal">Γ</mi></mrow></munder><mo>⁡</mo><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>−</mo><mi>θ</mi></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow></mrow><mo>=</mo><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>∈</mo><mi mathvariant="normal">Γ</mi></mrow></munder><mo>⁡</mo><msub><mrow><mo stretchy="false">‖</mo><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>−</mo><mi>θ</mi></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\operatorname{prox}_{h,\chi_{\Gamma}}(\theta)=\operatorname*{arg\ min}_{\theta_{1}\in\Gamma}\frac{1}{2}\|\theta_{1}-\theta\|_{2}^{2}=\operatorname*{arg\ min}_{\theta_{1}\in\Gamma}\|\theta_{1}-\theta\|_{2}.</annotation><annotation encoding="application/x-llamapun">roman_prox start_POSTSUBSCRIPT italic_h , italic_χ start_POSTSUBSCRIPT roman_Γ end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_θ ) = start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∈ roman_Γ end_POSTSUBSCRIPT divide start_ARG 1 end_ARG start_ARG 2 end_ARG ∥ italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT - italic_θ ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT = start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∈ roman_Γ end_POSTSUBSCRIPT ∥ italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT - italic_θ ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.39)</span></td>
</tr></tbody>
</table>
<p class="ltx_p"><math alttext="\blacksquare" class="ltx_Math" display="inline" id="Thmexample1.p1.m5"><semantics><mi mathvariant="normal">■</mi><annotation encoding="application/x-tex">\blacksquare</annotation><annotation encoding="application/x-llamapun">■</annotation></semantics></math></p>
</div>
</div>
<div class="ltx_theorem ltx_theorem_example" id="Thmexample2">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Example A.2</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexample2.p1">
<p class="ltx_p">The <math alttext="\ell^{1}" class="ltx_Math" display="inline" id="Thmexample2.p1.m1"><semantics><msup><mi mathvariant="normal">ℓ</mi><mn>1</mn></msup><annotation encoding="application/x-tex">\ell^{1}</annotation><annotation encoding="application/x-llamapun">roman_ℓ start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT</annotation></semantics></math> norm has a proximal operator which performs soft thresholding:</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E40">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="S_{h}(\theta)\doteq\operatorname{prox}_{h,\lambda\|\cdot\|_{1}}(\theta)=\operatorname*{arg\ min}_{\theta_{1}}\left[\frac{1}{2h}\|\theta_{1}-\theta\|_{2}^{2}+\lambda\|\theta\|_{1}\right]" class="ltx_math_unparsed" display="block" id="S1.E40.m1"><semantics><mrow><mrow><msub><mi>S</mi><mi>h</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><msub><mi>prox</mi><mrow><mi>h</mi><mo>,</mo><mi>λ</mi><mo lspace="0em" rspace="0em">∥</mo><mo lspace="0em" rspace="0em">⋅</mo><msub><mo lspace="0em">∥</mo><mn>1</mn></msub></mrow></msub><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><msub><mi>θ</mi><mn>1</mn></msub></munder><mo>⁡</mo><mrow><mo>[</mo><mrow><mrow><mfrac><mn>1</mn><mrow><mn>2</mn><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mfrac><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>−</mo><mi>θ</mi></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo>+</mo><mrow><mi>λ</mi><mo lspace="0em" rspace="0em">​</mo><msub><mrow><mo stretchy="false">‖</mo><mi>θ</mi><mo stretchy="false">‖</mo></mrow><mn>1</mn></msub></mrow></mrow><mo>]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">S_{h}(\theta)\doteq\operatorname{prox}_{h,\lambda\|\cdot\|_{1}}(\theta)=\operatorname*{arg\ min}_{\theta_{1}}\left[\frac{1}{2h}\|\theta_{1}-\theta\|_{2}^{2}+\lambda\|\theta\|_{1}\right]</annotation><annotation encoding="application/x-llamapun">italic_S start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT ( italic_θ ) ≐ roman_prox start_POSTSUBSCRIPT italic_h , italic_λ ∥ ⋅ ∥ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_θ ) = start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_POSTSUBSCRIPT [ divide start_ARG 1 end_ARG start_ARG 2 italic_h end_ARG ∥ italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT - italic_θ ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + italic_λ ∥ italic_θ ∥ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.40)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">then <math alttext="S_{h}(\theta)" class="ltx_Math" display="inline" id="Thmexample2.p1.m2"><semantics><mrow><msub><mi>S</mi><mi>h</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">S_{h}(\theta)</annotation><annotation encoding="application/x-llamapun">italic_S start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT ( italic_θ )</annotation></semantics></math> is defined by</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E41">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="S_{h}(\theta)_{i}=\begin{cases}\theta_{i}-h\lambda,&amp;\text{if}\ \theta_{i}\geq h\lambda\\
0,&amp;\text{if}\ \theta_{i}\in[-h\lambda,h\lambda]\\
\theta_{i}+h\lambda,&amp;\text{if}\ \theta_{i}\leq-h\lambda\end{cases}=\begin{cases}\max\{\lvert\theta_{i}\rvert-h\lambda,0\}\operatorname{sign}(\theta_{i}),&amp;\text{if}\ \lvert\theta_{i}\rvert\geq h\lambda\\
0,&amp;\text{if}\ \lvert\theta_{i}\rvert&lt;h\lambda.\end{cases}" class="ltx_Math" display="block" id="S1.E41.m1"><semantics><mrow><mrow><msub><mi>S</mi><mi>h</mi></msub><mo lspace="0em" rspace="0em">​</mo><msub><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mi>i</mi></msub></mrow><mo>=</mo><mrow><mo>{</mo><mtable columnspacing="5pt" displaystyle="true" rowspacing="0pt"><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><msub><mi>θ</mi><mi>i</mi></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>λ</mi></mrow></mrow><mo>,</mo></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mtext>if</mtext><mo lspace="0.500em" rspace="0em">​</mo><msub><mi>θ</mi><mi>i</mi></msub></mrow><mo>≥</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>λ</mi></mrow></mrow></mtd></mtr><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mn>0</mn><mo>,</mo></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mtext>if</mtext><mo lspace="0.500em" rspace="0em">​</mo><msub><mi>θ</mi><mi>i</mi></msub></mrow><mo>∈</mo><mrow><mo stretchy="false">[</mo><mrow><mo>−</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>λ</mi></mrow></mrow><mo>,</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>λ</mi></mrow><mo stretchy="false">]</mo></mrow></mrow></mtd></mtr><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><msub><mi>θ</mi><mi>i</mi></msub><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>λ</mi></mrow></mrow><mo>,</mo></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mtext>if</mtext><mo lspace="0.500em" rspace="0em">​</mo><msub><mi>θ</mi><mi>i</mi></msub></mrow><mo>≤</mo><mrow><mo>−</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>λ</mi></mrow></mrow></mrow></mtd></mtr></mtable></mrow><mo>=</mo><mrow><mo>{</mo><mtable columnspacing="5pt" displaystyle="true" rowspacing="0pt"><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mrow><mi>max</mi><mo>⁡</mo><mrow><mo stretchy="false">{</mo><mrow><mrow><mo stretchy="false">|</mo><msub><mi>θ</mi><mi>i</mi></msub><mo stretchy="false">|</mo></mrow><mo>−</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>λ</mi></mrow></mrow><mo>,</mo><mn>0</mn><mo stretchy="false">}</mo></mrow></mrow><mo lspace="0.167em" rspace="0em">​</mo><mrow><mi>sign</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>,</mo></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mtext>if</mtext><mo lspace="0.500em" rspace="0em">​</mo><mrow><mo stretchy="false">|</mo><msub><mi>θ</mi><mi>i</mi></msub><mo stretchy="false">|</mo></mrow></mrow><mo>≥</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>λ</mi></mrow></mrow></mtd></mtr><mtr><mtd class="ltx_align_left" columnalign="left"><mrow><mn>0</mn><mo>,</mo></mrow></mtd><mtd class="ltx_align_left" columnalign="left"><mrow><mrow><mrow><mtext>if</mtext><mo lspace="0.500em" rspace="0em">​</mo><mrow><mo stretchy="false">|</mo><msub><mi>θ</mi><mi>i</mi></msub><mo stretchy="false">|</mo></mrow></mrow><mo>&lt;</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>λ</mi></mrow></mrow><mo lspace="0em">.</mo></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">S_{h}(\theta)_{i}=\begin{cases}\theta_{i}-h\lambda,&amp;\text{if}\ \theta_{i}\geq h\lambda\\
0,&amp;\text{if}\ \theta_{i}\in[-h\lambda,h\lambda]\\
\theta_{i}+h\lambda,&amp;\text{if}\ \theta_{i}\leq-h\lambda\end{cases}=\begin{cases}\max\{\lvert\theta_{i}\rvert-h\lambda,0\}\operatorname{sign}(\theta_{i}),&amp;\text{if}\ \lvert\theta_{i}\rvert\geq h\lambda\\
0,&amp;\text{if}\ \lvert\theta_{i}\rvert&lt;h\lambda.\end{cases}</annotation><annotation encoding="application/x-llamapun">italic_S start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT ( italic_θ ) start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = { start_ROW start_CELL italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT - italic_h italic_λ , end_CELL start_CELL if italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ≥ italic_h italic_λ end_CELL end_ROW start_ROW start_CELL 0 , end_CELL start_CELL if italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ [ - italic_h italic_λ , italic_h italic_λ ] end_CELL end_ROW start_ROW start_CELL italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT + italic_h italic_λ , end_CELL start_CELL if italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ≤ - italic_h italic_λ end_CELL end_ROW = { start_ROW start_CELL roman_max { | italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | - italic_h italic_λ , 0 } roman_sign ( italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) , end_CELL start_CELL if | italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | ≥ italic_h italic_λ end_CELL end_ROW start_ROW start_CELL 0 , end_CELL start_CELL if | italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | &lt; italic_h italic_λ . end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.41)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">The proximal gradient operation with the smooth part of the objective being least-squares and the non-smooth part being the <math alttext="\ell^{1}" class="ltx_Math" display="inline" id="Thmexample2.p1.m3"><semantics><msup><mi mathvariant="normal">ℓ</mi><mn>1</mn></msup><annotation encoding="application/x-tex">\ell^{1}</annotation><annotation encoding="application/x-llamapun">roman_ℓ start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT</annotation></semantics></math> norm (hence using this soft thresholding proximal operator) is called the Iterative Shrinkage-Thresholding Algorithm (ISTA).
 <math alttext="\blacksquare" class="ltx_Math" display="inline" id="Thmexample2.p1.m4"><semantics><mi mathvariant="normal">■</mi><annotation encoding="application/x-tex">\blacksquare</annotation><annotation encoding="application/x-llamapun">■</annotation></semantics></math></p>
</div>
</div>
<div class="ltx_theorem ltx_theorem_example" id="Thmexample3">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Example A.3</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexample3.p1">
<p class="ltx_p">In <a class="ltx_ref" href="Ch4.html" title="Chapter 4 Deep Representations from Unrolled Optimization ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Chapter</span> <span class="ltx_text ltx_ref_tag">4</span></a> we use a proximal operator corresponding to the <math alttext="\ell^{1}" class="ltx_Math" display="inline" id="Thmexample3.p1.m1"><semantics><msup><mi mathvariant="normal">ℓ</mi><mn>1</mn></msup><annotation encoding="application/x-tex">\ell^{1}</annotation><annotation encoding="application/x-llamapun">roman_ℓ start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT</annotation></semantics></math> norm plus the characteristic function for the positive orthant <math alttext="\mathbb{R}_{+}^{n}\doteq\{\bm{x}\in\mathbb{R}^{n}\colon x_{i}\geq 0\ \forall i\}" class="ltx_Math" display="inline" id="Thmexample3.p1.m2"><semantics><mrow><msubsup><mi>ℝ</mi><mo>+</mo><mi>n</mi></msubsup><mo>≐</mo><mrow><mo stretchy="false">{</mo><mrow><mi>𝒙</mi><mo>∈</mo><msup><mi>ℝ</mi><mi>n</mi></msup></mrow><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>≥</mo><mrow><mn>0</mn><mo lspace="0.667em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∀</mo><mi>i</mi></mrow></mrow></mrow><mo stretchy="false">}</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{R}_{+}^{n}\doteq\{\bm{x}\in\mathbb{R}^{n}\colon x_{i}\geq 0\ \forall i\}</annotation><annotation encoding="application/x-llamapun">blackboard_R start_POSTSUBSCRIPT + end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT ≐ { bold_italic_x ∈ blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT : italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ≥ 0 ∀ italic_i }</annotation></semantics></math>, namely</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E42">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="T_{h}(\theta)\doteq\operatorname{prox}_{h,\lambda\|\cdot\|_{1}+\chi_{\mathbb{R}_{+}^{n}}}(\theta)=\operatorname*{arg\ min}_{\theta_{1}\in\mathbb{R}_{+}^{n}}\left[\frac{1}{2h}\|\theta_{1}-\theta\|_{2}^{2}+\lambda\|\theta\|_{1}\right]," class="ltx_math_unparsed" display="block" id="S1.E42.m1"><semantics><mrow><mrow><mrow><msub><mi>T</mi><mi>h</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><msub><mi>prox</mi><mrow><mi>h</mi><mo>,</mo><mi>λ</mi><mo lspace="0em" rspace="0em">∥</mo><mo lspace="0em" rspace="0em">⋅</mo><msub><mo lspace="0em" rspace="0em">∥</mo><mn>1</mn></msub><mo lspace="0em">+</mo><msub><mi>χ</mi><msubsup><mi>ℝ</mi><mo>+</mo><mi>n</mi></msubsup></msub></mrow></msub><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>∈</mo><msubsup><mi>ℝ</mi><mo>+</mo><mi>n</mi></msubsup></mrow></munder><mo>⁡</mo><mrow><mo>[</mo><mrow><mrow><mfrac><mn>1</mn><mrow><mn>2</mn><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mfrac><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>−</mo><mi>θ</mi></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo>+</mo><mrow><mi>λ</mi><mo lspace="0em" rspace="0em">​</mo><msub><mrow><mo stretchy="false">‖</mo><mi>θ</mi><mo stretchy="false">‖</mo></mrow><mn>1</mn></msub></mrow></mrow><mo>]</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">T_{h}(\theta)\doteq\operatorname{prox}_{h,\lambda\|\cdot\|_{1}+\chi_{\mathbb{R}_{+}^{n}}}(\theta)=\operatorname*{arg\ min}_{\theta_{1}\in\mathbb{R}_{+}^{n}}\left[\frac{1}{2h}\|\theta_{1}-\theta\|_{2}^{2}+\lambda\|\theta\|_{1}\right],</annotation><annotation encoding="application/x-llamapun">italic_T start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT ( italic_θ ) ≐ roman_prox start_POSTSUBSCRIPT italic_h , italic_λ ∥ ⋅ ∥ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT + italic_χ start_POSTSUBSCRIPT blackboard_R start_POSTSUBSCRIPT + end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_θ ) = start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUBSCRIPT + end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT end_POSTSUBSCRIPT [ divide start_ARG 1 end_ARG start_ARG 2 italic_h end_ARG ∥ italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT - italic_θ ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT + italic_λ ∥ italic_θ ∥ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ] ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.42)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">then <math alttext="T_{h}" class="ltx_Math" display="inline" id="Thmexample3.p1.m3"><semantics><msub><mi>T</mi><mi>h</mi></msub><annotation encoding="application/x-tex">T_{h}</annotation><annotation encoding="application/x-llamapun">italic_T start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT</annotation></semantics></math> is defined as</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E43">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="T_{h}(\theta)_{i}\doteq\max\{\theta_{i}-h\lambda,0\}." class="ltx_Math" display="block" id="S1.E43.m1"><semantics><mrow><mrow><mrow><msub><mi>T</mi><mi>h</mi></msub><mo lspace="0em" rspace="0em">​</mo><msub><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mi>i</mi></msub></mrow><mo>≐</mo><mrow><mi>max</mi><mo>⁡</mo><mrow><mo stretchy="false">{</mo><mrow><msub><mi>θ</mi><mi>i</mi></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mi>λ</mi></mrow></mrow><mo>,</mo><mn>0</mn><mo stretchy="false">}</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">T_{h}(\theta)_{i}\doteq\max\{\theta_{i}-h\lambda,0\}.</annotation><annotation encoding="application/x-llamapun">italic_T start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT ( italic_θ ) start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ≐ roman_max { italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT - italic_h italic_λ , 0 } .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.43)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">This proximal operator yields the non-negative ISTA that is invoked in <a class="ltx_ref" href="Ch4.html" title="Chapter 4 Deep Representations from Unrolled Optimization ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Chapter</span> <span class="ltx_text ltx_ref_tag">4</span></a> and beyond.
 <math alttext="\blacksquare" class="ltx_Math" display="inline" id="Thmexample3.p1.m4"><semantics><mi mathvariant="normal">■</mi><annotation encoding="application/x-tex">\blacksquare</annotation><annotation encoding="application/x-llamapun">■</annotation></semantics></math></p>
</div>
</div>
</section>
<section class="ltx_subsection" id="S1.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.1.4 </span>Stochastic Gradient Descent for Large-Scale Problems</h3>
<div class="ltx_para" id="S1.SS4.p1">
<p class="ltx_p">In deep learning, the objective function <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S1.SS4.p1.m1"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> usually cannot be computed exactly, and instead at each optimization step it is <span class="ltx_text ltx_font_italic">estimated</span> using finite samples (say, using a mini-batch). A common way to model this situation is to define a <span class="ltx_text ltx_font_italic">stochastic loss function</span> <math alttext="\mathcal{L}_{\omega}(\theta)" class="ltx_Math" display="inline" id="S1.SS4.p1.m2"><semantics><mrow><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>ω</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}_{\omega}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUBSCRIPT italic_ω end_POSTSUBSCRIPT ( italic_θ )</annotation></semantics></math> where <math alttext="\omega" class="ltx_Math" display="inline" id="S1.SS4.p1.m3"><semantics><mi>ω</mi><annotation encoding="application/x-tex">\omega</annotation><annotation encoding="application/x-llamapun">italic_ω</annotation></semantics></math> is some “source of randomness”. For example, <math alttext="\omega" class="ltx_Math" display="inline" id="S1.SS4.p1.m4"><semantics><mi>ω</mi><annotation encoding="application/x-tex">\omega</annotation><annotation encoding="application/x-llamapun">italic_ω</annotation></semantics></math> could contain the indices of the samples in a batch over which to compute the loss. Then, we would like to minimize <math alttext="\mathcal{L}(\theta)\doteq\operatorname{\mathbb{E}}_{\omega}[\mathcal{L}_{\omega}(\theta)]" class="ltx_Math" display="inline" id="S1.SS4.p1.m5"><semantics><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><msub><mi>𝔼</mi><mi>ω</mi></msub><mo>⁡</mo><mrow><mo stretchy="false">[</mo><mrow><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>ω</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)\doteq\operatorname{\mathbb{E}}_{\omega}[\mathcal{L}_{\omega}(\theta)]</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ ) ≐ blackboard_E start_POSTSUBSCRIPT italic_ω end_POSTSUBSCRIPT [ caligraphic_L start_POSTSUBSCRIPT italic_ω end_POSTSUBSCRIPT ( italic_θ ) ]</annotation></semantics></math> over <math alttext="\theta" class="ltx_Math" display="inline" id="S1.SS4.p1.m6"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>, given access to a <span class="ltx_text ltx_font_italic">stochastic first-order oracle</span>: given <math alttext="\theta" class="ltx_Math" display="inline" id="S1.SS4.p1.m7"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>, we can sample <math alttext="\omega" class="ltx_Math" display="inline" id="S1.SS4.p1.m8"><semantics><mi>ω</mi><annotation encoding="application/x-tex">\omega</annotation><annotation encoding="application/x-llamapun">italic_ω</annotation></semantics></math> and compute <math alttext="\mathcal{L}_{\omega}(\theta)" class="ltx_Math" display="inline" id="S1.SS4.p1.m9"><semantics><mrow><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>ω</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}_{\omega}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUBSCRIPT italic_ω end_POSTSUBSCRIPT ( italic_θ )</annotation></semantics></math> and <math alttext="\nabla_{\theta}\mathcal{L}_{\omega}(\theta)" class="ltx_Math" display="inline" id="S1.SS4.p1.m10"><semantics><mrow><mrow><msub><mo>∇</mo><mi>θ</mi></msub><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>ω</mi></msub></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla_{\theta}\mathcal{L}_{\omega}(\theta)</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L start_POSTSUBSCRIPT italic_ω end_POSTSUBSCRIPT ( italic_θ )</annotation></semantics></math>. This minimization problem is called a <span class="ltx_text ltx_font_italic">stochastic optimization problem</span>.</p>
</div>
<div class="ltx_para" id="S1.SS4.p2">
<p class="ltx_p">The basic first-order stochastic algorithm is <span class="ltx_text ltx_font_italic">stochastic gradient descent</span>: at each iteration <math alttext="k" class="ltx_Math" display="inline" id="S1.SS4.p2.m1"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation><annotation encoding="application/x-llamapun">italic_k</annotation></semantics></math> we sample <math alttext="\omega_{k}" class="ltx_Math" display="inline" id="S1.SS4.p2.m2"><semantics><msub><mi>ω</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\omega_{k}</annotation><annotation encoding="application/x-llamapun">italic_ω start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>, define <math alttext="\mathcal{L}_{k}\doteq\mathcal{L}_{\omega_{k}}" class="ltx_Math" display="inline" id="S1.SS4.p2.m3"><semantics><mrow><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>k</mi></msub><mo>≐</mo><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><msub><mi>ω</mi><mi>k</mi></msub></msub></mrow><annotation encoding="application/x-tex">\mathcal{L}_{k}\doteq\mathcal{L}_{\omega_{k}}</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ≐ caligraphic_L start_POSTSUBSCRIPT italic_ω start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math>, and perform a gradient step on <math alttext="\mathcal{L}_{k}" class="ltx_Math" display="inline" id="S1.SS4.p2.m4"><semantics><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\mathcal{L}_{k}</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>, i.e.,</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E44">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta_{k+1}=\theta_{k}-h\nabla\mathcal{L}_{k}(\theta_{k})." class="ltx_Math" display="block" id="S1.E44.m1"><semantics><mrow><mrow><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∇</mo><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>k</mi></msub></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\theta_{k+1}=\theta_{k}-h\nabla\mathcal{L}_{k}(\theta_{k}).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_h ∇ caligraphic_L start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.44)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">However, even for very simple problems we cannot expect the same type of convergence as we obtained in gradient descent. For example, suppose that there are <math alttext="m" class="ltx_Math" display="inline" id="S1.SS4.p2.m5"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation><annotation encoding="application/x-llamapun">italic_m</annotation></semantics></math> possible values for <math alttext="\omega\in\{1,\dots,m\}" class="ltx_Math" display="inline" id="S1.SS4.p2.m6"><semantics><mrow><mi>ω</mi><mo>∈</mo><mrow><mo stretchy="false">{</mo><mn>1</mn><mo>,</mo><mi mathvariant="normal">…</mi><mo>,</mo><mi>m</mi><mo stretchy="false">}</mo></mrow></mrow><annotation encoding="application/x-tex">\omega\in\{1,\dots,m\}</annotation><annotation encoding="application/x-llamapun">italic_ω ∈ { 1 , … , italic_m }</annotation></semantics></math> which it takes with equal probability, and there are <math alttext="m" class="ltx_Math" display="inline" id="S1.SS4.p2.m7"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation><annotation encoding="application/x-llamapun">italic_m</annotation></semantics></math> possible targets <math alttext="\xi_{1},\dots,\xi_{m}" class="ltx_Math" display="inline" id="S1.SS4.p2.m8"><semantics><mrow><msub><mi>ξ</mi><mn>1</mn></msub><mo>,</mo><mi mathvariant="normal">…</mi><mo>,</mo><msub><mi>ξ</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">\xi_{1},\dots,\xi_{m}</annotation><annotation encoding="application/x-llamapun">italic_ξ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_ξ start_POSTSUBSCRIPT italic_m end_POSTSUBSCRIPT</annotation></semantics></math>, such that the loss function <math alttext="\mathcal{L}_{\omega}" class="ltx_Math" display="inline" id="S1.SS4.p2.m9"><semantics><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>ω</mi></msub><annotation encoding="application/x-tex">\mathcal{L}_{\omega}</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUBSCRIPT italic_ω end_POSTSUBSCRIPT</annotation></semantics></math> is</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E45">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{\omega}(\theta)\doteq\frac{1}{2}\|\theta-\xi_{\omega}\|_{2}^{2}." class="ltx_Math" display="block" id="S1.E45.m1"><semantics><mrow><mrow><mrow><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>ω</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><mi>θ</mi><mo>−</mo><msub><mi>ξ</mi><mi>ω</mi></msub></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}_{\omega}(\theta)\doteq\frac{1}{2}\|\theta-\xi_{\omega}\|_{2}^{2}.</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUBSCRIPT italic_ω end_POSTSUBSCRIPT ( italic_θ ) ≐ divide start_ARG 1 end_ARG start_ARG 2 end_ARG ∥ italic_θ - italic_ξ start_POSTSUBSCRIPT italic_ω end_POSTSUBSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.45)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Then <math alttext="\operatorname*{arg\ min}_{\theta}\operatorname{\mathbb{E}}[\mathcal{L}_{\omega}(\theta)]=\frac{1}{m}\sum_{i=1}\xi_{i}" class="ltx_Math" display="inline" id="S1.SS4.p2.m10"><semantics><mrow><mrow><mrow><msub><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mi>θ</mi></msub><mo lspace="0.167em">⁡</mo><mi>𝔼</mi></mrow><mo>⁡</mo><mrow><mo stretchy="false">[</mo><mrow><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>ω</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mfrac><mn>1</mn><mi>m</mi></mfrac><mo lspace="0em" rspace="0em">​</mo><mrow><msub><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow></msub><msub><mi>ξ</mi><mi>i</mi></msub></mrow></mrow></mrow><annotation encoding="application/x-tex">\operatorname*{arg\ min}_{\theta}\operatorname{\mathbb{E}}[\mathcal{L}_{\omega}(\theta)]=\frac{1}{m}\sum_{i=1}\xi_{i}</annotation><annotation encoding="application/x-llamapun">start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT blackboard_E [ caligraphic_L start_POSTSUBSCRIPT italic_ω end_POSTSUBSCRIPT ( italic_θ ) ] = divide start_ARG 1 end_ARG start_ARG italic_m end_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT italic_ξ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, but stochastic gradient descent can “pinball” around the global optimum value, and not converge, as visualized in <a class="ltx_ref" href="#F4" title="In A.1.4 Stochastic Gradient Descent for Large-Scale Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Figure</span> <span class="ltx_text ltx_ref_tag">A.4</span></a>.</p>
</div>
<figure class="ltx_figure" id="F4"><img alt="Figure A.4 : Stochastic gradient descent may not converge, even for very benign objectives, but Nesterov gradient converges. For even simple quadratic objectives, stochastic gradient descent iterates may pinball around the global optimum, whereas Nesterov gradients align to point to the optimal value." class="ltx_graphics ltx_img_landscape" height="266" id="F4.g1" src="chapters/appendixA/figs/sgd_vs_nesterov.png" width="598"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" style="font-size:90%;">Figure A.4</span>: </span><span class="ltx_text ltx_font_bold" style="font-size:90%;">Stochastic gradient descent may not converge, even for very benign objectives, but Nesterov gradient converges.<span class="ltx_text ltx_font_medium"> For even simple quadratic objectives, stochastic gradient descent iterates may pinball around the global optimum, whereas Nesterov gradients align to point to the optimal value.</span></span></figcaption>
</figure>
<div class="ltx_para" id="S1.SS4.p3">
<p class="ltx_p">In order to fix this, we can either average the parameters <math alttext="\theta_{k}" class="ltx_Math" display="inline" id="S1.SS4.p3.m1"><semantics><msub><mi>θ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\theta_{k}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> or average the gradients <math alttext="\nabla\mathcal{L}_{k}(\theta_{k})" class="ltx_Math" display="inline" id="S1.SS4.p3.m2"><semantics><mrow><mrow><mo rspace="0.167em">∇</mo><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>k</mi></msub></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla\mathcal{L}_{k}(\theta_{k})</annotation><annotation encoding="application/x-llamapun">∇ caligraphic_L start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT )</annotation></semantics></math> over time. If we average the parameters <math alttext="\theta_{k}" class="ltx_Math" display="inline" id="S1.SS4.p3.m3"><semantics><msub><mi>θ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\theta_{k}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>, then (using <a class="ltx_ref" href="#F4" title="In A.1.4 Stochastic Gradient Descent for Large-Scale Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Figure</span> <span class="ltx_text ltx_ref_tag">A.4</span></a> as a mental model) the issue of pinballing is straightforwardly not possible, since the average iterate will grow closer to the center. As such, most theoretical convergence proofs consider the convergence of the average iterate <math alttext="\frac{1}{k}\sum_{i=0}^{k}\theta_{i}" class="ltx_Math" display="inline" id="S1.SS4.p3.m4"><semantics><mrow><mfrac><mn>1</mn><mi>k</mi></mfrac><mo lspace="0em" rspace="0em">​</mo><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>k</mi></msubsup><msub><mi>θ</mi><mi>i</mi></msub></mrow></mrow><annotation encoding="application/x-tex">\frac{1}{k}\sum_{i=0}^{k}\theta_{i}</annotation><annotation encoding="application/x-llamapun">divide start_ARG 1 end_ARG start_ARG italic_k end_ARG ∑ start_POSTSUBSCRIPT italic_i = 0 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT italic_θ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> to the global minimum. If we average the gradients, we will eventually learn an average gradient <math alttext="\frac{1}{k}\sum_{i=0}^{k}\nabla\mathcal{L}_{k}(\theta_{k})" class="ltx_Math" display="inline" id="S1.SS4.p3.m5"><semantics><mrow><mfrac><mn>1</mn><mi>k</mi></mfrac><mo lspace="0em" rspace="0em">​</mo><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>k</mi></msubsup><mrow><mrow><mo rspace="0.167em">∇</mo><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>k</mi></msub></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex">\frac{1}{k}\sum_{i=0}^{k}\nabla\mathcal{L}_{k}(\theta_{k})</annotation><annotation encoding="application/x-llamapun">divide start_ARG 1 end_ARG start_ARG italic_k end_ARG ∑ start_POSTSUBSCRIPT italic_i = 0 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT ∇ caligraphic_L start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT )</annotation></semantics></math> which does not change much at each iteration and therefore does not pinball.</p>
</div>
<div class="ltx_para" id="S1.SS4.p4">
<p class="ltx_p">In practice, instead of using an arithmetic average, we take an <span class="ltx_text ltx_font_italic">exponentially moving average</span> (EMA) of the parameters (this is called <span class="ltx_text ltx_font_italic">Polyak momentum</span>) or of the gradients (this is called <span class="ltx_text ltx_font_italic">Nesterov momentum</span>). Nesterov momentum is more popular and we will study it here.</p>
</div>
<div class="ltx_para" id="S1.SS4.p5">
<p class="ltx_p">A stochastic gradient descent iteration with Nesterov momentum is as follows:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx104">
<tbody id="S1.E46"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\bm{g}_{k}" class="ltx_Math" display="inline" id="S1.E46.m1"><semantics><msub><mi>𝒈</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\displaystyle\bm{g}_{k}</annotation><annotation encoding="application/x-llamapun">bold_italic_g start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\beta\bm{g}_{k-1}+(1-\beta)\nabla\mathcal{L}_{k}(\theta_{k})" class="ltx_Math" display="inline" id="S1.E46.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mi>β</mi><mo lspace="0em" rspace="0em">​</mo><msub><mi>𝒈</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><mo>+</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>−</mo><mi>β</mi></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0.167em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∇</mo><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>k</mi></msub></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\beta\bm{g}_{k-1}+(1-\beta)\nabla\mathcal{L}_{k}(\theta_{k})</annotation><annotation encoding="application/x-llamapun">= italic_β bold_italic_g start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT + ( 1 - italic_β ) ∇ caligraphic_L start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.46)</span></td>
</tr></tbody>
<tbody id="S1.E47"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\theta_{k+1}" class="ltx_Math" display="inline" id="S1.E47.m1"><semantics><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\displaystyle\theta_{k+1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\theta_{k}-h\bm{g}_{k}." class="ltx_Math" display="inline" id="S1.E47.m2"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><msub><mi>𝒈</mi><mi>k</mi></msub></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\theta_{k}-h\bm{g}_{k}.</annotation><annotation encoding="application/x-llamapun">= italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_h bold_italic_g start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.47)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">We do not go through a convergence proof (see Chapter 7 of <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx90" title="">GG23</a>]</cite> for an example). However, Nesterov momentum handles our toy case in <a class="ltx_ref" href="#F4" title="In A.1.4 Stochastic Gradient Descent for Large-Scale Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Figure</span> <span class="ltx_text ltx_ref_tag">A.4</span></a> easily (see the right-hand figure): it stops pinballing and eventually converges to the global optimum.</p>
</div>
<div class="ltx_para" id="S1.SS4.p6">
<p class="ltx_p">We end with a caveat: one can show that Polyak momentum and Nesterov momentum are equivalent, for certain choices of parameter settings. Then it is also possible to show that a decaying learning rate schedule (i.e., the learning rate <math alttext="h" class="ltx_Math" display="inline" id="S1.SS4.p6.m1"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math> depends on the iteration <math alttext="k" class="ltx_Math" display="inline" id="S1.SS4.p6.m2"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation><annotation encoding="application/x-llamapun">italic_k</annotation></semantics></math>, and its limit is <math alttext="h_{k}\to 0" class="ltx_Math" display="inline" id="S1.SS4.p6.m3"><semantics><mrow><msub><mi>h</mi><mi>k</mi></msub><mo stretchy="false">→</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">h_{k}\to 0</annotation><annotation encoding="application/x-llamapun">italic_h start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT → 0</annotation></semantics></math> as <math alttext="k\to\infty" class="ltx_Math" display="inline" id="S1.SS4.p6.m4"><semantics><mrow><mi>k</mi><mo stretchy="false">→</mo><mi mathvariant="normal">∞</mi></mrow><annotation encoding="application/x-tex">k\to\infty</annotation><annotation encoding="application/x-llamapun">italic_k → ∞</annotation></semantics></math>) with plain SGD (or PSGD) can mimic the effect of momentum. Namely, <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx68" title="">DCM+23</a>]</cite> shows that if the SGD algorithm lasts <math alttext="K" class="ltx_Math" display="inline" id="S1.SS4.p6.m5"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation><annotation encoding="application/x-llamapun">italic_K</annotation></semantics></math> iterations, the gradient norms are bounded <math alttext="\|\nabla\mathcal{L}(\theta_{k})\|_{2}\leq G" class="ltx_Math" display="inline" id="S1.SS4.p6.m6"><semantics><mrow><msub><mrow><mo stretchy="false">‖</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><mo>≤</mo><mi>G</mi></mrow><annotation encoding="application/x-tex">\|\nabla\mathcal{L}(\theta_{k})\|_{2}\leq G</annotation><annotation encoding="application/x-llamapun">∥ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ≤ italic_G</annotation></semantics></math>, and we define <math alttext="D\doteq\|\theta_{0}-\theta^{\star}\|_{2}" class="ltx_Math" display="inline" id="S1.SS4.p6.m7"><semantics><mrow><mi>D</mi><mo>≐</mo><msub><mrow><mo stretchy="false">‖</mo><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>−</mo><msup><mi>θ</mi><mo>⋆</mo></msup></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">D\doteq\|\theta_{0}-\theta^{\star}\|_{2}</annotation><annotation encoding="application/x-llamapun">italic_D ≐ ∥ italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT - italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>, then plain SGD iterates <math alttext="\theta_{k}" class="ltx_Math" display="inline" id="S1.SS4.p6.m8"><semantics><msub><mi>θ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\theta_{k}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> satisfy the rate <math alttext="\operatorname{\mathbb{E}}[\mathcal{L}(\theta_{k})-\mathcal{L}(\theta^{\star})]\leq DG/\sqrt{K}" class="ltx_Math" display="inline" id="S1.SS4.p6.m9"><semantics><mrow><mrow><mi>𝔼</mi><mo>⁡</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>≤</mo><mrow><mrow><mi>D</mi><mo lspace="0em" rspace="0em">​</mo><mi>G</mi></mrow><mo>/</mo><msqrt><mi>K</mi></msqrt></mrow></mrow><annotation encoding="application/x-tex">\operatorname{\mathbb{E}}[\mathcal{L}(\theta_{k})-\mathcal{L}(\theta^{\star})]\leq DG/\sqrt{K}</annotation><annotation encoding="application/x-llamapun">blackboard_E [ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) - caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ] ≤ italic_D italic_G / square-root start_ARG italic_K end_ARG</annotation></semantics></math> — but only so long as the learning rate <math alttext="h_{k}=(D/[G\sqrt{K}])(1-k/K)" class="ltx_Math" display="inline" id="S1.SS4.p6.m10"><semantics><mrow><msub><mi>h</mi><mi>k</mi></msub><mo>=</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mi>D</mi><mo>/</mo><mrow><mo stretchy="false">[</mo><mrow><mi>G</mi><mo lspace="0em" rspace="0em">​</mo><msqrt><mi>K</mi></msqrt></mrow><mo stretchy="false">]</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>−</mo><mrow><mi>k</mi><mo>/</mo><mi>K</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">h_{k}=(D/[G\sqrt{K}])(1-k/K)</annotation><annotation encoding="application/x-llamapun">italic_h start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT = ( italic_D / [ italic_G square-root start_ARG italic_K end_ARG ] ) ( 1 - italic_k / italic_K )</annotation></semantics></math> decays <span class="ltx_text ltx_font_italic">linearly</span> with time. This matches learning rate schedules used in practice. Indeed, surprisingly, such a theory of convex optimization can predict many empirical phenomena in deep networks <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx239" title="">SHT+25</a>]</cite>, despite deep learning optimization being highly non-convex and non-smooth in the worst case. It is so far unclear why this is the case.</p>
</div>
</section>
<section class="ltx_subsection" id="S1.SS5">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.1.5 </span>Putting Everything Together: Adam</h3>
<div class="ltx_para" id="S1.SS5.p1">
<p class="ltx_p">The gradient descent scheme proposes an iteration of the form</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E48">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta_{k+1}=\theta_{k}+h\bm{v}_{k}," class="ltx_Math" display="block" id="S1.E48.m1"><semantics><mrow><mrow><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>+</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><msub><mi>𝒗</mi><mi>k</mi></msub></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\theta_{k+1}=\theta_{k}+h\bm{v}_{k},</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT + italic_h bold_italic_v start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.48)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where (recall) <math alttext="\bm{v}_{k}" class="ltx_Math" display="inline" id="S1.SS5.p1.m1"><semantics><msub><mi>𝒗</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\bm{v}_{k}</annotation><annotation encoding="application/x-llamapun">bold_italic_v start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> is chosen to be (proportional to) the steepest descent vector in the Euclidean norm:</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E49">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\bm{v}_{k}=-\frac{\nabla\mathcal{L}(\theta_{k})}{\|\nabla\mathcal{L}(\theta_{k})\|_{2}}\in\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{n}\\
\|\bm{v}\|_{2}=1\end{subarray}}\langle\nabla\mathcal{L}(\theta_{k}),\bm{v}\rangle." class="ltx_Math" display="block" id="S1.E49.m1"><semantics><mrow><mrow><msub><mi>𝒗</mi><mi>k</mi></msub><mo>=</mo><mrow><mo>−</mo><mfrac><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><msub><mrow><mo stretchy="false">‖</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub></mfrac></mrow><mo>∈</mo><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mtable rowspacing="0pt"><mtr><mtd><mrow><mi>𝒗</mi><mo>∈</mo><msup><mi>ℝ</mi><mi>n</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mo stretchy="false">‖</mo><mi>𝒗</mi><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><mo>=</mo><mn>1</mn></mrow></mtd></mtr></mtable></munder><mo>⁡</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\bm{v}_{k}=-\frac{\nabla\mathcal{L}(\theta_{k})}{\|\nabla\mathcal{L}(\theta_{k})\|_{2}}\in\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{n}\\
\|\bm{v}\|_{2}=1\end{subarray}}\langle\nabla\mathcal{L}(\theta_{k}),\bm{v}\rangle.</annotation><annotation encoding="application/x-llamapun">bold_italic_v start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT = - divide start_ARG ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) end_ARG start_ARG ∥ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT end_ARG ∈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT start_ARG start_ROW start_CELL bold_italic_v ∈ blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT end_CELL end_ROW start_ROW start_CELL ∥ bold_italic_v ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT = 1 end_CELL end_ROW end_ARG end_POSTSUBSCRIPT ⟨ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) , bold_italic_v ⟩ .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.49)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">However, in the context of deep learning optimization, there is absolutely nothing which implies that we have to use the Euclidean norm; indeed the “natural geometry” of the space of parameters is not well-respected by the Euclidean norm, since small changes in the parameter space can lead to very large differences in the output space, for a particular fixed input to the network. If we were instead to use a generic norm <math alttext="\|\cdot\|" class="ltx_math_unparsed" display="inline" id="S1.SS5.p1.m2"><semantics><mrow><mo rspace="0em">∥</mo><mo lspace="0em" rspace="0em">⋅</mo><mo lspace="0em">∥</mo></mrow><annotation encoding="application/x-tex">\|\cdot\|</annotation><annotation encoding="application/x-llamapun">∥ ⋅ ∥</annotation></semantics></math> on the parameter space <math alttext="\mathbb{R}^{n}" class="ltx_Math" display="inline" id="S1.SS5.p1.m3"><semantics><msup><mi>ℝ</mi><mi>n</mi></msup><annotation encoding="application/x-tex">\mathbb{R}^{n}</annotation><annotation encoding="application/x-llamapun">blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT</annotation></semantics></math>, we would get some other quantity corresponding to the so-called <span class="ltx_text ltx_font_italic">dual norm</span>:</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E50">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\bm{v}_{k}\in\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{n}\\
\|\bm{v}\|=1\end{subarray}}\langle\nabla\mathcal{L}(\theta_{k}),\bm{v}\rangle." class="ltx_Math" display="block" id="S1.E50.m1"><semantics><mrow><mrow><msub><mi>𝒗</mi><mi>k</mi></msub><mo>∈</mo><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mtable rowspacing="0pt"><mtr><mtd><mrow><mi>𝒗</mi><mo>∈</mo><msup><mi>ℝ</mi><mi>n</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><mrow><mo stretchy="false">‖</mo><mi>𝒗</mi><mo stretchy="false">‖</mo></mrow><mo>=</mo><mn>1</mn></mrow></mtd></mtr></mtable></munder><mo>⁡</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\bm{v}_{k}\in\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{n}\\
\|\bm{v}\|=1\end{subarray}}\langle\nabla\mathcal{L}(\theta_{k}),\bm{v}\rangle.</annotation><annotation encoding="application/x-llamapun">bold_italic_v start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT start_ARG start_ROW start_CELL bold_italic_v ∈ blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT end_CELL end_ROW start_ROW start_CELL ∥ bold_italic_v ∥ = 1 end_CELL end_ROW end_ARG end_POSTSUBSCRIPT ⟨ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) , bold_italic_v ⟩ .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.50)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">For instance, if we were to use the <math alttext="\ell^{\infty}" class="ltx_Math" display="inline" id="S1.SS5.p1.m4"><semantics><msup><mi mathvariant="normal">ℓ</mi><mi mathvariant="normal">∞</mi></msup><annotation encoding="application/x-tex">\ell^{\infty}</annotation><annotation encoding="application/x-llamapun">roman_ℓ start_POSTSUPERSCRIPT ∞ end_POSTSUPERSCRIPT</annotation></semantics></math>-norm, it is possible to show that</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E51">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\bm{v}_{k}=-\operatorname{sign}(\nabla\mathcal{L}(\theta_{k}))\in\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{n}\\
\|\bm{v}\|_{\infty}=1\end{subarray}}\langle\nabla\mathcal{L}(\theta_{k}),\bm{v}\rangle," class="ltx_Math" display="block" id="S1.E51.m1"><semantics><mrow><mrow><msub><mi>𝒗</mi><mi>k</mi></msub><mo>=</mo><mrow><mo rspace="0.167em">−</mo><mrow><mi>sign</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>∈</mo><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mtable rowspacing="0pt"><mtr><mtd><mrow><mi>𝒗</mi><mo>∈</mo><msup><mi>ℝ</mi><mi>n</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><msub><mrow><mo stretchy="false">‖</mo><mi>𝒗</mi><mo stretchy="false">‖</mo></mrow><mi mathvariant="normal">∞</mi></msub><mo>=</mo><mn>1</mn></mrow></mtd></mtr></mtable></munder><mo>⁡</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mi>𝒗</mi><mo stretchy="false">⟩</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\bm{v}_{k}=-\operatorname{sign}(\nabla\mathcal{L}(\theta_{k}))\in\operatorname*{arg\ min}_{\begin{subarray}{c}\bm{v}\in\mathbb{R}^{n}\\
\|\bm{v}\|_{\infty}=1\end{subarray}}\langle\nabla\mathcal{L}(\theta_{k}),\bm{v}\rangle,</annotation><annotation encoding="application/x-llamapun">bold_italic_v start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT = - roman_sign ( ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ) ∈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT start_ARG start_ROW start_CELL bold_italic_v ∈ blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT end_CELL end_ROW start_ROW start_CELL ∥ bold_italic_v ∥ start_POSTSUBSCRIPT ∞ end_POSTSUBSCRIPT = 1 end_CELL end_ROW end_ARG end_POSTSUBSCRIPT ⟨ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) , bold_italic_v ⟩ ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.51)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where <math alttext="\operatorname{sign}(\bm{x})_{i}=\operatorname{sign}(x_{i})\in\{-1,0,1\}" class="ltx_math_unparsed" display="inline" id="S1.SS5.p1.m5"><semantics><mrow><mi>sign</mi><msub><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow><mi>i</mi></msub><mo>=</mo><mi>sign</mi><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><mo>∈</mo><mrow><mo stretchy="false">{</mo><mo lspace="0em">−</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">}</mo></mrow></mrow><annotation encoding="application/x-tex">\operatorname{sign}(\bm{x})_{i}=\operatorname{sign}(x_{i})\in\{-1,0,1\}</annotation><annotation encoding="application/x-llamapun">roman_sign ( bold_italic_x ) start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = roman_sign ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ∈ { - 1 , 0 , 1 }</annotation></semantics></math>. Thus if we were so-inclined, we could use the so-called <span class="ltx_text ltx_font_italic">sign-gradient descent</span>:</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E52">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta_{k+1}=\theta_{k}-h\operatorname{sign}(\nabla\mathcal{L}(\theta_{k}))." class="ltx_Math" display="block" id="S1.E52.m1"><semantics><mrow><mrow><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><mi>sign</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\theta_{k+1}=\theta_{k}-h\operatorname{sign}(\nabla\mathcal{L}(\theta_{k})).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_h roman_sign ( ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.52)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">From sign-gradient descent, we can derive the famous Adam optimization algorithm. Note that for a scalar <math alttext="x\in\mathbb{R}" class="ltx_Math" display="inline" id="S1.SS5.p1.m6"><semantics><mrow><mi>x</mi><mo>∈</mo><mi>ℝ</mi></mrow><annotation encoding="application/x-tex">x\in\mathbb{R}</annotation><annotation encoding="application/x-llamapun">italic_x ∈ blackboard_R</annotation></semantics></math> we can write</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E53">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\operatorname{sign}(x)=\frac{x}{\lvert x\rvert}=\frac{x}{\sqrt{x^{2}}}." class="ltx_Math" display="block" id="S1.E53.m1"><semantics><mrow><mrow><mrow><mi>sign</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mfrac><mi>x</mi><mrow><mo stretchy="false">|</mo><mi>x</mi><mo stretchy="false">|</mo></mrow></mfrac><mo>=</mo><mfrac><mi>x</mi><msqrt><msup><mi>x</mi><mn>2</mn></msup></msqrt></mfrac></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\operatorname{sign}(x)=\frac{x}{\lvert x\rvert}=\frac{x}{\sqrt{x^{2}}}.</annotation><annotation encoding="application/x-llamapun">roman_sign ( italic_x ) = divide start_ARG italic_x end_ARG start_ARG | italic_x | end_ARG = divide start_ARG italic_x end_ARG start_ARG square-root start_ARG italic_x start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT end_ARG end_ARG .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.53)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Similarly, for a vector <math alttext="\bm{x}\in\mathbb{R}^{n}" class="ltx_Math" display="inline" id="S1.SS5.p1.m7"><semantics><mrow><mi>𝒙</mi><mo>∈</mo><msup><mi>ℝ</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">\bm{x}\in\mathbb{R}^{n}</annotation><annotation encoding="application/x-llamapun">bold_italic_x ∈ blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT</annotation></semantics></math> we write (where <math alttext="\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}" class="ltx_Math" display="inline" id="S1.SS5.p1.m8"><semantics><mpadded class="ltx_markedasmath" depth="0.7pt" height="4.7pt" voffset="1.3pt" width="8.0pt"><mo class="ltx_markedasmath">⊙</mo></mpadded><annotation encoding="application/x-tex">\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}</annotation><annotation encoding="application/x-llamapun">⊙</annotation></semantics></math> and
<math alttext="\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}}" class="ltx_Math" display="inline" id="S1.SS5.p1.m9"><semantics><mpadded class="ltx_markedasmath" depth="0.7pt" height="4.7pt" voffset="1.3pt" width="8.0pt"><mo class="ltx_markedasmath">⊘</mo></mpadded><annotation encoding="application/x-tex">\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}}</annotation><annotation encoding="application/x-llamapun">⊘</annotation></semantics></math> are element-wise multiplication and division)</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E54">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\operatorname{sign}(\bm{x})=\bm{x}\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}}[\bm{x}^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}2}]^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}(1/2)}." class="ltx_Math" display="block" id="S1.E54.m1"><semantics><mrow><mrow><mrow><mi>sign</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mi>𝒙</mi><mpadded class="ltx_markedasmath" depth="0.7pt" height="4.7pt" voffset="1.3pt" width="8.0pt"><mo class="ltx_markedasmath">⊘</mo></mpadded><msup><mrow><mo lspace="0.222em" stretchy="false">[</mo><msup><mi>𝒙</mi><mrow><mpadded depth="0.2pt" height="1.6pt" voffset="0.8pt" width="3.0pt"><mo class="ltx_markedasmath" mathsize="48%">⊙</mo></mpadded><mn>2</mn></mrow></msup><mo stretchy="false">]</mo></mrow><mrow><mpadded depth="0.2pt" height="1.6pt" voffset="0.8pt" width="3.0pt"><mo class="ltx_markedasmath" mathsize="48%">⊙</mo></mpadded><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>/</mo><mn>2</mn></mrow><mo stretchy="false">)</mo></mrow></mrow></msup></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\operatorname{sign}(\bm{x})=\bm{x}\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}}[\bm{x}^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}2}]^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}(1/2)}.</annotation><annotation encoding="application/x-llamapun">roman_sign ( bold_italic_x ) = bold_italic_x ⊘ [ bold_italic_x start_POSTSUPERSCRIPT ⊙ 2 end_POSTSUPERSCRIPT ] start_POSTSUPERSCRIPT ⊙ ( 1 / 2 ) end_POSTSUPERSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.54)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Using this representation we can write (<a class="ltx_ref" href="#S1.E52" title="Equation A.1.52 ‣ A.1.5 Putting Everything Together: Adam ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">A.1.52</span></a>) as</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E55">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta_{k+1}=\theta_{k}-h([\nabla\mathcal{L}(\theta_{k})]\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}}[\nabla\mathcal{L}(\theta_{k})^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}2}]^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}\frac{1}{2}})." class="ltx_Math" display="block" id="S1.E55.m1"><semantics><mrow><mrow><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mo stretchy="false">[</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo rspace="0.222em" stretchy="false">]</mo></mrow><mpadded class="ltx_markedasmath" depth="0.7pt" height="4.7pt" voffset="1.3pt" width="8.0pt"><mo class="ltx_markedasmath">⊘</mo></mpadded><msup><mrow><mo lspace="0.222em" stretchy="false">[</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><mrow><mpadded depth="0.2pt" height="1.6pt" voffset="0.8pt" width="3.0pt"><mo class="ltx_markedasmath" mathsize="48%">⊙</mo></mpadded><mn>2</mn></mrow></msup></mrow><mo stretchy="false">]</mo></mrow><mrow><mpadded depth="0.2pt" height="1.6pt" voffset="0.8pt" width="3.0pt"><mo class="ltx_markedasmath" mathsize="48%">⊙</mo></mpadded><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow></msup></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\theta_{k+1}=\theta_{k}-h([\nabla\mathcal{L}(\theta_{k})]\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}}[\nabla\mathcal{L}(\theta_{k})^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}2}]^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}\frac{1}{2}}).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_h ( [ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ] ⊘ [ ∇ caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) start_POSTSUPERSCRIPT ⊙ 2 end_POSTSUPERSCRIPT ] start_POSTSUPERSCRIPT ⊙ divide start_ARG 1 end_ARG start_ARG 2 end_ARG end_POSTSUPERSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.55)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Now consider the stochastic regime where we are optimizing a different loss <math alttext="L_{k}" class="ltx_Math" display="inline" id="S1.SS5.p1.m10"><semantics><msub><mi>L</mi><mi>k</mi></msub><annotation encoding="application/x-tex">L_{k}</annotation><annotation encoding="application/x-llamapun">italic_L start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> at each iteration. In SGD, we “tracked” (i.e., took an average of) the gradients using Nesterov momentum. Here, we can track both the gradient and the squared gradient using momentum, i.e.,</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx105">
<tbody id="S1.E56"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\bm{g}_{k}" class="ltx_Math" display="inline" id="S1.E56.m1"><semantics><msub><mi>𝒈</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\displaystyle\bm{g}_{k}</annotation><annotation encoding="application/x-llamapun">bold_italic_g start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\beta^{1}\bm{g}_{k-1}+(1-\beta^{1})\nabla\mathcal{L}_{k}(\theta_{k})" class="ltx_Math" display="inline" id="S1.E56.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><msup><mi>β</mi><mn>1</mn></msup><mo lspace="0em" rspace="0em">​</mo><msub><mi>𝒈</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><mo>+</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>−</mo><msup><mi>β</mi><mn>1</mn></msup></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0.167em" rspace="0em">​</mo><mrow><mo rspace="0.167em">∇</mo><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>k</mi></msub></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\beta^{1}\bm{g}_{k-1}+(1-\beta^{1})\nabla\mathcal{L}_{k}(\theta_{k})</annotation><annotation encoding="application/x-llamapun">= italic_β start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT bold_italic_g start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT + ( 1 - italic_β start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT ) ∇ caligraphic_L start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.56)</span></td>
</tr></tbody>
<tbody id="S1.E57"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\bm{s}_{k}" class="ltx_Math" display="inline" id="S1.E57.m1"><semantics><msub><mi>𝒔</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\displaystyle\bm{s}_{k}</annotation><annotation encoding="application/x-llamapun">bold_italic_s start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\beta^{2}\bm{s}_{k-1}+(1-\beta^{2})[\nabla\mathcal{L}_{k}(\theta_{k})]^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}2}" class="ltx_Math" display="inline" id="S1.E57.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><msup><mi>β</mi><mn>2</mn></msup><mo lspace="0em" rspace="0em">​</mo><msub><mi>𝒔</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><mo>+</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>−</mo><msup><mi>β</mi><mn>2</mn></msup></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mrow><mo stretchy="false">[</mo><mrow><mrow><mo rspace="0.167em">∇</mo><msub><mi class="ltx_font_mathcaligraphic">ℒ</mi><mi>k</mi></msub></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow><mrow><mpadded depth="0.2pt" height="1.6pt" voffset="0.8pt" width="3.0pt"><mo class="ltx_markedasmath" mathsize="48%">⊙</mo></mpadded><mn>2</mn></mrow></msup></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\beta^{2}\bm{s}_{k-1}+(1-\beta^{2})[\nabla\mathcal{L}_{k}(\theta_{k})]^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}2}</annotation><annotation encoding="application/x-llamapun">= italic_β start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT bold_italic_s start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT + ( 1 - italic_β start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ) [ ∇ caligraphic_L start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ] start_POSTSUPERSCRIPT ⊙ 2 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.57)</span></td>
</tr></tbody>
<tbody id="S1.E58"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\theta_{k+1}" class="ltx_Math" display="inline" id="S1.E58.m1"><semantics><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\displaystyle\theta_{k+1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\theta_{k}-h\bm{g}_{k}\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}}\bm{s}_{k}^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}\frac{1}{2}}," class="ltx_Math" display="inline" id="S1.E58.m2"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><msub><mi>𝒈</mi><mi>k</mi></msub></mrow><mpadded class="ltx_markedasmath" depth="0.7pt" height="4.7pt" voffset="1.3pt" width="8.0pt"><mo class="ltx_markedasmath">⊘</mo></mpadded><msubsup><mi>𝒔</mi><mi>k</mi><mrow><mpadded depth="0.2pt" height="1.6pt" voffset="0.8pt" width="3.0pt"><mo class="ltx_markedasmath" mathsize="48%">⊙</mo></mpadded><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow></msubsup></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\theta_{k}-h\bm{g}_{k}\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\oslash$}}{\scalebox{0.8}{$\textstyle\oslash$}}{\scalebox{0.8}{$\scriptstyle\oslash$}}{\scalebox{0.8}{$\scriptscriptstyle\oslash$}}$}}}\bm{s}_{k}^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}\frac{1}{2}},</annotation><annotation encoding="application/x-llamapun">= italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_h bold_italic_g start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ⊘ bold_italic_s start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊙ divide start_ARG 1 end_ARG start_ARG 2 end_ARG end_POSTSUPERSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.58)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where <math alttext="\beta^{i}\in[0,1]" class="ltx_Math" display="inline" id="S1.SS5.p1.m11"><semantics><mrow><msup><mi>β</mi><mi>i</mi></msup><mo>∈</mo><mrow><mo stretchy="false">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false">]</mo></mrow></mrow><annotation encoding="application/x-tex">\beta^{i}\in[0,1]</annotation><annotation encoding="application/x-llamapun">italic_β start_POSTSUPERSCRIPT italic_i end_POSTSUPERSCRIPT ∈ [ 0 , 1 ]</annotation></semantics></math> are the momentum parameters. The algorithm
presented by this iteration is the celebrated <span class="ltx_text ltx_font_italic">Adam</span>
optimizer,<span class="ltx_note ltx_role_footnote" id="footnote5"><sup class="ltx_note_mark">5</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">5</sup><span class="ltx_tag ltx_tag_note">5</span>In order to avoid division-by-zero errors, we divide by
<math alttext="\bm{s}_{k}^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}(1/2)}+\varepsilon\bm{1}_{n}" class="ltx_Math" display="inline" id="footnote5.m1"><semantics><mrow><msubsup><mi>𝒔</mi><mi>k</mi><mrow><mpadded depth="0.2pt" height="1.6pt" voffset="0.8pt" width="3.0pt"><mo class="ltx_markedasmath" mathsize="48%">⊙</mo></mpadded><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>/</mo><mn>2</mn></mrow><mo stretchy="false">)</mo></mrow></mrow></msubsup><mo>+</mo><mrow><mi>ε</mi><mo lspace="0em" rspace="0em">​</mo><msub><mn>𝟏</mn><mi>n</mi></msub></mrow></mrow><annotation encoding="application/x-tex">\bm{s}_{k}^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}(1/2)}+\varepsilon\bm{1}_{n}</annotation><annotation encoding="application/x-llamapun">bold_italic_s start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊙ ( 1 / 2 ) end_POSTSUPERSCRIPT + italic_ε bold_1 start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT</annotation></semantics></math> where <math alttext="\varepsilon" class="ltx_Math" display="inline" id="footnote5.m2"><semantics><mi>ε</mi><annotation encoding="application/x-tex">\varepsilon</annotation><annotation encoding="application/x-llamapun">italic_ε</annotation></semantics></math> is small, say on the order of <math alttext="10^{-8}" class="ltx_Math" display="inline" id="footnote5.m3"><semantics><msup><mn>10</mn><mrow><mo>−</mo><mn>8</mn></mrow></msup><annotation encoding="application/x-tex">10^{-8}</annotation><annotation encoding="application/x-llamapun">10 start_POSTSUPERSCRIPT - 8 end_POSTSUPERSCRIPT</annotation></semantics></math>.</span></span></span> which is the most-used optimizer in deep learning. While convergence proofs of Adam are more involved, it falls out of the same steepest descent principle we used so far, and so we should expect that given a small enough learning rate, each update should improve the loss.</p>
</div>
<div class="ltx_para" id="S1.SS5.p2">
<p class="ltx_p">Another way to view Adam, which partially explains its empirical success, is that it dynamically updates the learning rates for each parameter based on the squared gradients. In particular, notice that we can write</p>
<table class="ltx_equation ltx_eqn_table" id="S1.E59">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta_{k+1}=\theta_{k}-\eta_{k}\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}\bm{g}_{k}\qquad\text{where}\qquad\eta_{k}=h\bm{s}_{k}^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}(-\frac{1}{2})}" class="ltx_Math" display="block" id="S1.E59.m1"><semantics><mrow><mrow><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>−</mo><mrow><msub><mi>η</mi><mi>k</mi></msub><mpadded class="ltx_markedasmath" depth="0.7pt" height="4.7pt" voffset="1.3pt" width="8.0pt"><mo class="ltx_markedasmath">⊙</mo></mpadded><msub><mi>𝒈</mi><mi>k</mi></msub></mrow></mrow><mspace width="2em"></mspace><mtext>where</mtext></mrow></mrow><mspace width="2em"></mspace><mrow><msub><mi>η</mi><mi>k</mi></msub><mo>=</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><msubsup><mi>𝒔</mi><mi>k</mi><mrow><mpadded depth="0.2pt" height="1.6pt" voffset="0.8pt" width="3.0pt"><mo class="ltx_markedasmath" mathsize="48%">⊙</mo></mpadded><mrow><mo stretchy="false">(</mo><mrow><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow><mo stretchy="false">)</mo></mrow></mrow></msubsup></mrow></mrow></mrow><annotation encoding="application/x-tex">\theta_{k+1}=\theta_{k}-\eta_{k}\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}\bm{g}_{k}\qquad\text{where}\qquad\eta_{k}=h\bm{s}_{k}^{\mathbin{\mathchoice{\raisebox{1.3pt}{$\displaystyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{1.3pt}{$\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.75pt}{$\scriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}{\raisebox{0.6pt}{$\scriptscriptstyle\mathchoice{\scalebox{0.8}{$\displaystyle\odot$}}{\scalebox{0.8}{$\textstyle\odot$}}{\scalebox{0.8}{$\scriptstyle\odot$}}{\scalebox{0.8}{$\scriptscriptstyle\odot$}}$}}}(-\frac{1}{2})}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ⊙ bold_italic_g start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT where italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT = italic_h bold_italic_s start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊙ ( - divide start_ARG 1 end_ARG start_ARG 2 end_ARG ) end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.1.59)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where <math alttext="\eta_{k}" class="ltx_Math" display="inline" id="S1.SS5.p2.m1"><semantics><msub><mi>η</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\eta_{k}</annotation><annotation encoding="application/x-llamapun">italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> is the parameter-wise adaptively set learning rate. This scheme is called adaptive because if the gradient of a particular parameter is large up to iteration <math alttext="k" class="ltx_Math" display="inline" id="S1.SS5.p2.m2"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation><annotation encoding="application/x-llamapun">italic_k</annotation></semantics></math>, then the learning rate for this parameter becomes smaller to compensate, and vice versa, as can be seen from the above equation.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">A.2 </span>Computing Gradients via Automatic Differentiation</h2>
<div class="ltx_para" id="S2.p1">
<p class="ltx_p">Above, we discussed several optimization algorithms for deep networks which assumed access to a <span class="ltx_text ltx_font_italic">first-order oracle</span>, i.e., a device which would allow us to compute <math alttext="\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S2.p1.m1"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ )</annotation></semantics></math> and <math alttext="\nabla\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S2.p1.m2"><semantics><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">∇ caligraphic_L ( italic_θ )</annotation></semantics></math>.
For simple functions <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.p1.m3"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>, it is possible to do this by hand.
However, for deep neural networks, this quickly becomes tedious, and hinders
rapid experimentation.
Hence we require a general algorithm which would allow us to efficiently compute the gradients of arbitrary (sub)differentiable network architectures.</p>
</div>
<div class="ltx_para" id="S2.p2">
<p class="ltx_p">In this section, we introduce the basics of <span class="ltx_text ltx_font_italic">automatic differentiation</span>
(AD or <span class="ltx_text ltx_font_italic">autodiff</span>), which is a computationally efficient way to compute
gradients and Jacobians of general functions <math alttext="f:\mathbb{R}^{m}\to\mathbb{R}^{n}" class="ltx_Math" display="inline" id="S2.p2.m1"><semantics><mrow><mi>f</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><mi>m</mi></msup><mo stretchy="false">→</mo><msup><mi>ℝ</mi><mi>n</mi></msup></mrow></mrow><annotation encoding="application/x-tex">f:\mathbb{R}^{m}\to\mathbb{R}^{n}</annotation><annotation encoding="application/x-llamapun">italic_f : blackboard_R start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT → blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT</annotation></semantics></math>. We will show
how this leads to the backpropagation algorithm for computing gradients of loss
functions involving neural networks.
A summary of the structure of this section is as follows:</p>
<ol class="ltx_enumerate" id="S2.I1">
<li class="ltx_item" id="S2.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span>
<div class="ltx_para" id="S2.I1.i1.p1">
<p class="ltx_p">We introduce <span class="ltx_text ltx_font_bold">differentials</span>, a convenient formalism for
calculating and organizing the derivatives of functions between
high-dimensional parameter spaces (which may themselves be products of
other spaces involving matrices, tensors, etc.).</p>
</div>
</li>
<li class="ltx_item" id="S2.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span>
<div class="ltx_para" id="S2.I1.i2.p1">
<p class="ltx_p">We describe the basics of <span class="ltx_text ltx_font_bold">forward-mode</span> and
<span class="ltx_text ltx_font_bold">reverse-mode</span> automatic differentiation, which involves
considerations that are important for efficient computation of
gradients/Jacobians for different kinds of functions arising in machine
learning applications.</p>
</div>
</li>
<li class="ltx_item" id="S2.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span>
<div class="ltx_para" id="S2.I1.i3.p1">
<p class="ltx_p">We describe <span class="ltx_text ltx_font_bold">backpropagation</span> in the special case of a loss
function applied to a stack-of-layers neural network as an instantiation
of reverse-mode automatic differentiation.</p>
</div>
</li>
</ol>
</div>
<div class="ltx_para" id="S2.p3">
<p class="ltx_p">Our treatment will err on the mathematical side, to give the reader a deep
understanding of the underlying mathematics. The reader should ensure to couple
this understanding with a strong grasp of practical aspects of automatic
differentiation for deep learning, for example as manifested in the outstanding
tutorial of <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx133" title="">Kar22a</a>]</cite>.</p>
</div>
<section class="ltx_subsection" id="S2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.2.1 </span>Differentials</h3>
<div class="ltx_para" id="S2.SS1.p1">
<p class="ltx_p">A full accounting of this subsection is given in the excellent guide <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx31" title="">BEJ25</a>]</cite>.
To motivate differentials, let us first consider the simple example of a differentiable function <math alttext="\mathcal{L}\colon\mathbb{R}\to\mathbb{R}" class="ltx_Math" display="inline" id="S2.SS1.p1.m1"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><mi>ℝ</mi><mo stretchy="false">→</mo><mi>ℝ</mi></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}\colon\mathbb{R}\to\mathbb{R}</annotation><annotation encoding="application/x-llamapun">caligraphic_L : blackboard_R → blackboard_R</annotation></semantics></math> acting on a parameter <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS1.p1.m2"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>. We can write</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta)-\mathcal{L}(\theta_{0})=\mathcal{L}^{\prime}(\theta_{0})\cdot(\theta-\theta_{0})+o(\lvert\theta-\theta_{0}\rvert)." class="ltx_Math" display="block" id="S2.E1.m1"><semantics><mrow><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>=</mo><mrow><mrow><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo rspace="0.055em" stretchy="false">)</mo></mrow></mrow><mo rspace="0.222em">⋅</mo><mrow><mo stretchy="false">(</mo><mrow><mi>θ</mi><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>o</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mo stretchy="false">|</mo><mrow><mi>θ</mi><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow><mo stretchy="false">|</mo></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)-\mathcal{L}(\theta_{0})=\mathcal{L}^{\prime}(\theta_{0})\cdot(\theta-\theta_{0})+o(\lvert\theta-\theta_{0}\rvert).</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ ) - caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) = caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) ⋅ ( italic_θ - italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) + italic_o ( | italic_θ - italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT | ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.1)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">If we take <math alttext="\delta\theta\doteq\theta-\theta_{0}" class="ltx_Math" display="inline" id="S2.SS1.p1.m3"><semantics><mrow><mrow><mi>δ</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><mo>≐</mo><mrow><mi>θ</mi><mo>−</mo><msub><mi>θ</mi><mn>0</mn></msub></mrow></mrow><annotation encoding="application/x-tex">\delta\theta\doteq\theta-\theta_{0}</annotation><annotation encoding="application/x-llamapun">italic_δ italic_θ ≐ italic_θ - italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\delta\mathcal{L}\doteq\mathcal{L}(\theta_{0}+\delta\theta)-\mathcal{L}(\theta_{0})" class="ltx_Math" display="inline" id="S2.SS1.p1.m4"><semantics><mrow><mrow><mi>δ</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>≐</mo><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msub><mi>θ</mi><mn>0</mn></msub><mo>+</mo><mrow><mi>δ</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex">\delta\mathcal{L}\doteq\mathcal{L}(\theta_{0}+\delta\theta)-\mathcal{L}(\theta_{0})</annotation><annotation encoding="application/x-llamapun">italic_δ caligraphic_L ≐ caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT + italic_δ italic_θ ) - caligraphic_L ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT )</annotation></semantics></math>, we can write</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\delta\mathcal{L}=\mathcal{L}^{\prime}(\theta_{0})\cdot\delta\theta+o(\lvert\delta\theta\rvert)." class="ltx_Math" display="block" id="S2.E2.m1"><semantics><mrow><mrow><mrow><mi>δ</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>=</mo><mrow><mrow><mrow><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo rspace="0.055em" stretchy="false">)</mo></mrow></mrow><mo rspace="0.222em">⋅</mo><mi>δ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><mo>+</mo><mrow><mi>o</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mo stretchy="false">|</mo><mrow><mi>δ</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><mo stretchy="false">|</mo></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\delta\mathcal{L}=\mathcal{L}^{\prime}(\theta_{0})\cdot\delta\theta+o(\lvert\delta\theta\rvert).</annotation><annotation encoding="application/x-llamapun">italic_δ caligraphic_L = caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) ⋅ italic_δ italic_θ + italic_o ( | italic_δ italic_θ | ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">We will (non-rigorously) define <math alttext="\mathrm{d}\theta" class="ltx_Math" display="inline" id="S2.SS1.p1.m5"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}\theta</annotation><annotation encoding="application/x-llamapun">roman_d italic_θ</annotation></semantics></math> and <math alttext="\mathrm{d}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p1.m6"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L</annotation></semantics></math>, i.e., the <span class="ltx_text ltx_font_italic">differentials</span> of <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS1.p1.m7"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> and <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p1.m8"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>, to be <span class="ltx_text ltx_font_italic">infinitesimally small</span> changes in <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS1.p1.m9"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> and <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p1.m10"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>.
Think of them as what one gets when <math alttext="\delta\theta" class="ltx_Math" display="inline" id="S2.SS1.p1.m11"><semantics><mrow><mi>δ</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">\delta\theta</annotation><annotation encoding="application/x-llamapun">italic_δ italic_θ</annotation></semantics></math> (and therefore <math alttext="\delta\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p1.m12"><semantics><mrow><mi>δ</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\delta\mathcal{L}</annotation><annotation encoding="application/x-llamapun">italic_δ caligraphic_L</annotation></semantics></math>) are extremely small. The goal of differential calculus, in some sense, is to study the relationships between the differentials <math alttext="\mathrm{d}\theta" class="ltx_Math" display="inline" id="S2.SS1.p1.m13"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}\theta</annotation><annotation encoding="application/x-llamapun">roman_d italic_θ</annotation></semantics></math> and <math alttext="\mathrm{d}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p1.m14"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L</annotation></semantics></math>, namely, seeing how small changes in the input of a function change the output. We should note that the differential <math alttext="\mathrm{d}\theta" class="ltx_Math" display="inline" id="S2.SS1.p1.m15"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}\theta</annotation><annotation encoding="application/x-llamapun">roman_d italic_θ</annotation></semantics></math> is the <span class="ltx_text ltx_font_italic">same shape</span> as <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS1.p1.m16"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>, and the differential <math alttext="\mathrm{d}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p1.m17"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L</annotation></semantics></math> is the <span class="ltx_text ltx_font_italic">same shape</span> as <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p1.m18"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>. In particular, we can write</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathrm{d}\mathcal{L}=\mathcal{L}^{\prime}(\theta)\cdot\mathrm{d}\theta," class="ltx_Math" display="block" id="S2.E3.m1"><semantics><mrow><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>=</mo><mrow><mrow><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo rspace="0.055em" stretchy="false">)</mo></mrow></mrow><mo rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\mathrm{d}\mathcal{L}=\mathcal{L}^{\prime}(\theta)\cdot\mathrm{d}\theta,</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L = caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ ) ⋅ roman_d italic_θ ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">whereby we have that all higher powers of <math alttext="\lvert\mathrm{d}\theta\rvert" class="ltx_Math" display="inline" id="S2.SS1.p1.m19"><semantics><mrow><mo stretchy="false">|</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><mo stretchy="false">|</mo></mrow><annotation encoding="application/x-tex">\lvert\mathrm{d}\theta\rvert</annotation><annotation encoding="application/x-llamapun">| roman_d italic_θ |</annotation></semantics></math>, such as <math alttext="(\mathrm{d}\theta)^{2}" class="ltx_Math" display="inline" id="S2.SS1.p1.m20"><semantics><msup><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><mo stretchy="false">)</mo></mrow><mn>2</mn></msup><annotation encoding="application/x-tex">(\mathrm{d}\theta)^{2}</annotation><annotation encoding="application/x-llamapun">( roman_d italic_θ ) start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math>, are <math alttext="0" class="ltx_Math" display="inline" id="S2.SS1.p1.m21"><mn>0</mn></math>.</p>
</div>
<div class="ltx_para" id="S2.SS1.p2">
<p class="ltx_p">Let’s see how this works for a higher dimensions, i.e., <math alttext="\mathcal{L}\colon\mathbb{R}^{n}\to\mathbb{R}" class="ltx_Math" display="inline" id="S2.SS1.p2.m1"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><mi>n</mi></msup><mo stretchy="false">→</mo><mi>ℝ</mi></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}\colon\mathbb{R}^{n}\to\mathbb{R}</annotation><annotation encoding="application/x-llamapun">caligraphic_L : blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT → blackboard_R</annotation></semantics></math>. Then we still have</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathrm{d}\mathcal{L}=\mathcal{L}^{\prime}(\theta)\cdot\mathrm{d}\theta" class="ltx_Math" display="block" id="S2.E4.m1"><semantics><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>=</mo><mrow><mrow><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo rspace="0.055em" stretchy="false">)</mo></mrow></mrow><mo rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow></mrow><annotation encoding="application/x-tex">\mathrm{d}\mathcal{L}=\mathcal{L}^{\prime}(\theta)\cdot\mathrm{d}\theta</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L = caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ ) ⋅ roman_d italic_θ</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">for some notion of a derivative <math alttext="\mathcal{L}^{\prime}(\theta)" class="ltx_Math" display="inline" id="S2.SS1.p2.m2"><semantics><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}^{\prime}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math>. Since <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS1.p2.m3"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> (hence <math alttext="\mathrm{d}\theta" class="ltx_Math" display="inline" id="S2.SS1.p2.m4"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}\theta</annotation><annotation encoding="application/x-llamapun">roman_d italic_θ</annotation></semantics></math>) is a column vector here and <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p2.m5"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> (hence <math alttext="\mathrm{d}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p2.m6"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L</annotation></semantics></math>) is a scalar, we must have that <math alttext="\mathcal{L}^{\prime}(\theta)" class="ltx_Math" display="inline" id="S2.SS1.p2.m7"><semantics><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}^{\prime}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math> is a row vector. In this case, <math alttext="\mathcal{L}^{\prime}(\theta)" class="ltx_Math" display="inline" id="S2.SS1.p2.m8"><semantics><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}^{\prime}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math> is the Jacobian of <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p2.m9"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> w.r.t. <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS1.p2.m10"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>. Here notice that we have set all higher powers and products of coordinates of <math alttext="\mathrm{d}\theta" class="ltx_Math" display="inline" id="S2.SS1.p2.m11"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}\theta</annotation><annotation encoding="application/x-llamapun">roman_d italic_θ</annotation></semantics></math> to <math alttext="0" class="ltx_Math" display="inline" id="S2.SS1.p2.m12"><mn>0</mn></math>. In sum,</p>
<blockquote class="ltx_quote">
<p class="ltx_p"><span class="ltx_text ltx_font_italic">All products and powers <math alttext="\geq 2" class="ltx_Math" display="inline" id="S2.SS1.p2.m13"><semantics><mrow><mi></mi><mo>≥</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\geq 2</annotation><annotation encoding="application/x-llamapun">≥ 2</annotation></semantics></math> of differentials are equal to <math alttext="0" class="ltx_Math" display="inline" id="S2.SS1.p2.m14"><mn>0</mn></math>.</span></p>
</blockquote>
</div>
<div class="ltx_para" id="S2.SS1.p3">
<p class="ltx_p">Now consider a higher-order tensor function <math alttext="\mathcal{L}\colon\mathbb{R}^{m\times n}\to\mathbb{R}^{p\times q}" class="ltx_Math" display="inline" id="S2.SS1.p3.m1"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>n</mi></mrow></msup><mo stretchy="false">→</mo><msup><mi>ℝ</mi><mrow><mi>p</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>q</mi></mrow></msup></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}\colon\mathbb{R}^{m\times n}\to\mathbb{R}^{p\times q}</annotation><annotation encoding="application/x-llamapun">caligraphic_L : blackboard_R start_POSTSUPERSCRIPT italic_m × italic_n end_POSTSUPERSCRIPT → blackboard_R start_POSTSUPERSCRIPT italic_p × italic_q end_POSTSUPERSCRIPT</annotation></semantics></math>. Then our basic linearization equation is insufficient for this case: <math alttext="\mathrm{d}\mathcal{L}=\mathcal{L}^{\prime}(\theta)\cdot\mathrm{d}\theta" class="ltx_Math" display="inline" id="S2.SS1.p3.m2"><semantics><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>=</mo><mrow><mrow><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo rspace="0.055em" stretchy="false">)</mo></mrow></mrow><mo rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow></mrow><annotation encoding="application/x-tex">\mathrm{d}\mathcal{L}=\mathcal{L}^{\prime}(\theta)\cdot\mathrm{d}\theta</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L = caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ ) ⋅ roman_d italic_θ</annotation></semantics></math> does not make sense since <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS1.p3.m3"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> is an <math alttext="m\times n" class="ltx_Math" display="inline" id="S2.SS1.p3.m4"><semantics><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m\times n</annotation><annotation encoding="application/x-llamapun">italic_m × italic_n</annotation></semantics></math> matrix but <math alttext="\mathrm{d}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p3.m5"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L</annotation></semantics></math> is a <math alttext="p\times q" class="ltx_Math" display="inline" id="S2.SS1.p3.m6"><semantics><mrow><mi>p</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">p\times q</annotation><annotation encoding="application/x-llamapun">italic_p × italic_q</annotation></semantics></math> matrix, so there is no possible vector or matrix shape for <math alttext="\mathcal{L}^{\prime}(\theta)" class="ltx_Math" display="inline" id="S2.SS1.p3.m7"><semantics><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}^{\prime}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math> that works in general (as no matrix can multiply a <math alttext="m\times n" class="ltx_Math" display="inline" id="S2.SS1.p3.m8"><semantics><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m\times n</annotation><annotation encoding="application/x-llamapun">italic_m × italic_n</annotation></semantics></math> matrix to form a <math alttext="p\times q" class="ltx_Math" display="inline" id="S2.SS1.p3.m9"><semantics><mrow><mi>p</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">p\times q</annotation><annotation encoding="application/x-llamapun">italic_p × italic_q</annotation></semantics></math> matrix unless <math alttext="m=p" class="ltx_Math" display="inline" id="S2.SS1.p3.m10"><semantics><mrow><mi>m</mi><mo>=</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">m=p</annotation><annotation encoding="application/x-llamapun">italic_m = italic_p</annotation></semantics></math>). So we must have a slightly more advanced interpretation.</p>
</div>
<div class="ltx_para" id="S2.SS1.p4">
<p class="ltx_p">Namely, we consider <math alttext="\mathcal{L}^{\prime}(\theta)" class="ltx_Math" display="inline" id="S2.SS1.p4.m1"><semantics><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}^{\prime}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math> as a <span class="ltx_text ltx_font_italic">linear transformation</span> whose input is <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS1.p4.m2"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>-space and whose output is <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p4.m3"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>-space, which takes in a small change in <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS1.p4.m4"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> and outputs the corresponding small change in <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p4.m5"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>. Namely, we can write</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathrm{d}\mathcal{L}=\mathcal{L}^{\prime}(\theta)[\mathrm{d}\theta]." class="ltx_Math" display="block" id="S2.E5.m1"><semantics><mrow><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>=</mo><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathrm{d}\mathcal{L}=\mathcal{L}^{\prime}(\theta)[\mathrm{d}\theta].</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L = caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ ) [ roman_d italic_θ ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">In the previous cases, <math alttext="\mathcal{L}^{\prime}(\theta)" class="ltx_Math" display="inline" id="S2.SS1.p4.m6"><semantics><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}^{\prime}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math> was first a linear operator <math alttext="\mathbb{R}\to\mathbb{R}" class="ltx_Math" display="inline" id="S2.SS1.p4.m7"><semantics><mrow><mi>ℝ</mi><mo stretchy="false">→</mo><mi>ℝ</mi></mrow><annotation encoding="application/x-tex">\mathbb{R}\to\mathbb{R}</annotation><annotation encoding="application/x-llamapun">blackboard_R → blackboard_R</annotation></semantics></math> whose action was to multiply its input by the scalar derivative of <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p4.m8"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> with respect to <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS1.p4.m9"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>, and then a linear operator <math alttext="\mathbb{R}^{n}\to\mathbb{R}" class="ltx_Math" display="inline" id="S2.SS1.p4.m10"><semantics><mrow><msup><mi>ℝ</mi><mi>n</mi></msup><mo stretchy="false">→</mo><mi>ℝ</mi></mrow><annotation encoding="application/x-tex">\mathbb{R}^{n}\to\mathbb{R}</annotation><annotation encoding="application/x-llamapun">blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT → blackboard_R</annotation></semantics></math> whose action was to multiply its input by the Jacobian derivative of <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p4.m11"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> with respect to <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS1.p4.m12"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>. In general <math alttext="\mathcal{L}^{\prime}(\theta)" class="ltx_Math" display="inline" id="S2.SS1.p4.m13"><semantics><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}^{\prime}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math> is the “derivative” of <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p4.m14"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> w.r.t. <math alttext="\theta" class="ltx_Math" display="inline" id="S2.SS1.p4.m15"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>.
Think of <math alttext="\mathcal{L}^{\prime}" class="ltx_Math" display="inline" id="S2.SS1.p4.m16"><semantics><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><annotation encoding="application/x-tex">\mathcal{L}^{\prime}</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> as a generalized version of the Jacobian of <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p4.m17"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math>.
As such, it follows some simple derivative rules, most crucially the chain rule.</p>
</div>
<div class="ltx_theorem ltx_theorem_theorem" id="Thmtheorem1">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold">Theorem A.1</span></span><span class="ltx_text ltx_font_bold"> </span>(Differential Chain Rule)<span class="ltx_text ltx_font_bold">.</span>
</h6>
<div class="ltx_para" id="Thmtheorem1.p1">
<p class="ltx_p"><span class="ltx_text ltx_font_italic">Suppose <math alttext="\mathcal{L}=f\circ g" class="ltx_Math" display="inline" id="Thmtheorem1.p1.m1"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>=</mo><mrow><mi>f</mi><mo lspace="0.222em" rspace="0.222em">∘</mo><mi>g</mi></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}=f\circ g</annotation><annotation encoding="application/x-llamapun">caligraphic_L = italic_f ∘ italic_g</annotation></semantics></math> where <math alttext="f" class="ltx_Math" display="inline" id="Thmtheorem1.p1.m2"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation><annotation encoding="application/x-llamapun">italic_f</annotation></semantics></math> and <math alttext="g" class="ltx_Math" display="inline" id="Thmtheorem1.p1.m3"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation><annotation encoding="application/x-llamapun">italic_g</annotation></semantics></math> are differentiable. Then</span></p>
<table class="ltx_equation ltx_eqn_table" id="S2.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathrm{d}\mathcal{L}=f^{\prime}(g(\theta))g^{\prime}(\theta)[\mathrm{d}\theta]," class="ltx_Math" display="block" id="S2.E6.m1"><semantics><mrow><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>=</mo><mrow><msup><mi>f</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>g</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\mathrm{d}\mathcal{L}=f^{\prime}(g(\theta))g^{\prime}(\theta)[\mathrm{d}\theta],</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L = italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_g ( italic_θ ) ) italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ ) [ roman_d italic_θ ] ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.6)</span></td>
</tr></tbody>
</table>
<p class="ltx_p"><span class="ltx_text ltx_font_italic">where (as usual) multiplication indicates composition of linear operators. In particular,</span></p>
<table class="ltx_equation ltx_eqn_table" id="S2.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}^{\prime}(\theta)=f^{\prime}(g(\theta))g^{\prime}(\theta)" class="ltx_Math" display="block" id="S2.E7.m1"><semantics><mrow><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><msup><mi>f</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>g</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}^{\prime}(\theta)=f^{\prime}(g(\theta))g^{\prime}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ ) = italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_g ( italic_θ ) ) italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.7)</span></td>
</tr></tbody>
</table>
<p class="ltx_p"><span class="ltx_text ltx_font_italic">in the sense of equality of linear operators.</span></p>
</div>
</div>
<div class="ltx_para" id="S2.SS1.p5">
<p class="ltx_p">It is productive to think of the multivariate chain rule in functorial terms:
composition of functions gets ‘turned into’ matrix multiplication of Jacobians
(composition of linear operators!).
We illustrate the power of this result and this perspective through several
examples.</p>
</div>
<div class="ltx_theorem ltx_theorem_example" id="Thmexample4">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Example A.4</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexample4.p1">
<p class="ltx_p">Consider the function <math alttext="f(\bm{X})=\bm{W}\bm{X}+\bm{b}\bm{1}^{\top}" class="ltx_Math" display="inline" id="Thmexample4.p1.m1"><semantics><mrow><mrow><mi>f</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi>𝑾</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑿</mi></mrow><mo>+</mo><mrow><mi>𝒃</mi><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup></mrow></mrow></mrow><annotation encoding="application/x-tex">f(\bm{X})=\bm{W}\bm{X}+\bm{b}\bm{1}^{\top}</annotation><annotation encoding="application/x-llamapun">italic_f ( bold_italic_X ) = bold_italic_W bold_italic_X + bold_italic_b bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT</annotation></semantics></math>. Then</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathrm{d}f=f(\bm{X}+\mathrm{d}\bm{X})-f(\bm{X})=[\bm{W}(\bm{X}+\mathrm{d}\bm{X})+\bm{b}\bm{1}^{\top}]-[\bm{W}\bm{X}+\bm{b}\bm{1}^{\top}]=\bm{W}\mathrm{d}\bm{X}." class="ltx_Math" display="block" id="S2.E8.m1"><semantics><mrow><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>f</mi></mrow><mo>=</mo><mrow><mrow><mi>f</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>𝑿</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑿</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi>f</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>=</mo><mrow><mrow><mo stretchy="false">[</mo><mrow><mrow><mi>𝑾</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>𝑿</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑿</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>𝒃</mi><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup></mrow></mrow><mo stretchy="false">]</mo></mrow><mo>−</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><mi>𝑾</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑿</mi></mrow><mo>+</mo><mrow><mi>𝒃</mi><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mi>𝑾</mi><mo lspace="0em" rspace="0em">​</mo><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑿</mi></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathrm{d}f=f(\bm{X}+\mathrm{d}\bm{X})-f(\bm{X})=[\bm{W}(\bm{X}+\mathrm{d}\bm{X})+\bm{b}\bm{1}^{\top}]-[\bm{W}\bm{X}+\bm{b}\bm{1}^{\top}]=\bm{W}\mathrm{d}\bm{X}.</annotation><annotation encoding="application/x-llamapun">roman_d italic_f = italic_f ( bold_italic_X + roman_d bold_italic_X ) - italic_f ( bold_italic_X ) = [ bold_italic_W ( bold_italic_X + roman_d bold_italic_X ) + bold_italic_b bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ] - [ bold_italic_W bold_italic_X + bold_italic_b bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ] = bold_italic_W roman_d bold_italic_X .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.8)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Thus the derivative of an affine function w.r.t. its input is</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E9">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f^{\prime}(\bm{X})[\mathrm{d}\bm{X}]=\bm{W}\mathrm{d}\bm{X}\implies f^{\prime}(\bm{X})=\bm{W}." class="ltx_Math" display="block" id="S2.E9.m1"><semantics><mrow><mrow><mrow><msup><mi>f</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑿</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mi>𝑾</mi><mo lspace="0em" rspace="0em">​</mo><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑿</mi></mrow><mo stretchy="false">⟹</mo><mrow><msup><mi>f</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mi>𝑾</mi></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">f^{\prime}(\bm{X})[\mathrm{d}\bm{X}]=\bm{W}\mathrm{d}\bm{X}\implies f^{\prime}(\bm{X})=\bm{W}.</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( bold_italic_X ) [ roman_d bold_italic_X ] = bold_italic_W roman_d bold_italic_X ⟹ italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( bold_italic_X ) = bold_italic_W .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.9)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Notice that <math alttext="f^{\prime}" class="ltx_Math" display="inline" id="Thmexample4.p1.m2"><semantics><msup><mi>f</mi><mo>′</mo></msup><annotation encoding="application/x-tex">f^{\prime}</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> is <span class="ltx_text ltx_font_italic">constant</span>. On the other hand, consider the function <math alttext="g(\bm{W},\bm{b})=\bm{W}\bm{X}+\bm{b}\bm{1}^{\top}" class="ltx_Math" display="inline" id="Thmexample4.p1.m3"><semantics><mrow><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑾</mi><mo>,</mo><mi>𝒃</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi>𝑾</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑿</mi></mrow><mo>+</mo><mrow><mi>𝒃</mi><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup></mrow></mrow></mrow><annotation encoding="application/x-tex">g(\bm{W},\bm{b})=\bm{W}\bm{X}+\bm{b}\bm{1}^{\top}</annotation><annotation encoding="application/x-llamapun">italic_g ( bold_italic_W , bold_italic_b ) = bold_italic_W bold_italic_X + bold_italic_b bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT</annotation></semantics></math>. Then</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx106">
<tbody id="S2.E10"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathrm{d}g" class="ltx_Math" display="inline" id="S2.E10.m1"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>g</mi></mrow><annotation encoding="application/x-tex">\displaystyle\mathrm{d}g</annotation><annotation encoding="application/x-llamapun">roman_d italic_g</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=g(\bm{W}+\mathrm{d}\bm{W},\bm{b}+\mathrm{d}\bm{b})-g(\bm{W},\bm{b})=[(\bm{W}+\mathrm{d}\bm{W})\bm{X}+(\bm{b}+\mathrm{d}\bm{b})\bm{1}^{\top}]-[\bm{W}\bm{X}+\bm{b}]" class="ltx_Math" display="inline" id="S2.E10.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>𝑾</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑾</mi></mrow></mrow><mo>,</mo><mrow><mi>𝒃</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒃</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑾</mi><mo>,</mo><mi>𝒃</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>=</mo><mrow><mrow><mo stretchy="false">[</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><mi>𝑾</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑾</mi></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>𝑿</mi></mrow><mo>+</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mi>𝒃</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒃</mi></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup></mrow></mrow><mo stretchy="false">]</mo></mrow><mo>−</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><mi>𝑾</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑿</mi></mrow><mo>+</mo><mi>𝒃</mi></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=g(\bm{W}+\mathrm{d}\bm{W},\bm{b}+\mathrm{d}\bm{b})-g(\bm{W},\bm{b})=[(\bm{W}+\mathrm{d}\bm{W})\bm{X}+(\bm{b}+\mathrm{d}\bm{b})\bm{1}^{\top}]-[\bm{W}\bm{X}+\bm{b}]</annotation><annotation encoding="application/x-llamapun">= italic_g ( bold_italic_W + roman_d bold_italic_W , bold_italic_b + roman_d bold_italic_b ) - italic_g ( bold_italic_W , bold_italic_b ) = [ ( bold_italic_W + roman_d bold_italic_W ) bold_italic_X + ( bold_italic_b + roman_d bold_italic_b ) bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ] - [ bold_italic_W bold_italic_X + bold_italic_b ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.10)</span></td>
</tr></tbody>
<tbody id="S2.E11"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=(\mathrm{d}\bm{W})\bm{X}+(\mathrm{d}\bm{b})\bm{1}^{\top}=g^{\prime}(\bm{W},\bm{B})[\mathrm{d}\bm{W},\mathrm{d}\bm{b}]." class="ltx_Math" display="inline" id="S2.E11.m1"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑾</mi></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>𝑿</mi></mrow><mo>+</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒃</mi></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup></mrow></mrow><mo>=</mo><mrow><msup><mi>g</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑾</mi><mo>,</mo><mi>𝑩</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑾</mi></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒃</mi></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=(\mathrm{d}\bm{W})\bm{X}+(\mathrm{d}\bm{b})\bm{1}^{\top}=g^{\prime}(\bm{W},\bm{B})[\mathrm{d}\bm{W},\mathrm{d}\bm{b}].</annotation><annotation encoding="application/x-llamapun">= ( roman_d bold_italic_W ) bold_italic_X + ( roman_d bold_italic_b ) bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT = italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( bold_italic_W , bold_italic_B ) [ roman_d bold_italic_W , roman_d bold_italic_b ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.11)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Notice that this derivative is <span class="ltx_text ltx_font_italic">constant</span> in <math alttext="\bm{W},\bm{b}" class="ltx_Math" display="inline" id="Thmexample4.p1.m4"><semantics><mrow><mi>𝑾</mi><mo>,</mo><mi>𝒃</mi></mrow><annotation encoding="application/x-tex">\bm{W},\bm{b}</annotation><annotation encoding="application/x-llamapun">bold_italic_W , bold_italic_b</annotation></semantics></math> (which makes sense since <math alttext="g" class="ltx_Math" display="inline" id="Thmexample4.p1.m5"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation><annotation encoding="application/x-llamapun">italic_g</annotation></semantics></math> itself is linear) and linear in the differential inputs <math alttext="\mathrm{d}\bm{W},\mathrm{d}\bm{b}" class="ltx_Math" display="inline" id="Thmexample4.p1.m6"><semantics><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑾</mi></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒃</mi></mrow></mrow><annotation encoding="application/x-tex">\mathrm{d}\bm{W},\mathrm{d}\bm{b}</annotation><annotation encoding="application/x-llamapun">roman_d bold_italic_W , roman_d bold_italic_b</annotation></semantics></math>.
 <math alttext="\blacksquare" class="ltx_Math" display="inline" id="Thmexample4.p1.m7"><semantics><mi mathvariant="normal">■</mi><annotation encoding="application/x-tex">\blacksquare</annotation><annotation encoding="application/x-llamapun">■</annotation></semantics></math></p>
</div>
</div>
<div class="ltx_theorem ltx_theorem_example" id="Thmexample5">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Example A.5</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexample5.p1">
<p class="ltx_p">Consider the function <math alttext="f=gh" class="ltx_Math" display="inline" id="Thmexample5.p1.m1"><semantics><mrow><mi>f</mi><mo>=</mo><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mrow><annotation encoding="application/x-tex">f=gh</annotation><annotation encoding="application/x-llamapun">italic_f = italic_g italic_h</annotation></semantics></math> where <math alttext="g,h" class="ltx_Math" display="inline" id="Thmexample5.p1.m2"><semantics><mrow><mi>g</mi><mo>,</mo><mi>h</mi></mrow><annotation encoding="application/x-tex">g,h</annotation><annotation encoding="application/x-llamapun">italic_g , italic_h</annotation></semantics></math> are differentiable functions whose outputs can multiply together. Then <math alttext="f=p\circ v" class="ltx_Math" display="inline" id="Thmexample5.p1.m3"><semantics><mrow><mi>f</mi><mo>=</mo><mrow><mi>p</mi><mo lspace="0.222em" rspace="0.222em">∘</mo><mi>v</mi></mrow></mrow><annotation encoding="application/x-tex">f=p\circ v</annotation><annotation encoding="application/x-llamapun">italic_f = italic_p ∘ italic_v</annotation></semantics></math> where <math alttext="v=(g,h)" class="ltx_Math" display="inline" id="Thmexample5.p1.m4"><semantics><mrow><mi>v</mi><mo>=</mo><mrow><mo stretchy="false">(</mo><mi>g</mi><mo>,</mo><mi>h</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">v=(g,h)</annotation><annotation encoding="application/x-llamapun">italic_v = ( italic_g , italic_h )</annotation></semantics></math> and <math alttext="p(a,b)=ab" class="ltx_Math" display="inline" id="Thmexample5.p1.m5"><semantics><mrow><mrow><mi>p</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mi>a</mi><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow></mrow><annotation encoding="application/x-tex">p(a,b)=ab</annotation><annotation encoding="application/x-llamapun">italic_p ( italic_a , italic_b ) = italic_a italic_b</annotation></semantics></math>. Applying the chain rule we have</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E12">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathrm{d}f=p^{\prime}(v(x))v^{\prime}(x)[\mathrm{d}x]." class="ltx_Math" display="block" id="S2.E12.m1"><semantics><mrow><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>f</mi></mrow><mo>=</mo><mrow><msup><mi>p</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>v</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>v</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathrm{d}f=p^{\prime}(v(x))v^{\prime}(x)[\mathrm{d}x].</annotation><annotation encoding="application/x-llamapun">roman_d italic_f = italic_p start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_v ( italic_x ) ) italic_v start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.12)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">To compute <math alttext="v^{\prime}(x)" class="ltx_Math" display="inline" id="Thmexample5.p1.m6"><semantics><mrow><msup><mi>v</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">v^{\prime}(x)</annotation><annotation encoding="application/x-llamapun">italic_v start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x )</annotation></semantics></math> we can compute</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E13">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathrm{d}v=v^{\prime}(x)[\mathrm{d}x]=v(x+\mathrm{d}x)-v(x)=\begin{bmatrix}g(x+\mathrm{d}x)-g(x)\\
h(x+\mathrm{d}x)-h(x)\end{bmatrix}=\begin{bmatrix}g^{\prime}(x)[\mathrm{d}x]\\
h^{\prime}(x)[\mathrm{d}x]\end{bmatrix}." class="ltx_Math" display="block" id="S2.E13.m1"><semantics><mrow><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>v</mi></mrow><mo>=</mo><mrow><msup><mi>v</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi>v</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>x</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi>v</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>=</mo><mrow><mo>[</mo><mtable displaystyle="true" rowspacing="0pt"><mtr><mtd><mrow><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>x</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></mtd></mtr><mtr><mtd><mrow><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>x</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></mtd></mtr></mtable><mo>]</mo></mrow><mo>=</mo><mrow><mo>[</mo><mtable displaystyle="true" rowspacing="0pt"><mtr><mtd><mrow><msup><mi>g</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>h</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow></mtd></mtr></mtable><mo>]</mo></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathrm{d}v=v^{\prime}(x)[\mathrm{d}x]=v(x+\mathrm{d}x)-v(x)=\begin{bmatrix}g(x+\mathrm{d}x)-g(x)\\
h(x+\mathrm{d}x)-h(x)\end{bmatrix}=\begin{bmatrix}g^{\prime}(x)[\mathrm{d}x]\\
h^{\prime}(x)[\mathrm{d}x]\end{bmatrix}.</annotation><annotation encoding="application/x-llamapun">roman_d italic_v = italic_v start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] = italic_v ( italic_x + roman_d italic_x ) - italic_v ( italic_x ) = [ start_ARG start_ROW start_CELL italic_g ( italic_x + roman_d italic_x ) - italic_g ( italic_x ) end_CELL end_ROW start_ROW start_CELL italic_h ( italic_x + roman_d italic_x ) - italic_h ( italic_x ) end_CELL end_ROW end_ARG ] = [ start_ARG start_ROW start_CELL italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] end_CELL end_ROW start_ROW start_CELL italic_h start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] end_CELL end_ROW end_ARG ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.13)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">To compute <math alttext="p^{\prime}" class="ltx_Math" display="inline" id="Thmexample5.p1.m7"><semantics><msup><mi>p</mi><mo>′</mo></msup><annotation encoding="application/x-tex">p^{\prime}</annotation><annotation encoding="application/x-llamapun">italic_p start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> we can compute</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx107">
<tbody id="S2.E14"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathrm{d}p" class="ltx_Math" display="inline" id="S2.E14.m1"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">\displaystyle\mathrm{d}p</annotation><annotation encoding="application/x-llamapun">roman_d italic_p</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=p^{\prime}(a,b)[\mathrm{d}a,\mathrm{d}b]=p(a+\mathrm{d}a,b+\mathrm{d}b)-p(a,b)=(a+\mathrm{d}a)(b+\mathrm{d}b)-ab" class="ltx_Math" display="inline" id="S2.E14.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><msup><mi>p</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>a</mi></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi>p</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>a</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>a</mi></mrow></mrow><mo>,</mo><mrow><mi>b</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi>p</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>=</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><mi>a</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>a</mi></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>b</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi>a</mi><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=p^{\prime}(a,b)[\mathrm{d}a,\mathrm{d}b]=p(a+\mathrm{d}a,b+\mathrm{d}b)-p(a,b)=(a+\mathrm{d}a)(b+\mathrm{d}b)-ab</annotation><annotation encoding="application/x-llamapun">= italic_p start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_a , italic_b ) [ roman_d italic_a , roman_d italic_b ] = italic_p ( italic_a + roman_d italic_a , italic_b + roman_d italic_b ) - italic_p ( italic_a , italic_b ) = ( italic_a + roman_d italic_a ) ( italic_b + roman_d italic_b ) - italic_a italic_b</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.14)</span></td>
</tr></tbody>
<tbody id="S2.E15"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=(\mathrm{d}a)b+a(\mathrm{d}b)+(\mathrm{d}a)(\mathrm{d}b)=(\mathrm{d}a)b+a(\mathrm{d}b)," class="ltx_Math" display="inline" id="S2.E15.m1"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>a</mi></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow><mo>+</mo><mrow><mi>a</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>a</mi></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>=</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>a</mi></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow><mo>+</mo><mrow><mi>a</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\displaystyle=(\mathrm{d}a)b+a(\mathrm{d}b)+(\mathrm{d}a)(\mathrm{d}b)=(\mathrm{d}a)b+a(\mathrm{d}b),</annotation><annotation encoding="application/x-llamapun">= ( roman_d italic_a ) italic_b + italic_a ( roman_d italic_b ) + ( roman_d italic_a ) ( roman_d italic_b ) = ( roman_d italic_a ) italic_b + italic_a ( roman_d italic_b ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.15)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where (recall) the product of the differentials <math alttext="\mathrm{d}a" class="ltx_Math" display="inline" id="Thmexample5.p1.m8"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}a</annotation><annotation encoding="application/x-llamapun">roman_d italic_a</annotation></semantics></math> and <math alttext="\mathrm{d}b" class="ltx_Math" display="inline" id="Thmexample5.p1.m9"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}b</annotation><annotation encoding="application/x-llamapun">roman_d italic_b</annotation></semantics></math> is set to <math alttext="0" class="ltx_Math" display="inline" id="Thmexample5.p1.m10"><mn>0</mn></math>. Therefore</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E16">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p^{\prime}(a,b)[\mathrm{d}a,\mathrm{d}b]=(\mathrm{d}a)b+(\mathrm{d}b)a." class="ltx_Math" display="block" id="S2.E16.m1"><semantics><mrow><mrow><mrow><msup><mi>p</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>a</mi></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>a</mi></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow><mo>+</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>b</mi></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>a</mi></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">p^{\prime}(a,b)[\mathrm{d}a,\mathrm{d}b]=(\mathrm{d}a)b+(\mathrm{d}b)a.</annotation><annotation encoding="application/x-llamapun">italic_p start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_a , italic_b ) [ roman_d italic_a , roman_d italic_b ] = ( roman_d italic_a ) italic_b + ( roman_d italic_b ) italic_a .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.16)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Putting these together, we find</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx108">
<tbody id="S2.E17"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle f^{\prime}(x)[\mathrm{d}x]" class="ltx_Math" display="inline" id="S2.E17.m1"><semantics><mrow><msup><mi>f</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle f^{\prime}(x)[\mathrm{d}x]</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ]</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=p^{\prime}(v(x))v^{\prime}(x)[\mathrm{d}x]=p^{\prime}(g(x),h(x))[g^{\prime}(x)[\mathrm{d}x],h^{\prime}(x)[\mathrm{d}x]]" class="ltx_Math" display="inline" id="S2.E17.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><msup><mi>p</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>v</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>v</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><msup><mi>p</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><msup><mi>g</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>,</mo><mrow><msup><mi>h</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=p^{\prime}(v(x))v^{\prime}(x)[\mathrm{d}x]=p^{\prime}(g(x),h(x))[g^{\prime}(x)[\mathrm{d}x],h^{\prime}(x)[\mathrm{d}x]]</annotation><annotation encoding="application/x-llamapun">= italic_p start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_v ( italic_x ) ) italic_v start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] = italic_p start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_g ( italic_x ) , italic_h ( italic_x ) ) [ italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] , italic_h start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.17)</span></td>
</tr></tbody>
<tbody id="S2.E18"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=(g^{\prime}(x)[\mathrm{d}x])h(x)+g(x)(h^{\prime}(x)[\mathrm{d}x])." class="ltx_Math" display="inline" id="S2.E18.m1"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><msup><mi>g</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msup><mi>h</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=(g^{\prime}(x)[\mathrm{d}x])h(x)+g(x)(h^{\prime}(x)[\mathrm{d}x]).</annotation><annotation encoding="application/x-llamapun">= ( italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] ) italic_h ( italic_x ) + italic_g ( italic_x ) ( italic_h start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.18)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">This gives</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E19">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f^{\prime}(x)[\mathrm{d}x]=(g^{\prime}(x)[\mathrm{d}x])h(x)+g(x)(h^{\prime}(x)[\mathrm{d}x])." class="ltx_Math" display="block" id="S2.E19.m1"><semantics><mrow><mrow><mrow><msup><mi>f</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><msup><mi>g</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msup><mi>h</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">f^{\prime}(x)[\mathrm{d}x]=(g^{\prime}(x)[\mathrm{d}x])h(x)+g(x)(h^{\prime}(x)[\mathrm{d}x]).</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] = ( italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] ) italic_h ( italic_x ) + italic_g ( italic_x ) ( italic_h start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.19)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">If for example we say that <math alttext="f,g,h\colon\mathbb{R}\to\mathbb{R}" class="ltx_Math" display="inline" id="Thmexample5.p1.m11"><semantics><mrow><mrow><mi>f</mi><mo>,</mo><mi>g</mi><mo>,</mo><mi>h</mi></mrow><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><mi>ℝ</mi><mo stretchy="false">→</mo><mi>ℝ</mi></mrow></mrow><annotation encoding="application/x-tex">f,g,h\colon\mathbb{R}\to\mathbb{R}</annotation><annotation encoding="application/x-llamapun">italic_f , italic_g , italic_h : blackboard_R → blackboard_R</annotation></semantics></math> then everything commutes so</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E20">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f^{\prime}(x)[\mathrm{d}x]=(g^{\prime}(x)h(x)+g(x)h^{\prime}(x))[\mathrm{d}x]\implies f^{\prime}(x)=g^{\prime}(x)h(x)+g(x)h^{\prime}(x)" class="ltx_Math" display="block" id="S2.E20.m1"><semantics><mrow><mrow><msup><mi>f</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mrow><msup><mi>g</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>h</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>x</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo stretchy="false">⟹</mo><mrow><msup><mi>f</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><msup><mi>g</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>h</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex">f^{\prime}(x)[\mathrm{d}x]=(g^{\prime}(x)h(x)+g(x)h^{\prime}(x))[\mathrm{d}x]\implies f^{\prime}(x)=g^{\prime}(x)h(x)+g(x)h^{\prime}(x)</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) [ roman_d italic_x ] = ( italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) italic_h ( italic_x ) + italic_g ( italic_x ) italic_h start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) ) [ roman_d italic_x ] ⟹ italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) = italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) italic_h ( italic_x ) + italic_g ( italic_x ) italic_h start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.20)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">which is the familiar product rule.
 <math alttext="\blacksquare" class="ltx_Math" display="inline" id="Thmexample5.p1.m12"><semantics><mi mathvariant="normal">■</mi><annotation encoding="application/x-tex">\blacksquare</annotation><annotation encoding="application/x-llamapun">■</annotation></semantics></math></p>
</div>
</div>
<div class="ltx_theorem ltx_theorem_example" id="Thmexample6">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Example A.6</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexample6.p1">
<p class="ltx_p">Consider the function <math alttext="f(\bm{A})=\bm{A}^{\top}\bm{A}\bm{B}\bm{A}" class="ltx_Math" display="inline" id="Thmexample6.p1.m1"><semantics><mrow><mrow><mi>f</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑨</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><msup><mi>𝑨</mi><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑩</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow></mrow><annotation encoding="application/x-tex">f(\bm{A})=\bm{A}^{\top}\bm{A}\bm{B}\bm{A}</annotation><annotation encoding="application/x-llamapun">italic_f ( bold_italic_A ) = bold_italic_A start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT bold_italic_A bold_italic_B bold_italic_A</annotation></semantics></math> where <math alttext="\bm{A}" class="ltx_Math" display="inline" id="Thmexample6.p1.m2"><semantics><mi>𝑨</mi><annotation encoding="application/x-tex">\bm{A}</annotation><annotation encoding="application/x-llamapun">bold_italic_A</annotation></semantics></math> is a matrix and <math alttext="\bm{B}" class="ltx_Math" display="inline" id="Thmexample6.p1.m3"><semantics><mi>𝑩</mi><annotation encoding="application/x-tex">\bm{B}</annotation><annotation encoding="application/x-llamapun">bold_italic_B</annotation></semantics></math> is a constant matrix. Then, letting <math alttext="f=gh" class="ltx_Math" display="inline" id="Thmexample6.p1.m4"><semantics><mrow><mi>f</mi><mo>=</mo><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow></mrow><annotation encoding="application/x-tex">f=gh</annotation><annotation encoding="application/x-llamapun">italic_f = italic_g italic_h</annotation></semantics></math> where <math alttext="g(\bm{A})=\bm{A}^{\top}\bm{A}" class="ltx_Math" display="inline" id="Thmexample6.p1.m5"><semantics><mrow><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑨</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><msup><mi>𝑨</mi><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow></mrow><annotation encoding="application/x-tex">g(\bm{A})=\bm{A}^{\top}\bm{A}</annotation><annotation encoding="application/x-llamapun">italic_g ( bold_italic_A ) = bold_italic_A start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT bold_italic_A</annotation></semantics></math> and <math alttext="h(\bm{A})=\bm{B}\bm{A}" class="ltx_Math" display="inline" id="Thmexample6.p1.m6"><semantics><mrow><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑨</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mi>𝑩</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow></mrow><annotation encoding="application/x-tex">h(\bm{A})=\bm{B}\bm{A}</annotation><annotation encoding="application/x-llamapun">italic_h ( bold_italic_A ) = bold_italic_B bold_italic_A</annotation></semantics></math>, we can use the product rule to obtain</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx109">
<tbody id="S2.E21"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle f^{\prime}(\bm{A})[\mathrm{d}\bm{A}]" class="ltx_Math" display="inline" id="S2.E21.m1"><semantics><mrow><msup><mi>f</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑨</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle f^{\prime}(\bm{A})[\mathrm{d}\bm{A}]</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( bold_italic_A ) [ roman_d bold_italic_A ]</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=(g^{\prime}(\bm{A})[\mathrm{d}\bm{A}])h(\bm{A})+g(\bm{A})(h^{\prime}(\bm{A})[\mathrm{d}\bm{A}])" class="ltx_Math" display="inline" id="S2.E21.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><msup><mi>g</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑨</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑨</mi><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>g</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑨</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msup><mi>h</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑨</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=(g^{\prime}(\bm{A})[\mathrm{d}\bm{A}])h(\bm{A})+g(\bm{A})(h^{\prime}(\bm{A})[\mathrm{d}\bm{A}])</annotation><annotation encoding="application/x-llamapun">= ( italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( bold_italic_A ) [ roman_d bold_italic_A ] ) italic_h ( bold_italic_A ) + italic_g ( bold_italic_A ) ( italic_h start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( bold_italic_A ) [ roman_d bold_italic_A ] )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.21)</span></td>
</tr></tbody>
<tbody id="S2.E22"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=((\mathrm{d}\bm{A})^{\top}\bm{A}+\bm{A}^{\top}(\mathrm{d}\bm{A}))\bm{B}\bm{A}+\bm{A}^{\top}\bm{A}\bm{B}(\mathrm{d}\bm{A})." class="ltx_Math" display="inline" id="S2.E22.m1"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><mrow><msup><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow><mo stretchy="false">)</mo></mrow><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow><mo>+</mo><mrow><msup><mi>𝑨</mi><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>𝑩</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow><mo>+</mo><mrow><msup><mi>𝑨</mi><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑩</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=((\mathrm{d}\bm{A})^{\top}\bm{A}+\bm{A}^{\top}(\mathrm{d}\bm{A}))\bm{B}\bm{A}+\bm{A}^{\top}\bm{A}\bm{B}(\mathrm{d}\bm{A}).</annotation><annotation encoding="application/x-llamapun">= ( ( roman_d bold_italic_A ) start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT bold_italic_A + bold_italic_A start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ( roman_d bold_italic_A ) ) bold_italic_B bold_italic_A + bold_italic_A start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT bold_italic_A bold_italic_B ( roman_d bold_italic_A ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.22)</span></td>
</tr></tbody>
</table>
<p class="ltx_p"><math alttext="\blacksquare" class="ltx_Math" display="inline" id="Thmexample6.p1.m7"><semantics><mi mathvariant="normal">■</mi><annotation encoding="application/x-tex">\blacksquare</annotation><annotation encoding="application/x-llamapun">■</annotation></semantics></math></p>
</div>
</div>
<div class="ltx_theorem ltx_theorem_example" id="Thmexample7">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Example A.7</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexample7.p1">
<p class="ltx_p">Consider the function <math alttext="f\colon\mathbb{R}^{m\times n\times k}\to\mathbb{R}^{m\times n}" class="ltx_Math" display="inline" id="Thmexample7.p1.m1"><semantics><mrow><mi>f</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>n</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>k</mi></mrow></msup><mo stretchy="false">→</mo><msup><mi>ℝ</mi><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>n</mi></mrow></msup></mrow></mrow><annotation encoding="application/x-tex">f\colon\mathbb{R}^{m\times n\times k}\to\mathbb{R}^{m\times n}</annotation><annotation encoding="application/x-llamapun">italic_f : blackboard_R start_POSTSUPERSCRIPT italic_m × italic_n × italic_k end_POSTSUPERSCRIPT → blackboard_R start_POSTSUPERSCRIPT italic_m × italic_n end_POSTSUPERSCRIPT</annotation></semantics></math> given by</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E23">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f(\bm{A})_{ij}=\sum_{t=1}^{k}A_{ijt}." class="ltx_Math" display="block" id="S2.E23.m1"><semantics><mrow><mrow><mrow><mi>f</mi><mo lspace="0em" rspace="0em">​</mo><msub><mrow><mo stretchy="false">(</mo><mi>𝑨</mi><mo stretchy="false">)</mo></mrow><mrow><mi>i</mi><mo lspace="0em" rspace="0em">​</mo><mi>j</mi></mrow></msub></mrow><mo rspace="0.111em">=</mo><mrow><munderover><mo movablelimits="false">∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><msub><mi>A</mi><mrow><mi>i</mi><mo lspace="0em" rspace="0em">​</mo><mi>j</mi><mo lspace="0em" rspace="0em">​</mo><mi>t</mi></mrow></msub></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">f(\bm{A})_{ij}=\sum_{t=1}^{k}A_{ijt}.</annotation><annotation encoding="application/x-llamapun">italic_f ( bold_italic_A ) start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT = ∑ start_POSTSUBSCRIPT italic_t = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT italic_A start_POSTSUBSCRIPT italic_i italic_j italic_t end_POSTSUBSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.23)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">We cannot write a (matrix-valued) Jacobian or gradient for this function. But we can compute its differential just fine:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E24">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathrm{d}f_{ij}=[f(\bm{A}+\mathrm{d}\bm{A})-f(\bm{A})]_{ij}=\sum_{t=1}^{k}\mathrm{d}\bm{A}_{ijt}=\bm{1}_{k}^{\top}(\mathrm{d}\bm{A})_{ij}." class="ltx_Math" display="block" id="S2.E24.m1"><semantics><mrow><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msub><mi>f</mi><mrow><mi>i</mi><mo lspace="0em" rspace="0em">​</mo><mi>j</mi></mrow></msub></mrow><mo>=</mo><msub><mrow><mo stretchy="false">[</mo><mrow><mrow><mi>f</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>𝑨</mi><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi>f</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑨</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo stretchy="false">]</mo></mrow><mrow><mi>i</mi><mo lspace="0em" rspace="0em">​</mo><mi>j</mi></mrow></msub><mo rspace="0.111em">=</mo><mrow><munderover><mo movablelimits="false">∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msub><mi>𝑨</mi><mrow><mi>i</mi><mo lspace="0em" rspace="0em">​</mo><mi>j</mi><mo lspace="0em" rspace="0em">​</mo><mi>t</mi></mrow></msub></mrow></mrow><mo>=</mo><mrow><msubsup><mn>𝟏</mn><mi>k</mi><mo>⊤</mo></msubsup><mo lspace="0em" rspace="0em">​</mo><msub><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow><mo stretchy="false">)</mo></mrow><mrow><mi>i</mi><mo lspace="0em" rspace="0em">​</mo><mi>j</mi></mrow></msub></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathrm{d}f_{ij}=[f(\bm{A}+\mathrm{d}\bm{A})-f(\bm{A})]_{ij}=\sum_{t=1}^{k}\mathrm{d}\bm{A}_{ijt}=\bm{1}_{k}^{\top}(\mathrm{d}\bm{A})_{ij}.</annotation><annotation encoding="application/x-llamapun">roman_d italic_f start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT = [ italic_f ( bold_italic_A + roman_d bold_italic_A ) - italic_f ( bold_italic_A ) ] start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT = ∑ start_POSTSUBSCRIPT italic_t = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT roman_d bold_italic_A start_POSTSUBSCRIPT italic_i italic_j italic_t end_POSTSUBSCRIPT = bold_1 start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ( roman_d bold_italic_A ) start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.24)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">So</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E25">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="(f^{\prime}(\bm{A})[\mathrm{d}\bm{A}])_{ij}=\bm{1}_{k}^{\top}(\mathrm{d}\bm{A})_{ij}," class="ltx_Math" display="block" id="S2.E25.m1"><semantics><mrow><mrow><msub><mrow><mo stretchy="false">(</mo><mrow><msup><mi>f</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑨</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mrow><mi>i</mi><mo lspace="0em" rspace="0em">​</mo><mi>j</mi></mrow></msub><mo>=</mo><mrow><msubsup><mn>𝟏</mn><mi>k</mi><mo>⊤</mo></msubsup><mo lspace="0em" rspace="0em">​</mo><msub><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝑨</mi></mrow><mo stretchy="false">)</mo></mrow><mrow><mi>i</mi><mo lspace="0em" rspace="0em">​</mo><mi>j</mi></mrow></msub></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">(f^{\prime}(\bm{A})[\mathrm{d}\bm{A}])_{ij}=\bm{1}_{k}^{\top}(\mathrm{d}\bm{A})_{ij},</annotation><annotation encoding="application/x-llamapun">( italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( bold_italic_A ) [ roman_d bold_italic_A ] ) start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT = bold_1 start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ( roman_d bold_italic_A ) start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.25)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">which represents a higher-order tensor multiplication operation that is nonetheless well-defined.
 <math alttext="\blacksquare" class="ltx_Math" display="inline" id="Thmexample7.p1.m2"><semantics><mi mathvariant="normal">■</mi><annotation encoding="application/x-tex">\blacksquare</annotation><annotation encoding="application/x-llamapun">■</annotation></semantics></math></p>
</div>
</div>
<div class="ltx_para" id="S2.SS1.p6">
<p class="ltx_p">This gives us all the technology we need to compute differentials of everything.
The last thing we cover in this section is a method to compute gradients using
the differential. Namely, for a function <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p6.m1"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> whose output is a scalar, the
gradient <math alttext="\nabla\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p6.m2"><semantics><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ caligraphic_L</annotation></semantics></math> is defined as</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E26">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathrm{d}\mathcal{L}=\mathcal{L}^{\prime}(\theta)[\mathrm{d}\theta]=\langle\nabla\mathcal{L}(\theta),\mathrm{d}\theta\rangle," class="ltx_Math" display="block" id="S2.E26.m1"><semantics><mrow><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>=</mo><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mo stretchy="false">⟨</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><mo stretchy="false">⟩</mo></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\mathrm{d}\mathcal{L}=\mathcal{L}^{\prime}(\theta)[\mathrm{d}\theta]=\langle\nabla\mathcal{L}(\theta),\mathrm{d}\theta\rangle,</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L = caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ ) [ roman_d italic_θ ] = ⟨ ∇ caligraphic_L ( italic_θ ) , roman_d italic_θ ⟩ ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.26)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where the inner product here is the “standard” inner product for the specified objects (i.e., for vectors it’s the <math alttext="\ell^{2}" class="ltx_Math" display="inline" id="S2.SS1.p6.m3"><semantics><msup><mi mathvariant="normal">ℓ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\ell^{2}</annotation><annotation encoding="application/x-llamapun">roman_ℓ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math> inner product, whereas for matrices it’s the Frobenius inner product, and for higher-order tensors it’s the analogous sum-of-coordinates inner product).
This definition is the correct generalization of the ‘familiar’ example of the
gradient of a function from <math alttext="\mathbb{R}^{n}" class="ltx_Math" display="inline" id="S2.SS1.p6.m4"><semantics><msup><mi>ℝ</mi><mi>n</mi></msup><annotation encoding="application/x-tex">\mathbb{R}^{n}</annotation><annotation encoding="application/x-llamapun">blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT</annotation></semantics></math> to <math alttext="\mathbb{R}" class="ltx_Math" display="inline" id="S2.SS1.p6.m5"><semantics><mi>ℝ</mi><annotation encoding="application/x-tex">\mathbb{R}</annotation><annotation encoding="application/x-llamapun">blackboard_R</annotation></semantics></math> as the vector of partial
derivatives—a version of Taylor’s theorem for general functions <math alttext="f:\mathbb{R}^{m}\to\mathbb{R}^{n}" class="ltx_Math" display="inline" id="S2.SS1.p6.m6"><semantics><mrow><mi>f</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><mi>m</mi></msup><mo stretchy="false">→</mo><msup><mi>ℝ</mi><mi>n</mi></msup></mrow></mrow><annotation encoding="application/x-tex">f:\mathbb{R}^{m}\to\mathbb{R}^{n}</annotation><annotation encoding="application/x-llamapun">italic_f : blackboard_R start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT → blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT</annotation></semantics></math> makes this connection rigorous.
So one way to compute the gradient <math alttext="\nabla\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p6.m7"><semantics><mrow><mo rspace="0.167em">∇</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ caligraphic_L</annotation></semantics></math> is to compute the differential
<math alttext="\mathrm{d}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS1.p6.m8"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\mathrm{d}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L</annotation></semantics></math> and rewrite it in the form
<math alttext="\langle\text{something},\mathrm{d}\theta\rangle" class="ltx_Math" display="inline" id="S2.SS1.p6.m9"><semantics><mrow><mo stretchy="false">⟨</mo><mtext>something</mtext><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">\langle\text{something},\mathrm{d}\theta\rangle</annotation><annotation encoding="application/x-llamapun">⟨ something , roman_d italic_θ ⟩</annotation></semantics></math>, then that “something” is the
gradient.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.2.2 </span>Automatic Differentiation</h3>
<div class="ltx_para" id="S2.SS2.p1">
<p class="ltx_p">The main idea of AD is to compute the chain rule efficiently.
The basic problem we need to cope with is the following. In the optimization section
of the appendix, we considered
that the parameter space <math alttext="\Theta" class="ltx_Math" display="inline" id="S2.SS2.p1.m1"><semantics><mi mathvariant="normal">Θ</mi><annotation encoding="application/x-tex">\Theta</annotation><annotation encoding="application/x-llamapun">roman_Θ</annotation></semantics></math> was an abstract Euclidean space like
<math alttext="\mathbb{R}^{n}" class="ltx_Math" display="inline" id="S2.SS2.p1.m2"><semantics><msup><mi>ℝ</mi><mi>n</mi></msup><annotation encoding="application/x-tex">\mathbb{R}^{n}</annotation><annotation encoding="application/x-llamapun">blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT</annotation></semantics></math>. In practice the parameters are really some collection of vectors,
matrices, and higher-order objects: <math alttext="\Theta=\mathbb{R}^{m\times n}\times\mathbb{R}^{n}\times\mathbb{R}^{r\times q\times p}\times\mathbb{R}^{r\times q}\times\cdots" class="ltx_Math" display="inline" id="S2.SS2.p1.m3"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo>=</mo><mrow><msup><mi>ℝ</mi><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>n</mi></mrow></msup><mo lspace="0.222em" rspace="0.222em">×</mo><msup><mi>ℝ</mi><mi>n</mi></msup><mo lspace="0.222em" rspace="0.222em">×</mo><msup><mi>ℝ</mi><mrow><mi>r</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>q</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>p</mi></mrow></msup><mo lspace="0.222em" rspace="0.222em">×</mo><msup><mi>ℝ</mi><mrow><mi>r</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>q</mi></mrow></msup><mo lspace="0.222em" rspace="0.222em">×</mo><mi mathvariant="normal">⋯</mi></mrow></mrow><annotation encoding="application/x-tex">\Theta=\mathbb{R}^{m\times n}\times\mathbb{R}^{n}\times\mathbb{R}^{r\times q\times p}\times\mathbb{R}^{r\times q}\times\cdots</annotation><annotation encoding="application/x-llamapun">roman_Θ = blackboard_R start_POSTSUPERSCRIPT italic_m × italic_n end_POSTSUPERSCRIPT × blackboard_R start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT × blackboard_R start_POSTSUPERSCRIPT italic_r × italic_q × italic_p end_POSTSUPERSCRIPT × blackboard_R start_POSTSUPERSCRIPT italic_r × italic_q end_POSTSUPERSCRIPT × ⋯</annotation></semantics></math>. While in
theory this is the same thing as a large parameter space <math alttext="\mathbb{R}^{n^{\prime}}" class="ltx_Math" display="inline" id="S2.SS2.p1.m4"><semantics><msup><mi>ℝ</mi><msup><mi>n</mi><mo>′</mo></msup></msup><annotation encoding="application/x-tex">\mathbb{R}^{n^{\prime}}</annotation><annotation encoding="application/x-llamapun">blackboard_R start_POSTSUPERSCRIPT italic_n start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> for
some (very large) <math alttext="n^{\prime}" class="ltx_Math" display="inline" id="S2.SS2.p1.m5"><semantics><msup><mi>n</mi><mo>′</mo></msup><annotation encoding="application/x-tex">n^{\prime}</annotation><annotation encoding="application/x-llamapun">italic_n start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>, computationally efficient algorithms for differentiation must treat these two spaces differently.
Forward and reverse mode automatic differentiation are two different schemes for
performing this computation.</p>
</div>
<div class="ltx_para" id="S2.SS2.p2">
<p class="ltx_p">Let us do a simple example to start. Let <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS2.p2.m1"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> be defined by <math alttext="\mathcal{L}=a\circ b\circ c" class="ltx_Math" display="inline" id="S2.SS2.p2.m2"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>=</mo><mrow><mi>a</mi><mo lspace="0.222em" rspace="0.222em">∘</mo><mi>b</mi><mo lspace="0.222em" rspace="0.222em">∘</mo><mi>c</mi></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}=a\circ b\circ c</annotation><annotation encoding="application/x-llamapun">caligraphic_L = italic_a ∘ italic_b ∘ italic_c</annotation></semantics></math> where <math alttext="a,b,c" class="ltx_Math" display="inline" id="S2.SS2.p2.m3"><semantics><mrow><mi>a</mi><mo>,</mo><mi>b</mi><mo>,</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">a,b,c</annotation><annotation encoding="application/x-llamapun">italic_a , italic_b , italic_c</annotation></semantics></math> are differentiable. Then the <span class="ltx_text ltx_font_italic">chain rule</span> gives</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E27">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}^{\prime}(\theta)=a^{\prime}(b(c(\theta)))b^{\prime}(c(\theta))c^{\prime}(\theta)." class="ltx_Math" display="block" id="S2.E27.m1"><semantics><mrow><mrow><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><msup><mi>a</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>b</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>b</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>c</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}^{\prime}(\theta)=a^{\prime}(b(c(\theta)))b^{\prime}(c(\theta))c^{\prime}(\theta).</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ ) = italic_a start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_b ( italic_c ( italic_θ ) ) ) italic_b start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_c ( italic_θ ) ) italic_c start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.27)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">To compute <math alttext="\mathcal{L}(\theta)" class="ltx_Math" display="inline" id="S2.SS2.p2.m4"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ )</annotation></semantics></math>, we first compute <math alttext="c(\theta)" class="ltx_Math" display="inline" id="S2.SS2.p2.m5"><semantics><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">c(\theta)</annotation><annotation encoding="application/x-llamapun">italic_c ( italic_θ )</annotation></semantics></math> then <math alttext="b(c(\theta))" class="ltx_Math" display="inline" id="S2.SS2.p2.m6"><semantics><mrow><mi>b</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">b(c(\theta))</annotation><annotation encoding="application/x-llamapun">italic_b ( italic_c ( italic_θ ) )</annotation></semantics></math> then <math alttext="a(b(c(\theta)))" class="ltx_Math" display="inline" id="S2.SS2.p2.m7"><semantics><mrow><mi>a</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>b</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">a(b(c(\theta)))</annotation><annotation encoding="application/x-llamapun">italic_a ( italic_b ( italic_c ( italic_θ ) ) )</annotation></semantics></math>, and store them all. There are two ways to compute <math alttext="\mathcal{L}^{\prime}(\theta)" class="ltx_Math" display="inline" id="S2.SS2.p2.m8"><semantics><mrow><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}^{\prime}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math>. The <span class="ltx_text ltx_font_italic">forward-mode AD</span> will compute</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E28">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="c^{\prime}(\theta)\implies b^{\prime}(c(\theta))c^{\prime}(\theta)\implies a^{\prime}(b(c(\theta)))b^{\prime}(c(\theta))c^{\prime}(\theta)" class="ltx_Math" display="block" id="S2.E28.m1"><semantics><mrow><mrow><msup><mi>c</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">⟹</mo><mrow><msup><mi>b</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>c</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">⟹</mo><mrow><msup><mi>a</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>b</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>b</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>c</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">c^{\prime}(\theta)\implies b^{\prime}(c(\theta))c^{\prime}(\theta)\implies a^{\prime}(b(c(\theta)))b^{\prime}(c(\theta))c^{\prime}(\theta)</annotation><annotation encoding="application/x-llamapun">italic_c start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ ) ⟹ italic_b start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_c ( italic_θ ) ) italic_c start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ ) ⟹ italic_a start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_b ( italic_c ( italic_θ ) ) ) italic_b start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_c ( italic_θ ) ) italic_c start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.28)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">i.e., computing the derivatives “from the bottom-up”. The <span class="ltx_text ltx_font_italic">reverse mode AD</span> will compute</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E29">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="a^{\prime}(b(c(\theta)))\implies a^{\prime}(b(c(\theta)))b^{\prime}(c(\theta))\implies a^{\prime}(b(c(\theta)))b^{\prime}(c(\theta))c^{\prime}(\theta)," class="ltx_Math" display="block" id="S2.E29.m1"><semantics><mrow><mrow><mrow><msup><mi>a</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>b</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">⟹</mo><mrow><msup><mi>a</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>b</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>b</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">⟹</mo><mrow><msup><mi>a</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>b</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>b</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>c</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">a^{\prime}(b(c(\theta)))\implies a^{\prime}(b(c(\theta)))b^{\prime}(c(\theta))\implies a^{\prime}(b(c(\theta)))b^{\prime}(c(\theta))c^{\prime}(\theta),</annotation><annotation encoding="application/x-llamapun">italic_a start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_b ( italic_c ( italic_θ ) ) ) ⟹ italic_a start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_b ( italic_c ( italic_θ ) ) ) italic_b start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_c ( italic_θ ) ) ⟹ italic_a start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_b ( italic_c ( italic_θ ) ) ) italic_b start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_c ( italic_θ ) ) italic_c start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_θ ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.29)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">i.e., computing the derivatives “from the top down”. To see why this matters, suppose that <math alttext="f\colon\mathbb{R}^{p}\to\mathbb{R}^{s}" class="ltx_Math" display="inline" id="S2.SS2.p2.m9"><semantics><mrow><mi>f</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><mi>p</mi></msup><mo stretchy="false">→</mo><msup><mi>ℝ</mi><mi>s</mi></msup></mrow></mrow><annotation encoding="application/x-tex">f\colon\mathbb{R}^{p}\to\mathbb{R}^{s}</annotation><annotation encoding="application/x-llamapun">italic_f : blackboard_R start_POSTSUPERSCRIPT italic_p end_POSTSUPERSCRIPT → blackboard_R start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT</annotation></semantics></math> is given by <math alttext="f=a\circ b\circ c" class="ltx_Math" display="inline" id="S2.SS2.p2.m10"><semantics><mrow><mi>f</mi><mo>=</mo><mrow><mi>a</mi><mo lspace="0.222em" rspace="0.222em">∘</mo><mi>b</mi><mo lspace="0.222em" rspace="0.222em">∘</mo><mi>c</mi></mrow></mrow><annotation encoding="application/x-tex">f=a\circ b\circ c</annotation><annotation encoding="application/x-llamapun">italic_f = italic_a ∘ italic_b ∘ italic_c</annotation></semantics></math> where <math alttext="a\colon\mathbb{R}^{r}\to\mathbb{R}^{s}" class="ltx_Math" display="inline" id="S2.SS2.p2.m11"><semantics><mrow><mi>a</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><mi>r</mi></msup><mo stretchy="false">→</mo><msup><mi>ℝ</mi><mi>s</mi></msup></mrow></mrow><annotation encoding="application/x-tex">a\colon\mathbb{R}^{r}\to\mathbb{R}^{s}</annotation><annotation encoding="application/x-llamapun">italic_a : blackboard_R start_POSTSUPERSCRIPT italic_r end_POSTSUPERSCRIPT → blackboard_R start_POSTSUPERSCRIPT italic_s end_POSTSUPERSCRIPT</annotation></semantics></math>, <math alttext="b\colon\mathbb{R}^{q}\to\mathbb{R}^{r}" class="ltx_Math" display="inline" id="S2.SS2.p2.m12"><semantics><mrow><mi>b</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><mi>q</mi></msup><mo stretchy="false">→</mo><msup><mi>ℝ</mi><mi>r</mi></msup></mrow></mrow><annotation encoding="application/x-tex">b\colon\mathbb{R}^{q}\to\mathbb{R}^{r}</annotation><annotation encoding="application/x-llamapun">italic_b : blackboard_R start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT → blackboard_R start_POSTSUPERSCRIPT italic_r end_POSTSUPERSCRIPT</annotation></semantics></math>, <math alttext="c\colon\mathbb{R}^{p}\to\mathbb{R}^{q}" class="ltx_Math" display="inline" id="S2.SS2.p2.m13"><semantics><mrow><mi>c</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><mi>p</mi></msup><mo stretchy="false">→</mo><msup><mi>ℝ</mi><mi>q</mi></msup></mrow></mrow><annotation encoding="application/x-tex">c\colon\mathbb{R}^{p}\to\mathbb{R}^{q}</annotation><annotation encoding="application/x-llamapun">italic_c : blackboard_R start_POSTSUPERSCRIPT italic_p end_POSTSUPERSCRIPT → blackboard_R start_POSTSUPERSCRIPT italic_q end_POSTSUPERSCRIPT</annotation></semantics></math>. Then the chain rule is:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E30">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f^{\prime}(\bm{x})=a^{\prime}(b(c(\bm{x})))b^{\prime}(c(\bm{x}))c^{\prime}(\bm{x})" class="ltx_Math" display="block" id="S2.E30.m1"><semantics><mrow><mrow><msup><mi>f</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><msup><mi>a</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>b</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>b</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>c</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">f^{\prime}(\bm{x})=a^{\prime}(b(c(\bm{x})))b^{\prime}(c(\bm{x}))c^{\prime}(\bm{x})</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( bold_italic_x ) = italic_a start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_b ( italic_c ( bold_italic_x ) ) ) italic_b start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_c ( bold_italic_x ) ) italic_c start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( bold_italic_x )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.30)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where (recall) <math alttext="f^{\prime}" class="ltx_Math" display="inline" id="S2.SS2.p2.m14"><semantics><msup><mi>f</mi><mo>′</mo></msup><annotation encoding="application/x-tex">f^{\prime}</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> is the derivative, in this case the Jacobian (since the input and output of each function are both vectors). Assuming that computing each Jacobian is trivial and the only cost is multiplying the Jacobians together, forward-mode AD has the following computational costs (assuming that multiplying <math alttext="A\in\mathbb{R}^{m\times n},B\in\mathbb{R}^{n\times k}" class="ltx_Math" display="inline" id="S2.SS2.p2.m15"><semantics><mrow><mrow><mi>A</mi><mo>∈</mo><msup><mi>ℝ</mi><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>n</mi></mrow></msup></mrow><mo>,</mo><mrow><mi>B</mi><mo>∈</mo><msup><mi>ℝ</mi><mrow><mi>n</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>k</mi></mrow></msup></mrow></mrow><annotation encoding="application/x-tex">A\in\mathbb{R}^{m\times n},B\in\mathbb{R}^{n\times k}</annotation><annotation encoding="application/x-llamapun">italic_A ∈ blackboard_R start_POSTSUPERSCRIPT italic_m × italic_n end_POSTSUPERSCRIPT , italic_B ∈ blackboard_R start_POSTSUPERSCRIPT italic_n × italic_k end_POSTSUPERSCRIPT</annotation></semantics></math> takes <math alttext="\mathcal{O}(mnk)" class="ltx_Math" display="inline" id="S2.SS2.p2.m16"><semantics><mrow><mi class="ltx_font_mathcaligraphic">𝒪</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>m</mi><mo lspace="0em" rspace="0em">​</mo><mi>n</mi><mo lspace="0em" rspace="0em">​</mo><mi>k</mi></mrow><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{O}(mnk)</annotation><annotation encoding="application/x-llamapun">caligraphic_O ( italic_m italic_n italic_k )</annotation></semantics></math> time):</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx110">
<tbody id="S2.E31"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\text{computing}\ c^{\prime}(\bm{x})\in\mathbb{R}^{q\times p}\ \text{takes negligible time}" class="ltx_Math" display="inline" id="S2.E31.m1"><semantics><mrow><mrow><mtext>computing</mtext><mo lspace="0.500em" rspace="0em">​</mo><msup><mi>c</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo>∈</mo><mrow><msup><mi>ℝ</mi><mrow><mi>q</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>p</mi></mrow></msup><mo lspace="0em" rspace="0em">​</mo><mtext>takes negligible time</mtext></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\text{computing}\ c^{\prime}(\bm{x})\in\mathbb{R}^{q\times p}\ \text{takes negligible time}</annotation><annotation encoding="application/x-llamapun">computing italic_c start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( bold_italic_x ) ∈ blackboard_R start_POSTSUPERSCRIPT italic_q × italic_p end_POSTSUPERSCRIPT takes negligible time</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.31)</span></td>
</tr></tbody>
<tbody id="S2.E32"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\text{computing}\ b^{\prime}(c(\bm{x}))c^{\prime}(x)\in\mathbb{R}^{r\times p}\ \text{takes $\mathcal{O}(pqr)$ time}" class="ltx_Math" display="inline" id="S2.E32.m1"><semantics><mrow><mrow><mtext>computing</mtext><mo lspace="0.500em" rspace="0em">​</mo><msup><mi>b</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>c</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mrow><mo>∈</mo><mrow><msup><mi>ℝ</mi><mrow><mi>r</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>p</mi></mrow></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mtext>takes </mtext><mrow><mi class="ltx_font_mathcaligraphic">𝒪</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>p</mi><mo lspace="0em" rspace="0em">​</mo><mi>q</mi><mo lspace="0em" rspace="0em">​</mo><mi>r</mi></mrow><mo stretchy="false">)</mo></mrow></mrow><mtext> time</mtext></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\text{computing}\ b^{\prime}(c(\bm{x}))c^{\prime}(x)\in\mathbb{R}^{r\times p}\ \text{takes $\mathcal{O}(pqr)$ time}</annotation><annotation encoding="application/x-llamapun">computing italic_b start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_c ( bold_italic_x ) ) italic_c start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) ∈ blackboard_R start_POSTSUPERSCRIPT italic_r × italic_p end_POSTSUPERSCRIPT takes caligraphic_O ( italic_p italic_q italic_r ) time</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.32)</span></td>
</tr></tbody>
<tbody id="S2.E33"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\text{computing}\ a^{\prime}(b(c(\bm{x})))b^{\prime}(c(\bm{x}))c^{\prime}(\bm{x})\in\mathbb{R}^{s\times p}\ \text{takes $\mathcal{O}(pqr+prs)$ time.}" class="ltx_Math" display="inline" id="S2.E33.m1"><semantics><mrow><mrow><mtext>computing</mtext><mo lspace="0.500em" rspace="0em">​</mo><msup><mi>a</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>b</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>b</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>c</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo>∈</mo><mrow><msup><mi>ℝ</mi><mrow><mi>s</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>p</mi></mrow></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mtext>takes </mtext><mrow><mi class="ltx_font_mathcaligraphic">𝒪</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mi>p</mi><mo lspace="0em" rspace="0em">​</mo><mi>q</mi><mo lspace="0em" rspace="0em">​</mo><mi>r</mi></mrow><mo>+</mo><mrow><mi>p</mi><mo lspace="0em" rspace="0em">​</mo><mi>r</mi><mo lspace="0em" rspace="0em">​</mo><mi>s</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mtext> time.</mtext></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\text{computing}\ a^{\prime}(b(c(\bm{x})))b^{\prime}(c(\bm{x}))c^{\prime}(\bm{x})\in\mathbb{R}^{s\times p}\ \text{takes $\mathcal{O}(pqr+prs)$ time.}</annotation><annotation encoding="application/x-llamapun">computing italic_a start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_b ( italic_c ( bold_italic_x ) ) ) italic_b start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_c ( bold_italic_x ) ) italic_c start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( bold_italic_x ) ∈ blackboard_R start_POSTSUPERSCRIPT italic_s × italic_p end_POSTSUPERSCRIPT takes caligraphic_O ( italic_p italic_q italic_r + italic_p italic_r italic_s ) time.</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.33)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Meanwhile, doing reverse-mode AD has the following computational costs:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx111">
<tbody id="S2.E34"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\text{computing}\ a^{\prime}(b(c(\bm{x})))\in\mathbb{R}^{s\times r}\ \text{takes negligible time}" class="ltx_Math" display="inline" id="S2.E34.m1"><semantics><mrow><mrow><mtext>computing</mtext><mo lspace="0.500em" rspace="0em">​</mo><msup><mi>a</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>b</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>∈</mo><mrow><msup><mi>ℝ</mi><mrow><mi>s</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>r</mi></mrow></msup><mo lspace="0em" rspace="0em">​</mo><mtext>takes negligible time</mtext></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\text{computing}\ a^{\prime}(b(c(\bm{x})))\in\mathbb{R}^{s\times r}\ \text{takes negligible time}</annotation><annotation encoding="application/x-llamapun">computing italic_a start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_b ( italic_c ( bold_italic_x ) ) ) ∈ blackboard_R start_POSTSUPERSCRIPT italic_s × italic_r end_POSTSUPERSCRIPT takes negligible time</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.34)</span></td>
</tr></tbody>
<tbody id="S2.E35"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\text{computing}\ a^{\prime}(b(c(\bm{x})))b^{\prime}(c(\bm{x}))\in\mathbb{R}^{s\times q}\ \text{takes $\mathcal{O}(qrs)$ time}" class="ltx_Math" display="inline" id="S2.E35.m1"><semantics><mrow><mrow><mtext>computing</mtext><mo lspace="0.500em" rspace="0em">​</mo><msup><mi>a</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>b</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>b</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>∈</mo><mrow><msup><mi>ℝ</mi><mrow><mi>s</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>q</mi></mrow></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mtext>takes </mtext><mrow><mi class="ltx_font_mathcaligraphic">𝒪</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>q</mi><mo lspace="0em" rspace="0em">​</mo><mi>r</mi><mo lspace="0em" rspace="0em">​</mo><mi>s</mi></mrow><mo stretchy="false">)</mo></mrow></mrow><mtext> time</mtext></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\text{computing}\ a^{\prime}(b(c(\bm{x})))b^{\prime}(c(\bm{x}))\in\mathbb{R}^{s\times q}\ \text{takes $\mathcal{O}(qrs)$ time}</annotation><annotation encoding="application/x-llamapun">computing italic_a start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_b ( italic_c ( bold_italic_x ) ) ) italic_b start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_c ( bold_italic_x ) ) ∈ blackboard_R start_POSTSUPERSCRIPT italic_s × italic_q end_POSTSUPERSCRIPT takes caligraphic_O ( italic_q italic_r italic_s ) time</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.35)</span></td>
</tr></tbody>
<tbody id="S2.E36"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\text{computing}\ a^{\prime}(b(c(\bm{x})))b^{\prime}(c(\bm{x}))c^{\prime}(\bm{x})\in\mathbb{R}^{s\times p}\ \text{takes $\mathcal{O}(qrs+pqs)$ time.}" class="ltx_Math" display="inline" id="S2.E36.m1"><semantics><mrow><mrow><mtext>computing</mtext><mo lspace="0.500em" rspace="0em">​</mo><msup><mi>a</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>b</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>b</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>c</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>c</mi><mo>′</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒙</mi><mo stretchy="false">)</mo></mrow></mrow><mo>∈</mo><mrow><msup><mi>ℝ</mi><mrow><mi>s</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>p</mi></mrow></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mtext>takes </mtext><mrow><mi class="ltx_font_mathcaligraphic">𝒪</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mi>q</mi><mo lspace="0em" rspace="0em">​</mo><mi>r</mi><mo lspace="0em" rspace="0em">​</mo><mi>s</mi></mrow><mo>+</mo><mrow><mi>p</mi><mo lspace="0em" rspace="0em">​</mo><mi>q</mi><mo lspace="0em" rspace="0em">​</mo><mi>s</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mtext> time.</mtext></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\text{computing}\ a^{\prime}(b(c(\bm{x})))b^{\prime}(c(\bm{x}))c^{\prime}(\bm{x})\in\mathbb{R}^{s\times p}\ \text{takes $\mathcal{O}(qrs+pqs)$ time.}</annotation><annotation encoding="application/x-llamapun">computing italic_a start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_b ( italic_c ( bold_italic_x ) ) ) italic_b start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_c ( bold_italic_x ) ) italic_c start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( bold_italic_x ) ∈ blackboard_R start_POSTSUPERSCRIPT italic_s × italic_p end_POSTSUPERSCRIPT takes caligraphic_O ( italic_q italic_r italic_s + italic_p italic_q italic_s ) time.</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.36)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">In other words, the forward-mode AD takes <math alttext="\mathcal{O}(p(qr+rs))" class="ltx_Math" display="inline" id="S2.SS2.p2.m17"><semantics><mrow><mi class="ltx_font_mathcaligraphic">𝒪</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>p</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mi>q</mi><mo lspace="0em" rspace="0em">​</mo><mi>r</mi></mrow><mo>+</mo><mrow><mi>r</mi><mo lspace="0em" rspace="0em">​</mo><mi>s</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{O}(p(qr+rs))</annotation><annotation encoding="application/x-llamapun">caligraphic_O ( italic_p ( italic_q italic_r + italic_r italic_s ) )</annotation></semantics></math> time, and the reverse-mode AD takes <math alttext="\mathcal{O}(s(pq+qr))" class="ltx_Math" display="inline" id="S2.SS2.p2.m18"><semantics><mrow><mi class="ltx_font_mathcaligraphic">𝒪</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>s</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mi>p</mi><mo lspace="0em" rspace="0em">​</mo><mi>q</mi></mrow><mo>+</mo><mrow><mi>q</mi><mo lspace="0em" rspace="0em">​</mo><mi>r</mi></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{O}(s(pq+qr))</annotation><annotation encoding="application/x-llamapun">caligraphic_O ( italic_s ( italic_p italic_q + italic_q italic_r ) )</annotation></semantics></math> time. <span class="ltx_text ltx_font_italic">These take a different amount of time!</span></p>
</div>
<div class="ltx_para" id="S2.SS2.p3">
<p class="ltx_p">More generally, suppose that <math alttext="f=f^{L}\circ\cdots\circ f^{1}" class="ltx_Math" display="inline" id="S2.SS2.p3.m1"><semantics><mrow><mi>f</mi><mo>=</mo><mrow><msup><mi>f</mi><mi>L</mi></msup><mo lspace="0.222em" rspace="0.222em">∘</mo><mi mathvariant="normal">⋯</mi><mo lspace="0.222em" rspace="0.222em">∘</mo><msup><mi>f</mi><mn>1</mn></msup></mrow></mrow><annotation encoding="application/x-tex">f=f^{L}\circ\cdots\circ f^{1}</annotation><annotation encoding="application/x-llamapun">italic_f = italic_f start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT ∘ ⋯ ∘ italic_f start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT</annotation></semantics></math> where each <math alttext="f^{\ell}\colon\mathbb{R}^{d^{\ell-1}}\to\mathbb{R}^{d^{\ell}}" class="ltx_Math" display="inline" id="S2.SS2.p3.m2"><semantics><mrow><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><msup><mi>d</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>−</mo><mn>1</mn></mrow></msup></msup><mo stretchy="false">→</mo><msup><mi>ℝ</mi><msup><mi>d</mi><mi mathvariant="normal">ℓ</mi></msup></msup></mrow></mrow><annotation encoding="application/x-tex">f^{\ell}\colon\mathbb{R}^{d^{\ell-1}}\to\mathbb{R}^{d^{\ell}}</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT : blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUPERSCRIPT roman_ℓ - 1 end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT → blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math>, so that <math alttext="f\colon\mathbb{R}^{d^{0}}\to\mathbb{R}^{d^{L}}" class="ltx_Math" display="inline" id="S2.SS2.p3.m3"><semantics><mrow><mi>f</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><msup><mi>d</mi><mn>0</mn></msup></msup><mo stretchy="false">→</mo><msup><mi>ℝ</mi><msup><mi>d</mi><mi>L</mi></msup></msup></mrow></mrow><annotation encoding="application/x-tex">f\colon\mathbb{R}^{d^{0}}\to\mathbb{R}^{d^{L}}</annotation><annotation encoding="application/x-llamapun">italic_f : blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUPERSCRIPT 0 end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT → blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math>. Then the forward-mode AD takes <math alttext="\mathcal{O}(d^{0}(\sum_{\ell=2}^{L}d^{\ell-1}d^{\ell}))" class="ltx_Math" display="inline" id="S2.SS2.p3.m4"><semantics><mrow><mi class="ltx_font_mathcaligraphic">𝒪</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msup><mi>d</mi><mn>0</mn></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msubsup><mo lspace="0em">∑</mo><mrow><mi mathvariant="normal">ℓ</mi><mo>=</mo><mn>2</mn></mrow><mi>L</mi></msubsup><mrow><msup><mi>d</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>−</mo><mn>1</mn></mrow></msup><mo lspace="0em" rspace="0em">​</mo><msup><mi>d</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{O}(d^{0}(\sum_{\ell=2}^{L}d^{\ell-1}d^{\ell}))</annotation><annotation encoding="application/x-llamapun">caligraphic_O ( italic_d start_POSTSUPERSCRIPT 0 end_POSTSUPERSCRIPT ( ∑ start_POSTSUBSCRIPT roman_ℓ = 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT italic_d start_POSTSUPERSCRIPT roman_ℓ - 1 end_POSTSUPERSCRIPT italic_d start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) )</annotation></semantics></math> time while the reverse-mode AD takes <math alttext="\mathcal{O}(d^{L}(\sum_{\ell=1}^{L-1}d^{\ell-1}d^{\ell}))" class="ltx_Math" display="inline" id="S2.SS2.p3.m5"><semantics><mrow><mi class="ltx_font_mathcaligraphic">𝒪</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msup><mi>d</mi><mi>L</mi></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msubsup><mo lspace="0em">∑</mo><mrow><mi mathvariant="normal">ℓ</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>L</mi><mo>−</mo><mn>1</mn></mrow></msubsup><mrow><msup><mi>d</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>−</mo><mn>1</mn></mrow></msup><mo lspace="0em" rspace="0em">​</mo><msup><mi>d</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{O}(d^{L}(\sum_{\ell=1}^{L-1}d^{\ell-1}d^{\ell}))</annotation><annotation encoding="application/x-llamapun">caligraphic_O ( italic_d start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT ( ∑ start_POSTSUBSCRIPT roman_ℓ = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_L - 1 end_POSTSUPERSCRIPT italic_d start_POSTSUPERSCRIPT roman_ℓ - 1 end_POSTSUPERSCRIPT italic_d start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) )</annotation></semantics></math> time. From the above rates, we see that all else equal:</p>
<ul class="ltx_itemize" id="S2.I2">
<li class="ltx_item" id="S2.I2.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S2.I2.i1.p1">
<p class="ltx_p">If the function to optimize has <span class="ltx_text ltx_font_italic">more outputs than inputs</span> (i.e., <math alttext="d^{L}&gt;d^{0}" class="ltx_Math" display="inline" id="S2.I2.i1.p1.m1"><semantics><mrow><msup><mi>d</mi><mi>L</mi></msup><mo>&gt;</mo><msup><mi>d</mi><mn>0</mn></msup></mrow><annotation encoding="application/x-tex">d^{L}&gt;d^{0}</annotation><annotation encoding="application/x-llamapun">italic_d start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT &gt; italic_d start_POSTSUPERSCRIPT 0 end_POSTSUPERSCRIPT</annotation></semantics></math>), use <span class="ltx_text ltx_font_italic">forward-mode AD</span>.</p>
</div>
</li>
<li class="ltx_item" id="S2.I2.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S2.I2.i2.p1">
<p class="ltx_p">If the function to optimize has <span class="ltx_text ltx_font_italic">more inputs than outputs</span> (i.e., <math alttext="d^{0}&gt;d^{L}" class="ltx_Math" display="inline" id="S2.I2.i2.p1.m1"><semantics><mrow><msup><mi>d</mi><mn>0</mn></msup><mo>&gt;</mo><msup><mi>d</mi><mi>L</mi></msup></mrow><annotation encoding="application/x-tex">d^{0}&gt;d^{L}</annotation><annotation encoding="application/x-llamapun">italic_d start_POSTSUPERSCRIPT 0 end_POSTSUPERSCRIPT &gt; italic_d start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT</annotation></semantics></math>), use <span class="ltx_text ltx_font_italic">reverse-mode AD</span>.</p>
</div>
</li>
</ul>
<p class="ltx_p">In a neural network, we compute the gradient of a <span class="ltx_text ltx_font_italic">loss function</span> <math alttext="\mathcal{L}\colon\Theta\to\mathbb{R}" class="ltx_Math" display="inline" id="S2.SS2.p3.m6"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">→</mo><mi>ℝ</mi></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}\colon\Theta\to\mathbb{R}</annotation><annotation encoding="application/x-llamapun">caligraphic_L : roman_Θ → blackboard_R</annotation></semantics></math>, where the parameter space <math alttext="\Theta" class="ltx_Math" display="inline" id="S2.SS2.p3.m7"><semantics><mi mathvariant="normal">Θ</mi><annotation encoding="application/x-tex">\Theta</annotation><annotation encoding="application/x-llamapun">roman_Θ</annotation></semantics></math> is usually very high-dimensional. So in practice we always use reverse-mode AD for training neural networks. Reverse-mode AD, in the context of training neural networks, is called <span class="ltx_text ltx_font_italic">backpropagation</span>.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.2.3 </span>Back Propagation</h3>
<div class="ltx_para" id="S2.SS3.p1">
<p class="ltx_p">In this section, we will discuss algorithmic backpropagation using a simple yet completely practical example. Suppose that we fix an input-label pair <math alttext="(\bm{X},\bm{y})" class="ltx_Math" display="inline" id="S2.SS3.p1.m1"><semantics><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo>,</mo><mi>𝒚</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\bm{X},\bm{y})</annotation><annotation encoding="application/x-llamapun">( bold_italic_X , bold_italic_y )</annotation></semantics></math>, and fix a network architecture <math alttext="f_{\theta}=f_{\theta}^{L}\circ\cdots\circ f_{\theta}^{1}\circ f_{\theta}^{\mathrm{emb}}" class="ltx_Math" display="inline" id="S2.SS3.p1.m2"><semantics><mrow><msub><mi>f</mi><mi>θ</mi></msub><mo>=</mo><mrow><msubsup><mi>f</mi><mi>θ</mi><mi>L</mi></msubsup><mo lspace="0.222em" rspace="0.222em">∘</mo><mi mathvariant="normal">⋯</mi><mo lspace="0.222em" rspace="0.222em">∘</mo><msubsup><mi>f</mi><mi>θ</mi><mn>1</mn></msubsup><mo lspace="0.222em" rspace="0.222em">∘</mo><msubsup><mi>f</mi><mi>θ</mi><mi>emb</mi></msubsup></mrow></mrow><annotation encoding="application/x-tex">f_{\theta}=f_{\theta}^{L}\circ\cdots\circ f_{\theta}^{1}\circ f_{\theta}^{\mathrm{emb}}</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT = italic_f start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT ∘ ⋯ ∘ italic_f start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT ∘ italic_f start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT roman_emb end_POSTSUPERSCRIPT</annotation></semantics></math> where <math alttext="\theta=(\theta^{\mathrm{emb}},\theta^{1},\dots,\theta^{m},\theta^{\mathrm{head}})" class="ltx_Math" display="inline" id="S2.SS3.p1.m3"><semantics><mrow><mi>θ</mi><mo>=</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mi>emb</mi></msup><mo>,</mo><msup><mi>θ</mi><mn>1</mn></msup><mo>,</mo><mi mathvariant="normal">…</mi><mo>,</mo><msup><mi>θ</mi><mi>m</mi></msup><mo>,</mo><msup><mi>θ</mi><mi>head</mi></msup><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta=(\theta^{\mathrm{emb}},\theta^{1},\dots,\theta^{m},\theta^{\mathrm{head}})</annotation><annotation encoding="application/x-llamapun">italic_θ = ( italic_θ start_POSTSUPERSCRIPT roman_emb end_POSTSUPERSCRIPT , italic_θ start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT , … , italic_θ start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT , italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT )</annotation></semantics></math> and task-specific head <math alttext="h_{\theta^{\mathrm{head}}}" class="ltx_Math" display="inline" id="S2.SS3.p1.m4"><semantics><msub><mi>h</mi><msup><mi>θ</mi><mi>head</mi></msup></msub><annotation encoding="application/x-tex">h_{\theta^{\mathrm{head}}}</annotation><annotation encoding="application/x-llamapun">italic_h start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math>, and write</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx112">
<tbody id="S2.E37"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\bm{Z}_{\theta}^{1}(\bm{X})\doteq f_{\theta}^{\mathrm{emb}}(\bm{X})," class="ltx_Math" display="inline" id="S2.E37.m1"><semantics><mrow><mrow><mrow><msubsup><mi>𝒁</mi><mi>θ</mi><mn>1</mn></msubsup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><msubsup><mi>f</mi><mi>θ</mi><mi>emb</mi></msubsup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\displaystyle\bm{Z}_{\theta}^{1}(\bm{X})\doteq f_{\theta}^{\mathrm{emb}}(\bm{X}),</annotation><annotation encoding="application/x-llamapun">bold_italic_Z start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT ( bold_italic_X ) ≐ italic_f start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT roman_emb end_POSTSUPERSCRIPT ( bold_italic_X ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.37)</span></td>
</tr></tbody>
<tbody id="S2.E38"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\bm{Z}_{\theta}^{\ell+1}(\bm{X})\doteq f_{\theta}^{\ell}(\bm{Z}_{\theta}^{\ell}(\bm{X})),\quad\forall\ell\in\{1,\dots,L\}," class="ltx_Math" display="inline" id="S2.E38.m1"><semantics><mrow><mrow><mrow><mrow><msubsup><mi>𝒁</mi><mi>θ</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msubsup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><msubsup><mi>f</mi><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msubsup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msubsup><mi>𝒁</mi><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msubsup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><mo rspace="1.167em">,</mo><mrow><mrow><mo rspace="0.167em">∀</mo><mi mathvariant="normal">ℓ</mi></mrow><mo>∈</mo><mrow><mo stretchy="false">{</mo><mn>1</mn><mo>,</mo><mi mathvariant="normal">…</mi><mo>,</mo><mi>L</mi><mo stretchy="false">}</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\displaystyle\bm{Z}_{\theta}^{\ell+1}(\bm{X})\doteq f_{\theta}^{\ell}(\bm{Z}_{\theta}^{\ell}(\bm{X})),\quad\forall\ell\in\{1,\dots,L\},</annotation><annotation encoding="application/x-llamapun">bold_italic_Z start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT ( bold_italic_X ) ≐ italic_f start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ( bold_italic_Z start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ( bold_italic_X ) ) , ∀ roman_ℓ ∈ { 1 , … , italic_L } ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.38)</span></td>
</tr></tbody>
<tbody id="S2.E39"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\hat{\bm{y}}_{\theta^{\mathrm{head}}}(\bm{X})\doteq h_{\theta}(\bm{Z}_{\theta}^{L+1}(\bm{X}))." class="ltx_Math" display="inline" id="S2.E39.m1"><semantics><mrow><mrow><mrow><msub><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover><msup><mi>θ</mi><mi>head</mi></msup></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><msub><mi>h</mi><mi>θ</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msubsup><mi>𝒁</mi><mi>θ</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msubsup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle\hat{\bm{y}}_{\theta^{\mathrm{head}}}(\bm{X})\doteq h_{\theta}(\bm{Z}_{\theta}^{L+1}(\bm{X})).</annotation><annotation encoding="application/x-llamapun">over^ start_ARG bold_italic_y end_ARG start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT end_POSTSUBSCRIPT ( bold_italic_X ) ≐ italic_h start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( bold_italic_Z start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT ( bold_italic_X ) ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.39)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Then, we can define the loss on this one term by</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E40">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta)\doteq\mathsf{L}(\bm{y},\hat{\bm{y}}_{\theta}(\bm{X}))," class="ltx_Math" display="block" id="S2.E40.m1"><semantics><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><mi>𝖫</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒚</mi><mo>,</mo><mrow><msub><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover><mi>θ</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta)\doteq\mathsf{L}(\bm{y},\hat{\bm{y}}_{\theta}(\bm{X})),</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ ) ≐ sansserif_L ( bold_italic_y , over^ start_ARG bold_italic_y end_ARG start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( bold_italic_X ) ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.40)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where <math alttext="\mathsf{L}" class="ltx_Math" display="inline" id="S2.SS3.p1.m5"><semantics><mi>𝖫</mi><annotation encoding="application/x-tex">\mathsf{L}</annotation><annotation encoding="application/x-llamapun">sansserif_L</annotation></semantics></math> is a differentiable function of its second argument. Then the backward-mode AD instructs us to compute the derivatives in the order <math alttext="\theta^{\mathrm{head}},\theta^{L},\dots,\theta^{1},\theta^{\mathrm{emb}}" class="ltx_Math" display="inline" id="S2.SS3.p1.m6"><semantics><mrow><msup><mi>θ</mi><mi>head</mi></msup><mo>,</mo><msup><mi>θ</mi><mi>L</mi></msup><mo>,</mo><mi mathvariant="normal">…</mi><mo>,</mo><msup><mi>θ</mi><mn>1</mn></msup><mo>,</mo><msup><mi>θ</mi><mi>emb</mi></msup></mrow><annotation encoding="application/x-tex">\theta^{\mathrm{head}},\theta^{L},\dots,\theta^{1},\theta^{\mathrm{emb}}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT , italic_θ start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT , … , italic_θ start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT , italic_θ start_POSTSUPERSCRIPT roman_emb end_POSTSUPERSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S2.SS3.p2">
<p class="ltx_p">To carry out this computation, let us make some changes to the notation.</p>
<ul class="ltx_itemize" id="S2.I3">
<li class="ltx_item" id="S2.I3.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S2.I3.i1.p1">
<p class="ltx_p">First, let us change the notation to emphasize the dependency structure between the variables. Namely,</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx113">
<tbody id="S2.E41"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\bm{Z}^{1}\doteq f^{\mathrm{emb}}(\bm{X},\theta^{\mathrm{emb}})" class="ltx_Math" display="inline" id="S2.E41.m1"><semantics><mrow><msup><mi>𝒁</mi><mn>1</mn></msup><mo>≐</mo><mrow><msup><mi>f</mi><mi>emb</mi></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝑿</mi><mo>,</mo><msup><mi>θ</mi><mi>emb</mi></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\bm{Z}^{1}\doteq f^{\mathrm{emb}}(\bm{X},\theta^{\mathrm{emb}})</annotation><annotation encoding="application/x-llamapun">bold_italic_Z start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT ≐ italic_f start_POSTSUPERSCRIPT roman_emb end_POSTSUPERSCRIPT ( bold_italic_X , italic_θ start_POSTSUPERSCRIPT roman_emb end_POSTSUPERSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.41)</span></td>
</tr></tbody>
<tbody id="S2.E42"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\bm{Z}^{\ell+1}\doteq f^{\ell}(\bm{Z}^{\ell},\theta^{\ell}),\qquad\forall\ell\in\{1,\dots,L\}," class="ltx_Math" display="inline" id="S2.E42.m1"><semantics><mrow><mrow><mrow><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>≐</mo><mrow><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup><mo>,</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo rspace="2.167em">,</mo><mrow><mrow><mo rspace="0.167em">∀</mo><mi mathvariant="normal">ℓ</mi></mrow><mo>∈</mo><mrow><mo stretchy="false">{</mo><mn>1</mn><mo>,</mo><mi mathvariant="normal">…</mi><mo>,</mo><mi>L</mi><mo stretchy="false">}</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\displaystyle\bm{Z}^{\ell+1}\doteq f^{\ell}(\bm{Z}^{\ell},\theta^{\ell}),\qquad\forall\ell\in\{1,\dots,L\},</annotation><annotation encoding="application/x-llamapun">bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT ≐ italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ( bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT , italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) , ∀ roman_ℓ ∈ { 1 , … , italic_L } ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.42)</span></td>
</tr></tbody>
<tbody id="S2.E43"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\hat{\bm{y}}\doteq h(\bm{Z}^{L+1},\theta^{\mathrm{head}})," class="ltx_Math" display="inline" id="S2.E43.m1"><semantics><mrow><mrow><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover><mo>≐</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>,</mo><msup><mi>θ</mi><mi>head</mi></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\displaystyle\hat{\bm{y}}\doteq h(\bm{Z}^{L+1},\theta^{\mathrm{head}}),</annotation><annotation encoding="application/x-llamapun">over^ start_ARG bold_italic_y end_ARG ≐ italic_h ( bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT , italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.43)</span></td>
</tr></tbody>
<tbody id="S2.E44"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\mathcal{L}\doteq\mathsf{L}(\bm{y},\hat{\bm{y}})." class="ltx_Math" display="inline" id="S2.E44.m1"><semantics><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>≐</mo><mrow><mi>𝖫</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒚</mi><mo>,</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle\mathcal{L}\doteq\mathsf{L}(\bm{y},\hat{\bm{y}}).</annotation><annotation encoding="application/x-llamapun">caligraphic_L ≐ sansserif_L ( bold_italic_y , over^ start_ARG bold_italic_y end_ARG ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.44)</span></td>
</tr></tbody>
</table>
</div>
</li>
<li class="ltx_item" id="S2.I3.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S2.I3.i2.p1">
<p class="ltx_p">Then, instead of having the derivative be <math alttext="f^{\prime}" class="ltx_Math" display="inline" id="S2.I3.i2.p1.m1"><semantics><msup><mi>f</mi><mo>′</mo></msup><annotation encoding="application/x-tex">f^{\prime}</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>, we explicitly notate the independent variable and write the derivative as <math alttext="\frac{\mathrm{d}f}{\mathrm{d}\theta^{1}}" class="ltx_Math" display="inline" id="S2.I3.i2.p1.m2"><semantics><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>f</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mn>1</mn></msup></mrow></mfrac><annotation encoding="application/x-tex">\frac{\mathrm{d}f}{\mathrm{d}\theta^{1}}</annotation><annotation encoding="application/x-llamapun">divide start_ARG roman_d italic_f end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT end_ARG</annotation></semantics></math>, for example. This is because there are many variables in our model and we only care about one at a time.</p>
</div>
</li>
</ul>
<p class="ltx_p">We can start by computing the appropriate differentials. First, for <math alttext="\theta^{\mathrm{head}}" class="ltx_Math" display="inline" id="S2.SS3.p2.m1"><semantics><msup><mi>θ</mi><mi>head</mi></msup><annotation encoding="application/x-tex">\theta^{\mathrm{head}}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT</annotation></semantics></math> we have</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx114">
<tbody id="S2.E45"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathrm{d}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E45.m1"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\displaystyle\mathrm{d}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\mathrm{d}\mathsf{L}" class="ltx_Math" display="inline" id="S2.E45.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝖫</mi></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\mathrm{d}\mathsf{L}</annotation><annotation encoding="application/x-llamapun">= roman_d sansserif_L</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.45)</span></td>
</tr></tbody>
<tbody id="S2.E46"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\cdot\mathrm{d}\hat{\bm{y}}" class="ltx_Math" display="inline" id="S2.E46.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝖫</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\cdot\mathrm{d}\hat{\bm{y}}</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d sansserif_L end_ARG start_ARG roman_d over^ start_ARG bold_italic_y end_ARG end_ARG ⋅ roman_d over^ start_ARG bold_italic_y end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.46)</span></td>
</tr></tbody>
<tbody id="S2.E47"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\cdot\mathrm{d}{(h(\bm{Z}^{L+1},\theta^{\mathrm{head}}))}" class="ltx_Math" display="inline" id="S2.E47.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝖫</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>,</mo><msup><mi>θ</mi><mi>head</mi></msup><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\cdot\mathrm{d}{(h(\bm{Z}^{L+1},\theta^{\mathrm{head}}))}</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d sansserif_L end_ARG start_ARG roman_d over^ start_ARG bold_italic_y end_ARG end_ARG ⋅ roman_d ( italic_h ( bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT , italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.47)</span></td>
</tr></tbody>
<tbody id="S2.E48"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\left[\frac{\mathrm{d}h}{\mathrm{d}\bm{Z}^{L+1}}\cdot\mathrm{d}\bm{Z}^{L+1}+\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}\cdot\mathrm{d}\theta^{\mathrm{head}}\right]." class="ltx_Math" display="inline" id="S2.E48.m1"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝖫</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></mrow></mfrac></mstyle><mo lspace="0em" rspace="0em">​</mo><mrow><mo>[</mo><mrow><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><mo>+</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow></mrow><mo>]</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\left[\frac{\mathrm{d}h}{\mathrm{d}\bm{Z}^{L+1}}\cdot\mathrm{d}\bm{Z}^{L+1}+\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}\cdot\mathrm{d}\theta^{\mathrm{head}}\right].</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d sansserif_L end_ARG start_ARG roman_d over^ start_ARG bold_italic_y end_ARG end_ARG [ divide start_ARG roman_d italic_h end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT end_ARG ⋅ roman_d bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT + divide start_ARG roman_d italic_h end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT end_ARG ⋅ roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.48)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Now since <math alttext="\bm{Z}^{L+1}" class="ltx_Math" display="inline" id="S2.SS3.p2.m2"><semantics><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">\bm{Z}^{L+1}</annotation><annotation encoding="application/x-llamapun">bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT</annotation></semantics></math> does not depend on <math alttext="\theta^{\mathrm{head}}" class="ltx_Math" display="inline" id="S2.SS3.p2.m3"><semantics><msup><mi>θ</mi><mi>head</mi></msup><annotation encoding="application/x-tex">\theta^{\mathrm{head}}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT</annotation></semantics></math>, we have <math alttext="\mathrm{d}\bm{Z}^{L+1}=0" class="ltx_Math" display="inline" id="S2.SS3.p2.m4"><semantics><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\mathrm{d}\bm{Z}^{L+1}=0</annotation><annotation encoding="application/x-llamapun">roman_d bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT = 0</annotation></semantics></math>, so in the end it holds (using the fact that the gradient is the transpose of the derivative for a function <math alttext="\mathsf{L}" class="ltx_Math" display="inline" id="S2.SS3.p2.m5"><semantics><mi>𝖫</mi><annotation encoding="application/x-tex">\mathsf{L}</annotation><annotation encoding="application/x-llamapun">sansserif_L</annotation></semantics></math> whose codomain is <math alttext="\mathbb{R}" class="ltx_Math" display="inline" id="S2.SS3.p2.m6"><semantics><mi>ℝ</mi><annotation encoding="application/x-tex">\mathbb{R}</annotation><annotation encoding="application/x-llamapun">blackboard_R</annotation></semantics></math>):</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx115">
<tbody id="S2.E49"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathrm{d}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E49.m1"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\displaystyle\mathrm{d}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\cdot\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}\cdot\mathrm{d}\theta^{\mathrm{head}}" class="ltx_Math" display="inline" id="S2.E49.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝖫</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\cdot\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}\cdot\mathrm{d}\theta^{\mathrm{head}}</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d sansserif_L end_ARG start_ARG roman_d over^ start_ARG bold_italic_y end_ARG end_ARG ⋅ divide start_ARG roman_d italic_h end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT end_ARG ⋅ roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.49)</span></td>
</tr></tbody>
<tbody id="S2.E50"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=[\nabla_{\hat{\bm{y}}}\mathsf{L}]^{\top}\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}\cdot\mathrm{d}\theta^{\mathrm{head}}" class="ltx_Math" display="inline" id="S2.E50.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mrow><msup><mrow><mo stretchy="false">[</mo><mrow><msub><mo rspace="0.167em">∇</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></msub><mi>𝖫</mi></mrow><mo stretchy="false">]</mo></mrow><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow></mfrac></mstyle></mrow><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=[\nabla_{\hat{\bm{y}}}\mathsf{L}]^{\top}\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}\cdot\mathrm{d}\theta^{\mathrm{head}}</annotation><annotation encoding="application/x-llamapun">= [ ∇ start_POSTSUBSCRIPT over^ start_ARG bold_italic_y end_ARG end_POSTSUBSCRIPT sansserif_L ] start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT divide start_ARG roman_d italic_h end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT end_ARG ⋅ roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.50)</span></td>
</tr></tbody>
<tbody id="S2.E51"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left\langle\nabla_{\hat{\bm{y}}}\mathsf{L},\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}\cdot\mathrm{d}\theta^{\mathrm{head}}\right\rangle" class="ltx_Math" display="inline" id="S2.E51.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mo>⟨</mo><mrow><msub><mo rspace="0.167em">∇</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></msub><mi>𝖫</mi></mrow><mo>,</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow><mo>⟩</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\left\langle\nabla_{\hat{\bm{y}}}\mathsf{L},\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}\cdot\mathrm{d}\theta^{\mathrm{head}}\right\rangle</annotation><annotation encoding="application/x-llamapun">= ⟨ ∇ start_POSTSUBSCRIPT over^ start_ARG bold_italic_y end_ARG end_POSTSUBSCRIPT sansserif_L , divide start_ARG roman_d italic_h end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT end_ARG ⋅ roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT ⟩</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.51)</span></td>
</tr></tbody>
<tbody id="S2.E52"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left\langle\left(\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}\right)^{*}\nabla_{\hat{\bm{y}}}\mathsf{L},\mathrm{d}\theta^{\mathrm{head}}\right\rangle" class="ltx_Math" display="inline" id="S2.E52.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mo>⟨</mo><mrow><msup><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow></mfrac></mstyle><mo>)</mo></mrow><mo>∗</mo></msup><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></msub><mi>𝖫</mi></mrow></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow><mo>⟩</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\left\langle\left(\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}\right)^{*}\nabla_{\hat{\bm{y}}}\mathsf{L},\mathrm{d}\theta^{\mathrm{head}}\right\rangle</annotation><annotation encoding="application/x-llamapun">= ⟨ ( divide start_ARG roman_d italic_h end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT end_ARG ) start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∇ start_POSTSUBSCRIPT over^ start_ARG bold_italic_y end_ARG end_POSTSUBSCRIPT sansserif_L , roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT ⟩</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.52)</span></td>
</tr></tbody>
<tbody id="S2.E53"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\langle\nabla_{\theta^{\mathrm{head}}}\mathcal{L},\mathrm{d}\theta^{\mathrm{head}}\rangle." class="ltx_Math" display="inline" id="S2.E53.m1"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><mo stretchy="false">⟨</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>θ</mi><mi>head</mi></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow><mo stretchy="false">⟩</mo></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\langle\nabla_{\theta^{\mathrm{head}}}\mathcal{L},\mathrm{d}\theta^{\mathrm{head}}\rangle.</annotation><annotation encoding="application/x-llamapun">= ⟨ ∇ start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L , roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT ⟩ .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.53)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Thus to compute <math alttext="\nabla_{\theta^{\mathrm{head}}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS3.p2.m7"><semantics><mrow><msub><mo>∇</mo><msup><mi>θ</mi><mi>head</mi></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla_{\theta^{\mathrm{head}}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math>, we compute the gradient <math alttext="\nabla_{\hat{\bm{y}}}\mathsf{L}" class="ltx_Math" display="inline" id="S2.SS3.p2.m8"><semantics><mrow><msub><mo>∇</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></msub><mi>𝖫</mi></mrow><annotation encoding="application/x-tex">\nabla_{\hat{\bm{y}}}\mathsf{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT over^ start_ARG bold_italic_y end_ARG end_POSTSUBSCRIPT sansserif_L</annotation></semantics></math> and the <span class="ltx_text ltx_font_italic">adjoint<span class="ltx_note ltx_role_footnote" id="footnote6"><sup class="ltx_note_mark">6</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">6</sup><span class="ltx_tag ltx_tag_note"><span class="ltx_text ltx_font_upright">6</span></span><span class="ltx_text ltx_font_upright">The adjoint is like a generalized transpose for more general linear transformations. Particularly, for a given pair of inner product spaces and linear transformation </span><math alttext="T" class="ltx_Math" display="inline" id="footnote6.m1"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation><annotation encoding="application/x-llamapun">italic_T</annotation></semantics></math><span class="ltx_text ltx_font_upright"> between those spaces, the adjoint </span><math alttext="T^{*}" class="ltx_Math" display="inline" id="footnote6.m2"><semantics><msup><mi>T</mi><mo>∗</mo></msup><annotation encoding="application/x-tex">T^{*}</annotation><annotation encoding="application/x-llamapun">italic_T start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT</annotation></semantics></math><span class="ltx_text ltx_font_upright"> is defined by the identity </span><math alttext="\langle T\bm{x},\bm{y}\rangle=\langle\bm{x},T^{*}\bm{y}\rangle" class="ltx_Math" display="inline" id="footnote6.m3"><semantics><mrow><mrow><mo stretchy="false">⟨</mo><mrow><mi>T</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝐱</mi></mrow><mo>,</mo><mi>𝐲</mi><mo stretchy="false">⟩</mo></mrow><mo>=</mo><mrow><mo stretchy="false">⟨</mo><mi>𝐱</mi><mo>,</mo><mrow><msup><mi>T</mi><mo>∗</mo></msup><mo lspace="0em" rspace="0em">​</mo><mi>𝐲</mi></mrow><mo stretchy="false">⟩</mo></mrow></mrow><annotation encoding="application/x-tex">\langle T\bm{x},\bm{y}\rangle=\langle\bm{x},T^{*}\bm{y}\rangle</annotation><annotation encoding="application/x-llamapun">⟨ italic_T bold_italic_x , bold_italic_y ⟩ = ⟨ bold_italic_x , italic_T start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT bold_italic_y ⟩</annotation></semantics></math><span class="ltx_text ltx_font_upright">. In finite dimensions (i.e., all cases relevant to this book) the adjoint exists and is unique.</span></span></span></span></span> of the derivative <math alttext="\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}" class="ltx_Math" display="inline" id="S2.SS3.p2.m9"><semantics><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow></mfrac><annotation encoding="application/x-tex">\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}</annotation><annotation encoding="application/x-llamapun">divide start_ARG roman_d italic_h end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT end_ARG</annotation></semantics></math> and multiply (i.e., apply the adjoint linear transformation to the gradient). In practice, both derivatives can be computed by hand, but many modern computational frameworks can <span class="ltx_text ltx_font_italic">automatically</span> define the derivatives (and/or their adjoints) given code for the “forward pass,” i.e., the loss function computation. While extending this automatic derivative definition to as many functions as possible is an area of active research, the resource <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx31" title="">BEJ25</a>]</cite> describes one basic approach to do it in some detail. By the way, backpropagation is also called the <span class="ltx_text ltx_font_italic">adjoint method</span> for this reason — i.e., that we use adjoints derivatives to compute the gradient.</p>
</div>
<div class="ltx_para" id="S2.SS3.p3">
<p class="ltx_p">Now let us compute the differentials w.r.t. some <math alttext="\theta^{\ell}" class="ltx_Math" display="inline" id="S2.SS3.p3.m1"><semantics><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup><annotation encoding="application/x-tex">\theta^{\ell}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx116">
<tbody id="S2.E54"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathrm{d}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E54.m1"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\displaystyle\mathrm{d}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\cdot\mathrm{d}\bm{Z}^{\ell+1}" class="ltx_Math" display="inline" id="S2.E54.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\cdot\mathrm{d}\bm{Z}^{\ell+1}</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d caligraphic_L end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_ARG ⋅ roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.54)</span></td>
</tr></tbody>
<tbody id="S2.E55"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\cdot\mathrm{d}{(f^{\ell}(\bm{Z}^{\ell},\theta^{\ell}))}" class="ltx_Math" display="inline" id="S2.E55.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup><mo>,</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\cdot\mathrm{d}{(f^{\ell}(\bm{Z}^{\ell},\theta^{\ell}))}</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d caligraphic_L end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_ARG ⋅ roman_d ( italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ( bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT , italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.55)</span></td>
</tr></tbody>
<tbody id="S2.E56"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\left[\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\bm{Z}^{\ell}}\cdot\mathrm{d}\bm{Z}^{\ell}+\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\cdot\mathrm{d}\theta^{\ell}\right]" class="ltx_Math" display="inline" id="S2.E56.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo lspace="0em" rspace="0em">​</mo><mrow><mo>[</mo><mrow><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo>+</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mrow><mo>]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\left[\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\bm{Z}^{\ell}}\cdot\mathrm{d}\bm{Z}^{\ell}+\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\cdot\mathrm{d}\theta^{\ell}\right]</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d caligraphic_L end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_ARG [ divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG ⋅ roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT + divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG ⋅ roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.56)</span></td>
</tr></tbody>
<tbody id="S2.E57"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\cdot\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\cdot\mathrm{d}\theta^{\ell}\qquad\text{(b/c~{}$\bm{Z}^{\ell}$ isn't fn.~{}of $\theta^{\ell}$ so $\mathrm{d}\bm{Z}^{\ell}=0$)}" class="ltx_Math" display="inline" id="S2.E57.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mspace width="2em"></mspace><mrow><mtext>(b/c </mtext><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup><mtext> isn’t fn. of </mtext><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup><mtext> so </mtext><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo>=</mo><mn>0</mn></mrow><mtext>)</mtext></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\cdot\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\cdot\mathrm{d}\theta^{\ell}\qquad\text{(b/c~{}$\bm{Z}^{\ell}$ isn't fn.~{}of $\theta^{\ell}$ so $\mathrm{d}\bm{Z}^{\ell}=0$)}</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d caligraphic_L end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_ARG ⋅ divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG ⋅ roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT (b/c bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT isn’t fn. of italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT so roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT = 0 )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.57)</span></td>
</tr></tbody>
<tbody id="S2.E58"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=[\nabla_{\bm{Z}^{\ell+1}}\mathcal{L}]^{\top}\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\cdot\mathrm{d}\theta^{\ell}" class="ltx_Math" display="inline" id="S2.E58.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mrow><msup><mrow><mo stretchy="false">[</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo stretchy="false">]</mo></mrow><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mfrac></mstyle></mrow><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=[\nabla_{\bm{Z}^{\ell+1}}\mathcal{L}]^{\top}\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\cdot\mathrm{d}\theta^{\ell}</annotation><annotation encoding="application/x-llamapun">= [ ∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L ] start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG ⋅ roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.58)</span></td>
</tr></tbody>
<tbody id="S2.E59"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left\langle\nabla_{\bm{Z}^{\ell+1}}\mathcal{L},\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\cdot\mathrm{d}\theta^{\ell}\right\rangle" class="ltx_Math" display="inline" id="S2.E59.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mo>⟨</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>,</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo>⟩</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\left\langle\nabla_{\bm{Z}^{\ell+1}}\mathcal{L},\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\cdot\mathrm{d}\theta^{\ell}\right\rangle</annotation><annotation encoding="application/x-llamapun">= ⟨ ∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L , divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG ⋅ roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ⟩</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.59)</span></td>
</tr></tbody>
<tbody id="S2.E60"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left\langle\left(\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\right)^{*}\nabla_{\bm{Z}^{\ell+1}}\mathcal{L},\mathrm{d}\theta^{\ell}\right\rangle" class="ltx_Math" display="inline" id="S2.E60.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mo>⟨</mo><mrow><msup><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mfrac></mstyle><mo>)</mo></mrow><mo>∗</mo></msup><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo>⟩</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\left\langle\left(\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\right)^{*}\nabla_{\bm{Z}^{\ell+1}}\mathcal{L},\mathrm{d}\theta^{\ell}\right\rangle</annotation><annotation encoding="application/x-llamapun">= ⟨ ( divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG ) start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L , roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ⟩</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.60)</span></td>
</tr></tbody>
<tbody id="S2.E61"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\langle\nabla_{\theta^{\ell}}\mathcal{L},\mathrm{d}\theta^{\ell}\rangle." class="ltx_Math" display="inline" id="S2.E61.m1"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><mo stretchy="false">⟨</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo stretchy="false">⟩</mo></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\langle\nabla_{\theta^{\ell}}\mathcal{L},\mathrm{d}\theta^{\ell}\rangle.</annotation><annotation encoding="application/x-llamapun">= ⟨ ∇ start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L , roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ⟩ .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.61)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Thus to compute <math alttext="\nabla_{\theta^{\ell}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS3.p3.m2"><semantics><mrow><msub><mo>∇</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla_{\theta^{\ell}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math> we compute <math alttext="\nabla_{\bm{Z}^{\ell+1}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS3.p3.m3"><semantics><mrow><msub><mo>∇</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla_{\bm{Z}^{\ell+1}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math> then apply the adjoint derivative <math alttext="\left(\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\right)^{*}" class="ltx_Math" display="inline" id="S2.SS3.p3.m4"><semantics><msup><mrow><mo>(</mo><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mfrac><mo>)</mo></mrow><mo>∗</mo></msup><annotation encoding="application/x-tex">\left(\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\right)^{*}</annotation><annotation encoding="application/x-llamapun">( divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG ) start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT</annotation></semantics></math> to it. Since <math alttext="\nabla_{\theta^{\ell}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS3.p3.m5"><semantics><mrow><msub><mo>∇</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla_{\theta^{\ell}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math> depends on <math alttext="\nabla_{\bm{Z}^{\ell+1}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS3.p3.m6"><semantics><mrow><msub><mo>∇</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla_{\bm{Z}^{\ell+1}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math>, we also want to be able to compute the gradients w.r.t. <math alttext="\bm{Z}^{\ell}" class="ltx_Math" display="inline" id="S2.SS3.p3.m7"><semantics><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup><annotation encoding="application/x-tex">\bm{Z}^{\ell}</annotation><annotation encoding="application/x-llamapun">bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT</annotation></semantics></math>. This can be computed in the exact same way:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx117">
<tbody id="S2.E62"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathrm{d}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E62.m1"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\displaystyle\mathrm{d}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\cdot\mathrm{d}\bm{Z}^{\ell+1}" class="ltx_Math" display="inline" id="S2.E62.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\cdot\mathrm{d}\bm{Z}^{\ell+1}</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d caligraphic_L end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_ARG ⋅ roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.62)</span></td>
</tr></tbody>
<tbody id="S2.E63"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\cdot\mathrm{d}{(f^{\ell}(\bm{Z}^{\ell},\theta^{\ell}))}" class="ltx_Math" display="inline" id="S2.E63.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup><mo>,</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\cdot\mathrm{d}{(f^{\ell}(\bm{Z}^{\ell},\theta^{\ell}))}</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d caligraphic_L end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_ARG ⋅ roman_d ( italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ( bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT , italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.63)</span></td>
</tr></tbody>
<tbody id="S2.E64"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\left[\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\bm{Z}^{\ell}}\cdot\mathrm{d}\bm{Z}^{\ell}+\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\cdot\mathrm{d}\theta^{\ell}\right]" class="ltx_Math" display="inline" id="S2.E64.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo lspace="0em" rspace="0em">​</mo><mrow><mo>[</mo><mrow><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo>+</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mrow><mo>]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\left[\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\bm{Z}^{\ell}}\cdot\mathrm{d}\bm{Z}^{\ell}+\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\theta^{\ell}}\cdot\mathrm{d}\theta^{\ell}\right]</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d caligraphic_L end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_ARG [ divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG ⋅ roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT + divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG ⋅ roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.64)</span></td>
</tr></tbody>
<tbody id="S2.E65"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\cdot\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\bm{Z}^{\ell}}\cdot\mathrm{d}\bm{Z}^{\ell}\qquad\text{(b/c~{}~{}$\theta^{\ell}$ isn't fn.~{}of $\bm{Z}^{\ell}$ so $\mathrm{d}\theta^{\ell}=0$ this time)}" class="ltx_Math" display="inline" id="S2.E65.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mspace width="2em"></mspace><mrow><mtext>(b/c </mtext><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup><mtext> isn’t fn. of </mtext><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup><mtext> so </mtext><mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo>=</mo><mn>0</mn></mrow><mtext> this time)</mtext></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathcal{L}}{\mathrm{d}\bm{Z}^{\ell+1}}\cdot\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\bm{Z}^{\ell}}\cdot\mathrm{d}\bm{Z}^{\ell}\qquad\text{(b/c~{}~{}$\theta^{\ell}$ isn't fn.~{}of $\bm{Z}^{\ell}$ so $\mathrm{d}\theta^{\ell}=0$ this time)}</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d caligraphic_L end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_ARG ⋅ divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG ⋅ roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT (b/c italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT isn’t fn. of bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT so roman_d italic_θ start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT = 0 this time)</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.65)</span></td>
</tr></tbody>
<tbody id="S2.E66"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left\langle\left(\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\bm{Z}^{\ell}}\right)^{*}\nabla_{\bm{Z}^{\ell+1}}\mathcal{L},\mathrm{d}\bm{Z}^{\ell}\right\rangle\qquad\text{(same machine)}" class="ltx_Math" display="inline" id="S2.E66.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mo>⟨</mo><mrow><msup><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mfrac></mstyle><mo>)</mo></mrow><mo>∗</mo></msup><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo>⟩</mo></mrow><mspace width="2em"></mspace><mtext>(same machine)</mtext></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\left\langle\left(\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\bm{Z}^{\ell}}\right)^{*}\nabla_{\bm{Z}^{\ell+1}}\mathcal{L},\mathrm{d}\bm{Z}^{\ell}\right\rangle\qquad\text{(same machine)}</annotation><annotation encoding="application/x-llamapun">= ⟨ ( divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG ) start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L , roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ⟩ (same machine)</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.66)</span></td>
</tr></tbody>
<tbody id="S2.E67"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\langle\nabla_{\bm{Z}^{\ell}}\mathcal{L},\mathrm{d}\bm{Z}^{\ell}\rangle." class="ltx_Math" display="inline" id="S2.E67.m1"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><mo stretchy="false">⟨</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo stretchy="false">⟩</mo></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\langle\nabla_{\bm{Z}^{\ell}}\mathcal{L},\mathrm{d}\bm{Z}^{\ell}\rangle.</annotation><annotation encoding="application/x-llamapun">= ⟨ ∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L , roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ⟩ .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.67)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Thus to compute <math alttext="\nabla_{\bm{Z}^{\ell}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS3.p3.m8"><semantics><mrow><msub><mo>∇</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla_{\bm{Z}^{\ell}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math> we compute <math alttext="\nabla_{\bm{Z}^{\ell+1}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS3.p3.m9"><semantics><mrow><msub><mo>∇</mo><msup><mi>𝒁</mi><mrow><mi mathvariant="normal">ℓ</mi><mo>+</mo><mn>1</mn></mrow></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla_{\bm{Z}^{\ell+1}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ + 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math> then apply the adjoint derivative <math alttext="\left(\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\bm{Z}^{\ell}}\right)^{*}" class="ltx_Math" display="inline" id="S2.SS3.p3.m10"><semantics><msup><mrow><mo>(</mo><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mfrac><mo>)</mo></mrow><mo>∗</mo></msup><annotation encoding="application/x-tex">\left(\frac{\mathrm{d}f^{\ell}}{\mathrm{d}\bm{Z}^{\ell}}\right)^{*}</annotation><annotation encoding="application/x-llamapun">( divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG ) start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT</annotation></semantics></math> to it. So we have a recursion to compute <math alttext="\nabla_{\bm{Z}^{\ell}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS3.p3.m11"><semantics><mrow><msub><mo>∇</mo><msup><mi>𝒁</mi><mi mathvariant="normal">ℓ</mi></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla_{\bm{Z}^{\ell}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math> for all <math alttext="\ell" class="ltx_Math" display="inline" id="S2.SS3.p3.m12"><semantics><mi mathvariant="normal">ℓ</mi><annotation encoding="application/x-tex">\ell</annotation><annotation encoding="application/x-llamapun">roman_ℓ</annotation></semantics></math>, with base case <math alttext="\nabla_{\bm{Z}^{L+1}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.SS3.p3.m13"><semantics><mrow><msub><mo>∇</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\nabla_{\bm{Z}^{L+1}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math>, which is given by</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx118">
<tbody id="S2.E68"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathrm{d}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E68.m1"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\displaystyle\mathrm{d}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">roman_d caligraphic_L</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\mathrm{d}\mathsf{L}" class="ltx_Math" display="inline" id="S2.E68.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝖫</mi></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\mathrm{d}\mathsf{L}</annotation><annotation encoding="application/x-llamapun">= roman_d sansserif_L</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.68)</span></td>
</tr></tbody>
<tbody id="S2.E69"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\cdot\mathrm{d}\hat{\bm{y}}" class="ltx_Math" display="inline" id="S2.E69.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝖫</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\cdot\mathrm{d}\hat{\bm{y}}</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d sansserif_L end_ARG start_ARG roman_d over^ start_ARG bold_italic_y end_ARG end_ARG ⋅ roman_d over^ start_ARG bold_italic_y end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.69)</span></td>
</tr></tbody>
<tbody id="S2.E70"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\cdot\mathrm{d}{h(\bm{Z}^{L+1},\theta^{\mathrm{head}})}" class="ltx_Math" display="inline" id="S2.E70.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝖫</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>,</mo><msup><mi>θ</mi><mi>head</mi></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\cdot\mathrm{d}{h(\bm{Z}^{L+1},\theta^{\mathrm{head}})}</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d sansserif_L end_ARG start_ARG roman_d over^ start_ARG bold_italic_y end_ARG end_ARG ⋅ roman_d italic_h ( bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT , italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.70)</span></td>
</tr></tbody>
<tbody id="S2.E71"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\left[\frac{\mathrm{d}h}{\mathrm{d}\bm{Z}^{L+1}}\cdot\mathrm{d}\bm{Z}^{L+1}+\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}\cdot\mathrm{d}\theta^{\mathrm{head}}\right]" class="ltx_Math" display="inline" id="S2.E71.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝖫</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></mrow></mfrac></mstyle><mo lspace="0em" rspace="0em">​</mo><mrow><mo>[</mo><mrow><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><mo>+</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>head</mi></msup></mrow></mrow><mo>]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\left[\frac{\mathrm{d}h}{\mathrm{d}\bm{Z}^{L+1}}\cdot\mathrm{d}\bm{Z}^{L+1}+\frac{\mathrm{d}h}{\mathrm{d}\theta^{\mathrm{head}}}\cdot\mathrm{d}\theta^{\mathrm{head}}\right]</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d sansserif_L end_ARG start_ARG roman_d over^ start_ARG bold_italic_y end_ARG end_ARG [ divide start_ARG roman_d italic_h end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT end_ARG ⋅ roman_d bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT + divide start_ARG roman_d italic_h end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT end_ARG ⋅ roman_d italic_θ start_POSTSUPERSCRIPT roman_head end_POSTSUPERSCRIPT ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.71)</span></td>
</tr></tbody>
<tbody id="S2.E72"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\cdot\frac{\mathrm{d}h}{\mathrm{d}\bm{Z}^{L+1}}\cdot\mathrm{d}\bm{Z}^{L+1}" class="ltx_Math" display="inline" id="S2.E72.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝖫</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo lspace="0.222em" rspace="0.222em">⋅</mo><mi mathvariant="normal">d</mi></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\frac{\mathrm{d}\mathsf{L}}{\mathrm{d}\hat{\bm{y}}}\cdot\frac{\mathrm{d}h}{\mathrm{d}\bm{Z}^{L+1}}\cdot\mathrm{d}\bm{Z}^{L+1}</annotation><annotation encoding="application/x-llamapun">= divide start_ARG roman_d sansserif_L end_ARG start_ARG roman_d over^ start_ARG bold_italic_y end_ARG end_ARG ⋅ divide start_ARG roman_d italic_h end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT end_ARG ⋅ roman_d bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.72)</span></td>
</tr></tbody>
<tbody id="S2.E73"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left\langle\left(\frac{\mathrm{d}h}{\mathrm{d}\bm{Z}^{L+1}}\right)^{*}\nabla_{\hat{\bm{y}}}\mathsf{L},\mathrm{d}\bm{Z}^{L+1}\right\rangle" class="ltx_Math" display="inline" id="S2.E73.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mo>⟨</mo><mrow><msup><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo>)</mo></mrow><mo>∗</mo></msup><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></msub><mi>𝖫</mi></mrow></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><mo>⟩</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\left\langle\left(\frac{\mathrm{d}h}{\mathrm{d}\bm{Z}^{L+1}}\right)^{*}\nabla_{\hat{\bm{y}}}\mathsf{L},\mathrm{d}\bm{Z}^{L+1}\right\rangle</annotation><annotation encoding="application/x-llamapun">= ⟨ ( divide start_ARG roman_d italic_h end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT end_ARG ) start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∇ start_POSTSUBSCRIPT over^ start_ARG bold_italic_y end_ARG end_POSTSUBSCRIPT sansserif_L , roman_d bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT ⟩</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.73)</span></td>
</tr></tbody>
<tbody id="S2.E74"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\langle\nabla_{\bm{Z}^{L+1}}\mathcal{L},\mathrm{d}\bm{Z}^{L+1}\rangle." class="ltx_Math" display="inline" id="S2.E74.m1"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><mo stretchy="false">⟨</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><mo stretchy="false">⟩</mo></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\langle\nabla_{\bm{Z}^{L+1}}\mathcal{L},\mathrm{d}\bm{Z}^{L+1}\rangle.</annotation><annotation encoding="application/x-llamapun">= ⟨ ∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L , roman_d bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT ⟩ .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.74)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Thus we have the recursion:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx119">
<tbody id="S2.E75"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\nabla_{\bm{Z}^{L+1}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E75.m1"><semantics><mrow><msub><mo>∇</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\displaystyle\nabla_{\bm{Z}^{L+1}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left(\frac{\mathrm{d}h}{\mathrm{d}\bm{Z}^{L+1}}\right)^{*}\nabla_{\hat{\bm{y}}}\mathsf{L}" class="ltx_Math" display="inline" id="S2.E75.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><msup><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow></mfrac></mstyle><mo>)</mo></mrow><mo>∗</mo></msup><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mover accent="true"><mi>𝒚</mi><mo>^</mo></mover></msub><mi>𝖫</mi></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\left(\frac{\mathrm{d}h}{\mathrm{d}\bm{Z}^{L+1}}\right)^{*}\nabla_{\hat{\bm{y}}}\mathsf{L}</annotation><annotation encoding="application/x-llamapun">= ( divide start_ARG roman_d italic_h end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT end_ARG ) start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∇ start_POSTSUBSCRIPT over^ start_ARG bold_italic_y end_ARG end_POSTSUBSCRIPT sansserif_L</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.75)</span></td>
</tr></tbody>
<tbody id="S2.E76"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\nabla_{\bm{Z}^{L}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E76.m1"><semantics><mrow><msub><mo>∇</mo><msup><mi>𝒁</mi><mi>L</mi></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\displaystyle\nabla_{\bm{Z}^{L}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left(\frac{\mathrm{d}f^{L}}{\mathrm{d}\bm{Z}^{L}}\right)^{*}\nabla_{\bm{Z}^{L+1}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E76.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><msup><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi>L</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mi>L</mi></msup></mrow></mfrac></mstyle><mo>)</mo></mrow><mo>∗</mo></msup><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\left(\frac{\mathrm{d}f^{L}}{\mathrm{d}\bm{Z}^{L}}\right)^{*}\nabla_{\bm{Z}^{L+1}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">= ( divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT end_ARG ) start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.76)</span></td>
</tr></tbody>
<tbody id="S2.E77"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\nabla_{\theta^{L}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E77.m1"><semantics><mrow><msub><mo>∇</mo><msup><mi>θ</mi><mi>L</mi></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\displaystyle\nabla_{\theta^{L}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left(\frac{\mathrm{d}f^{L}}{\mathrm{d}\theta^{L}}\right)^{*}\nabla_{\bm{Z}^{L+1}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E77.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><msup><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi>L</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>L</mi></msup></mrow></mfrac></mstyle><mo>)</mo></mrow><mo>∗</mo></msup><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>𝒁</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\left(\frac{\mathrm{d}f^{L}}{\mathrm{d}\theta^{L}}\right)^{*}\nabla_{\bm{Z}^{L+1}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">= ( divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT italic_L end_POSTSUPERSCRIPT end_ARG ) start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT italic_L + 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.77)</span></td>
</tr></tbody>
<tbody id="S2.E78"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\vdots" class="ltx_Math" display="inline" id="S2.E78.m1"><semantics><mi mathvariant="normal">⋮</mi><annotation encoding="application/x-tex">\displaystyle\vdots</annotation><annotation encoding="application/x-llamapun">⋮</annotation></semantics></math></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.78)</span></td>
</tr></tbody>
<tbody id="S2.E79"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\nabla_{\bm{Z}^{1}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E79.m1"><semantics><mrow><msub><mo>∇</mo><msup><mi>𝒁</mi><mn>1</mn></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\displaystyle\nabla_{\bm{Z}^{1}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left(\frac{\mathrm{d}f^{1}}{\mathrm{d}\bm{Z}^{1}}\right)^{*}\nabla_{\bm{Z}^{2}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E79.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><msup><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mn>1</mn></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mn>1</mn></msup></mrow></mfrac></mstyle><mo>)</mo></mrow><mo>∗</mo></msup><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>𝒁</mi><mn>2</mn></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\left(\frac{\mathrm{d}f^{1}}{\mathrm{d}\bm{Z}^{1}}\right)^{*}\nabla_{\bm{Z}^{2}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">= ( divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT end_ARG start_ARG roman_d bold_italic_Z start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT end_ARG ) start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.79)</span></td>
</tr></tbody>
<tbody id="S2.E80"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\nabla_{\theta^{1}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E80.m1"><semantics><mrow><msub><mo>∇</mo><msup><mi>θ</mi><mn>1</mn></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\displaystyle\nabla_{\theta^{1}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left(\frac{\mathrm{d}f^{1}}{\mathrm{d}\theta^{1}}\right)^{*}\nabla_{\bm{Z}^{2}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E80.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><msup><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mn>1</mn></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mn>1</mn></msup></mrow></mfrac></mstyle><mo>)</mo></mrow><mo>∗</mo></msup><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>𝒁</mi><mn>2</mn></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\left(\frac{\mathrm{d}f^{1}}{\mathrm{d}\theta^{1}}\right)^{*}\nabla_{\bm{Z}^{2}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">= ( divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT end_ARG ) start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.80)</span></td>
</tr></tbody>
<tbody id="S2.E81"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\nabla_{\theta^{\mathrm{emb}}}\mathcal{L}" class="ltx_Math" display="inline" id="S2.E81.m1"><semantics><mrow><msub><mo>∇</mo><msup><mi>θ</mi><mi>emb</mi></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><annotation encoding="application/x-tex">\displaystyle\nabla_{\theta^{\mathrm{emb}}}\mathcal{L}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT italic_θ start_POSTSUPERSCRIPT roman_emb end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\left(\frac{\mathrm{d}f^{\mathrm{emb}}}{\mathrm{d}\theta^{\mathrm{emb}}}\right)^{*}\nabla_{\bm{Z}^{1}}\mathcal{L}." class="ltx_Math" display="inline" id="S2.E81.m2"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><msup><mrow><mo>(</mo><mstyle displaystyle="true"><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi>emb</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>θ</mi><mi>emb</mi></msup></mrow></mfrac></mstyle><mo>)</mo></mrow><mo>∗</mo></msup><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><msup><mi>𝒁</mi><mn>1</mn></msup></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\left(\frac{\mathrm{d}f^{\mathrm{emb}}}{\mathrm{d}\theta^{\mathrm{emb}}}\right)^{*}\nabla_{\bm{Z}^{1}}\mathcal{L}.</annotation><annotation encoding="application/x-llamapun">= ( divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_emb end_POSTSUPERSCRIPT end_ARG start_ARG roman_d italic_θ start_POSTSUPERSCRIPT roman_emb end_POSTSUPERSCRIPT end_ARG ) start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT ∇ start_POSTSUBSCRIPT bold_italic_Z start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT end_POSTSUBSCRIPT caligraphic_L .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.81)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S2.SS3.p4">
<p class="ltx_p">This gives us a computationally efficient algorithm to find all gradients in the whole network.</p>
</div>
<div class="ltx_para" id="S2.SS3.p5">
<p class="ltx_p">We’ll finish this section by computing the adjoint derivative for a simple layer.</p>
</div>
<div class="ltx_theorem ltx_theorem_example" id="Thmexample8">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Example A.8</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexample8.p1">
<p class="ltx_p">Consider the “linear” (affine) layer <math alttext="f^{\ell}" class="ltx_Math" display="inline" id="Thmexample8.p1.m1"><semantics><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup><annotation encoding="application/x-tex">f^{\ell}</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT</annotation></semantics></math></p>
<table class="ltx_equation ltx_eqn_table" id="S2.E82">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f^{\ell}(\bm{Z},\bm{W}^{\ell},\bm{b}^{\ell})\doteq\bm{W}^{\ell}\bm{Z}+\bm{b}^{\ell}\bm{1}^{\top}=\begin{bmatrix}\bm{W}^{\ell}&amp;\bm{b}^{\ell}\end{bmatrix}." class="ltx_Math" display="block" id="S2.E82.m1"><semantics><mrow><mrow><mrow><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>𝒁</mi><mo>,</mo><msup><mi>𝑾</mi><mi mathvariant="normal">ℓ</mi></msup><mo>,</mo><msup><mi>𝒃</mi><mi mathvariant="normal">ℓ</mi></msup><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><mrow><msup><mi>𝑾</mi><mi mathvariant="normal">ℓ</mi></msup><mo lspace="0em" rspace="0em">​</mo><mi>𝒁</mi></mrow><mo>+</mo><mrow><msup><mi>𝒃</mi><mi mathvariant="normal">ℓ</mi></msup><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup></mrow></mrow><mo>=</mo><mrow><mo>[</mo><mtable columnspacing="5pt" displaystyle="true"><mtr><mtd><msup><mi>𝑾</mi><mi mathvariant="normal">ℓ</mi></msup></mtd><mtd><msup><mi>𝒃</mi><mi mathvariant="normal">ℓ</mi></msup></mtd></mtr></mtable><mo>]</mo></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">f^{\ell}(\bm{Z},\bm{W}^{\ell},\bm{b}^{\ell})\doteq\bm{W}^{\ell}\bm{Z}+\bm{b}^{\ell}\bm{1}^{\top}=\begin{bmatrix}\bm{W}^{\ell}&amp;\bm{b}^{\ell}\end{bmatrix}.</annotation><annotation encoding="application/x-llamapun">italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ( bold_italic_Z , bold_italic_W start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT , bold_italic_b start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) ≐ bold_italic_W start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT bold_italic_Z + bold_italic_b start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT = [ start_ARG start_ROW start_CELL bold_italic_W start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_CELL start_CELL bold_italic_b start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_CELL end_ROW end_ARG ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.82)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">We can compute the differential w.r.t. both parameters as</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx120">
<tbody id="S2.E83"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathrm{d}f^{\ell}" class="ltx_Math" display="inline" id="S2.E83.m1"><semantics><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><annotation encoding="application/x-tex">\displaystyle\mathrm{d}f^{\ell}</annotation><annotation encoding="application/x-llamapun">roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=[(\bm{W}^{\ell}+\mathrm{d}\bm{W}^{\ell})\bm{Z}+(\bm{b}^{\ell}+\mathrm{d}\bm{b}^{\ell})\bm{1}^{\top}]-[\bm{W}^{\ell}\bm{Z}+\bm{b}^{\ell}]" class="ltx_Math" display="inline" id="S2.E83.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mo stretchy="false">[</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><msup><mi>𝑾</mi><mi mathvariant="normal">ℓ</mi></msup><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝑾</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>𝒁</mi></mrow><mo>+</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><msup><mi>𝒃</mi><mi mathvariant="normal">ℓ</mi></msup><mo>+</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒃</mi><mi mathvariant="normal">ℓ</mi></msup></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup></mrow></mrow><mo stretchy="false">]</mo></mrow><mo>−</mo><mrow><mo stretchy="false">[</mo><mrow><mrow><msup><mi>𝑾</mi><mi mathvariant="normal">ℓ</mi></msup><mo lspace="0em" rspace="0em">​</mo><mi>𝒁</mi></mrow><mo>+</mo><msup><mi>𝒃</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=[(\bm{W}^{\ell}+\mathrm{d}\bm{W}^{\ell})\bm{Z}+(\bm{b}^{\ell}+\mathrm{d}\bm{b}^{\ell})\bm{1}^{\top}]-[\bm{W}^{\ell}\bm{Z}+\bm{b}^{\ell}]</annotation><annotation encoding="application/x-llamapun">= [ ( bold_italic_W start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT + roman_d bold_italic_W start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) bold_italic_Z + ( bold_italic_b start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT + roman_d bold_italic_b start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ] - [ bold_italic_W start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT bold_italic_Z + bold_italic_b start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.83)</span></td>
</tr></tbody>
<tbody id="S2.E84"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=(\mathrm{d}\bm{W}^{\ell})\bm{Z}+(\mathrm{d}\bm{b}^{\ell})\bm{1}^{\top}." class="ltx_Math" display="inline" id="S2.E84.m1"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝑾</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>𝒁</mi></mrow><mo>+</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒃</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle=(\mathrm{d}\bm{W}^{\ell})\bm{Z}+(\mathrm{d}\bm{b}^{\ell})\bm{1}^{\top}.</annotation><annotation encoding="application/x-llamapun">= ( roman_d bold_italic_W start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) bold_italic_Z + ( roman_d bold_italic_b start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.84)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Thus the derivative of this transformation is</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E85">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\frac{\mathrm{d}f^{\ell}}{\mathrm{d}(\bm{W}^{\ell},\bm{b}^{\ell})}[\mathrm{d}\bm{W}^{\ell},\mathrm{d}\bm{b}^{\ell}]=(\mathrm{d}\bm{W}^{\ell})\bm{Z}+(\mathrm{d}\bm{b}^{\ell})\bm{1}^{\top}," class="ltx_Math" display="block" id="S2.E85.m1"><semantics><mrow><mrow><mrow><mfrac><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>f</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>𝑾</mi><mi mathvariant="normal">ℓ</mi></msup><mo>,</mo><msup><mi>𝒃</mi><mi mathvariant="normal">ℓ</mi></msup><mo stretchy="false">)</mo></mrow></mrow></mfrac><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝑾</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo>,</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒃</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mrow><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝑾</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mi>𝒁</mi></mrow><mo>+</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒃</mi><mi mathvariant="normal">ℓ</mi></msup></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\frac{\mathrm{d}f^{\ell}}{\mathrm{d}(\bm{W}^{\ell},\bm{b}^{\ell})}[\mathrm{d}\bm{W}^{\ell},\mathrm{d}\bm{b}^{\ell}]=(\mathrm{d}\bm{W}^{\ell})\bm{Z}+(\mathrm{d}\bm{b}^{\ell})\bm{1}^{\top},</annotation><annotation encoding="application/x-llamapun">divide start_ARG roman_d italic_f start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT end_ARG start_ARG roman_d ( bold_italic_W start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT , bold_italic_b start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) end_ARG [ roman_d bold_italic_W start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT , roman_d bold_italic_b start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ] = ( roman_d bold_italic_W start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) bold_italic_Z + ( roman_d bold_italic_b start_POSTSUPERSCRIPT roman_ℓ end_POSTSUPERSCRIPT ) bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.85)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">namely, representing the following linear transformation from <math alttext="\mathbb{R}^{m\times d}\times\mathbb{R}^{m}" class="ltx_Math" display="inline" id="Thmexample8.p1.m2"><semantics><mrow><msup><mi>ℝ</mi><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>d</mi></mrow></msup><mo lspace="0.222em" rspace="0.222em">×</mo><msup><mi>ℝ</mi><mi>m</mi></msup></mrow><annotation encoding="application/x-tex">\mathbb{R}^{m\times d}\times\mathbb{R}^{m}</annotation><annotation encoding="application/x-llamapun">blackboard_R start_POSTSUPERSCRIPT italic_m × italic_d end_POSTSUPERSCRIPT × blackboard_R start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT</annotation></semantics></math> to <math alttext="\mathbb{R}^{m\times n}" class="ltx_Math" display="inline" id="Thmexample8.p1.m3"><semantics><msup><mi>ℝ</mi><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>n</mi></mrow></msup><annotation encoding="application/x-tex">\mathbb{R}^{m\times n}</annotation><annotation encoding="application/x-llamapun">blackboard_R start_POSTSUPERSCRIPT italic_m × italic_n end_POSTSUPERSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E86">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="T[\bm{A},\bm{u}]=\bm{A}\bm{Z}+\bm{u}\bm{1}^{\top}." class="ltx_Math" display="block" id="S2.E86.m1"><semantics><mrow><mrow><mrow><mi>T</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mi>𝑨</mi><mo>,</mo><mi>𝒖</mi><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mrow><mi>𝑨</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒁</mi></mrow><mo>+</mo><mrow><mi>𝒖</mi><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">T[\bm{A},\bm{u}]=\bm{A}\bm{Z}+\bm{u}\bm{1}^{\top}.</annotation><annotation encoding="application/x-llamapun">italic_T [ bold_italic_A , bold_italic_u ] = bold_italic_A bold_italic_Z + bold_italic_u bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.86)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">We calculate the adjoint <math alttext="T^{*}\colon\mathbb{R}^{m\times n}\to\mathbb{R}^{m\times d}\times\mathbb{R}^{m}" class="ltx_Math" display="inline" id="Thmexample8.p1.m4"><semantics><mrow><msup><mi>T</mi><mo>∗</mo></msup><mo lspace="0.278em" rspace="0.278em">:</mo><mrow><msup><mi>ℝ</mi><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>n</mi></mrow></msup><mo stretchy="false">→</mo><mrow><msup><mi>ℝ</mi><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>d</mi></mrow></msup><mo lspace="0.222em" rspace="0.222em">×</mo><msup><mi>ℝ</mi><mi>m</mi></msup></mrow></mrow></mrow><annotation encoding="application/x-tex">T^{*}\colon\mathbb{R}^{m\times n}\to\mathbb{R}^{m\times d}\times\mathbb{R}^{m}</annotation><annotation encoding="application/x-llamapun">italic_T start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT : blackboard_R start_POSTSUPERSCRIPT italic_m × italic_n end_POSTSUPERSCRIPT → blackboard_R start_POSTSUPERSCRIPT italic_m × italic_d end_POSTSUPERSCRIPT × blackboard_R start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT</annotation></semantics></math> w.r.t. the sum-over-coordinates (Frobenius) inner product by the following procedure:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx121">
<tbody id="S2.E87"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\langle T[\bm{A},\bm{u}],\bm{B}\rangle_{\mathbb{R}^{m\times n}}" class="ltx_Math" display="inline" id="S2.E87.m1"><semantics><msub><mrow><mo stretchy="false">⟨</mo><mrow><mi>T</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mi>𝑨</mi><mo>,</mo><mi>𝒖</mi><mo stretchy="false">]</mo></mrow></mrow><mo>,</mo><mi>𝑩</mi><mo stretchy="false">⟩</mo></mrow><msup><mi>ℝ</mi><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>n</mi></mrow></msup></msub><annotation encoding="application/x-tex">\displaystyle\langle T[\bm{A},\bm{u}],\bm{B}\rangle_{\mathbb{R}^{m\times n}}</annotation><annotation encoding="application/x-llamapun">⟨ italic_T [ bold_italic_A , bold_italic_u ] , bold_italic_B ⟩ start_POSTSUBSCRIPT blackboard_R start_POSTSUPERSCRIPT italic_m × italic_n end_POSTSUPERSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\operatorname{tr}((\bm{A}\bm{Z}+\bm{u}\bm{1}^{\top})\bm{B}^{\top})" class="ltx_Math" display="inline" id="S2.E87.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><mi>tr</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mo stretchy="false">(</mo><mrow><mrow><mi>𝑨</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒁</mi></mrow><mo>+</mo><mrow><mi>𝒖</mi><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝑩</mi><mo>⊤</mo></msup></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\operatorname{tr}((\bm{A}\bm{Z}+\bm{u}\bm{1}^{\top})\bm{B}^{\top})</annotation><annotation encoding="application/x-llamapun">= roman_tr ( ( bold_italic_A bold_italic_Z + bold_italic_u bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ) bold_italic_B start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.87)</span></td>
</tr></tbody>
<tbody id="S2.E88"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\operatorname{tr}(\bm{A}\bm{Z}\bm{B}^{\top}+\bm{u}\bm{1}^{\top}\bm{B}^{\top})" class="ltx_Math" display="inline" id="S2.E88.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mi>tr</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><mi>𝑨</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒁</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝑩</mi><mo>⊤</mo></msup></mrow><mo>+</mo><mrow><mi>𝒖</mi><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝑩</mi><mo>⊤</mo></msup></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\operatorname{tr}(\bm{A}\bm{Z}\bm{B}^{\top}+\bm{u}\bm{1}^{\top}\bm{B}^{\top})</annotation><annotation encoding="application/x-llamapun">= roman_tr ( bold_italic_A bold_italic_Z bold_italic_B start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT + bold_italic_u bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT bold_italic_B start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.88)</span></td>
</tr></tbody>
<tbody id="S2.E89"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\operatorname{tr}(\bm{A}\bm{Z}\bm{B}^{\top})+\operatorname{tr}(\bm{u}\bm{1}^{\top}\bm{B}^{\top})" class="ltx_Math" display="inline" id="S2.E89.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mi>tr</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mrow><mi>𝑨</mi><mo lspace="0em" rspace="0em">​</mo><mi>𝒁</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝑩</mi><mo>⊤</mo></msup></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>tr</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mrow><mi>𝒖</mi><mo lspace="0em" rspace="0em">​</mo><msup><mn>𝟏</mn><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝑩</mi><mo>⊤</mo></msup></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\operatorname{tr}(\bm{A}\bm{Z}\bm{B}^{\top})+\operatorname{tr}(\bm{u}\bm{1}^{\top}\bm{B}^{\top})</annotation><annotation encoding="application/x-llamapun">= roman_tr ( bold_italic_A bold_italic_Z bold_italic_B start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ) + roman_tr ( bold_italic_u bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT bold_italic_B start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.89)</span></td>
</tr></tbody>
<tbody id="S2.E90"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\operatorname{tr}(\bm{B}\bm{Z}^{\top}\bm{A}^{\top})+\operatorname{tr}(\bm{1}^{\top}\bm{B}^{\top}\bm{u})" class="ltx_Math" display="inline" id="S2.E90.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><mrow><mi>tr</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mrow><mi>𝑩</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝑨</mi><mo>⊤</mo></msup></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>+</mo><mrow><mi>tr</mi><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mrow><msup><mn>𝟏</mn><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝑩</mi><mo>⊤</mo></msup><mo lspace="0em" rspace="0em">​</mo><mi>𝒖</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\operatorname{tr}(\bm{B}\bm{Z}^{\top}\bm{A}^{\top})+\operatorname{tr}(\bm{1}^{\top}\bm{B}^{\top}\bm{u})</annotation><annotation encoding="application/x-llamapun">= roman_tr ( bold_italic_B bold_italic_Z start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT bold_italic_A start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT ) + roman_tr ( bold_1 start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT bold_italic_B start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT bold_italic_u )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.90)</span></td>
</tr></tbody>
<tbody id="S2.E91"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\langle\bm{B}\bm{Z}^{\top},\bm{A}\rangle_{\mathbb{R}^{m\times d}}+\langle\bm{B}\bm{1},\bm{u}\rangle_{\mathbb{R}^{m}}" class="ltx_Math" display="inline" id="S2.E91.m1"><semantics><mrow><mi></mi><mo>=</mo><mrow><msub><mrow><mo stretchy="false">⟨</mo><mrow><mi>𝑩</mi><mo lspace="0em" rspace="0em">​</mo><msup><mi>𝒁</mi><mo>⊤</mo></msup></mrow><mo>,</mo><mi>𝑨</mi><mo stretchy="false">⟩</mo></mrow><msup><mi>ℝ</mi><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>d</mi></mrow></msup></msub><mo>+</mo><msub><mrow><mo stretchy="false">⟨</mo><mrow><mi>𝑩</mi><mo lspace="0em" rspace="0em">​</mo><mn>𝟏</mn></mrow><mo>,</mo><mi>𝒖</mi><mo stretchy="false">⟩</mo></mrow><msup><mi>ℝ</mi><mi>m</mi></msup></msub></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\langle\bm{B}\bm{Z}^{\top},\bm{A}\rangle_{\mathbb{R}^{m\times d}}+\langle\bm{B}\bm{1},\bm{u}\rangle_{\mathbb{R}^{m}}</annotation><annotation encoding="application/x-llamapun">= ⟨ bold_italic_B bold_italic_Z start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT , bold_italic_A ⟩ start_POSTSUBSCRIPT blackboard_R start_POSTSUPERSCRIPT italic_m × italic_d end_POSTSUPERSCRIPT end_POSTSUBSCRIPT + ⟨ bold_italic_B bold_1 , bold_italic_u ⟩ start_POSTSUBSCRIPT blackboard_R start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.91)</span></td>
</tr></tbody>
<tbody id="S2.E92"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\langle\bm{B}(\bm{Z}^{\top},\bm{1}),(\bm{A},\bm{u})\rangle_{\mathbb{R}^{m\times d}\times\mathbb{R}^{m}}" class="ltx_Math" display="inline" id="S2.E92.m1"><semantics><mrow><mi></mi><mo>=</mo><msub><mrow><mo stretchy="false">⟨</mo><mrow><mi>𝑩</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>𝒁</mi><mo>⊤</mo></msup><mo>,</mo><mn>𝟏</mn><mo stretchy="false">)</mo></mrow></mrow><mo>,</mo><mrow><mo stretchy="false">(</mo><mi>𝑨</mi><mo>,</mo><mi>𝒖</mi><mo stretchy="false">)</mo></mrow><mo stretchy="false">⟩</mo></mrow><mrow><msup><mi>ℝ</mi><mrow><mi>m</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>d</mi></mrow></msup><mo lspace="0.222em" rspace="0.222em">×</mo><msup><mi>ℝ</mi><mi>m</mi></msup></mrow></msub></mrow><annotation encoding="application/x-tex">\displaystyle=\langle\bm{B}(\bm{Z}^{\top},\bm{1}),(\bm{A},\bm{u})\rangle_{\mathbb{R}^{m\times d}\times\mathbb{R}^{m}}</annotation><annotation encoding="application/x-llamapun">= ⟨ bold_italic_B ( bold_italic_Z start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT , bold_1 ) , ( bold_italic_A , bold_italic_u ) ⟩ start_POSTSUBSCRIPT blackboard_R start_POSTSUPERSCRIPT italic_m × italic_d end_POSTSUPERSCRIPT × blackboard_R start_POSTSUPERSCRIPT italic_m end_POSTSUPERSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.2.92)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">So <math alttext="T^{*}\bm{B}=\bm{B}(\bm{Z}^{\top},\bm{1})" class="ltx_Math" display="inline" id="Thmexample8.p1.m5"><semantics><mrow><mrow><msup><mi>T</mi><mo>∗</mo></msup><mo lspace="0em" rspace="0em">​</mo><mi>𝑩</mi></mrow><mo>=</mo><mrow><mi>𝑩</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>𝒁</mi><mo>⊤</mo></msup><mo>,</mo><mn>𝟏</mn><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">T^{*}\bm{B}=\bm{B}(\bm{Z}^{\top},\bm{1})</annotation><annotation encoding="application/x-llamapun">italic_T start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT bold_italic_B = bold_italic_B ( bold_italic_Z start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT , bold_1 )</annotation></semantics></math>.
 <math alttext="\blacksquare" class="ltx_Math" display="inline" id="Thmexample8.p1.m6"><semantics><mi mathvariant="normal">■</mi><annotation encoding="application/x-tex">\blacksquare</annotation><annotation encoding="application/x-llamapun">■</annotation></semantics></math></p>
</div>
</div>
<div class="ltx_para" id="S2.SS3.p6">
<p class="ltx_p">Note that as a simple application of chain rule, both backpropagation and automatic differentiation work over general “computational graphs”, i.e., compositions of (simple) functions. We give all examples as neural network layers because this is the most common example in practice.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">A.3 </span>Game Theory and Minimax Optimization</h2>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p">In certain cases, such as in <a class="ltx_ref" href="Ch5.html" title="Chapter 5 Consistent and Self-Consistent Representations ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Chapter</span> <span class="ltx_text ltx_ref_tag">5</span></a>, a learning problem cannot be reduced to a single optimization problem but rather represents multiple potentially opposing components of the system try to each minimize their own objective. Examples of this paradigm include distribution learning via generative adversarial networks (GAN) and closed-loop transcription (CTRL). We will denote such a system as a <span class="ltx_text ltx_font_italic">two-player game</span>, where we have two “players” (i.e., components) called Player 1 and Player 2 trying to minimize their objectives <math alttext="\mathcal{L}^{1}" class="ltx_Math" display="inline" id="S3.p1.m1"><semantics><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mn>1</mn></msup><annotation encoding="application/x-tex">\mathcal{L}^{1}</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="\mathcal{L}^{2}" class="ltx_Math" display="inline" id="S3.p1.m2"><semantics><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\mathcal{L}^{2}</annotation><annotation encoding="application/x-llamapun">caligraphic_L start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math> respectively. Player 1 picks parameters <math alttext="\theta\in\Theta" class="ltx_Math" display="inline" id="S3.p1.m3"><semantics><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow><annotation encoding="application/x-tex">\theta\in\Theta</annotation><annotation encoding="application/x-llamapun">italic_θ ∈ roman_Θ</annotation></semantics></math> and Player 2 picks parameters <math alttext="\eta\in\mathrm{H}" class="ltx_Math" display="inline" id="S3.p1.m4"><semantics><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow><annotation encoding="application/x-tex">\eta\in\mathrm{H}</annotation><annotation encoding="application/x-llamapun">italic_η ∈ roman_H</annotation></semantics></math>. In this book we consider the special case of <span class="ltx_text ltx_font_italic">zero-sum games</span>, i.e., defining a common objective <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S3.p1.m5"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> such that <math alttext="\mathcal{L}=-\mathcal{L}^{1}=\mathcal{L}^{2}" class="ltx_Math" display="inline" id="S3.p1.m6"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo>=</mo><mrow><mo>−</mo><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mn>1</mn></msup></mrow><mo>=</mo><msup><mi class="ltx_font_mathcaligraphic">ℒ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\mathcal{L}=-\mathcal{L}^{1}=\mathcal{L}^{2}</annotation><annotation encoding="application/x-llamapun">caligraphic_L = - caligraphic_L start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT = caligraphic_L start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S3.p2">
<p class="ltx_p">Our first, very preliminary example is as follows. Suppose that there exists functions <math alttext="u(\theta)" class="ltx_Math" display="inline" id="S3.p2.m1"><semantics><mrow><mi>u</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">u(\theta)</annotation><annotation encoding="application/x-llamapun">italic_u ( italic_θ )</annotation></semantics></math> and <math alttext="v(\eta)" class="ltx_Math" display="inline" id="S3.p2.m2"><semantics><mrow><mi>v</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">v(\eta)</annotation><annotation encoding="application/x-llamapun">italic_v ( italic_η )</annotation></semantics></math> such that</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta,\eta)=-u(\theta)+v(\eta)." class="ltx_Math" display="block" id="S3.E1.m1"><semantics><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><mo>−</mo><mrow><mi>u</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>+</mo><mrow><mi>v</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta,\eta)=-u(\theta)+v(\eta).</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ , italic_η ) = - italic_u ( italic_θ ) + italic_v ( italic_η ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.1)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Then both players’ objectives are independent of the other player, and the players should try to achieve their respective optima:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta^{\star}\in\operatorname*{arg\ min}_{\theta\in\Theta}u(\theta),\qquad\eta^{\star}\in\operatorname*{arg\ min}_{\eta\in\mathrm{H}}v(\eta)." class="ltx_Math" display="block" id="S3.E2.m1"><semantics><mrow><mrow><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>∈</mo><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo>⁡</mo><mi>u</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo rspace="2.167em">,</mo><mrow><msup><mi>η</mi><mo>⋆</mo></msup><mo>∈</mo><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo>⁡</mo><mi>v</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\theta^{\star}\in\operatorname*{arg\ min}_{\theta\in\Theta}u(\theta),\qquad\eta^{\star}\in\operatorname*{arg\ min}_{\eta\in\mathrm{H}}v(\eta).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT italic_u ( italic_θ ) , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT italic_v ( italic_η ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">The pair <math alttext="(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.p2.m3"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> is a straightforward special case of an <span class="ltx_text ltx_font_italic">equilibrium</span>: a situation where neither player will want to move, given the chance, since moving will end up making their own situation worse. However, not all games are so trivial; many have more complicated objectives and information structures.</p>
</div>
<div class="ltx_para" id="S3.p3">
<p class="ltx_p">In this book, the relevant game-theoretic formalism is a Stackelberg game (variously called sequential game). In this formalism, one player (without loss of generality Player 1, and also described as a <span class="ltx_text ltx_font_italic">leader</span>) picks their parameters before the other (i.e., Player 2, also described as a <span class="ltx_text ltx_font_italic">follower</span>), and the follower can use the full knowledge of the leader’s choice to make their own choice. The correct notion of equilibrium for a Stackelberg game is a <span class="ltx_text ltx_font_italic">Stackelberg equilibrium</span>. To explain this equilibrium, note that since Player 2 (i.e., the follower) can choose <math alttext="\eta" class="ltx_Math" display="inline" id="S3.p3.m1"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> reactively to the choice <math alttext="\theta_{1}" class="ltx_Math" display="inline" id="S3.p3.m2"><semantics><msub><mi>θ</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\theta_{1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> made by Player 1 (i.e., the leader), Player 2 would of course choose the <math alttext="\eta" class="ltx_Math" display="inline" id="S3.p3.m3"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> which minimizes <math alttext="\mathcal{L}(\theta_{1},\cdot)" class="ltx_Math" display="inline" id="S3.p3.m4"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>1</mn></msub><mo rspace="0em">,</mo><mo lspace="0em" rspace="0em">⋅</mo><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta_{1},\cdot)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , ⋅ )</annotation></semantics></math>. But of course a rational Player 1 would realize this, and so pick a <math alttext="\theta_{1}" class="ltx_Math" display="inline" id="S3.p3.m5"><semantics><msub><mi>θ</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\theta_{1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math> such that the worst-case <math alttext="\eta" class="ltx_Math" display="inline" id="S3.p3.m6"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> picked by Player 2 according to this rule is not too bad. More formally, let <math alttext="\mathcal{S}(\theta)\doteq\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)" class="ltx_Math" display="inline" id="S3.p3.m7"><semantics><mrow><mrow><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≐</mo><mrow><mrow><msub><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></msub><mo>⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\mathcal{S}(\theta)\doteq\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)</annotation><annotation encoding="application/x-llamapun">caligraphic_S ( italic_θ ) ≐ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η )</annotation></semantics></math> be the set of <math alttext="\eta" class="ltx_Math" display="inline" id="S3.p3.m8"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> minimizing <math alttext="\mathcal{L}(\theta,\eta)" class="ltx_Math" display="inline" id="S3.p3.m9"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta,\eta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ , italic_η )</annotation></semantics></math>, i.e., the set of all <math alttext="\eta" class="ltx_Math" display="inline" id="S3.p3.m10"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> which Player 2 is liable to play given that Player 1 has played <math alttext="\theta" class="ltx_Math" display="inline" id="S3.p3.m11"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>. Then <math alttext="(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.p3.m12"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> is a Stackelberg equilibrium if</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta^{\star}\in\operatorname*{arg\ max}_{\theta\in\Theta}\min_{\eta\in\mathcal{S}(\theta)}\mathcal{L}(\theta,\eta),\qquad\eta^{\star}\in\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta^{\star},\eta)." class="ltx_Math" display="block" id="S3.E3.m1"><semantics><mrow><mrow><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>∈</mo><mrow><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>max</mi></mrow><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mrow><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></munder></mrow><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo rspace="2.167em">,</mo><mrow><msup><mi>η</mi><mo>⋆</mo></msup><mo>∈</mo><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo>⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\theta^{\star}\in\operatorname*{arg\ max}_{\theta\in\Theta}\min_{\eta\in\mathcal{S}(\theta)}\mathcal{L}(\theta,\eta),\qquad\eta^{\star}\in\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta^{\star},\eta).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∈ start_OPERATOR roman_arg roman_max end_OPERATOR start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT roman_min start_POSTSUBSCRIPT italic_η ∈ caligraphic_S ( italic_θ ) end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Actually (proof as exercise), one can show that in the context of two-player zero-sum Stackelberg games, <math alttext="(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.p3.m13"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> is a Stackelberg equilibrium if and only if</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta^{\star}\in\operatorname*{arg\ max}_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta),\qquad\eta^{\star}\in\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta^{\star},\eta)," class="ltx_Math" display="block" id="S3.E4.m1"><semantics><mrow><mrow><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>∈</mo><mrow><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>max</mi></mrow><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder></mrow><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo rspace="2.167em">,</mo><mrow><msup><mi>η</mi><mo>⋆</mo></msup><mo>∈</mo><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo>⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\theta^{\star}\in\operatorname*{arg\ max}_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta),\qquad\eta^{\star}\in\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta^{\star},\eta),</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∈ start_OPERATOR roman_arg roman_max end_OPERATOR start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">(note that the notation <math alttext="\mathcal{S}(\theta)" class="ltx_Math" display="inline" id="S3.p3.m14"><semantics><mrow><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{S}(\theta)</annotation><annotation encoding="application/x-llamapun">caligraphic_S ( italic_θ )</annotation></semantics></math> is not used nor needed).</p>
</div>
<div class="ltx_proof">
<h6 class="ltx_title ltx_runin ltx_font_italic ltx_title_proof">Proof.</h6>
<div class="ltx_para" id="S3.p4">
<p class="ltx_p">Note that</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{S}(\theta)=\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)," class="ltx_Math" display="block" id="S3.E5.m1"><semantics><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo>⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\mathcal{S}(\theta)=\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta),</annotation><annotation encoding="application/x-llamapun">caligraphic_S ( italic_θ ) = start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">so it holds</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\min_{\eta\in\mathcal{S}(\theta)}\mathcal{L}(\theta,\eta)=\min_{\eta\in\operatorname*{arg\ min}_{\eta^{\prime}\in\mathrm{H}}\mathcal{L}(\theta,\eta^{\prime})}\mathcal{L}(\theta,\eta)=\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)." class="ltx_Math" display="block" id="S3.E6.m1"><semantics><mrow><mrow><mrow><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mrow><mi class="ltx_font_mathcaligraphic">𝒮</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mrow><mrow><msub><mrow><mi>arg</mi><mo lspace="0.350em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><msup><mi>η</mi><mo>′</mo></msup><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></msub><mo>⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><msup><mi>η</mi><mo>′</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\min_{\eta\in\mathcal{S}(\theta)}\mathcal{L}(\theta,\eta)=\min_{\eta\in\operatorname*{arg\ min}_{\eta^{\prime}\in\mathrm{H}}\mathcal{L}(\theta,\eta^{\prime})}\mathcal{L}(\theta,\eta)=\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta).</annotation><annotation encoding="application/x-llamapun">roman_min start_POSTSUBSCRIPT italic_η ∈ caligraphic_S ( italic_θ ) end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) = roman_min start_POSTSUBSCRIPT italic_η ∈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_η start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ) end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) = roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.6)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">∎</p>
</div>
</div>
<div class="ltx_para" id="S3.p5">
<p class="ltx_p">In the rest of the section, we will briefly discuss some algorithmic approaches to learn Stackelberg equilibria. The intuition you should have is that learning an equilibrium is like letting the different parts of the system automatically figure out tradeoffs between the different objectives they want to optimize.</p>
</div>
<div class="ltx_para" id="S3.p6">
<p class="ltx_p">We end this section with a caveat: in two-player zero-sum games, if it holds that</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)=\min_{\eta\in\mathrm{H}}\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta)" class="ltx_Math" display="block" id="S3.E7.m1"><semantics><mrow><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)=\min_{\eta\in\mathrm{H}}\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta)</annotation><annotation encoding="application/x-llamapun">roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) = roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.7)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">then every Stackelberg equilibrium is a saddle point,<span class="ltx_note ltx_role_footnote" id="footnote7"><sup class="ltx_note_mark">7</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">7</sup><span class="ltx_tag ltx_tag_note">7</span>Famously called a <span class="ltx_text ltx_font_italic">Nash equilibrium</span>.</span></span></span> i.e.,</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta^{\star}\in\operatorname*{arg\ max}_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star}),\qquad\eta^{\star}\in\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta^{\star},\eta)," class="ltx_Math" display="block" id="S3.E8.m1"><semantics><mrow><mrow><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>∈</mo><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>max</mi></mrow><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo>⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo rspace="2.167em">,</mo><mrow><msup><mi>η</mi><mo>⋆</mo></msup><mo>∈</mo><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo>⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\theta^{\star}\in\operatorname*{arg\ max}_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star}),\qquad\eta^{\star}\in\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta^{\star},\eta),</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∈ start_OPERATOR roman_arg roman_max end_OPERATOR start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.8)</span></td>
</tr></tbody>
</table>
<p class="ltx_p"><span class="ltx_text ltx_font_italic">and vice versa</span>, and furthermore each Stackelberg equilibrium has the (same) objective value</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)." class="ltx_Math" display="block" id="S3.Ex1.m1"><semantics><mrow><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta).</annotation><annotation encoding="application/x-llamapun">roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_proof">
<h6 class="ltx_title ltx_runin ltx_font_italic ltx_title_proof">Proof.</h6>
<div class="ltx_para" id="S3.p7">
<p class="ltx_p">Suppose that indeed</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E9">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)=\min_{\eta\in\mathrm{H}}\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta)." class="ltx_Math" display="block" id="S3.E9.m1"><semantics><mrow><mrow><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)=\min_{\eta\in\mathrm{H}}\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta).</annotation><annotation encoding="application/x-llamapun">roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) = roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.9)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S3.p8">
<p class="ltx_p">First suppose that <math alttext="(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.p8.m1"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> is a saddle point. We will show it is a Stackelberg equilibrium. By definition we have</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E10">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta^{\star},\eta)=\mathcal{L}(\theta^{\star},\eta^{\star})=\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star})." class="ltx_Math" display="block" id="S3.E10.m1"><semantics><mrow><mrow><mrow><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta^{\star},\eta)=\mathcal{L}(\theta^{\star},\eta^{\star})=\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star}).</annotation><annotation encoding="application/x-llamapun">roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η ) = caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) = roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.10)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">It then holds for any <math alttext="\theta" class="ltx_Math" display="inline" id="S3.p8.m2"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> and <math alttext="\eta" class="ltx_Math" display="inline" id="S3.p8.m3"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> that</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E11">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)\leq\mathcal{L}(\theta,\eta^{\star})\leq\mathcal{L}(\theta^{\star},\eta^{\star})." class="ltx_Math" display="block" id="S3.E11.m1"><semantics><mrow><mrow><mrow><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)\leq\mathcal{L}(\theta,\eta^{\star})\leq\mathcal{L}(\theta^{\star},\eta^{\star}).</annotation><annotation encoding="application/x-llamapun">roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) ≤ caligraphic_L ( italic_θ , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ≤ caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.11)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Therefore</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E12">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta)\leq\mathcal{L}(\theta^{\star},\eta^{\star})." class="ltx_Math" display="block" id="S3.E12.m1"><semantics><mrow><mrow><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta)\leq\mathcal{L}(\theta^{\star},\eta^{\star}).</annotation><annotation encoding="application/x-llamapun">roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) ≤ caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.12)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Completely symmetrically,</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E13">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta^{\star},\eta^{\star})\leq\mathcal{L}(\theta^{\star},\eta)\leq\max_{\theta\in\Theta}\mathcal{L}(\theta^{\star},\eta)\implies\mathcal{L}(\theta^{\star},\eta^{\star})\leq\min_{\eta\in\mathrm{H}}\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta)." class="ltx_Math" display="block" id="S3.E13.m1"><semantics><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">⟹</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta^{\star},\eta^{\star})\leq\mathcal{L}(\theta^{\star},\eta)\leq\max_{\theta\in\Theta}\mathcal{L}(\theta^{\star},\eta)\implies\mathcal{L}(\theta^{\star},\eta^{\star})\leq\min_{\eta\in\mathrm{H}}\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta).</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ≤ caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η ) ≤ roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η ) ⟹ caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ≤ roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.13)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Therefore since <math alttext="\max\min=\min\max" class="ltx_Math" display="inline" id="S3.p8.m4"><semantics><mrow><mrow><mi>max</mi><mo lspace="0.167em">⁡</mo><mi>min</mi></mrow><mo>=</mo><mrow><mi>min</mi><mo lspace="0.167em">⁡</mo><mi>max</mi></mrow></mrow><annotation encoding="application/x-tex">\max\min=\min\max</annotation><annotation encoding="application/x-llamapun">roman_max roman_min = roman_min roman_max</annotation></semantics></math> we have</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E14">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)=\mathcal{L}(\theta^{\star},\eta^{\star})=\min_{\eta\in\mathrm{H}}\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta)." class="ltx_Math" display="block" id="S3.E14.m1"><semantics><mrow><mrow><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)=\mathcal{L}(\theta^{\star},\eta^{\star})=\min_{\eta\in\mathrm{H}}\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta).</annotation><annotation encoding="application/x-llamapun">roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) = caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) = roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.14)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">In particular, it holds that</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E15">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta^{\star}\in\operatorname*{arg\ max}_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)." class="ltx_Math" display="block" id="S3.E15.m1"><semantics><mrow><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>∈</mo><mrow><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>max</mi></mrow><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder></mrow><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\theta^{\star}\in\operatorname*{arg\ max}_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∈ start_OPERATOR roman_arg roman_max end_OPERATOR start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.15)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">From the saddle point condition we have <math alttext="\eta^{\star}\in\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta^{\star},\eta)" class="ltx_Math" display="inline" id="S3.p8.m5"><semantics><mrow><msup><mi>η</mi><mo>⋆</mo></msup><mo>∈</mo><mrow><mrow><msub><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></msub><mo>⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\eta^{\star}\in\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta^{\star},\eta)</annotation><annotation encoding="application/x-llamapun">italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η )</annotation></semantics></math>. So <math alttext="(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.p8.m6"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> is a Stackelberg equilibrium. Furthermore we have also proved that all saddle points obey (<a class="ltx_ref" href="#S3.E14" title="Equation A.3.14 ‣ A.3 Game Theory and Minimax Optimization ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">A.3.14</span></a>).</p>
</div>
<div class="ltx_para" id="S3.p9">
<p class="ltx_p">Now let <math alttext="(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.p9.m1"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> be a Stackelberg equilibrium. We claim that it is a saddle point, which completes the proof. By the definition of minimax equilibrium,</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E16">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)=\mathcal{L}(\theta^{\star},\eta^{\star})." class="ltx_Math" display="block" id="S3.E16.m1"><semantics><mrow><mrow><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)=\mathcal{L}(\theta^{\star},\eta^{\star}).</annotation><annotation encoding="application/x-llamapun">roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) = caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.16)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Then by the <math alttext="\min\max=\max\min" class="ltx_Math" display="inline" id="S3.p9.m2"><semantics><mrow><mrow><mi>min</mi><mo lspace="0.167em">⁡</mo><mi>max</mi></mrow><mo>=</mo><mrow><mi>max</mi><mo lspace="0.167em">⁡</mo><mi>min</mi></mrow></mrow><annotation encoding="application/x-tex">\min\max=\max\min</annotation><annotation encoding="application/x-llamapun">roman_min roman_max = roman_max roman_min</annotation></semantics></math> assumption we have</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E17">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)=\mathcal{L}(\theta^{\star},\eta^{\star})=\min_{\eta\in\mathrm{H}}\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta)." class="ltx_Math" display="block" id="S3.E17.m1"><semantics><mrow><mrow><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)=\mathcal{L}(\theta^{\star},\eta^{\star})=\min_{\eta\in\mathrm{H}}\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta).</annotation><annotation encoding="application/x-llamapun">roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) = caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) = roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.17)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">This proves that all minimax equilibria have the desired objective value <math alttext="\mathcal{L}(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.p9.m3"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math>. Now we want to show that</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E18">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta^{\star}\in\operatorname*{arg\ max}_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star}),\qquad\eta^{\star}\in\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta^{\star},\eta)." class="ltx_Math" display="block" id="S3.E18.m1"><semantics><mrow><mrow><mrow><msup><mi>θ</mi><mo>⋆</mo></msup><mo>∈</mo><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>max</mi></mrow><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo>⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo rspace="2.167em">,</mo><mrow><msup><mi>η</mi><mo>⋆</mo></msup><mo>∈</mo><mrow><mrow><munder><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo>⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\theta^{\star}\in\operatorname*{arg\ max}_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star}),\qquad\eta^{\star}\in\operatorname*{arg\ min}_{\eta\in\mathrm{H}}\mathcal{L}(\theta^{\star},\eta).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∈ start_OPERATOR roman_arg roman_max end_OPERATOR start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ∈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.18)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Indeed the latter assertion holds by definition of the minimax equilibrium, so only the former need be proved. Namely, we will show that</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E19">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star})=\mathcal{L}(\theta^{\star},\eta^{\star})." class="ltx_Math" display="block" id="S3.E19.m1"><semantics><mrow><mrow><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star})=\mathcal{L}(\theta^{\star},\eta^{\star}).</annotation><annotation encoding="application/x-llamapun">roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) = caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.19)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">To show this note that by definition of the <math alttext="\max" class="ltx_Math" display="inline" id="S3.p9.m4"><semantics><mi>max</mi><annotation encoding="application/x-tex">\max</annotation><annotation encoding="application/x-llamapun">roman_max</annotation></semantics></math></p>
<table class="ltx_equation ltx_eqn_table" id="S3.E20">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta^{\star},\eta^{\star})\leq\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star})," class="ltx_Math" display="block" id="S3.E20.m1"><semantics><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta^{\star},\eta^{\star})\leq\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star}),</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ≤ roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.20)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">meanwhile we have <math alttext="\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)\leq\mathcal{L}(\theta,\eta^{\star})" class="ltx_Math" display="inline" id="S3.p9.m5"><semantics><mrow><mrow><mrow><msub><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></msub><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)\leq\mathcal{L}(\theta,\eta^{\star})</annotation><annotation encoding="application/x-llamapun">roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) ≤ caligraphic_L ( italic_θ , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> so</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E21">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta^{\star},\eta^{\star})=\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)\leq\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star})." class="ltx_Math" display="block" id="S3.E21.m1"><semantics><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>≤</mo><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta^{\star},\eta^{\star})=\max_{\theta\in\Theta}\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)\leq\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star}).</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) = roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) ≤ roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.21)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Therefore it holds</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E22">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}(\theta^{\star},\eta^{\star})=\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star})," class="ltx_Math" display="block" id="S3.E22.m1"><semantics><mrow><mrow><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mrow><munder><mi>max</mi><mrow><mi>θ</mi><mo>∈</mo><mi mathvariant="normal">Θ</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta^{\star},\eta^{\star})=\max_{\theta\in\Theta}\mathcal{L}(\theta,\eta^{\star}),</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) = roman_max start_POSTSUBSCRIPT italic_θ ∈ roman_Θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.22)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">and the proof is complete.
∎</p>
</div>
</div>
<div class="ltx_para" id="S3.p10">
<p class="ltx_p">Conditions under which the <math alttext="\min\max=\max\min" class="ltx_Math" display="inline" id="S3.p10.m1"><semantics><mrow><mrow><mi>min</mi><mo lspace="0.167em">⁡</mo><mi>max</mi></mrow><mo>=</mo><mrow><mi>max</mi><mo lspace="0.167em">⁡</mo><mi>min</mi></mrow></mrow><annotation encoding="application/x-tex">\min\max=\max\min</annotation><annotation encoding="application/x-llamapun">roman_min roman_max = roman_max roman_min</annotation></semantics></math> equality holds are given by so-called <span class="ltx_text ltx_font_italic">minimax theorems</span>; the most famous of these is a theorem of von Neumann. However, in the cases we think about, this property usually does not hold.</p>
</div>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.3.1 </span>Learning Stackelberg Equilibria</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p">How can we learn Stackelberg equilibria via GDA? In general this is clearly impossible, since learning Stackelberg equilibria via GDA is obviously at least as hard as computing a global minimizer of a loss function (say by setting the shared objective <math alttext="\mathcal{L}(\theta,\eta)" class="ltx_Math" display="inline" id="S3.SS1.p1.m1"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta,\eta)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ , italic_η )</annotation></semantics></math> to only be a function of <math alttext="\eta" class="ltx_Math" display="inline" id="S3.SS1.p1.m2"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math>). As such, we can achieve two types of convergence guarantees:</p>
<ul class="ltx_itemize" id="S3.I1">
<li class="ltx_item" id="S3.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I1.i1.p1">
<p class="ltx_p">When <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S3.I1.i1.p1.m1"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> is (strongly) concave in the first argument <math alttext="\theta" class="ltx_Math" display="inline" id="S3.I1.i1.p1.m2"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> and (strongly) convex in the second argument <math alttext="\eta" class="ltx_Math" display="inline" id="S3.I1.i1.p1.m3"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> (as well as having Lipschitz gradients in both arguments), we can achieve exponentially fast convergence to a Stackelberg equilibrium.</p>
</div>
</li>
<li class="ltx_item" id="S3.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I1.i2.p1">
<p class="ltx_p">When <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S3.I1.i2.p1.m1"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> is not concave or convex in either argument, we can achieve <span class="ltx_text ltx_font_italic">local convergence guarantees</span>: namely, if we initialize the parameter values near a (local) Stackelberg equilibrium and the optimization geometry is good then we can learn that equilibrium efficiently.</p>
</div>
</li>
</ul>
</div>
<div class="ltx_para" id="S3.SS1.p2">
<p class="ltx_p">The former situation is exactly analogous to the case of single-player optimization, where we proved that gradient descent converges exponentially fast for strongly convex objectives which have Lipschitz gradient. The latter situation is also analogous to the case of single-player optimization, although we did not cover it in depth due to technical difficulty; indeed there exist local convergence guarantees for nonconvex objectives which have locally nice geometry.</p>
</div>
<div class="ltx_para" id="S3.SS1.p3">
<p class="ltx_p">The algorithm in these two cases is the same algorithm, called Gradient Descent-Ascent (GDA). To motivate GDA, suppose we are trying to learn <math alttext="\theta^{\star}" class="ltx_Math" display="inline" id="S3.SS1.p3.m1"><semantics><msup><mi>θ</mi><mo>⋆</mo></msup><annotation encoding="application/x-tex">\theta^{\star}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT</annotation></semantics></math>. We could do gradient ascent on the function <math alttext="\theta\mapsto\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)" class="ltx_Math" display="inline" id="S3.SS1.p3.m2"><semantics><mrow><mi>θ</mi><mo stretchy="false">↦</mo><mrow><mrow><msub><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></msub><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\theta\mapsto\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)</annotation><annotation encoding="application/x-llamapun">italic_θ ↦ roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η )</annotation></semantics></math>. But then we would need to take the derivative in <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS1.p3.m3"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> of this function. To see how to do this, suppose that <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S3.SS1.p3.m4"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> is strongly convex in <math alttext="\eta" class="ltx_Math" display="inline" id="S3.SS1.p3.m5"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> so that there is one minimizer <math alttext="\eta^{\star}(\theta)" class="ltx_Math" display="inline" id="S3.SS1.p3.m6"><semantics><mrow><msup><mi>η</mi><mo>⋆</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\eta^{\star}(\theta)</annotation><annotation encoding="application/x-llamapun">italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math> of <math alttext="\mathcal{L}(\theta,\cdot)" class="ltx_Math" display="inline" id="S3.SS1.p3.m7"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo rspace="0em">,</mo><mo lspace="0em" rspace="0em">⋅</mo><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta,\cdot)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ , ⋅ )</annotation></semantics></math>. Then, <span class="ltx_text ltx_font_italic">Danskin’s theorem</span> says that</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E23">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\nabla_{\theta}\left[\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)\right]=\nabla_{\theta}\mathcal{L}(\theta,\texttt{stop\_grad}(\eta^{\star}(\theta)))," class="ltx_Math" display="block" id="S3.E23.m1"><semantics><mrow><mrow><mrow><msub><mo>∇</mo><mi>θ</mi></msub><mrow><mo>[</mo><mrow><mrow><munder><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></munder><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>]</mo></mrow></mrow><mo>=</mo><mrow><mrow><msub><mo rspace="0.167em">∇</mo><mi>θ</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mrow><mtext class="ltx_mathvariant_monospace">stop_grad</mtext><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><msup><mi>η</mi><mo>⋆</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\nabla_{\theta}\left[\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)\right]=\nabla_{\theta}\mathcal{L}(\theta,\texttt{stop\_grad}(\eta^{\star}(\theta))),</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT [ roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) ] = ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , stop_grad ( italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ( italic_θ ) ) ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.23)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">where the gradient is <span class="ltx_text ltx_font_italic">only with respect to the first argument</span> (i.e., not a total derivative which would require computing the Jacobian of <math alttext="\eta^{\star}(\theta)" class="ltx_Math" display="inline" id="S3.SS1.p3.m8"><semantics><mrow><msup><mi>η</mi><mo>⋆</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\eta^{\star}(\theta)</annotation><annotation encoding="application/x-llamapun">italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math> with respect to <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS1.p3.m9"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>), indicated by the stop-gradient operator.<span class="ltx_note ltx_role_footnote" id="footnote8"><sup class="ltx_note_mark">8</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">8</sup><span class="ltx_tag ltx_tag_note">8</span>In the case that <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="footnote8.m1"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> is not strongly convex in <math alttext="\eta" class="ltx_Math" display="inline" id="footnote8.m2"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> but rather just convex, Danskin’s theorem can be stated in terms of subdifferentials. If <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="footnote8.m3"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> is not convex at all in <math alttext="\eta" class="ltx_Math" display="inline" id="footnote8.m4"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math>, then this derivative may not be well-defined, but one can obtain (local) convergence guarantees for the resulting algorithm anyways. Hence we use Danskin’s theorem as a motivation and not a justification for our algorithms. Danskin’s thoerems can be generalized into more relaxed circumstances by the so-called <span class="ltx_text ltx_font_italic">envelope theorems</span>.</span></span></span>
In order to take the derivative in <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS1.p3.m10"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>, we need to set up a <span class="ltx_text ltx_font_italic">secondary process</span> to also optimize <math alttext="\eta" class="ltx_Math" display="inline" id="S3.SS1.p3.m11"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> to obtain an approximation for <math alttext="\eta^{\star}(\theta)" class="ltx_Math" display="inline" id="S3.SS1.p3.m12"><semantics><mrow><msup><mi>η</mi><mo>⋆</mo></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\eta^{\star}(\theta)</annotation><annotation encoding="application/x-llamapun">italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ( italic_θ )</annotation></semantics></math>. We can do this through the following algorithmic template:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx122">
<tbody id="S3.E24"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\eta_{k+1}=\eta_{k+1}^{T+1};\qquad\eta_{k+1}^{t+1}=\eta_{k+1}^{t}-h\nabla_{\eta}\mathcal{L}(\theta_{k},\eta_{k+1}^{t}),\quad\forall t\in[T];\qquad\eta_{k+1}^{1}=\eta_{k}" class="ltx_Math" display="inline" id="S3.E24.m1"><semantics><mrow><mrow><msub><mi>η</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msubsup><mi>η</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>T</mi><mo>+</mo><mn>1</mn></mrow></msubsup></mrow><mo rspace="2.167em">;</mo><mrow><mrow><msubsup><mi>η</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msubsup><mo>=</mo><mrow><msubsup><mi>η</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mi>t</mi></msubsup><mo>−</mo><mrow><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>η</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><msubsup><mi>η</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mi>t</mi></msubsup><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo rspace="1.167em">,</mo><mrow><mrow><mrow><mo rspace="0.167em">∀</mo><mi>t</mi></mrow><mo>∈</mo><mrow><mo stretchy="false">[</mo><mi>T</mi><mo stretchy="false">]</mo></mrow></mrow><mo rspace="2.167em">;</mo><mrow><msubsup><mi>η</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mn>1</mn></msubsup><mo>=</mo><msub><mi>η</mi><mi>k</mi></msub></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\eta_{k+1}=\eta_{k+1}^{T+1};\qquad\eta_{k+1}^{t+1}=\eta_{k+1}^{t}-h\nabla_{\eta}\mathcal{L}(\theta_{k},\eta_{k+1}^{t}),\quad\forall t\in[T];\qquad\eta_{k+1}^{1}=\eta_{k}</annotation><annotation encoding="application/x-llamapun">italic_η start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_η start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T + 1 end_POSTSUPERSCRIPT ; italic_η start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_t + 1 end_POSTSUPERSCRIPT = italic_η start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT - italic_h ∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_η start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT ) , ∀ italic_t ∈ [ italic_T ] ; italic_η start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 1 end_POSTSUPERSCRIPT = italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.24)</span></td>
</tr></tbody>
<tbody id="S3.E25"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\theta_{k+1}=\theta_{k}+h\nabla_{\theta}\mathcal{L}(\theta_{k},\eta_{k+1})." class="ltx_Math" display="inline" id="S3.E25.m1"><semantics><mrow><mrow><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>+</mo><mrow><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>θ</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>η</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\displaystyle\theta_{k+1}=\theta_{k}+h\nabla_{\theta}\mathcal{L}(\theta_{k},\eta_{k+1}).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT + italic_h ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_η start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.25)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">That is, we take <math alttext="T" class="ltx_Math" display="inline" id="S3.SS1.p3.m13"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation><annotation encoding="application/x-llamapun">italic_T</annotation></semantics></math> steps of gradient descent to update <math alttext="\eta_{k}" class="ltx_Math" display="inline" id="S3.SS1.p3.m14"><semantics><msub><mi>η</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\eta_{k}</annotation><annotation encoding="application/x-llamapun">italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> (hopefully to the minimizer of <math alttext="\mathcal{L}(\theta_{k},\cdot)" class="ltx_Math" display="inline" id="S3.SS1.p3.m15"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo rspace="0em">,</mo><mo lspace="0em" rspace="0em">⋅</mo><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta_{k},\cdot)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , ⋅ )</annotation></semantics></math>), and then take a gradient ascent step to update <math alttext="\theta_{k}" class="ltx_Math" display="inline" id="S3.SS1.p3.m16"><semantics><msub><mi>θ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\theta_{k}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math>. As a bonus, on top of estimating <math alttext="\theta_{K}\approx\operatorname*{arg\ max}_{\theta}\min_{\eta}\mathcal{L}(\theta,\eta)" class="ltx_Math" display="inline" id="S3.SS1.p3.m17"><semantics><mrow><msub><mi>θ</mi><mi>K</mi></msub><mo>≈</mo><mrow><mrow><mrow><msub><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>max</mi></mrow><mi>θ</mi></msub><mo lspace="0.167em">⁡</mo><msub><mi>min</mi><mi>η</mi></msub></mrow><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\theta_{K}\approx\operatorname*{arg\ max}_{\theta}\min_{\eta}\mathcal{L}(\theta,\eta)</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT ≈ start_OPERATOR roman_arg roman_max end_OPERATOR start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT roman_min start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η )</annotation></semantics></math>, we also learn an <math alttext="\eta_{K}\approx\operatorname*{arg\ min}_{\eta}\mathcal{L}(\theta_{K},\eta)" class="ltx_Math" display="inline" id="S3.SS1.p3.m18"><semantics><mrow><msub><mi>η</mi><mi>K</mi></msub><mo>≈</mo><mrow><mrow><msub><mrow><mi>arg</mi><mo lspace="0.500em" rspace="0em">​</mo><mi>min</mi></mrow><mi>η</mi></msub><mo>⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>K</mi></msub><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\eta_{K}\approx\operatorname*{arg\ min}_{\eta}\mathcal{L}(\theta_{K},\eta)</annotation><annotation encoding="application/x-llamapun">italic_η start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT ≈ start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT , italic_η )</annotation></semantics></math> — this is an approximate Stackelberg equilibrium.</p>
</div>
<div class="ltx_para" id="S3.SS1.p4">
<p class="ltx_p">This method is often not done in practice, as it requires <math alttext="T+1" class="ltx_Math" display="inline" id="S3.SS1.p4.m1"><semantics><mrow><mi>T</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">T+1</annotation><annotation encoding="application/x-llamapun">italic_T + 1</annotation></semantics></math> total gradient descent iterations to update <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS1.p4.m2"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> once. Instead, we use the so-called <span class="ltx_text ltx_font_italic">(simultaneous) Gradient Descent-Ascent</span> (GDA) iteration</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx123">
<tbody id="S3.E26"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\theta_{k+1}" class="ltx_Math" display="inline" id="S3.E26.m1"><semantics><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\displaystyle\theta_{k+1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\theta_{k}+h\nabla_{\theta}\mathcal{L}(\theta_{k},\eta_{k})" class="ltx_Math" display="inline" id="S3.E26.m2"><semantics><mrow><mi></mi><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>+</mo><mrow><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>θ</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>η</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><annotation encoding="application/x-tex">\displaystyle=\theta_{k}+h\nabla_{\theta}\mathcal{L}(\theta_{k},\eta_{k})</annotation><annotation encoding="application/x-llamapun">= italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT + italic_h ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.26)</span></td>
</tr></tbody>
<tbody id="S3.E27"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\eta_{k+1}" class="ltx_Math" display="inline" id="S3.E27.m1"><semantics><msub><mi>η</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\displaystyle\eta_{k+1}</annotation><annotation encoding="application/x-llamapun">italic_η start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\eta_{k}-Th\nabla_{\eta}\mathcal{L}(\theta_{k},\eta_{k})," class="ltx_Math" display="inline" id="S3.E27.m2"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><msub><mi>η</mi><mi>k</mi></msub><mo>−</mo><mrow><mi>T</mi><mo lspace="0em" rspace="0em">​</mo><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>η</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>η</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\eta_{k}-Th\nabla_{\eta}\mathcal{L}(\theta_{k},\eta_{k}),</annotation><annotation encoding="application/x-llamapun">= italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_T italic_h ∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.27)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">which can be implemented efficiently via a single gradient step on <math alttext="(\theta,\eta)" class="ltx_Math" display="inline" id="S3.SS1.p4.m3"><semantics><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\theta,\eta)</annotation><annotation encoding="application/x-llamapun">( italic_θ , italic_η )</annotation></semantics></math>. The crucial idea here is, to make our method close to the inefficient iteration above, we use an <math alttext="\eta" class="ltx_Math" display="inline" id="S3.SS1.p4.m4"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> update which is <math alttext="T" class="ltx_Math" display="inline" id="S3.SS1.p4.m5"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation><annotation encoding="application/x-llamapun">italic_T</annotation></semantics></math> times faster than the <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS1.p4.m6"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> update (these can be seen as nearly the same by taking a linearization of the dynamics).</p>
</div>
<div class="ltx_para" id="S3.SS1.p5">
<p class="ltx_p">It is crucial to pick <math alttext="T" class="ltx_Math" display="inline" id="S3.SS1.p5.m1"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation><annotation encoding="application/x-llamapun">italic_T</annotation></semantics></math> sensibly. How can we do that? In the sequel, we discuss two configurations of <math alttext="T" class="ltx_Math" display="inline" id="S3.SS1.p5.m2"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation><annotation encoding="application/x-llamapun">italic_T</annotation></semantics></math> which lead to convergence of GDA to a Stackelberg equilibrium under different assumptions.</p>
</div>
<section class="ltx_subsubsection" id="S3.SS1.SSSx1">
<h4 class="ltx_title ltx_title_subsubsection">Convergence of One-Timescale GDA to Stackelberg Equilibrium</h4>
<div class="ltx_para" id="S3.SS1.SSSx1.p1">
<p class="ltx_p">If <math alttext="T=1" class="ltx_Math" display="inline" id="S3.SS1.SSSx1.p1.m1"><semantics><mrow><mi>T</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">T=1</annotation><annotation encoding="application/x-llamapun">italic_T = 1</annotation></semantics></math> (i.e., named <span class="ltx_text ltx_font_italic">one-timescale</span> because both <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS1.SSSx1.p1.m2"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> and <math alttext="\eta" class="ltx_Math" display="inline" id="S3.SS1.SSSx1.p1.m3"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> updates are of the same scale), then the GDA algorithm becomes</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E28">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\theta_{k+1}=\theta_{k}+h\nabla_{\theta}\mathcal{L}(\theta_{k},\eta_{k}),\qquad\eta_{k+1}=\eta_{k}-h\nabla_{\eta}\mathcal{L}(\theta_{k},\eta_{k})." class="ltx_Math" display="block" id="S3.E28.m1"><semantics><mrow><mrow><mrow><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>+</mo><mrow><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>θ</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>η</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo rspace="2.167em">,</mo><mrow><msub><mi>η</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mrow><msub><mi>η</mi><mi>k</mi></msub><mo>−</mo><mrow><mi>h</mi><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>η</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>η</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\theta_{k+1}=\theta_{k}+h\nabla_{\theta}\mathcal{L}(\theta_{k},\eta_{k}),\qquad\eta_{k+1}=\eta_{k}-h\nabla_{\eta}\mathcal{L}(\theta_{k},\eta_{k}).</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT + italic_h ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) , italic_η start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT = italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - italic_h ∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.28)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">If <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S3.SS1.SSSx1.p1.m4"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> has Lipschitz gradients in <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS1.SSSx1.p1.m5"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> and <math alttext="\eta" class="ltx_Math" display="inline" id="S3.SS1.SSSx1.p1.m6"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math>, and is strongly concave in <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS1.SSSx1.p1.m7"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> and strongly convex in <math alttext="\eta" class="ltx_Math" display="inline" id="S3.SS1.SSSx1.p1.m8"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math>, and is coercive (i.e.,<math alttext="\lim_{\|\theta\|_{2},\|\eta\|_{2}\to\infty}\mathcal{L}(\theta,\eta)=\infty" class="ltx_Math" display="inline" id="S3.SS1.SSSx1.p1.m9"><semantics><mrow><mrow><msub><mo>lim</mo><mrow><mrow><msub><mrow><mo stretchy="false">‖</mo><mi>θ</mi><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><mo>,</mo><msub><mrow><mo stretchy="false">‖</mo><mi>η</mi><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub></mrow><mo stretchy="false">→</mo><mi mathvariant="normal">∞</mi></mrow></msub><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>=</mo><mi mathvariant="normal">∞</mi></mrow><annotation encoding="application/x-tex">\lim_{\|\theta\|_{2},\|\eta\|_{2}\to\infty}\mathcal{L}(\theta,\eta)=\infty</annotation><annotation encoding="application/x-llamapun">roman_lim start_POSTSUBSCRIPT ∥ italic_θ ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , ∥ italic_η ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT → ∞ end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) = ∞</annotation></semantics></math>), then all saddle points are Stackelberg equilibria and vice versa. The work <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx316" title="">ZAK24</a>]</cite> shows that GDA (again, with <math alttext="T=1" class="ltx_Math" display="inline" id="S3.SS1.SSSx1.p1.m10"><semantics><mrow><mi>T</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">T=1</annotation><annotation encoding="application/x-llamapun">italic_T = 1</annotation></semantics></math>) with sufficiently small step size <math alttext="h" class="ltx_Math" display="inline" id="S3.SS1.SSSx1.p1.m11"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math> converges to a saddle point (hence Stackelberg equilibrium) exponentially fast if one exists, analogously to gradient descent for strongly convex functions with Lipschitz gradient.<span class="ltx_note ltx_role_footnote" id="footnote9"><sup class="ltx_note_mark">9</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">9</sup><span class="ltx_tag ltx_tag_note">9</span>We do not provide the step size or exponential base since they are complicated functions of the strong convexity/concavity/Lipschitz constant of the gradient. Of course, the paper <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx316" title="">ZAK24</a>]</cite> provides the precise parameter values.</span></span></span> To our knowledge, this flavor of results constitute the only known rigorous justification for single-timescale GDA.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S3.SS1.SSSx2">
<h4 class="ltx_title ltx_title_subsubsection">Local Convergence of Two-Timescale GDA to Stackelberg Equilibrium</h4>
<div class="ltx_para" id="S3.SS1.SSSx2.p1">
<p class="ltx_p">Strong convexity/concavity is a <span class="ltx_text ltx_font_italic">global</span> property, and none of the games we look into in this book have objectives which are globally strongly concave/strongly convex. In this case, the best we can hope for is <span class="ltx_text ltx_font_italic">local</span> convergence to Stackelberg equilibria: if the parameters are initialized close to a Stackelberg equilibrium, then GDA can converge onto it, given an appropriate step size <math alttext="h" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p1.m1"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math> and timescale <math alttext="T" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p1.m2"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation><annotation encoding="application/x-llamapun">italic_T</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="S3.SS1.SSSx2.p2">
<p class="ltx_p">In fact, our results also hold for a version of the <span class="ltx_text ltx_font_italic">local</span> Stackelberg equilibrium called the <span class="ltx_text ltx_font_italic">differential Stackelberg equilibrium</span>, which was introduced in <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx86" title="">FCR19</a>]</cite> (though we use the precise definition in <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx157" title="">LFD+22</a>]</cite>), and which we define as follows. A point <math alttext="(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p2.m1"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> is a differential Stackelberg equilibrium if:</p>
<ul class="ltx_itemize" id="S3.I2">
<li class="ltx_item" id="S3.I2.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I2.i1.p1">
<p class="ltx_p"><math alttext="\nabla_{\eta}\mathcal{L}(\theta^{\star},\eta^{\star})=\bm{0}" class="ltx_Math" display="inline" id="S3.I2.i1.p1.m1"><semantics><mrow><mrow><mrow><msub><mo>∇</mo><mi>η</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mn>𝟎</mn></mrow><annotation encoding="application/x-tex">\nabla_{\eta}\mathcal{L}(\theta^{\star},\eta^{\star})=\bm{0}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) = bold_0</annotation></semantics></math>;</p>
</div>
</li>
<li class="ltx_item" id="S3.I2.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I2.i2.p1">
<p class="ltx_p"><math alttext="\nabla_{\eta}^{2}\mathcal{L}(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.I2.i2.p1.m1"><semantics><mrow><mrow><msubsup><mo>∇</mo><mi>η</mi><mn>2</mn></msubsup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla_{\eta}^{2}\mathcal{L}(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> is symmetric positive definite;</p>
</div>
</li>
<li class="ltx_item" id="S3.I2.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I2.i3.p1">
<p class="ltx_p"><math alttext="\nabla_{\theta}\mathcal{L}(\theta^{\star},\eta^{\star})=\bm{0}" class="ltx_Math" display="inline" id="S3.I2.i3.p1.m1"><semantics><mrow><mrow><mrow><msub><mo>∇</mo><mi>θ</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mn>𝟎</mn></mrow><annotation encoding="application/x-tex">\nabla_{\theta}\mathcal{L}(\theta^{\star},\eta^{\star})=\bm{0}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) = bold_0</annotation></semantics></math>;</p>
</div>
</li>
<li class="ltx_item" id="S3.I2.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I2.i4.p1">
<p class="ltx_p"><math alttext="(\nabla_{\theta}^{2}\mathcal{L}+[\frac{\mathrm{d}}{\mathrm{d}\theta}\nabla_{\eta}\mathcal{L}][\nabla_{\eta}^{2}\mathcal{L}]^{-1}[\frac{\mathrm{d}}{\mathrm{d}\eta}\nabla_{\theta}\mathcal{L}])(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.I2.i4.p1.m1"><semantics><mrow><mrow><mo stretchy="false">(</mo><mrow><mrow><msubsup><mo rspace="0.167em">∇</mo><mi>θ</mi><mn>2</mn></msubsup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>+</mo><mrow><mrow><mo stretchy="false">[</mo><mrow><mfrac><mi mathvariant="normal">d</mi><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow></mfrac><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>η</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo stretchy="false">]</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mrow><mo stretchy="false">[</mo><mrow><msubsup><mo rspace="0.167em">∇</mo><mi>η</mi><mn>2</mn></msubsup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo stretchy="false">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">[</mo><mrow><mfrac><mi mathvariant="normal">d</mi><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>η</mi></mrow></mfrac><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>θ</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow></mrow><mo stretchy="false">)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">(\nabla_{\theta}^{2}\mathcal{L}+[\frac{\mathrm{d}}{\mathrm{d}\theta}\nabla_{\eta}\mathcal{L}][\nabla_{\eta}^{2}\mathcal{L}]^{-1}[\frac{\mathrm{d}}{\mathrm{d}\eta}\nabla_{\theta}\mathcal{L}])(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">( ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L + [ divide start_ARG roman_d end_ARG start_ARG roman_d italic_θ end_ARG ∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT caligraphic_L ] [ ∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ] start_POSTSUPERSCRIPT - 1 end_POSTSUPERSCRIPT [ divide start_ARG roman_d end_ARG start_ARG roman_d italic_η end_ARG ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L ] ) ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> is symmetric negative definite.</p>
</div>
</li>
</ul>
<p class="ltx_p">Notice that the last condition asks for the (total) Hessian</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E29">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\nabla^{2}\mathcal{L}(\theta,\eta)=\begin{bmatrix}\nabla_{\theta}^{2}\mathcal{L}(\theta,\eta)&amp;\frac{\mathrm{d}}{\mathrm{d}\eta}\nabla_{\theta}^{2}\mathcal{L}(\theta,\eta)\\
\frac{\mathrm{d}}{\mathrm{d}\theta}\nabla_{\eta\theta}^{2}\mathcal{L}(\theta,\eta)&amp;\nabla_{\eta}^{2}\mathcal{L}(\theta)\end{bmatrix}" class="ltx_Math" display="block" id="S3.E29.m1"><semantics><mrow><mrow><mrow><msup><mo>∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo>=</mo><mrow><mo>[</mo><mtable columnspacing="5pt" displaystyle="true" rowspacing="0pt"><mtr><mtd><mrow><mrow><msubsup><mo>∇</mo><mi>θ</mi><mn>2</mn></msubsup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mtd><mtd><mrow><mstyle displaystyle="false"><mfrac><mi mathvariant="normal">d</mi><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>η</mi></mrow></mfrac></mstyle><mo lspace="0.167em" rspace="0em">​</mo><mrow><msubsup><mo rspace="0.167em">∇</mo><mi>θ</mi><mn>2</mn></msubsup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mtd></mtr><mtr><mtd><mrow><mstyle displaystyle="false"><mfrac><mi mathvariant="normal">d</mi><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow></mfrac></mstyle><mo lspace="0.167em" rspace="0em">​</mo><mrow><msubsup><mo rspace="0.167em">∇</mo><mrow><mi>η</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow><mn>2</mn></msubsup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mtd><mtd><mrow><mrow><msubsup><mo>∇</mo><mi>η</mi><mn>2</mn></msubsup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow></mtd></mtr></mtable><mo>]</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla^{2}\mathcal{L}(\theta,\eta)=\begin{bmatrix}\nabla_{\theta}^{2}\mathcal{L}(\theta,\eta)&amp;\frac{\mathrm{d}}{\mathrm{d}\eta}\nabla_{\theta}^{2}\mathcal{L}(\theta,\eta)\\
\frac{\mathrm{d}}{\mathrm{d}\theta}\nabla_{\eta\theta}^{2}\mathcal{L}(\theta,\eta)&amp;\nabla_{\eta}^{2}\mathcal{L}(\theta)\end{bmatrix}</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ , italic_η ) = [ start_ARG start_ROW start_CELL ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ , italic_η ) end_CELL start_CELL divide start_ARG roman_d end_ARG start_ARG roman_d italic_η end_ARG ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ , italic_η ) end_CELL end_ROW start_ROW start_CELL divide start_ARG roman_d end_ARG start_ARG roman_d italic_θ end_ARG ∇ start_POSTSUBSCRIPT italic_η italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ , italic_η ) end_CELL start_CELL ∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ ) end_CELL end_ROW end_ARG ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.29)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">or, equivalently, its Schur complement to be negative definite. If we look at the computation of <math alttext="\nabla_{\theta}[\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)]" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p2.m2"><semantics><mrow><msub><mo>∇</mo><mi>θ</mi></msub><mrow><mo stretchy="false">[</mo><mrow><mrow><msub><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></msub><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla_{\theta}[\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)]</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT [ roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η ) ]</annotation></semantics></math> furnished by Danskin’s theorem, the last two criteria are actually constraints on the gradient and Hessian of the function <math alttext="\theta\mapsto\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p2.m3"><semantics><mrow><mi>θ</mi><mo stretchy="false">↦</mo><mrow><mrow><msub><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></msub><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow></mrow><annotation encoding="application/x-tex">\theta\mapsto\min_{\eta\in\mathrm{H}}\mathcal{L}(\theta,\eta)</annotation><annotation encoding="application/x-llamapun">italic_θ ↦ roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( italic_θ , italic_η )</annotation></semantics></math>, ensuring that the gradient is <math alttext="0" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p2.m4"><mn>0</mn></math> and the Hessian is negative semidefinite. This intuition tells us that we can expect that each Stackelberg equilibrium is a differential Stackelberg equilibrium; <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx85" title="">FCR20</a>]</cite> confirms this rigorously (up to some technical conditions).</p>
</div>
<div class="ltx_para" id="S3.SS1.SSSx2.p3">
<p class="ltx_p">Analogously to the notion of strict local optimum in single-player optimization (where we require <math alttext="\nabla^{2}\mathcal{L}(\theta^{\star})" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p3.m1"><semantics><mrow><mrow><msup><mo>∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla^{2}\mathcal{L}(\theta^{\star})</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> to be positive semidefinite), the definition of differential Stackelberg equilibrium <span class="ltx_text ltx_font_italic">implies that <math alttext="\mathcal{L}(\theta,\cdot)" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p3.m2"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo rspace="0em">,</mo><mo lspace="0em" rspace="0em">⋅</mo><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta,\cdot)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ , ⋅ )</annotation></semantics></math> is locally (strictly) convex in a neighborhood of the equilibrium, and that <math alttext="\min_{\eta\in\mathrm{H}}\mathcal{L}(\cdot,\eta)" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p3.m3"><semantics><mrow><mrow><msub><mi>min</mi><mrow><mi>η</mi><mo>∈</mo><mi mathvariant="normal">H</mi></mrow></msub><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mo lspace="0em" rspace="0em">⋅</mo><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\min_{\eta\in\mathrm{H}}\mathcal{L}(\cdot,\eta)</annotation><annotation encoding="application/x-llamapun">roman_min start_POSTSUBSCRIPT italic_η ∈ roman_H end_POSTSUBSCRIPT caligraphic_L ( ⋅ , italic_η )</annotation></semantics></math> is locally (strictly) concave in the same region</span>.</p>
</div>
<div class="ltx_para" id="S3.SS1.SSSx2.p4">
<p class="ltx_p">In this context, we present the result from <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx157" title="">LFD+22</a>]</cite>. Let <math alttext="(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p4.m1"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> be a differential Stackelberg equilibrium. Suppose that <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p4.m2"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> has Lipschitz gradients, i.e.,</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E30">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max\left\{\|\nabla_{\theta}^{2}\mathcal{L}(\theta^{\star},\eta^{\star})\|_{2},\left\|\nabla_{\eta}^{2}\mathcal{L}(\theta^{\star},\eta^{\star})\right\|_{2},\left\|\frac{\mathrm{d}}{\mathrm{d}\eta}\nabla_{\theta}\mathcal{L}(\theta^{\star},\eta^{\star})\right\|_{2}\right\}\leq\beta." class="ltx_Math" display="block" id="S3.E30.m1"><semantics><mrow><mrow><mrow><mi>max</mi><mo>⁡</mo><mrow><mo>{</mo><msub><mrow><mo stretchy="false">‖</mo><mrow><mrow><msubsup><mo rspace="0.167em">∇</mo><mi>θ</mi><mn>2</mn></msubsup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><mo>,</mo><msub><mrow><mo>‖</mo><mrow><mrow><msubsup><mo rspace="0.167em">∇</mo><mi>η</mi><mn>2</mn></msubsup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>‖</mo></mrow><mn>2</mn></msub><mo>,</mo><msub><mrow><mo>‖</mo><mrow><mfrac><mi mathvariant="normal">d</mi><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>η</mi></mrow></mfrac><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>θ</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo>‖</mo></mrow><mn>2</mn></msub><mo>}</mo></mrow></mrow><mo>≤</mo><mi>β</mi></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\max\left\{\|\nabla_{\theta}^{2}\mathcal{L}(\theta^{\star},\eta^{\star})\|_{2},\left\|\nabla_{\eta}^{2}\mathcal{L}(\theta^{\star},\eta^{\star})\right\|_{2},\left\|\frac{\mathrm{d}}{\mathrm{d}\eta}\nabla_{\theta}\mathcal{L}(\theta^{\star},\eta^{\star})\right\|_{2}\right\}\leq\beta.</annotation><annotation encoding="application/x-llamapun">roman_max { ∥ ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , ∥ ∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , ∥ divide start_ARG roman_d end_ARG start_ARG roman_d italic_η end_ARG ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT } ≤ italic_β .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.30)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Further define the local strong convexity/concavity parameters of <math alttext="\mathcal{L}(\theta,\cdot)" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p4.m3"><semantics><mrow><mi class="ltx_font_mathcaligraphic">ℒ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo rspace="0em">,</mo><mo lspace="0em" rspace="0em">⋅</mo><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{L}(\theta,\cdot)</annotation><annotation encoding="application/x-llamapun">caligraphic_L ( italic_θ , ⋅ )</annotation></semantics></math> and <math alttext="\min_{\eta}\mathcal{L}(\cdot,\eta)" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p4.m4"><semantics><mrow><mrow><msub><mi>min</mi><mi>η</mi></msub><mo lspace="0.167em">⁡</mo><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mo lspace="0em" rspace="0em">⋅</mo><mo>,</mo><mi>η</mi><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\min_{\eta}\mathcal{L}(\cdot,\eta)</annotation><annotation encoding="application/x-llamapun">roman_min start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT caligraphic_L ( ⋅ , italic_η )</annotation></semantics></math> respectively as</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E31">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mu_{\eta}=\lambda_{\min}(\nabla_{\eta}^{2}\mathcal{L}(\theta^{\star},\eta^{\star})),\qquad\mu_{\theta}=\min\left\{\beta,-\left(\nabla_{\theta}^{2}\mathcal{L}+\left[\frac{\mathrm{d}}{\mathrm{d}\theta}\nabla_{\eta}\mathcal{L}\right]\left[\nabla_{\eta}^{2}\mathcal{L}\right]^{-1}\left[\frac{\mathrm{d}}{\mathrm{d}\eta}\nabla_{\theta}\mathcal{L}\right]\right)(\theta^{\star},\eta^{\star})\right\}." class="ltx_Math" display="block" id="S3.E31.m1"><semantics><mrow><mrow><mrow><msub><mi>μ</mi><mi>η</mi></msub><mo>=</mo><mrow><msub><mi>λ</mi><mi>min</mi></msub><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mrow><mrow><msubsup><mo rspace="0.167em">∇</mo><mi>η</mi><mn>2</mn></msubsup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><mo rspace="2.167em">,</mo><mrow><msub><mi>μ</mi><mi>θ</mi></msub><mo>=</mo><mrow><mi>min</mi><mo>⁡</mo><mrow><mo>{</mo><mi>β</mi><mo>,</mo><mrow><mo>−</mo><mrow><mrow><mo>(</mo><mrow><mrow><msubsup><mo rspace="0.167em">∇</mo><mi>θ</mi><mn>2</mn></msubsup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>+</mo><mrow><mrow><mo>[</mo><mrow><mfrac><mi mathvariant="normal">d</mi><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>θ</mi></mrow></mfrac><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>η</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo>]</mo></mrow><mo lspace="0em" rspace="0em">​</mo><msup><mrow><mo>[</mo><mrow><msubsup><mo rspace="0.167em">∇</mo><mi>η</mi><mn>2</mn></msubsup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo>]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo lspace="0em" rspace="0em">​</mo><mrow><mo>[</mo><mrow><mfrac><mi mathvariant="normal">d</mi><mrow><mi mathvariant="normal">d</mi><mo lspace="0em" rspace="0em">​</mo><mi>η</mi></mrow></mfrac><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>θ</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow></mrow><mo>]</mo></mrow></mrow></mrow><mo>)</mo></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>}</mo></mrow></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\mu_{\eta}=\lambda_{\min}(\nabla_{\eta}^{2}\mathcal{L}(\theta^{\star},\eta^{\star})),\qquad\mu_{\theta}=\min\left\{\beta,-\left(\nabla_{\theta}^{2}\mathcal{L}+\left[\frac{\mathrm{d}}{\mathrm{d}\theta}\nabla_{\eta}\mathcal{L}\right]\left[\nabla_{\eta}^{2}\mathcal{L}\right]^{-1}\left[\frac{\mathrm{d}}{\mathrm{d}\eta}\nabla_{\theta}\mathcal{L}\right]\right)(\theta^{\star},\eta^{\star})\right\}.</annotation><annotation encoding="application/x-llamapun">italic_μ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT = italic_λ start_POSTSUBSCRIPT roman_min end_POSTSUBSCRIPT ( ∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ) , italic_μ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT = roman_min { italic_β , - ( ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L + [ divide start_ARG roman_d end_ARG start_ARG roman_d italic_θ end_ARG ∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT caligraphic_L ] [ ∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ] start_POSTSUPERSCRIPT - 1 end_POSTSUPERSCRIPT [ divide start_ARG roman_d end_ARG start_ARG roman_d italic_η end_ARG ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L ] ) ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) } .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.31)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">Then define the local condition numbers as</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E32">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\kappa_{\eta}=L/\mu_{\eta},\qquad\kappa_{\theta}=L/\mu_{\theta}." class="ltx_Math" display="block" id="S3.E32.m1"><semantics><mrow><mrow><mrow><msub><mi>κ</mi><mi>η</mi></msub><mo>=</mo><mrow><mi>L</mi><mo>/</mo><msub><mi>μ</mi><mi>η</mi></msub></mrow></mrow><mo rspace="2.167em">,</mo><mrow><msub><mi>κ</mi><mi>θ</mi></msub><mo>=</mo><mrow><mi>L</mi><mo>/</mo><msub><mi>μ</mi><mi>θ</mi></msub></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\kappa_{\eta}=L/\mu_{\eta},\qquad\kappa_{\theta}=L/\mu_{\theta}.</annotation><annotation encoding="application/x-llamapun">italic_κ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT = italic_L / italic_μ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT , italic_κ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT = italic_L / italic_μ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.32)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">The paper <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx157" title="">LFD+22</a>]</cite> says that if we take step size <math alttext="h=\frac{1}{4\beta T}" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p4.m5"><semantics><mrow><mi>h</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mn>4</mn><mo lspace="0em" rspace="0em">​</mo><mi>β</mi><mo lspace="0em" rspace="0em">​</mo><mi>T</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">h=\frac{1}{4\beta T}</annotation><annotation encoding="application/x-llamapun">italic_h = divide start_ARG 1 end_ARG start_ARG 4 italic_β italic_T end_ARG</annotation></semantics></math> and take <math alttext="T\geq 2\kappa" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p4.m6"><semantics><mrow><mi>T</mi><mo>≥</mo><mrow><mn>2</mn><mo lspace="0em" rspace="0em">​</mo><mi>κ</mi></mrow></mrow><annotation encoding="application/x-tex">T\geq 2\kappa</annotation><annotation encoding="application/x-llamapun">italic_T ≥ 2 italic_κ</annotation></semantics></math>, so that the algorithm is</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx124">
<tbody id="S3.E33"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\theta_{k+1}" class="ltx_Math" display="inline" id="S3.E33.m1"><semantics><msub><mi>θ</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\displaystyle\theta_{k+1}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\theta_{k}+\frac{1}{4\beta T}\nabla_{\theta}\mathcal{L}(\theta_{k},\eta_{k})," class="ltx_Math" display="inline" id="S3.E33.m2"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><msub><mi>θ</mi><mi>k</mi></msub><mo>+</mo><mrow><mstyle displaystyle="true"><mfrac><mn>1</mn><mrow><mn>4</mn><mo lspace="0em" rspace="0em">​</mo><mi>β</mi><mo lspace="0em" rspace="0em">​</mo><mi>T</mi></mrow></mfrac></mstyle><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>θ</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>η</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\theta_{k}+\frac{1}{4\beta T}\nabla_{\theta}\mathcal{L}(\theta_{k},\eta_{k}),</annotation><annotation encoding="application/x-llamapun">= italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT + divide start_ARG 1 end_ARG start_ARG 4 italic_β italic_T end_ARG ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.33)</span></td>
</tr></tbody>
<tbody id="S3.E34"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\eta_{k+1}" class="ltx_Math" display="inline" id="S3.E34.m1"><semantics><msub><mi>η</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">\displaystyle\eta_{k+1}</annotation><annotation encoding="application/x-llamapun">italic_η start_POSTSUBSCRIPT italic_k + 1 end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\eta_{k}-\frac{1}{4\beta}\nabla_{\eta}\mathcal{L}(\theta_{k},\eta_{k})," class="ltx_Math" display="inline" id="S3.E34.m2"><semantics><mrow><mrow><mi></mi><mo>=</mo><mrow><msub><mi>η</mi><mi>k</mi></msub><mo>−</mo><mrow><mstyle displaystyle="true"><mfrac><mn>1</mn><mrow><mn>4</mn><mo lspace="0em" rspace="0em">​</mo><mi>β</mi></mrow></mfrac></mstyle><mo lspace="0.167em" rspace="0em">​</mo><mrow><msub><mo rspace="0.167em">∇</mo><mi>η</mi></msub><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>η</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\displaystyle=\eta_{k}-\frac{1}{4\beta}\nabla_{\eta}\mathcal{L}(\theta_{k},\eta_{k}),</annotation><annotation encoding="application/x-llamapun">= italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT - divide start_ARG 1 end_ARG start_ARG 4 italic_β end_ARG ∇ start_POSTSUBSCRIPT italic_η end_POSTSUBSCRIPT caligraphic_L ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.34)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">the total Hessian <math alttext="\nabla^{2}\mathcal{L}(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p4.m7"><semantics><mrow><mrow><msup><mo>∇</mo><mn>2</mn></msup><mi class="ltx_font_mathcaligraphic">ℒ</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nabla^{2}\mathcal{L}(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">∇ start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT caligraphic_L ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math> is diagonalizable, and we initialize <math alttext="(\theta_{0},\eta_{0})" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p4.m8"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo>,</mo><msub><mi>η</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\theta_{0},\eta_{0})</annotation><annotation encoding="application/x-llamapun">( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_η start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT )</annotation></semantics></math> close enough to <math alttext="(\theta^{\star},\eta^{\star})" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p4.m9"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\theta^{\star},\eta^{\star})</annotation><annotation encoding="application/x-llamapun">( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT )</annotation></semantics></math>, then there are positive constants <math alttext="c_{0},c_{1}&gt;0" class="ltx_Math" display="inline" id="S3.SS1.SSSx2.p4.m10"><semantics><mrow><mrow><msub><mi>c</mi><mn>0</mn></msub><mo>,</mo><msub><mi>c</mi><mn>1</mn></msub></mrow><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">c_{0},c_{1}&gt;0</annotation><annotation encoding="application/x-llamapun">italic_c start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_c start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT &gt; 0</annotation></semantics></math> such that</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E35">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\|(\theta_{k},\eta_{k})-(\theta^{\star},\eta^{\star})\|_{2}\leq c_{0}\left(1-\frac{c_{1}}{T\kappa_{\theta}}\right)^{k}\|(\theta_{0},\eta_{0})-(\theta^{\star},\eta^{\star})\|_{2}," class="ltx_Math" display="block" id="S3.E35.m1"><semantics><mrow><mrow><msub><mrow><mo stretchy="false">‖</mo><mrow><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>η</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><mo>−</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub><mo>≤</mo><mrow><msub><mi>c</mi><mn>0</mn></msub><mo lspace="0em" rspace="0em">​</mo><msup><mrow><mo>(</mo><mrow><mn>1</mn><mo>−</mo><mfrac><msub><mi>c</mi><mn>1</mn></msub><mrow><mi>T</mi><mo lspace="0em" rspace="0em">​</mo><msub><mi>κ</mi><mi>θ</mi></msub></mrow></mfrac></mrow><mo>)</mo></mrow><mi>k</mi></msup><mo lspace="0em" rspace="0em">​</mo><msub><mrow><mo stretchy="false">‖</mo><mrow><mrow><mo stretchy="false">(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo>,</mo><msub><mi>η</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><mo>−</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo>,</mo><msup><mi>η</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn></msub></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\|(\theta_{k},\eta_{k})-(\theta^{\star},\eta^{\star})\|_{2}\leq c_{0}\left(1-\frac{c_{1}}{T\kappa_{\theta}}\right)^{k}\|(\theta_{0},\eta_{0})-(\theta^{\star},\eta^{\star})\|_{2},</annotation><annotation encoding="application/x-llamapun">∥ ( italic_θ start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT , italic_η start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ) - ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ≤ italic_c start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ( 1 - divide start_ARG italic_c start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_ARG start_ARG italic_T italic_κ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT end_ARG ) start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT ∥ ( italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , italic_η start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ) - ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT , italic_η start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.3.35)</span></td>
</tr></tbody>
</table>
<p class="ltx_p">implying exponential convergence to the differential Stackelberg equilibrium.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.3.2 </span>Practical Considerations when Learning Stackelberg Equilibria</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p">In practice, we do not know how to initialize parameters close to a (differential) Stackelberg equilibrium. Due to symmetries within the objective, including those induced by overparameterization of the neural networks being trained, one can (heuristically) expect that most initializations are close to a Stackelberg equilibrium. Also, we do not know how to compute the step size <math alttext="h" class="ltx_Math" display="inline" id="S3.SS2.p1.m1"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation><annotation encoding="application/x-llamapun">italic_h</annotation></semantics></math> or the timescale <math alttext="T" class="ltx_Math" display="inline" id="S3.SS2.p1.m2"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation><annotation encoding="application/x-llamapun">italic_T</annotation></semantics></math>, since they are dependent on properties of the loss <math alttext="\mathcal{L}" class="ltx_Math" display="inline" id="S3.SS2.p1.m3"><semantics><mi class="ltx_font_mathcaligraphic">ℒ</mi><annotation encoding="application/x-tex">\mathcal{L}</annotation><annotation encoding="application/x-llamapun">caligraphic_L</annotation></semantics></math> at the equilibrium. In practice, there are some common approaches:</p>
<ul class="ltx_itemize" id="S3.I3">
<li class="ltx_item" id="S3.I3.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I3.i1.p1">
<p class="ltx_p">Take <math alttext="T=1" class="ltx_Math" display="inline" id="S3.I3.i1.p1.m1"><semantics><mrow><mi>T</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">T=1</annotation><annotation encoding="application/x-llamapun">italic_T = 1</annotation></semantics></math> (equal step-sizes), and use updates for <math alttext="\theta" class="ltx_Math" display="inline" id="S3.I3.i1.p1.m2"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math> and <math alttext="\eta" class="ltx_Math" display="inline" id="S3.I3.i1.p1.m3"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> that are derived from a learning-rate-adaptive optimizer like Adam (as opposed to vanilla GD). Here, you <span class="ltx_text ltx_font_italic">hope</span> (but do not <span class="ltx_text ltx_font_italic">know</span>) that the optimizer can adjust the learning rates to learn a good equilibrium.</p>
</div>
</li>
<li class="ltx_item" id="S3.I3.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I3.i2.p1">
<p class="ltx_p">Take <math alttext="T" class="ltx_Math" display="inline" id="S3.I3.i2.p1.m1"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation><annotation encoding="application/x-llamapun">italic_T</annotation></semantics></math> to be some constant like <math alttext="T=10^{6}" class="ltx_Math" display="inline" id="S3.I3.i2.p1.m2"><semantics><mrow><mi>T</mi><mo>=</mo><msup><mn>10</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">T=10^{6}</annotation><annotation encoding="application/x-llamapun">italic_T = 10 start_POSTSUPERSCRIPT 6 end_POSTSUPERSCRIPT</annotation></semantics></math> which implies that <math alttext="\eta" class="ltx_Math" display="inline" id="S3.I3.i2.p1.m3"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation><annotation encoding="application/x-llamapun">italic_η</annotation></semantics></math> equilibrates <math alttext="10^{6}" class="ltx_Math" display="inline" id="S3.I3.i2.p1.m4"><semantics><msup><mn>10</mn><mn>6</mn></msup><annotation encoding="application/x-tex">10^{6}</annotation><annotation encoding="application/x-llamapun">10 start_POSTSUPERSCRIPT 6 end_POSTSUPERSCRIPT</annotation></semantics></math> times as fast as <math alttext="\theta" class="ltx_Math" display="inline" id="S3.I3.i2.p1.m5"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>. Here you can also use Adam-style updates, and hope that it fixes the time scale.</p>
</div>
</li>
<li class="ltx_item" id="S3.I3.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I3.i3.p1">
<p class="ltx_p">Let <math alttext="T" class="ltx_Math" display="inline" id="S3.I3.i3.p1.m1"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation><annotation encoding="application/x-llamapun">italic_T</annotation></semantics></math> depend on the iteration <math alttext="k" class="ltx_Math" display="inline" id="S3.I3.i3.p1.m2"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation><annotation encoding="application/x-llamapun">italic_k</annotation></semantics></math>, and let <math alttext="T_{k}\to\infty" class="ltx_Math" display="inline" id="S3.I3.i3.p1.m3"><semantics><mrow><msub><mi>T</mi><mi>k</mi></msub><mo stretchy="false">→</mo><mi mathvariant="normal">∞</mi></mrow><annotation encoding="application/x-tex">T_{k}\to\infty</annotation><annotation encoding="application/x-llamapun">italic_T start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT → ∞</annotation></semantics></math> as <math alttext="k\to\infty" class="ltx_Math" display="inline" id="S3.I3.i3.p1.m4"><semantics><mrow><mi>k</mi><mo stretchy="false">→</mo><mi mathvariant="normal">∞</mi></mrow><annotation encoding="application/x-tex">k\to\infty</annotation><annotation encoding="application/x-llamapun">italic_k → ∞</annotation></semantics></math>. This schedule was studied (also in the case of noise) by Borkar in <cite class="ltx_cite ltx_citemacro_cite">[<a class="ltx_ref" href="bib.html#bibx23" title="">Bor97</a>]</cite>.</p>
</div>
</li>
</ul>
<p class="ltx_p">For example, you can use this while training CTRL-style models (see <a class="ltx_ref" href="Ch5.html" title="Chapter 5 Consistent and Self-Consistent Representations ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Chapter</span> <span class="ltx_text ltx_ref_tag">5</span></a>), where the encoder is Player <math alttext="1" class="ltx_Math" display="inline" id="S3.SS2.p1.m4"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation><annotation encoding="application/x-llamapun">1</annotation></semantics></math> and the decoder is Player <math alttext="2" class="ltx_Math" display="inline" id="S3.SS2.p1.m5"><semantics><mn>2</mn><annotation encoding="application/x-tex">2</annotation><annotation encoding="application/x-llamapun">2</annotation></semantics></math>. Some theory about CTRL is given in <a class="ltx_ref" href="Ch5.html#Thmtheorem1" title="Theorem 5.1 ([PPC+23], Abridged). ‣ 5.2.2 A Mixture of Low-Dimensional Gaussians ‣ 5.2 Learning Self-Consistent Representations ‣ Chapter 5 Consistent and Self-Consistent Representations ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Theorem</span> <span class="ltx_text ltx_ref_tag">5.1</span></a>.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">A.4 </span>Exercises</h2>
<div class="ltx_theorem ltx_theorem_exercise" id="Thmexercise1">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Exercise A.1</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexercise1.p1">
<p class="ltx_p">We have shown that for a smooth function <math alttext="f" class="ltx_Math" display="inline" id="Thmexercise1.p1.m1"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation><annotation encoding="application/x-llamapun">italic_f</annotation></semantics></math>, gradient descent converges linearly to the global optimum if it is strongly convex. However, in general nonconvex optimization, we do not have convexity, let alone strong convexity. Fortunately, in some cases, <math alttext="f" class="ltx_Math" display="inline" id="Thmexercise1.p1.m2"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation><annotation encoding="application/x-llamapun">italic_f</annotation></semantics></math> satisfies the so-called <math alttext="\mu" class="ltx_Math" display="inline" id="Thmexercise1.p1.m3"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation><annotation encoding="application/x-llamapun">italic_μ</annotation></semantics></math>-Polyak-Lojasiewicz (PL) inequality, i.e., there exists a constant <math alttext="\mu&gt;0" class="ltx_Math" display="inline" id="Thmexercise1.p1.m4"><semantics><mrow><mi>μ</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\mu&gt;0</annotation><annotation encoding="application/x-llamapun">italic_μ &gt; 0</annotation></semantics></math> such that for all <math alttext="\theta" class="ltx_Math" display="inline" id="Thmexercise1.p1.m5"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation><annotation encoding="application/x-llamapun">italic_θ</annotation></semantics></math>,</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A2.S3.EGx125">
<tbody id="S4.Ex1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\frac{1}{2}\|\nabla f(\theta)\|_{2}^{2}\geq\mu\left(f(\theta)-f(\theta^{\star})\right)," class="ltx_Math" display="inline" id="S4.Ex1.m1"><semantics><mrow><mrow><mrow><mstyle displaystyle="true"><mfrac><mn>1</mn><mn>2</mn></mfrac></mstyle><mo lspace="0em" rspace="0em">​</mo><msubsup><mrow><mo stretchy="false">‖</mo><mrow><mrow><mo rspace="0.167em">∇</mo><mi>f</mi></mrow><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">‖</mo></mrow><mn>2</mn><mn>2</mn></msubsup></mrow><mo>≥</mo><mrow><mi>μ</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo>(</mo><mrow><mrow><mi>f</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mrow><mo>−</mo><mrow><mi>f</mi><mo lspace="0em" rspace="0em">​</mo><mrow><mo stretchy="false">(</mo><msup><mi>θ</mi><mo>⋆</mo></msup><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>)</mo></mrow></mrow></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\displaystyle\frac{1}{2}\|\nabla f(\theta)\|_{2}^{2}\geq\mu\left(f(\theta)-f(\theta^{\star})\right),</annotation><annotation encoding="application/x-llamapun">divide start_ARG 1 end_ARG start_ARG 2 end_ARG ∥ ∇ italic_f ( italic_θ ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT ≥ italic_μ ( italic_f ( italic_θ ) - italic_f ( italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ) ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p">where <math alttext="\theta^{*}" class="ltx_Math" display="inline" id="Thmexercise1.p1.m6"><semantics><msup><mi>θ</mi><mo>∗</mo></msup><annotation encoding="application/x-tex">\theta^{*}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT</annotation></semantics></math> is a minimizer of <math alttext="f" class="ltx_Math" display="inline" id="Thmexercise1.p1.m7"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation><annotation encoding="application/x-llamapun">italic_f</annotation></semantics></math>.</p>
</div>
<div class="ltx_para" id="Thmexercise1.p2">
<p class="ltx_p">Please show that under the PL inequality and the assumption that <math alttext="f" class="ltx_Math" display="inline" id="Thmexercise1.p2.m1"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation><annotation encoding="application/x-llamapun">italic_f</annotation></semantics></math> is <math alttext="\beta" class="ltx_Math" display="inline" id="Thmexercise1.p2.m2"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation><annotation encoding="application/x-llamapun">italic_β</annotation></semantics></math>-smooth, gradient descent (<a class="ltx_ref" href="#S1.E12" title="Equation A.1.12 ‣ Step-Size Selection ‣ A.1.1 Vanilla Gradient Descent for Smooth Problems ‣ A.1 Steepest Descent ‣ Appendix A Optimization Methods ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">A.1.12</span></a>) converges linearly to <math alttext="\theta^{*}" class="ltx_Math" display="inline" id="Thmexercise1.p2.m3"><semantics><msup><mi>θ</mi><mo>∗</mo></msup><annotation encoding="application/x-tex">\theta^{*}</annotation><annotation encoding="application/x-llamapun">italic_θ start_POSTSUPERSCRIPT ∗ end_POSTSUPERSCRIPT</annotation></semantics></math>.</p>
</div>
</div>
<div class="ltx_theorem ltx_theorem_exercise" id="Thmexercise2">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Exercise A.2</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexercise2.p1">
<p class="ltx_p">Compute the differential and adjoint derivative of the softmax function, defined as follows.</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\operatorname{\mathrm{softmax}}\left(\begin{bmatrix}x_{1}\\
\vdots\\
x_{n}\end{bmatrix}\right)=\frac{1}{\sum_{i=1}^{n}e^{x_{i}}}\begin{bmatrix}x_{1}\\
\vdots\\
x_{n}\end{bmatrix}." class="ltx_Math" display="block" id="S4.E1.m1"><semantics><mrow><mrow><mrow><mi>softmax</mi><mo>⁡</mo><mrow><mo>(</mo><mrow><mo>[</mo><mtable displaystyle="true" rowspacing="0pt"><mtr><mtd><msub><mi>x</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd><mi mathvariant="normal">⋮</mi></mtd></mtr><mtr><mtd><msub><mi>x</mi><mi>n</mi></msub></mtd></mtr></mtable><mo>]</mo></mrow><mo>)</mo></mrow></mrow><mo>=</mo><mrow><mfrac><mn>1</mn><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msup><mi>e</mi><msub><mi>x</mi><mi>i</mi></msub></msup></mrow></mfrac><mo lspace="0em" rspace="0em">​</mo><mrow><mo>[</mo><mtable displaystyle="true" rowspacing="0pt"><mtr><mtd><msub><mi>x</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd><mi mathvariant="normal">⋮</mi></mtd></mtr><mtr><mtd><msub><mi>x</mi><mi>n</mi></msub></mtd></mtr></mtable><mo>]</mo></mrow></mrow></mrow><mo lspace="0em">.</mo></mrow><annotation encoding="application/x-tex">\operatorname{\mathrm{softmax}}\left(\begin{bmatrix}x_{1}\\
\vdots\\
x_{n}\end{bmatrix}\right)=\frac{1}{\sum_{i=1}^{n}e^{x_{i}}}\begin{bmatrix}x_{1}\\
\vdots\\
x_{n}\end{bmatrix}.</annotation><annotation encoding="application/x-llamapun">roman_softmax ( [ start_ARG start_ROW start_CELL italic_x start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_CELL end_ROW start_ROW start_CELL ⋮ end_CELL end_ROW start_ROW start_CELL italic_x start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT end_CELL end_ROW end_ARG ] ) = divide start_ARG 1 end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT italic_e start_POSTSUPERSCRIPT italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUPERSCRIPT end_ARG [ start_ARG start_ROW start_CELL italic_x start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT end_CELL end_ROW start_ROW start_CELL ⋮ end_CELL end_ROW start_ROW start_CELL italic_x start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT end_CELL end_ROW end_ARG ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(A.4.1)</span></td>
</tr></tbody>
</table>
</div>
</div>
<div class="ltx_theorem ltx_theorem_exercise" id="Thmexercise3">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Exercise A.3</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexercise3.p1">
<p class="ltx_p">Carry through the backpropagation computation for a <math alttext="L" class="ltx_Math" display="inline" id="Thmexercise3.p1.m1"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation><annotation encoding="application/x-llamapun">italic_L</annotation></semantics></math>-layer MLP, as defined in <a class="ltx_ref" href="Ch7.html#S2.SS3" title="7.2.3 Architecture: Vision Transformer ‣ 7.2 Simplified Contrastive Learning ‣ Chapter 7 Learning Representations for Real-World Data ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Section</span> <span class="ltx_text ltx_ref_tag">7.2.3</span></a>.</p>
</div>
</div>
<div class="ltx_theorem ltx_theorem_exercise" id="Thmexercise4">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Exercise A.4</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexercise4.p1">
<p class="ltx_p">Carry through the backpropagation computation for a <math alttext="L" class="ltx_Math" display="inline" id="Thmexercise4.p1.m1"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation><annotation encoding="application/x-llamapun">italic_L</annotation></semantics></math>-layer transformer, as defined in <a class="ltx_ref" href="Ch7.html#S2.SS3" title="7.2.3 Architecture: Vision Transformer ‣ 7.2 Simplified Contrastive Learning ‣ Chapter 7 Learning Representations for Real-World Data ‣ Learning Deep Representations of Data Distributions"><span class="ltx_text ltx_ref_tag">Section</span> <span class="ltx_text ltx_ref_tag">7.2.3</span></a>.</p>
</div>
</div>
<div class="ltx_theorem ltx_theorem_exercise" id="Thmexercise5">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_italic">Exercise A.5</span></span><span class="ltx_text ltx_font_italic">.</span>
</h6>
<div class="ltx_para" id="Thmexercise5.p1">
<p class="ltx_p">Carry through the backpropagation computation for an autoencoder with <math alttext="L" class="ltx_Math" display="inline" id="Thmexercise5.p1.m1"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation><annotation encoding="application/x-llamapun">italic_L</annotation></semantics></math> encoder layers and <math alttext="L" class="ltx_Math" display="inline" id="Thmexercise5.p1.m2"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation><annotation encoding="application/x-llamapun">italic_L</annotation></semantics></math> decoder layers (without necessarily specifying an architecture).</p>
</div>
</div>
</section>
</section>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Mon Aug 18 12:37:23 2025 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
